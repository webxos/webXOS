<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRIOS by WebXOS (beta)</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.20.15/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .neon-green { box-shadow: 0 0 5px rgba(34, 197, 94, 0.7), 0 0 10px rgba(34, 197, 94, 0.4); }
        .neon-red { box-shadow: 0 0 5px rgba(239, 68, 68, 0.7), 0 0 10px rgba(239, 68, 68, 0.4); }
        .grid-dot:hover { transform: scale(1.2); transition: transform 0.2s; }
        .chromatic-knob {
            transition: background-color 0.3s;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 font-mono min-h-screen flex flex-col">
    <div id="root" class="flex-grow"></div>
    <script type="text/babel">
        const AgentConsole = ({ id, runAll, stopAll, vectorAngle }) => {
            const initialState = {
                input: '',
                messages: [],
                isPromptOpen: false,
                isApiOpen: false,
                promptInput: '',
                isTraining: false,
                stats: { wins: 0, losses: 0, draws: 0, score: 0, moves: 0, thinkTime: 0, trainingData: 0 },
                grid: Array(10).fill().map(() => Array(10).fill().map(() => ({
                    color: ['green', 'red', 'blue'][Math.floor(Math.random() * 3)],
                    active: Math.random() > 0.7
                })))
            };
            const [state, setState] = React.useState(initialState);

            React.useEffect(() => {
                if (runAll && !state.isTraining) {
                    setState(prev => ({ ...prev, isTraining: true, messages: [...prev.messages, { type: 'bot', text: `Agent ${id}: Started 24/7 training` }], stats: { ...prev.stats, thinkTime: prev.stats.thinkTime + 1 } }));
                }
                if (stopAll && state.isTraining) {
                    setState(prev => ({ ...prev, isTraining: false, messages: [...prev.messages, { type: 'bot', text: `Agent ${id}: Paused training` }] }));
                }
            }, [runAll, stopAll]);

            React.useEffect(() => {
                setState(prev => ({ ...prev, messages: [...prev.messages, { type: 'bot', text: `Agent ${id}: Vector angle adjusted to ${vectorAngle}°` }] }));
            }, [vectorAngle]);

            const handleExecute = (e) => {
                e.preventDefault();
                if (state.input.trim()) {
                    setState(prev => ({
                        ...prev,
                        messages: [...prev.messages, { type: 'user', text: prev.input }, { type: 'bot', text: `Agent ${id}: Training on "${prev.input}"` }],
                        stats: { ...prev.stats, moves: prev.stats.moves + 1, trainingData: prev.stats.trainingData + prev.input.length },
                        grid: prev.grid.map(row => row.map(cell => ({ ...cell, active: Math.random() > 0.5 ? !cell.active : cell.active }))),
                        input: ''
                    }));
                }
            };

            const handlePromptSubmit = (e) => {
                e.preventDefault();
                if (state.promptInput.trim()) {
                    setState(prev => ({
                        ...prev,
                        messages: [...prev.messages, { type: 'user', text: `Prompt: ${prev.promptInput}` }, { type: 'bot', text: `Agent ${id}: Injected prompt "${prev.promptInput}"` }],
                        stats: { ...prev.stats, trainingData: prev.stats.trainingData + prev.promptInput.length },
                        promptInput: '',
                        isPromptOpen: false
                    }));
                }
            };

            const handleExport = () => {
                const data = JSON.stringify({ stats: state.stats, messages: state.messages });
                const blob = new Blob([data], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `agent_${id}_model.json`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const handleImport = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const data = JSON.parse(event.target.result);
                        setState(prev => ({ ...prev, stats: data.stats, messages: data.messages }));
                    };
                    reader.readAsText(file);
                }
            };

            const toggleTraining = () => {
                setState(prev => ({
                    ...prev,
                    isTraining: !prev.isTraining,
                    messages: [...prev.messages, { type: 'bot', text: `Agent ${id}: ${!prev.isTraining ? 'Started 24/7 training' : 'Paused training'}` }],
                    stats: { ...prev.stats, thinkTime: !prev.isTraining ? prev.stats.thinkTime + 1 : prev.stats.thinkTime }
                }));
            };

            const resetAgent = () => {
                setState(initialState);
                setState(prev => ({ ...prev, messages: [{ type: 'bot', text: `Agent ${id}: Reset to boilerplate template` }] }));
            };

            return (
                <div className="border border-gray-700 rounded-lg p-4 mb-4 bg-gray-800">
                    <h2 className="text-lg font-bold mb-2 text-blue-400">Agent {id} QNN Training</h2>
                    <div className="grid grid-cols-10 gap-1 mb-4">
                        {state.grid.map((row, i) =>
                            row.map((cell, j) => (
                                <div
                                    key={`${i}-${j}`}
                                    className={`w-8 h-8 grid-dot ${cell.active ? `bg-${cell.color}-500` : 'bg-gray-700'} rounded-full`}
                                    title={`X:${j}, Y:${i}`}
                                    onClick={() => {
                                        setState(prev => {
                                            const newGrid = prev.grid.map(row => row.slice());
                                            newGrid[i][j].active = !newGrid[i][j].active;
                                            return { ...prev, grid: newGrid };
                                        });
                                    }}
                                ></div>
                            ))
                        )}
                    </div>
                    <div className="h-64 overflow-y-auto mb-4 p-2 bg-gray-900 border border-gray-600 rounded">
                        {state.messages.map((msg, idx) => (
                            <div key={idx} className={`mb-2 ${msg.type === 'user' ? 'text-green-400' : 'text-gray-300'}`}>
                                {msg.type === 'user' ? 'You: ' : `Agent ${id}: `}{msg.text}
                            </div>
                        ))}
                    </div>
                    <div className="flex space-x-2 mb-2">
                        <button
                            onClick={toggleTraining}
                            className={`px-4 py-2 ${state.isTraining ? 'bg-red-600 neon-red' : 'bg-green-600 neon-green'} hover:${state.isTraining ? 'bg-red-500' : 'bg-green-500'} rounded text-white`}
                        >
                            {state.isTraining ? 'STOP' : 'PLAY'}
                        </button>
                        <button onClick={handleExecute} className="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-white">execute</button>
                        <button onClick={() => setState(prev => ({ ...prev, isPromptOpen: true }))} className="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-white">prompt</button>
                        <button onClick={() => setState(prev => ({ ...prev, isApiOpen: true }))} className="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-white">api</button>
                    </div>
                    <div className="flex space-x-2 mb-2">
                        <button onClick={resetAgent} className="px-4 py-2 bg-red-600 neon-red hover:bg-red-500 rounded text-white">X</button>
                        <label className="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded text-white cursor-pointer">
                            Upload
                            <input type="file" className="hidden" onChange={handleImport} />
                        </label>
                        <button onClick={handleExport} className="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded text-white">Export</button>
                    </div>
                    <div className="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <h3 className="text-blue-400 font-bold">Agent {id} Stats</h3>
                            <p>Wins: {state.stats.wins}</p>
                            <p>Losses: {state.stats.losses}</p>
                            <p>Draws: {state.stats.draws}</p>
                            <p>Score %: {state.stats.moves ? ((state.stats.wins / state.stats.moves) * 100).toFixed(1) : 0}%</p>
                            <p>Moves Made: {state.stats.moves}</p>
                            <p>Avg. Think Time: {state.stats.thinkTime}s</p>
                            <p>Training Data: {state.stats.trainingData} KB</p>
                            <p>Vector Angle: {vectorAngle}°</p>
                        </div>
                    </div>
                    {state.isPromptOpen && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                            <div className="bg-gray-800 p-4 rounded-lg w-96">
                                <h3 className="text-lg font-bold mb-2 text-blue-400">Inject Prompt for Agent {id}</h3>
                                <textarea
                                    value={state.promptInput}
                                    onChange={(e) => setState(prev => ({ ...prev, promptInput: e.target.value }))}
                                    className="w-full h-32 p-2 bg-gray-900 border border-gray-600 rounded text-gray-100 mb-2"
                                    placeholder="Enter custom prompt..."
                                ></textarea>
                                <div className="flex space-x-2">
                                    <button onClick={handlePromptSubmit} className="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-white">Submit</button>
                                    <button onClick={() => setState(prev => ({ ...prev, isPromptOpen: false }))} className="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded text-white">Cancel</button>
                                </div>
                            </div>
                        </div>
                    )}
                    {state.isApiOpen && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                            <div className="bg-gray-800 p-4 rounded-lg w-96">
                                <h3 className="text-lg font-bold mb-2 text-blue-400">API Integration (BETA)</h3>
                                <p className="mb-2">To connect a backend with Netlify and GitHub:</p>
                                <ol className="list-decimal pl-4 mb-2">
                                    <li>Create a GitHub repository for your backend.</li>
                                    <li>Deploy it on Netlify via GitHub integration.</li>
                                    <li>Use Netlify Functions to handle API requests.</li>
                                    <li>Configure CORS and environment variables in Netlify.</li>
                                    <li>Call the API from TRIOS using fetch().</li>
                                </ol>
                                <button onClick={() => setState(prev => ({ ...prev, isApiOpen: false }))} className="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded text-white">Close</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const App = () => {
            const [runAll, setRunAll] = React.useState(false);
            const [stopAll, setStopAll] = React.useState(false);
            const [isHelpOpen, setIsHelpOpen] = React.useState(false);
            const [sliderValue, setSliderValue] = React.useState(0);

            const getKnobColor = (value) => {
                const colors = [
                    { pos: 0, color: 'rgb(255, 0, 0)' }, // Red
                    { pos: 16.67, color: 'rgb(255, 165, 0)' }, // Orange
                    { pos: 33.33, color: 'rgb(255, 255, 0)' }, // Yellow
                    { pos: 50, color: 'rgb(0, 255, 0)' }, // Green
                    { pos: 66.67, color: 'rgb(0, 0, 255)' }, // Blue
                    { pos: 83.33, color: 'rgb(75, 0, 130)' }, // Indigo
                    { pos: 100, color: 'rgb(148, 0, 211)' } // Violet
                ];
                const scaledValue = (value / 100) * 100;
                for (let i = 0; i < colors.length - 1; i++) {
                    if (scaledValue >= colors[i].pos && scaledValue <= colors[i + 1].pos) {
                        const ratio = (scaledValue - colors[i].pos) / (colors[i + 1].pos - colors[i].pos);
                        const startColor = colors[i].color.match(/\d+/g).map(Number);
                        const endColor = colors[i + 1].color.match(/\d+/g).map(Number);
                        const r = Math.round(startColor[0] + (endColor[0] - startColor[0]) * ratio);
                        const g = Math.round(startColor[1] + (endColor[1] - startColor[1]) * ratio);
                        const b = Math.round(startColor[2] + (endColor[2] - startColor[2]) * ratio);
                        return `rgb(${r}, ${g}, ${b})`;
                    }
                }
                return colors[colors.length - 1].color;
            };

            const vectorAngle = Math.round((sliderValue / 100) * 360);

            return (
                <div className="p-4">
                    <h1 className="text-2xl font-bold text-blue-400 mb-4">TRIOS by WebXOS (BETA)</h1>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <AgentConsole id={1} runAll={runAll} stopAll={stopAll} vectorAngle={vectorAngle} />
                        <AgentConsole id={2} runAll={runAll} stopAll={stopAll} vectorAngle={vectorAngle} />
                        <AgentConsole id={3} runAll={runAll} stopAll={stopAll} vectorAngle={vectorAngle} />
                    </div>
                    <div className="mt-4 p-4 bg-gray-800 border border-gray-700 rounded-lg flex justify-between items-center">
                        <div className="flex space-x-2">
                            <button
                                onClick={() => { setRunAll(true); setStopAll(false); }}
                                className="px-4 py-2 bg-green-600 neon-green hover:bg-green-500 rounded text-white"
                            >
                                RUN ALL
                            </button>
                            <button
                                onClick={() => { setStopAll(true); setRunAll(false); }}
                                className="px-4 py-2 bg-red-600 neon-red hover:bg-red-500 rounded text-white"
                            >
                                STOP ALL
                            </button>
                            <button
                                onClick={() => window.location.reload()}
                                className="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded text-white"
                            >
                                RESET ALL
                            </button>
                            <button
                                onClick={() => setIsHelpOpen(true)}
                                className="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-white"
                            >
                                HELP
                            </button>
                        </div>
                        <div className="flex items-center">
                            <input
                                type="range"
                                min="0"
                                max="100"
                                value={sliderValue}
                                onChange={(e) => setSliderValue(e.target.value)}
                                className="w-32 h-2 bg-gray-700 rounded-lg cursor-pointer"
                            />
                            <div
                                className="chromatic-knob ml-2"
                                style={{ backgroundColor: getKnobColor(sliderValue) }}
                            ></div>
                        </div>
                    </div>
                    <footer className="mt-4 text-center text-gray-400">
                        © 2025 WebXOS (BETA)| <a href="https://x.com/webxos" className="text-blue-400 hover:underline">x.com/webxos</a> | <a href="https://webxos.netlify.app" className="text-blue-400 hover:underline">webxos.netlify.app</a>
                    </footer>
                    {isHelpOpen && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                            <div className="bg-gray-800 p-4 rounded-lg w-96">
                                <h3 className="text-lg font-bold mb-2 text-blue-400">TRIOS User Manual</h3>
                                <p className="mb-2">TRIOS (BETA) by WebXOS 2025 is a lightweight 3x agent QNN training OS.</p>
                                <ul className="list-disc pl-4 mb-2">
                                    <li>Click grid dots to toggle activation (green/red/blue).</li>
                                    <li>Use PLAY/STOP to start/pause training per agent.</li>
                                    <li>Execute inputs or inject prompts via the PROMPT button.</li>
                                    <li>API button provides backend integration steps.</li>
                                    <li>Export/Import models using JSON files.</li>
                                    <li>Reset individual agents with the red X button.</li>
                                    <li>Use RUN ALL/STOP ALL for global training control.</li>
                                    <li>Slide the chromatic knob to adjust vector angle (0-360°) for all agents.</li>
                                </ul>
                                <p className="mb-2">Developed by WebXOS 2025:</p>
                                <p><a href="https://x.com/webxos" className="text-blue-400 hover:underline">x.com/webxos</a></p>
                                <p><a href="https://webxos.netlify.app" className="text-blue-400 hover:underline">webxos.netlify.app</a></p>
                                <button
                                    onClick={() => setIsHelpOpen(false)}
                                    className="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded text-white mt-2"
                                >
                                    Close
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
