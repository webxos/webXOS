<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>edTV: CHANNEL 11</title>
    <meta name="theme-color" content="#000000">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Press Start 2P',cursive;image-rendering:pixelated}
        body{background:#000;color:#0f0;overflow:hidden;height:100vh;user-select:none;-webkit-tap-highlight-color:transparent}
        #appContainer{position:relative;width:100%;height:100vh;overflow:hidden}
        .matrix-grid{position:absolute;inset:0;background:linear-gradient(rgba(0,255,0,0.1)1px,transparent 1px),linear-gradient(90deg,rgba(0,255,0,0.1)1px,transparent 1px);background-size:16px 16px;opacity:0.3}
        .crt-overlay{position:absolute;inset:0;background:linear-gradient(to bottom,transparent 50%,rgba(0,20,0,0.1)50%);background-size:100% 4px;z-index:5;pointer-events:none;animation:scanline 8s linear infinite}
        @keyframes scanline{0%{background-position:0 0}100%{background-position:0 100%}}
        .infrared-scanner{position:absolute;left:0;width:100%;height:4px;background:rgba(255,0,0,0.8);box-shadow:0 0 20px 5px rgba(255,0,0,0.8);z-index:3;animation:scanner 4s linear infinite}
        @keyframes scanner{0%{top:0}50%{top:100%}100%{top:0}}

        /* Top Banner */
        .top-banner{position:absolute;top:0;left:0;width:100%;height:50px;background:rgba(255,0,255,0.9);border-bottom:2px solid #f0f;display:flex;align-items:center;justify-content:center;z-index:12}
        .top-banner-text{font-size:13px;color:#000;text-shadow:1px 1px 0 #fff;letter-spacing:1px}

        /* Top-Right Buttons */
        .top-controls{position:absolute;top:52px;right:8px;display:flex;gap:8px;z-index:20}
        .btn{height:38px;min-width:90px;background:#000;border:2px solid #0ff;color:#0ff;font-size:9px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:0.2s}
        .btn:hover,.btn:active{background:#0ff;color:#000}
        .btn.style{border-color:#ff0;color:#ff0}
        .btn.style:hover{background:#ff0;color:#000}
        .btn.disabled{opacity:0.5;pointer-events:none}

        /* PIP Webcam */
        .ppv-face-view{position:absolute;top:55px;left:50%;transform:translateX(-50%);width:260px;height:195px;background:#000;border:3px solid #f00;z-index:18;overflow:hidden;cursor:pointer;box-shadow:0 0 20px rgba(255,0,0,0.7)}
        .ppv-face-view.enlarged{width:100%;height:100%;top:0;left:0;transform:none;z-index:30}
        .ppv-canvas{width:100%;height:100%}

        /* Red Scanner inside PIP */
        .scanner{position:absolute;top:0;left:0;width:100%;height:4px;background:rgba(255,0,0,0.9);box-shadow:0 0 15px 3px #f00;z-index:19;opacity:0;animation:scanner 2s linear infinite}
        .scanner.active{opacity:1}

        /* ASCII Overlay Canvas (full screen) */
        #asciiCanvas{position:absolute;inset:0;pointer-events:none;z-index:10}

        /* Terminal */
        .terminal-panel{position:absolute;bottom:0;left:0;width:100%;height:120px;background:rgba(0,0,0,0.95);border-top:2px solid #f00;display:flex;flex-direction:column;z-index:15}
        .terminal-body{flex:1;overflow-y:auto;padding:6px 8px;color:#ff5555;font-size:6px;line-height:1.3;background:repeating-linear-gradient(0deg,#000 0px,#000 1px,#0a0a0a 1px,#0a0a0a 2px);display:flex;flex-direction:column-reverse}
        .log-line{margin-bottom:2px;word-break:break-all}
        .log-success{color:#33ff33}
        .log-data{color:#ffff55}
        .log-badge{color:#0ff;font-weight:bold}

        @media (max-width:767px){
            .top-controls{top:50px;right:5px;gap:6px}
            .btn{height:36px;min-width:78px;font-size:8px}
            .ppv-face-view{top:52px;width:200px;height:150px}
            .terminal-panel{height:100px}
            .terminal-body{font-size:5.5px;padding:5px}
        }
    </style>
</head>
<body>
<div id="appContainer">
    <div class="matrix-grid"></div>
    <div class="crt-overlay"></div>
    <div class="infrared-scanner"></div>

    <!-- Top Banner -->
    <div class="top-banner">
        <div class="top-banner-text">edTV: CHANNEL 11</div>
    </div>

    <!-- Controls -->
    <div class="top-controls">
        <button id="activateBtn" class="btn">ACTIVATE</button>
        <button id="styleBtn" class="btn style">STYLE: 1</button>
    </div>

    <!-- PIP Webcam -->
    <div class="ppv-face-view" id="ppvFaceView">
        <canvas class="ppv-canvas" id="ppvCanvas"></canvas>
        <div class="scanner" id="scanner"></div>
    </div>

    <!-- ASCII Overlay -->
    <canvas id="asciiCanvas"></canvas>

    <!-- Terminal -->
    <div class="terminal-panel">
        <div class="terminal-body" id="terminalLog">
            <div class="log-line log-success">> SYSTEM ONLINE - ASCII MASK READY</div>
            <div <div class="log-line">> DOUBLE-CLICK PIP TO ENLARGE</div>
        </div>
    </div>
</div>

<video id="video" autoplay playsinline style="display:none"></video>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.21.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazeface@0.0.7"></script>

<script>
    const video = document.getElementById('video');
    const ppvCanvas = document.getElementById('ppvCanvas');
    const ppvCtx = ppvCanvas.getContext('2d');
    const asciiCanvas = document.getElementById('asciiCanvas');
    const actx = asciiCanvas.getContext('2d');
    const logEl = document.getElementById('terminalLog');
    const activateBtn = document.getElementById('activateBtn');
    const styleBtn = document.getElementById('styleBtn');
    const scanner = document.getElementById('scanner');
    const ppvFaceView = document.getElementById('ppvFaceView');

    let model, active = false, currentStyle = 0;

    const asciiMasks = [
`    /\\\\\\\\\\    
   /  ****  \\\  
  /  ******  \\\ 
 /____________\\\\
|  ▓▓▓▓▓▓▓▓▓  |
|  ████████  |
 \\            /
  \\\\________/`,

`   ╔═════════╗  
   ║  ●  ●  ║  
   ║   ──   ║  
   ║  ▄▄▄▄  ║  
   ╚═════════╝`,

`   ┌─────────┐
   │  ◉  ◉  │
   │    ▃    │
   │  ╔═══╗  │
   └─────────┘`,

`   ░░░░░░░░░░░
  ░░███████░░░
  ░░██░░░██░░░
  ░░███████░░░
  ░░░░░░░░░░░░`
    ];

    function log(msg, type = '') {
        const line = document.createElement('div');
        line.className = `log-line ${type}`;
        line.textContent = '> ' + msg;
        logEl.appendChild(line);
        logEl.scrollTop = logEl.scrollHeight;
    }

    function resize() {
        ppvCanvas.width = ppvFaceView.clientWidth;
        ppvCanvas.height = ppvFaceView.clientHeight;
        asciiCanvas.width = innerWidth;
        asciiCanvas.height = innerHeight;
    }

    async function start() {
        if (active) return;
        activateBtn.classList.add('disabled');
        activateBtn.textContent = 'LOCKING...';
        scanner.classList.add('active');
        log('INITIALIZING NEON ASCII MASK', 'log-success');

        try {
            model = await blazeface.load();
            const stream = await navigator.mediaDevices.getUserMedia({video: {facingMode: 'user'}});
            video.srcObject = stream;
            video.play();

            active = true;
            activateBtn.textContent = 'ACTIVE';
            log('ASCII MASK ONLINE - FACE DETECTED', 'log-success');
            detectFrame();
        } catch (e) {
            log('CAMERA ACCESS DENIED', 'log-error');
            activateBtn.classList.remove('disabled');
            activateBtn.textContent = 'ACTIVATE';
            scanner.classList.remove('active');
        }
    }

    function detectFrame() {
        if (!active) return;

        ppvCtx.drawImage(video, 0, 0, ppvCanvas.width, ppvCanvas.height);
        actx.clearRect(0, 0, asciiCanvas.width, asciiCanvas.height);

        model.estimateFaces(video, false).then(predictions => {
            if (predictions.length > 0) {
                const face = predictions[0];
                const scaleX = innerWidth / video.videoWidth;
                const scaleY = innerHeight / video.videoHeight;
                const size = (face.bottomRight[0] - face.topLeft[0]) * scaleX * 1.8;
                const x = face.topLeft[0] * scaleX - size / 6;
                const y = face.topLeft[1] * scaleY - size / 12;

                actx.font = `${size / 9}px 'Press Start 2P'`;
                actx.fillStyle = '#0f0';
                actx.shadowBlur = 30;
                actx.shadowColor = '#0f0';
                actx.textAlign = 'left';

                const lines = asciiMasks[currentStyle].split('\n');
                lines.forEach((line, i) => {
                    actx.fillText(line.trim(), x, y + i * (size / 9));
                });
            }
            requestAnimationFrame(detectFrame);
        });
    }

    styleBtn.onclick = () => {
        currentStyle = (currentStyle + 1) % asciiMasks.length;
        styleBtn.textContent = `STYLE: ${currentStyle + 1}`;
        log(`ASCII MASK STYLE ${currentStyle + 1} ENGAGED`, 'log-data');
    };

    activateBtn.onclick = start;
    ppvFaceView.ondblclick = () => ppvFaceView.classList.toggle('enlarged');
    window.onresize = resize;
    window.onload = () => {
        resize();
        log('CHANNEL 11 BROADCAST READY', 'log-badge');
    };
</script>
</body>
</html>
