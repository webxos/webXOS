<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>edTV: CHANNEL 11 // ASCII VR MASK v2</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  body{background:#000;color:#0f0;font-family:'Courier New',monospace;overflow:hidden;height:100vh;user-select:none}
  #container{position:relative;width:100%;height:100%}
  video,#ascii{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
    width:min(92vw,720px);aspect-ratio:4/3;border:6px solid #0f0;box-shadow:0 0 90px #0f0;border-radius:4px}
  #ascii{z-index:10;pointer-events:none;background:transparent}
  .banner{position:absolute;top:0;width:100%;height:50px;background:#0f0;color:#000;
    font:bold 18px 'Courier New';letter-spacing:6px;display:flex;align-items:center;justify-content:center;
    box-shadow:0 0 40px #0f0;z-index:100;animation:blink 2s infinite}
  @keyframes blink{0%,100%{opacity:1}50%{opacity:0.4}}
  .active .banner{background:#000;color:#0f0;animation:glitch .07s infinite}
  @keyframes glitch{0%,100%{clip-path:polygon(0 0,100% 0,100% 100%,0 100%)}50%{clip-path:polygon(0 40%,100% 20%,100% 80%,0 60%)}}
  button{position:absolute;bottom:30px;left:50%;transform:translateX(-50%);
    background:#000;color:#0f0;border:4px solid #0f0;padding:16px 40px;font:bold 18px 'Courier New';
    letter-spacing:4px;cursor:pointer;box-shadow:0 0 30px #0f0;z-index:100}
  button:active{background:#0f0;color:#000}
  #switch{position:absolute;top:60px;left:50%;transform:translateX(-50%);color:#0f0;font-size:14px;z-index:100;cursor:pointer}
</style>
</head>
<body>
<div id="container">
  <div class="banner">edTV: CHANNEL 11 // ASCII VR MASK v2</div>
  <div id="switch">STYLE: 1 (click to cycle)</div>
  <video id="video" autoplay playsinline muted></video>
  <canvas id="ascii"></canvas>
  <button id="start">ACTIVATE</button>
</div>

<script type="module">
import {FaceDetection, FilesetResolver} from 'https://cdn.jsdelivr.net/npm/@tensorflow-models/face-detection@0.1.0';
import '@tensorflow/tfjs-backend-webgl';

const video = document.getElementById('video');
const canvas = document.getElementById('ascii');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('start');
const switchEl = document.getElementById('switch');

const MASKS = [
` ▄▄▄▄▄▄▄▄▄▄▄
   ▄█████████████▄
  ▄███▓▓▓▓▓▓▓▓▓▓▓▓██▄
 ███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓███
 ███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓███
███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓███
███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓███
 ███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓███
  ███▓▓▓▓▓▓▓▓▓▓▓▓▓███
   ▀███▓▓▓▓▓▓▓▓▓███▀
     ▀████████████▀`,
` ▓▓▓▓▓▓▓▓▓▓▓▓▓
  ▓▓▓▓████████████▓▓
 ▓▓██▓▓▓▓▓▓▓▓▓▓▓▓██▓▓
▓██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██▓
██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██
██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██
██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██
 ██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██
  ██▓▓▓▓▓▓▓▓▓▓▓▓▓██
   ▀▀████████████▀▀`,
` ╔═╗╔═╗╔═╗╔═╗
   ║║║║║║║║║║║║
   ╚╦╝╚╦╝╚╦╝╚╦╝
   ╔╩╗╔╩╗╔╩╗╔╩╗
   ╚═╝╚═╝╚═╝╚═╝
   ╔═╗╔═╗╔═╗╔═╗
   ║█║║█║║█║║█║`,
` ▄▄▀▀▀▀▀▄▄
   ▄▀ ▄▄▄▄ ▀▄
  █ ▄▀ ▀▄ ▀▄ █
 █ █ █▄█ █▄█ █ █
 █ ▀▀▀ ▀▀▀ █
  █ ▄▄▄▄▄ █
   ▀▄ ▄▀
     ▀▄▄▄▄▄▀`
];

let detector, currentMask = 0, running = false;

async function start() {
  startBtn.remove();
  document.body.classList.add('active');

  const stream = await navigator.mediaDevices.getUserMedia({video: {facingMode: "user"}});
  video.srcObject = stream;
  await video.play();

  canvas.width = video.videoWidth || 640;
  canvas.height = video.videoHeight || 480;
  canvas.style.width = video.style.width;
  canvas.style.height = video.style.height;

  const vision = await FilesetResolver.forVisionTasks(
    "https://cdn.jsdelivr.net/npm/@tensorflow-models/face-detection@0.1.0/wasm"
  );

  detector = await FaceDetection.createDetector(FaceDetection.SupportedModels.BlazeFace, {
    runtime: 'tfjs',
    maxFaces: 1
  });

  running = true;
  draw();
}

function draw() {
  if (!running) return;

  ctx.fillStyle = 'rgba(0,0,0,0.4)';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  detector.detect(video).then(results => {
    if (results.length > 0) {
      const box = results[0].box;
      const centerX = box.xMin + box.width / 2;
      const centerY = box.yMin + box.height / 2;
      const size = box.width * 1.8;

      const lines = MASKS[currentMask].split('\n').filter(l => l.trim());
      const fontSize = size / lines.length * 1.1;

      ctx.font = `bold ${fontSize}px 'Courier New'`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillStyle = '#0f0';
      ctx.strokeStyle = '#000';
      ctx.lineWidth = fontSize * 0.15;

      lines.forEach((line, i) => {
        const y = centerY + (i - lines.length / 2) * fontSize * 0.9;
        ctx.strokeText(line, centerX, y);
        ctx.fillText(line, centerX, y);
      });
    }
  });

  requestAnimationFrame(draw);
}

switchEl.onclick = () => {
  currentMask = (currentMask + 1) % MASKS.length;
  switchEl.textContent = `STYLE: ${currentMask + 1} (click to cycle)`;
};

startBtn.onclick = start;
</script>
</body>
</html>
