<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEBXOS CHATBOT</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --neon-green: #39FF14;
            --dark-green: #0a2e0a;
            --darker-green: #051905;
            --black: #000000;
            --dark-gray: #111111;
            --medium-gray: #1a1a1a;
            --light-gray: #333333;
        }
        
        body {
            background-color: var(--black);
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
        }
        
        .sidebar { 
            width: 250px; 
            background-color: var(--dark-gray); 
            color: #e0e0e0;
            border-right: 1px solid var(--light-gray);
        }
        
        .main-content { 
            flex-grow: 1; 
            background-color: var(--black);
        }
        
        .loading-screen { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: var(--black); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            z-index: 9999; 
            flex-direction: column;
        }
        
        .loading-screen.hidden { display: none; }
        
        .chat-message { 
            margin: 10px; 
            padding: 10px; 
            border-radius: 8px; 
            max-width: 80%; 
            border: 1px solid var(--light-gray);
            white-space: pre-line; 
        }
        
        .user-message { 
            background: var(--dark-green); 
            color: var(--neon-green); 
            margin-left: auto; 
            border: 1px solid var(--neon-green);
        }
        
        .bot-message { 
            background: var(--dark-gray); 
            color: #e0e0e0;
            border: 1px solid var(--light-gray);
        }
        
        .logo { 
            font-weight: bold; 
            font-size: 1.5rem; 
            color: var(--neon-green); 
            text-shadow: 0 0 5px var(--neon-green);
        }
        
        .nav-item { 
            padding: 10px; 
            border-radius: 5px; 
            transition: all 0.3s; 
            margin-bottom: 5px;
        }
        
        .nav-item:hover { 
            background: var(--medium-gray); 
            cursor: pointer; 
            color: var(--neon-green);
        }
        
        .nav-item.active { 
            background: var(--dark-green); 
            color: var(--neon-green);
            box-shadow: 0 0 10px var(--neon-green);
        }
        
        .typing-dot { 
            display: inline-block; 
            width: 8px; 
            height: 8px; 
            border-radius: 50%; 
            background: var(--neon-green); 
            margin: 0 2px; 
            animation: typing 1.4s infinite ease-in-out; 
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
        
        .btn-primary {
            background-color: var(--dark-green);
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            background-color: var(--neon-green);
            color: var(--black);
            box-shadow: 0 0 10px var(--neon-green);
        }
        
        .btn-secondary {
            background-color: var(--dark-gray);
            color: #e0e0e0;
            border: 1px solid var(--light-gray);
            transition: all 0.3s;
        }
        
        .btn-secondary:hover {
            background-color: var(--medium-gray);
            border-color: var(--neon-green);
            color: var(--neon-green);
        }
        
        .panel {
            background-color: var(--dark-gray);
            border: 1px solid var(--light-gray);
            border-radius: 8px;
        }
        
        .training-progress {
            height: 10px;
            background: var(--dark-gray);
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--neon-green);
            transition: width 0.3s;
        }
        
        .file-upload-area {
            border: 2px dashed var(--neon-green);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 10px 0;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .file-upload-area:hover {
            background-color: var(--dark-green);
        }
        
        .file-upload-area.dragover {
            background-color: var(--dark-green);
            border-color: var(--neon-green);
            box-shadow: 0 0 10px var(--neon-green);
        }
        
        .parsed-content {
            max-height: 600px;
            overflow-y: auto;
            margin-top: 10px;
            padding: 10px;
            background: var(--black);
            border-radius: 5px;
            border: 1px solid var(--light-gray);
            font-size: 0.9rem;
            white-space: pre-wrap;
        }
        
        .suggestion-chip {
            background: var(--dark-green);
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .suggestion-chip:hover {
            background: var(--neon-green);
            color: var(--black);
            box-shadow: 0 0 8px var(--neon-green);
        }
        
        .attention-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-template-rows: repeat(12, 1fr);
            gap: 1px;
            width: 200px;
            height: 200px;
            background: var(--dark-gray);
            border: 1px solid var(--neon-green);
            margin: 10px auto;
        }
        
        .attention-cell {
            background: var(--black);
            transition: all 0.1s;
        }
        
        .attention-cell.active {
            background: var(--neon-green);
            box-shadow: 0 0 3px var(--neon-green);
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loading-screen">
        <div class="logo mb-4">WEBXOS CHATBOT</div>
        <div class="neon-text text-xl mb-2">Loading AI Training Environment</div>
        <div class="text-gray-400">Initializing Auto-Training System...</div>
        <div class="w-64 h-2 bg-gray-800 rounded-full mt-4 overflow-hidden">
            <div class="h-full rounded-full loading-bar"></div>
        </div>
    </div>
    
    <div id="app" class="hidden">
        <div class="flex h-screen">
            <!-- Sidebar -->
            <div class="sidebar p-4 flex flex-col">
                <div class="logo mb-8">WEBXOS CHATBOT</div>
                <ul class="flex-grow">
                    <li class="nav-item active" data-nav="chat" onclick="WebXOS.navigate('chat')">
                        <i class="fas fa-comments mr-2"></i>CHAT
                    </li>
                    <li class="nav-item" data-nav="train" onclick="WebXOS.navigate('train')">
                        <i class="fas fa-brain mr-2"></i>TRAIN & MONITOR
                    </li>
                    <li class="nav-item" data-nav="guide" onclick="WebXOS.navigate('guide')">
                        <i class="fas fa-book mr-2"></i>GUIDE
                    </li>
                </ul>
                <div class="mt-auto text-xs text-gray-400 text-center">
                    Auto-Train v2.1<br>Markdown-Only
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="main-content p-4 flex flex-col overflow-hidden">
                <!-- CHAT View -->
                <div id="chat" class="flex flex-col h-full">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold neon-text">AI Assistant</h2>
                        <div class="flex items-center">
                            <div class="mr-4">
                                <span class="neon-text">Training: </span>
                                <span id="training-progress-value">0%</span>
                            </div>
                            <div class="import-btn" onclick="WebXOS.showTrainingPage()">
                                <i class="fas fa-file-import mr-2"></i>Add Markdown Files
                            </div>
                        </div>
                    </div>
                    
                    <div class="training-progress">
                        <div class="progress-bar" id="training-progress-bar" style="width: 0%"></div>
                    </div>
                    
                    <div id="chat-container" class="flex-grow overflow-y-auto p-4 chat-container rounded-lg mb-4">
                        <div class="chat-message bot-message">
                            <div class="font-bold neon-text">AI Assistant</div>
                            <div>Welcome! Upload Markdown files in the Train tab — I’ll instantly turn them into a searchable Knowledge Pack and answer concisely using exact sections.</div>
                        </div>
                    </div>
                    
                    <div class="flex">
                        <input id="chat-input" class="flex-grow p-3 rounded-l" placeholder="Ask anything…" onkeypress="if(event.key === 'Enter') WebXOS.sendChat()">
                        <button class="p-3 btn-primary rounded-r flex items-center" onclick="WebXOS.sendChat()">
                            <i class="fas fa-paper-plane mr-2"></i>Send
                        </button>
                    </div>
                </div>
                
                <!-- TRAIN & MONITOR View -->
                <div id="train" class="flex flex-col h-full hidden overflow-y-auto">
                    <h2 class="text-2xl font-bold mb-4 neon-text">AI Training & Monitoring</h2>
                    <p class="text-gray-400 mb-6">Upload Markdown files — I automatically parse headings as topics and build a hybrid Knowledge Pack for precise answers.</p>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Training Progress -->
                        <div class="panel p-4">
                            <h3 class="text-xl font-semibold mb-3 neon-text">Training Progress</h3>
                            <div class="training-progress mb-4">
                                <div class="progress-bar" id="train-progress-bar" style="width: 0%"></div>
                            </div>
                            <div class="text-center mb-4">
                                <div class="text-3xl font-bold neon-text" id="train-progress-value">0%</div>
                                <div class="text-sm text-gray-400" id="progress-status">No training data added</div>
                            </div>
                            
                            <div class="training-stats">
                                <div class="stat-box">
                                    <div class="text-sm text-gray-400">Sections Learned</div>
                                    <div class="text-xl neon-text" id="data-count">0</div>
                                </div>
                                <div class="stat-box">
                                    <div class="text-sm text-gray-400">Topics</div>
                                    <div class="text-xl neon-text" id="topics-learned">0</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Data Upload -->
                        <div class="panel p-4">
                            <h3 class="text-xl font-semibold mb-3 neon-text">Add Markdown Files</h3>
                            
                            <div class="file-upload-area" id="file-upload-area">
                                <i class="fas fa-file-upload text-3xl mb-2 neon-text"></i>
                                <p class="neon-text">Drag & drop .md files or click</p>
                                <p class="text-xs text-gray-400 mt-1">Markdown only — lighter & faster</p>
                                <input type="file" id="file-input" class="hidden" accept=".md,.markdown" multiple>
                            </div>
                            
                            <div class="file-info hidden" id="file-info">
                                <div class="flex justify-between items-center">
                                    <span id="file-name">File name</span>
                                    <span id="file-size">Size</span>
                                </div>
                            </div>
                            
                            <div class="flex space-x-2 mt-3">
                                <button class="btn-primary flex-1 py-2" id="process-file-btn" onclick="AITrainer.processFiles()" disabled>
                                    <i class="fas fa-cogs mr-2"></i>Auto-Train
                                </button>
                                <button class="btn-secondary flex-1 py-2" onclick="AITrainer.clearFiles()">
                                    <i class="fas fa-times mr-2"></i>Clear
                                </button>
                            </div>

                            <button class="btn-secondary w-full text-left p-2 mt-4" onclick="AITrainer.showKnowledgePackPreview()">
                                <i class="fas fa-eye mr-2"></i>Preview Knowledge Pack
                            </button>

                            <div class="parsed-content hidden" id="parsed-content"></div>
                        </div>
                        
                        <!-- Training Visualization -->
                        <div class="panel p-4">
                            <h3 class="text-xl font-semibold mb-3 neon-text">Live Learning Activity</h3>
                            <div class="attention-grid" id="attention-grid"></div>
                        </div>
                    </div>
                </div>
                
                <!-- GUIDE View (unchanged except Markdown mention) -->
                <div id="guide" class="panel p-6 rounded-lg hidden overflow-y-auto">
                    <h2 class="text-2xl font-bold mb-4 neon-text">WEBXOS AI TRAINING - Guide</h2>
                    <p>Upload Markdown files → I instantly parse headings as topics → build a hybrid Knowledge Pack → answer using exact sections → concise & accurate.</p>
                    <p class="mt-4">Only .md files are supported in this lightweight version (PDF/JSON/TXT removed to reduce size and increase speed).</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const WebXOS = {
            state: new Proxy({ 
                appState: 'chat',
                trainingProgress: 0,
                trainingData: [],
                learnedTopics: []
            }, {
                set(target, key, value) {
                    target[key] = value;
                    if (key === 'trainingProgress') {
                        document.getElementById('training-progress-value').textContent = value + '%';
                        document.getElementById('training-progress-bar').style.width = value + '%';
                        document.getElementById('train-progress-value').textContent = value + '%';
                        document.getElementById('train-progress-bar').style.width = value + '%';
                        document.getElementById('data-count').textContent = WebXOS.state.trainingData.length;
                        document.getElementById('topics-learned').textContent = WebXOS.state.learnedTopics.length;
                    }
                    if (key !== 'appState') {
                        localStorage.setItem(key, JSON.stringify(value));
                    }
                    return true;
                },
                get(target, key) {
                    if (target[key] !== undefined) return target[key];
                    const stored = localStorage.getItem(key);
                    return stored ? JSON.parse(stored) : undefined;
                }
            }),
            
            navigate(view) {
                this.state.appState = view;
                ['chat', 'train', 'guide'].forEach(v => document.getElementById(v).classList.add('hidden'));
                document.getElementById(view).classList.remove('hidden');
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                document.querySelector(`[data-nav="${view}"]`).classList.add('active');
            },
            
            sendChat() {
                const input = document.getElementById('chat-input');
                const message = input.value.trim();
                if (!message) return;
                
                const chatContainer = document.getElementById('chat-container');
                chatContainer.innerHTML += `<div class="chat-message user-message"><div class="font-bold">You</div><div>${message}</div></div>`;
                
                chatContainer.innerHTML += `<div class="chat-message bot-message">
                    <div class="font-bold neon-text">AI Assistant</div>
                    <div class="typing-indicator"><span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span></div>
                </div>`;
                
                chatContainer.scrollTop = chatContainer.scrollHeight;
                input.value = '';
                
                setTimeout(() => {
                    const messages = chatContainer.querySelectorAll('.chat-message');
                    messages[messages.length - 1].remove();
                    const response = AITrainer.generateResponse(message);
                    chatContainer.innerHTML += `<div class="chat-message bot-message">
                        <div class="font-bold neon-text">AI Assistant</div>
                        <div>${response.text}</div>
                        ${response.suggestions ? `<div class="suggestions-container mt-3">${response.suggestions}</div>` : ''}
                    </div>`;
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }, 800 + Math.random() * 800);
            },
            
            useSuggestion(suggestion) {
                document.getElementById('chat-input').value = suggestion;
                this.sendChat();
            },
            
            showTrainingPage() {
                this.navigate('train');
            },
            
            init() {
                const loadingBar = document.querySelector('.loading-bar');
                let width = 0;
                const interval = setInterval(() => {
                    width += 8;
                    loadingBar.style.width = `${width}%`;
                    if (width >= 100) {
                        clearInterval(interval);
                        document.getElementById('loading-screen').classList.add('hidden');
                        document.getElementById('app').classList.remove('hidden');
                    }
                }, 80);
                
                AITrainer.init();
                this.navigate('chat');
            }
        };

        const AITrainer = {
            trainingData: [],
            learnedTopics: [],
            uploadedFiles: [],
            trainingInterval: null,
            
            init() {
                this.trainingData = WebXOS.state.trainingData || [];
                this.learnedTopics = WebXOS.state.learnedTopics || [];
                this.setupFileUpload();
                this.createAttentionGrid();
                this.startVisualization();
                this.updateProgress();
                if (this.trainingData.length > 0) this.showKnowledgePackPreview();
            },
            
            setupFileUpload() {
                const fileUploadArea = document.getElementById('file-upload-area');
                const fileInput = document.getElementById('file-input');
                
                fileUploadArea.addEventListener('click', () => fileInput.click());
                
                fileInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) this.handleFileSelect(Array.from(e.target.files));
                });
                
                fileUploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    fileUploadArea.classList.add('dragover');
                });
                
                ['dragleave', 'dragend'].forEach(ev => {
                    fileUploadArea.addEventListener(ev, () => fileUploadArea.classList.remove('dragover'));
                });
                
                fileUploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    fileUploadArea.classList.remove('dragover');
                    if (e.dataTransfer.files.length > 0) this.handleFileSelect(Array.from(e.dataTransfer.files));
                });
            },
            
            handleFileSelect(files) {
                this.uploadedFiles = files.filter(f => f.name.toLowerCase().endsWith('.md') || f.type === 'text/markdown');
                
                const totalBytes = this.uploadedFiles.reduce((a, f) => a + f.size, 0);
                
                document.getElementById('file-name').textContent = this.uploadedFiles.length === 1 
                    ? this.uploadedFiles[0].name 
                    : `${this.uploadedFiles.length} files selected`;
                document.getElementById('file-size').textContent = this.formatFileSize(totalBytes);
                document.getElementById('file-info').classList.remove('hidden');
                document.getElementById('process-file-btn').disabled = false;
            },
            
            async processFiles() {
                if (this.uploadedFiles.length === 0) return;
                
                const processBtn = document.getElementById('process-file-btn');
                processBtn.disabled = true;
                processBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Training...';
                
                for (const file of this.uploadedFiles) {
                    await this.processSingleFile(file);
                }
                
                this.updateProgress();
                this.showKnowledgePackPreview();
                
                processBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Complete';
                setTimeout(() => {
                    processBtn.innerHTML = '<i class="fas fa-cogs mr-2"></i>Auto-Train';
                    processBtn.disabled = false;
                }, 2000);
            },
            
            async processSingleFile(file) {
                return new Promise(resolve => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.processMarkdownFile(e.target.result, file.name);
                        this.updateProgress();
                        resolve();
                    };
                    reader.readAsText(file);
                });
            },
            
            processMarkdownFile(content, filename) {
                const lines = content.split('\n');
                let currentSection = '';
                let currentContent = [];
                let isCodeBlock = false;
                
                const flush = () => {
                    if (currentContent.length > 0) {
                        const contentText = currentContent.join('\n');
                        if (contentText.trim().length > 10) {
                            const title = currentSection || filename.replace(/\.md$/i, '') || 'Untitled';
                            this.trainingData.push({
                                input: `tell me about ${title}`,
                                response: contentText,
                                meta: { source: filename }
                            });
                            if (!this.learnedTopics.includes(title)) {
                                this.learnedTopics.push(title);
                            }
                        }
                        currentContent = [];
                        currentSection = '';
                    }
                };
                
                for (const line of lines) {
                    const trimmed = line.trim();
                    if (trimmed.startsWith('```')) {
                        isCodeBlock = !isCodeBlock;
                        currentContent.push(line);
                        continue;
                    }
                    if (!isCodeBlock && trimmed.startsWith('#')) {
                        flush();
                        currentSection = line.replace(/^#+\s*/, '').trim();
                    } else {
                        currentContent.push(line);
                    }
                }
                flush();
                
                WebXOS.state.trainingData = this.trainingData;
                WebXOS.state.learnedTopics = this.learnedTopics;
            },
            
            buildKnowledgePack() {
                if (this.trainingData.length === 0) return 'No training data yet.';
                
                const topics = Array.from(new Set(this.trainingData.map(d => d.input.match(/^tell me about (.+)$/i)?.[1] || ''))).filter(Boolean).sort();
                
                const header = [
                    '---',
                    'title: WebXOS Knowledge Pack',
                    `generated: ${new Date().toISOString()}`,
                    `topicsCount: ${topics.length}`,
                    `entries: ${this.trainingData.length}`,
                    '---',
                    '',
                    '# Table of Contents',
                    ...topics.map(t => `- ${t}`),
                    ''
                ].join('\n');
                
                const body = this.trainingData.map(d => {
                    const title = d.input.match(/^tell me about (.+)$/i)?.[1] || 'Untitled';
                    const source = d.meta?.source || 'unknown';
                    return [
                        `## ${title}`,
                        '',
                        d.response,
                        '',
                        `*(Source: ${source})*`,
                        ''
                    ].join('\n');
                }).join('\n');
                
                return header + body;
            },
            
            showKnowledgePackPreview() {
                const md = this.buildKnowledgePack();
                const preview = document.getElementById('parsed-content');
                preview.textContent = md;
                preview.classList.remove('hidden');
            },
            
            clearFiles() {
                this.uploadedFiles = [];
                document.getElementById('file-info').classList.add('hidden');
                document.getElementById('process-file-btn').disabled = true;
                document.getElementById('file-input').value = '';
            },
            
            formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' bytes';
                if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
                return (bytes / 1048576).toFixed(1) + ' MB';
            },
            
            createAttentionGrid() {
                const gridElement = document.getElementById('attention-grid');
                gridElement.innerHTML = '';
                for (let y = 0; y < 12; y++) {
                    for (let x = 0; x < 12; x++) {
                        const cell = document.createElement('div');
                        cell.className = 'attention-cell';
                        gridElement.appendChild(cell);
                    }
                }
            },
            
            updateAttentionGrid() {
                const cells = document.querySelectorAll('.attention-cell');
                cells.forEach(cell => {
                    const value = WebXOS.state.trainingProgress >= 100 ? 0.1 + Math.random() * 0.2 : Math.random();
                    const brightness = Math.floor(value * 100);
                    cell.style.backgroundColor = `hsl(120, 100%, ${brightness}%)`;
                    cell.classList.toggle('active', value > 0.6);
                });
            },
            
            startVisualization() {
                this.trainingInterval = setInterval(() => {
                    this.updateAttentionGrid();
                    if (WebXOS.state.trainingProgress >= 100) {
                        clearInterval(this.trainingInterval);
                    }
                }, 400);
            },
            
            updateProgress() {
                const chars = this.trainingData.reduce((sum, d) => sum + d.response.length, 0);
                const uniqueTopics = this.learnedTopics.length;
                const sectionCount = this.trainingData.length;
                
                const charScore = Math.min(chars / 20000 * 40, 40);
                const sectionScore = Math.min(sectionCount * 2, 30);
                const topicScore = Math.min(uniqueTopics * 2, 20);
                const structureBonus = 10; // always structured Markdown
                
                const newProgress = Math.min(100, Math.round(charScore + sectionScore + topicScore + structureBonus));
                WebXOS.state.trainingProgress = newProgress;
            },
            
            calculateSimilarity(a, b) {
                const tok = s => new Set(s.split(/[^a-z0-9]+/i).filter(Boolean));
                const s1 = tok(a);
                const s2 = tok(b);
                const inter = [...s1].filter(x => s2.has(x)).length;
                const uni = s1.size + s2.size - inter;
                return uni ? inter / uni : 0;
            },
            
            generateResponse(input) {
                const q = input.trim().toLowerCase();
                
                if (this.trainingData.length === 0) {
                    return {
                        text: "No training data yet. Upload Markdown files in the Train tab to get started.",
                        suggestions: '<div class="suggestion-chip" onclick="WebXOS.showTrainingPage()">Go to Training Tab</div>'
                    };
                }
                
                if (q.includes('knowledge pack') || q.includes('show me the knowledge')) {
                    return {
                        text: "Knowledge Pack is in the Training tab. Click the button to view it anytime.",
                        suggestions: '<div class="suggestion-chip" onclick="WebXOS.showTrainingPage()">View Knowledge Pack</div>'
                    };
                }
                
                if (q.includes('topic') && q.includes('learned')) {
                    return {
                        text: `Learned ${this.learnedTopics.length} topics:\n${this.learnedTopics.join(', ')}`,
                        suggestions: '<div class="suggestion-chip" onclick="WebXOS.showTrainingPage()">View Knowledge Pack</div>'
                    };
                }
                
                let best = null;
                let bestScore = 0;
                
                for (const d of this.trainingData) {
                    const match = d.input.match(/^tell me about (.+)$/i);
                    const title = match ? match[1] : '';
                    const titleLower = title.toLowerCase();
                    
                    let score = this.calculateSimilarity(q, titleLower);
                    if (q.includes(titleLower)) score = 1;
                    
                    if (score > bestScore) {
                        bestScore = score;
                        best = d;
                    }
                }
                
                if (best && bestScore > 0.3) {
                    let response = best.response;
                    if (response.length > 1000) {
                        response = response.slice(0, 1000) + '...\n\n(See Knowledge Pack for full section)';
                    }
                    return {
                        text: response,
                        suggestions: this.generateSuggestions()
                    };
                }
                
                return {
                    text: `I don't have exact info on that yet. Closest topics: ${this.learnedTopics.slice(0, 5).join(', ') || 'none'}. Add more Markdown data for better coverage.`,
                    suggestions: this.generateSuggestions()
                };
            },
            
            generateSuggestions() {
                const suggestions = [];
                const topics = this.learnedTopics.slice(0, 3);
                topics.forEach(t => {
                    suggestions.push(`<div class="suggestion-chip" onclick="WebXOS.useSuggestion('tell me about ${t}')">${t}</div>`);
                });
                suggestions.push('<div class="suggestion-chip" onclick="WebXOS.showTrainingPage()">Add More Data</div>');
                suggestions.push('<div class="suggestion-chip" onclick="AITrainer.showKnowledgePackPreview(); WebXOS.navigate(\'train\')">View Knowledge Pack</div>');
                return suggestions.join('');
            }
        };

        window.addEventListener('DOMContentLoaded', () => WebXOS.init());
    </script>
</body>
</html>
