<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WEBXOS AI Training</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
        :root {
            --neon-green: #39FF14;
            --dark-green: #0a2e0a;
            --darker-green: #051905;
            --black: #000000;
            --dark-gray: #111111;
            --medium-gray: #1a1a1a;
            --light-gray: #333333;
        }
        
        body {
            background-color: var(--black);
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
        }
        
        .sidebar { 
            width: 250px; 
            background-color: var(--dark-gray); 
            color: #e0e0e0;
            border-right: 1px solid var(--light-gray);
        }
        
        .main-content { 
            flex-grow: 1; 
            background-color: var(--black);
        }
        
        .loading-screen { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: var(--black); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            z-index: 9999; 
            flex-direction: column;
        }
        
        .loading-screen.hidden { display: none; }
        
        .chat-message { 
            margin: 10px; 
            padding: 10px; 
            border-radius: 8px; 
            max-width: 80%; 
            border: 1px solid var(--light-gray);
        }
        
        .user-message { 
            background: var(--dark-green); 
            color: var(--neon-green); 
            margin-left: auto; 
            border: 1px solid var(--neon-green);
        }
        
        .bot-message { 
            background: var(--dark-gray); 
            color: #e0e0e0;
            border: 1px solid var(--light-gray);
        }
        
        .logo { 
            font-weight: bold; 
            font-size: 1.5rem; 
            color: var(--neon-green); 
            text-shadow: 0 0 5px var(--neon-green);
        }
        
        .nav-item { 
            padding: 10px; 
            border-radius: 5px; 
            transition: all 0.3s; 
            margin-bottom: 5px;
        }
        
        .nav-item:hover { 
            background: var(--medium-gray); 
            cursor: pointer; 
            color: var(--neon-green);
        }
        
        .nav-item.active { 
            background: var(--dark-green); 
            color: var(--neon-green);
            box-shadow: 0 0 10px var(--neon-green);
        }
        
        .api-status { 
            display: inline-block; 
            width: 10px; 
            height: 10px; 
            border-radius: 50%; 
            margin-right: 5px; 
        }
        
        .api-status.connected { 
            background: var(--neon-green); 
            box-shadow: 0 0 5px var(--neon-green);
        }
        
        .api-status.disconnected { 
            background: #EF4444; 
        }
        
        .typing-indicator { display: inline-block; }
        .typing-dot { 
            display: inline-block; 
            width: 8px; 
            height: 8px; 
            border-radius: 50%; 
            background: var(--neon-green); 
            margin: 0 2px; 
            animation: typing 1.4s infinite ease-in-out; 
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
        
        .neon-glow {
            box-shadow: 0 0 5px var(--neon-green), 0 0 10px var(--neon-green), 0 0 15px var(--neon-green);
        }
        
        .neon-border {
            border: 1px solid var(--neon-green);
            box-shadow: 0 0 5px var(--neon-green);
        }
        
        .neon-text {
            color: var(--neon-green);
            text-shadow: 0 0 5px var(--neon-green);
        }
        
        .btn-primary {
            background-color: var(--dark-green);
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            background-color: var(--neon-green);
            color: var(--black);
            box-shadow: 0 0 10px var(--neon-green);
        }
        
        .btn-secondary {
            background-color: var(--dark-gray);
            color: #e0e0e0;
            border: 1px solid var(--light-gray);
            transition: all 0.3s;
        }
        
        .btn-secondary:hover {
            background-color: var(--medium-gray);
            border-color: var(--neon-green);
            color: var(--neon-green);
        }
        
        input, select, textarea {
            background-color: var(--dark-gray);
            color: #e0e0e0;
            border: 1px solid var(--light-gray);
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--neon-green);
            box-shadow: 0 0 5px var(--neon-green);
            outline: none;
        }
        
        .panel {
            background-color: var(--dark-gray);
            border: 1px solid var(--light-gray);
            border-radius: 8px;
        }
        
        .loading-bar {
            background: linear-gradient(90deg, var(--dark-green), var(--neon-green), var(--dark-green));
            background-size: 200% 100%;
            animation: loading 2s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .chat-container {
            background-color: var(--black);
            border: 1px solid var(--light-gray);
        }
        
        .training-progress {
            height: 10px;
            background: var(--dark-gray);
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--neon-green);
            transition: width 0.3s;
        }
        
        .import-btn {
            background-color: var(--dark-green);
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
        }
        
        .import-btn:hover {
            background-color: var(--neon-green);
            color: var(--black);
            box-shadow: 0 0 10px var(--neon-green);
        }

        .file-upload-area {
            border: 2px dashed var(--neon-green);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 10px 0;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .file-upload-area:hover {
            background-color: var(--dark-green);
        }
        
        .file-upload-area.dragover {
            background-color: var(--dark-green);
            border-color: var(--neon-green);
            box-shadow: 0 0 10px var(--neon-green);
        }
        
        .file-info {
            margin-top: 10px;
            padding: 10px;
            background: var(--black);
            border-radius: 5px;
            border: 1px solid var(--light-gray);
        }
        
        .parsing-progress {
            margin-top: 15px;
        }
        
        .parsed-content {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
            padding: 10px;
            background: var(--black);
            border-radius: 5px;
            border: 1px solid var(--light-gray);
            font-size: 0.8rem;
        }

        .suggestions-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            margin-bottom: 5px;
        }
        
        .suggestion-chip {
            background: var(--dark-green);
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .suggestion-chip:hover {
            background: var(--neon-green);
            color: var(--black);
            box-shadow: 0 0 8px var(--neon-green);
        }
        
        .topic-badge {
            display: inline-block;
            background: var(--dark-gray);
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
            border-radius: 12px;
            padding: 4px 8px;
            font-size: 0.7rem;
            margin: 2px;
        }
        
        .interaction-prompt {
            border-left: 3px solid var(--neon-green);
            padding-left: 10px;
            margin: 10px 0;
            font-style: italic;
        }

        .data-suggestion {
            font-style: italic;
            color: var(--neon-green);
            border-left: 2px solid var(--neon-green);
            padding-left: 8px;
            margin: 5px 0;
        }

        .training-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        .stat-box {
            background: var(--dark-gray);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            border: 1px solid var(--light-gray);
        }

        .attention-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-template-rows: repeat(12, 1fr);
            gap: 1px;
            width: 200px;
            height: 200px;
            background: var(--dark-gray);
            border: 1px solid var(--neon-green);
            margin: 10px auto;
        }
        
        .attention-cell {
            background: var(--black);
            border: 1px solid var(--light-gray);
            transition: all 0.1s;
        }
        
        .attention-cell.active {
            background: var(--neon-green);
            box-shadow: 0 0 3px var(--neon-green);
        }

        .training-data-item {
            padding: 8px;
            margin: 5px 0;
            background: var(--dark-gray);
            border-radius: 4px;
            border-left: 3px solid var(--neon-green);
        }

        .error-message {
            background: #7f1d1d;
            color: #fecaca;
            border: 1px solid #ef4444;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .success-message {
            background: var(--dark-green);
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loading-screen">
        <div class="logo mb-4">WEBXOS AI TRAINING</div>
        <div class="neon-text text-xl mb-2">Loading AI Training Environment</div>
        <div class="text-gray-400">Initializing Auto-Training System...</div>
        <div class="w-64 h-2 bg-gray-800 rounded-full mt-4 overflow-hidden">
            <div class="h-full rounded-full loading-bar"></div>
        </div>
    </div>
    
    <div id="app">
        <div class="flex h-screen">
            <!-- Sidebar -->
            <div class="sidebar p-4 flex flex-col">
                <div class="logo mb-8">WEBXOS AI TRAINING</div>
                <ul class="flex-grow">
                    <li class="nav-item active" data-nav="chat" onclick="WebXOS.navigate('chat')">
                        <i class="fas fa-comments mr-2"></i>CHAT
                    </li>
                    <li class="nav-item" data-nav="train" onclick="WebXOS.navigate('train')">
                        <i class="fas fa-brain mr-2"></i>TRAIN & MONITOR
                    </li>
                    <li class="nav-item" data-nav="guide" onclick="WebXOS.navigate('guide')">
                        <i class="fas fa-book mr-2"></i>GUIDE
                    </li>
                </ul>
                <div class="mt-auto text-xs text-gray-400 text-center">
                    Auto-Train v2.0<br>Zero Configuration AI
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="main-content p-4 flex flex-col overflow-hidden">
                <!-- CHAT View -->
                <div id="chat" class="flex flex-col h-full">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold neon-text">AI Assistant</h2>
                        <div class="flex items-center">
                            <div class="mr-4">
                                <span class="neon-text">Training: </span>
                                <span id="training-progress-value">0%</span>
                            </div>
                            <div class="import-btn" onclick="WebXOS.showTrainingPage()">
                                <i class="fas fa-file-import mr-2"></i>Add Training Data
                            </div>
                            <div id="agent-status" class="ml-2 flex items-center">
                                <span class="api-status disconnected"></span>
                                <span class="text-sm">Needs Training</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="training-progress">
                        <div class="progress-bar" id="training-progress-bar" style="width: 0%"></div>
                    </div>
                    
                    <div id="chat-container" class="flex-grow overflow-y-auto p-4 chat-container rounded-lg mb-4">
                        <div class="chat-message bot-message">
                            <div class="font-bold neon-text">AI Assistant</div>
                            <div>Welcome! I'm your AI assistant. To get started, please add some training data using the "Add Training Data" button. I'll automatically train myself on whatever you provide and become smarter over time.</div>
                            <div class="suggestions-container mt-3">
                                <div class="suggestion-chip" onclick="WebXOS.useSuggestion('How do I add training data?')">How to add data?</div>
                                <div class="suggestion-chip" onclick="WebXOS.useSuggestion('What kind of files can I upload?')">Supported files</div>
                                <div class="suggestion-chip" onclick="WebXOS.useSuggestion('How long does training take?')">Training time</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex">
                        <input id="chat-input" class="flex-grow p-3 rounded-l" placeholder="Ask me anything... (Add training data first for best results)" onkeypress="if(event.key === 'Enter') WebXOS.sendChat()">
                        <button class="p-3 btn-primary rounded-r flex items-center" onclick="WebXOS.sendChat()">
                            <i class="fas fa-paper-plane mr-2"></i>Send
                        </button>
                    </div>
                </div>
                
                <!-- TRAIN & MONITOR View -->
                <div id="train" class="flex flex-col h-full hidden overflow-y-auto">
                    <h2 class="text-2xl font-bold mb-4 neon-text">AI Training & Monitoring</h2>
                    <p class="text-gray-400 mb-6">Simply upload your data - I'll handle all training automatically. Monitor progress below.</p>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Training Progress -->
                        <div class="panel p-4">
                            <h3 class="text-xl font-semibold mb-3 neon-text">Training Progress</h3>
                            <div class="training-progress mb-4">
                                <div class="progress-bar" id="train-progress-bar" style="width: 0%"></div>
                            </div>
                            <div class="text-center mb-4">
                                <div class="text-3xl font-bold neon-text" id="train-progress-value">0%</div>
                                <div class="text-sm text-gray-400" id="progress-status">No training data added</div>
                            </div>
                            
                            <div class="training-stats">
                                <div class="stat-box">
                                    <div class="text-sm text-gray-400">Training Data</div>
                                    <div class="text-xl neon-text" id="data-count">0</div>
                                </div>
                                <div class="stat-box">
                                    <div class="text-sm text-gray-400">Auto-Training</div>
                                    <div class="text-xl neon-text" id="auto-training">ACTIVE</div>
                                </div>
                                <div class="stat-box">
                                    <div class="text-sm text-gray-400">Model Quality</div>
                                    <div class="text-xl neon-text" id="model-quality">Poor</div>
                                </div>
                                <div class="stat-box">
                                    <div class="text-sm text-gray-400">Topics Learned</div>
                                    <div class="text-xl neon-text" id="topics-learned">0</div>
                                </div>
                            </div>

                            <div class="mt-4 text-sm text-gray-400">
                                <div id="training-tips">
                                    <p>💡 <strong>Add more data</strong> to improve my understanding</p>
                                    <p>💡 I learn from: Documents, Q&A pairs, Conversations</p>
                                    <p>💡 Training happens automatically in background</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Data Upload -->
                        <div class="panel p-4">
                            <h3 class="text-xl font-semibold mb-3 neon-text">Add Training Data</h3>
                            <p class="text-gray-400 mb-4">Upload any documents or data. I'll automatically extract and learn from them.</p>
                            
                            <div class="file-upload-area" id="file-upload-area">
                                <i class="fas fa-file-upload text-3xl mb-2 neon-text"></i>
                                <p class="neon-text">Drag & drop files here or click to browse</p>
                                <p class="text-xs text-gray-400 mt-1">Supports: TXT, MD, PDF, JSON</p>
                                <input type="file" id="file-input" class="hidden" accept=".txt,.md,.pdf,.json" multiple>
                            </div>
                            
                            <div class="file-info hidden" id="file-info">
                                <div class="flex justify-between items-center">
                                    <span id="file-name">File name</span>
                                    <span id="file-size">Size</span>
                                </div>
                                <div class="parsing-progress mt-2">
                                    <div class="flex justify-between text-sm mb-1">
                                        <span>Processing:</span>
                                        <span id="parsing-progress-text">0%</span>
                                    </div>
                                    <div class="training-progress">
                                        <div class="progress-bar" id="parsing-progress-bar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <div class="parsed-content hidden" id="parsed-content"></div>
                            </div>
                            
                            <div class="flex space-x-2 mt-3">
                                <button class="btn-primary flex-1 py-2" id="process-file-btn" onclick="AITrainer.processFiles()" disabled>
                                    <i class="fas fa-cogs mr-2"></i>Auto-Train
                                </button>
                                <button class="btn-secondary flex-1 py-2" onclick="AITrainer.clearFiles()">
                                    <i class="fas fa-times mr-2"></i>Clear
                                </button>
                            </div>

                            <div class="mt-4">
                                <h4 class="text-lg font-semibold mb-2 neon-text">Quick Add Examples</h4>
                                <div class="space-y-2">
                                    <button class="btn-secondary w-full text-left p-2" onclick="AITrainer.addExample('hello', 'Hello! How can I help you today?')">
                                        + Add greeting example
                                    </button>
                                    <button class="btn-secondary w-full text-left p-2" onclick="AITrainer.addExample('help', 'I can answer questions based on the training data you provide.')">
                                        + Add help example
                                    </button>
                                    <button class="btn-secondary w-full text-left p-2" onclick="AITrainer.addExample('what can you do', 'I learn from your documents and data to answer questions and provide information.')">
                                        + Add capabilities example
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Training Visualization -->
                        <div class="panel p-4">
                            <h3 class="text-xl font-semibold mb-3 neon-text">Training Activity</h3>
                            <p class="text-gray-400 mb-4">Live visualization of learning patterns</p>
                            
                            <div class="attention-grid" id="attention-grid"></div>
                            
                            <div class="mt-4">
                                <h4 class="text-lg font-semibold mb-2 neon-text">Learned Topics</h4>
                                <div id="learned-topics" class="flex flex-wrap gap-1 min-h-20">
                                    <span class="text-gray-400 text-sm">No topics learned yet. Add data to see topics here.</span>
                                </div>
                            </div>

                            <div class="mt-4">
                                <button class="btn-primary w-full py-2" onclick="AITrainer.forceTraining()">
                                    <i class="fas fa-bolt mr-2"></i>Force Training Cycle
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- GUIDE View -->
                <div id="guide" class="panel p-6 rounded-lg hidden overflow-y-auto">
                    <h2 class="text-2xl font-bold mb-4 neon-text">WEBXOS AI TRAINING - Complete Guide</h2>
                    
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold mb-2 neon-text">Zero-Configuration AI Training</h3>
                        <p class="mb-4">This system automatically trains an AI assistant on whatever data you provide. No technical knowledge required - just upload and chat!</p>
                        
                        <div class="panel p-4 rounded-lg mb-4">
                            <h4 class="text-lg font-medium mb-2 neon-text">How It Works:</h4>
                            <ul class="list-disc pl-5 space-y-2">
                                <li><strong>Upload Data:</strong> Add documents (TXT, MD, PDF) or JSON training data</li>
                                <li><strong>Auto-Training:</strong> System automatically processes and trains on your data</li>
                                <li><strong>Monitor Progress:</strong> Watch training percentage increase as AI learns</li>
                                <li><strong>Chat Naturally:</strong> Ask questions - AI uses learned knowledge to respond</li>
                                <li><strong>Continuous Improvement:</strong> Add more data anytime to improve responses</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold mb-2 neon-text">Training Progress Explained</h3>
                        
                        <div class="panel p-4 rounded-lg mb-4">
                            <h4 class="text-lg font-medium mb-2 neon-text">What the Percentage Means:</h4>
                            <div class="space-y-3">
                                <div class="training-data-item">
                                    <strong>0-20%: Basic Training</strong>
                                    <p class="text-sm text-gray-400">AI understands basic patterns. Add more diverse data.</p>
                                </div>
                                <div class="training-data-item">
                                    <strong>20-50%: Learning Phase</strong>
                                    <p class="text-sm text-gray-400">AI starts recognizing topics and relationships in your data.</p>
                                </div>
                                <div class="training-data-item">
                                    <strong>50-80%: Good Understanding</strong>
                                    <p class="text-sm text-gray-400">AI can answer most questions about your uploaded content.</p>
                                </div>
                                <div class="training-data-item">
                                    <strong>80-100%: Expert Level</strong>
                                    <p class="text-sm text-gray-400">AI provides detailed, accurate responses about your data.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold mb-2 neon-text">Supported Data Types</h3>
                        
                        <div class="panel p-4 rounded-lg mb-4">
                            <h4 class="text-lg font-medium mb-2 neon-text">What You Can Upload:</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="training-data-item">
                                    <strong>📄 Text Files (.txt)</strong>
                                    <p class="text-sm text-gray-400">Plain text documents, articles, notes</p>
                                </div>
                                <div class="training-data-item">
                                    <strong>📝 Markdown (.md)</strong>
                                    <p class="text-sm text-gray-400">Documentation, readme files, structured content</p>
                                </div>
                                <div class="training-data-item">
                                    <strong>📊 PDF Documents</strong>
                                    <p class="text-sm text-gray-400">Reports, manuals, research papers</p>
                                </div>
                                <div class="training-data-item">
                                    <strong>🔧 JSON Training Data</strong>
                                    <p class="text-sm text-gray-400">Pre-formatted question-answer pairs</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-xl font-semibold mb-2 neon-text">Troubleshooting</h3>
                        
                        <div class="panel p-4 rounded-lg">
                            <h4 class="text-lg font-medium mb-2 neon-text">Common Issues & Solutions:</h4>
                            <div class="space-y-3">
                                <div class="training-data-item">
                                    <strong>🤖 "I need more training data"</strong>
                                    <p class="text-sm text-gray-400">Upload more documents or add example Q&A pairs</p>
                                </div>
                                <div class="training-data-item">
                                    <strong>📊 Low training percentage</strong>
                                    <p class="text-sm text-gray-400">Add diverse data types and more content</p>
                                </div>
                                <div class="training-data-item">
                                    <strong>💬 Generic responses</strong>
                                    <p class="text-sm text-gray-400">Provide specific examples of desired answers</p>
                                </div>
                                <div class="training-data-item">
                                    <strong>🔄 Training seems slow</strong>
                                    <p class="text-sm text-gray-400">Use "Force Training Cycle" button to accelerate</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // WebXOS AI Training Framework
        const WebXOS = {
            state: new Proxy({ 
                appState: 'chat',
                trainingProgress: 0,
                trainingData: [],
                learnedTopics: [],
                modelQuality: 'Poor',
                isTraining: false
            }, {
                set(target, key, value) {
                    target[key] = value;
                    
                    // Update UI when state changes
                    if (key === 'trainingProgress') {
                        document.getElementById('training-progress-value').textContent = value + '%';
                        document.getElementById('training-progress-bar').style.width = value + '%';
                        document.getElementById('train-progress-value').textContent = value + '%';
                        document.getElementById('train-progress-bar').style.width = value + '%';
                        
                        // Update status messages
                        const statusElement = document.getElementById('progress-status');
                        const agentStatus = document.getElementById('agent-status');
                        
                        if (value === 0) {
                            statusElement.textContent = 'No training data added';
                            agentStatus.innerHTML = '<span class="api-status disconnected"></span><span class="text-sm">Needs Training</span>';
                        } else if (value < 20) {
                            statusElement.textContent = 'Basic training started';
                            agentStatus.innerHTML = '<span class="api-status disconnected"></span><span class="text-sm">Learning</span>';
                        } else if (value < 50) {
                            statusElement.textContent = 'Making good progress';
                            agentStatus.innerHTML = '<span class="api-status connected"></span><span class="text-sm neon-text">Learning</span>';
                        } else if (value < 80) {
                            statusElement.textContent = 'Good understanding achieved';
                            agentStatus.innerHTML = '<span class="api-status connected"></span><span class="text-sm neon-text">Good</span>';
                        } else {
                            statusElement.textContent = 'Expert level reached';
                            agentStatus.innerHTML = '<span class="api-status connected"></span><span class="text-sm neon-text">Expert</span>';
                        }
                        
                        // Update model quality
                        let quality = 'Poor';
                        if (value >= 80) quality = 'Excellent';
                        else if (value >= 50) quality = 'Good';
                        else if (value >= 20) quality = 'Fair';
                        document.getElementById('model-quality').textContent = quality;
                    }
                    
                    if (key === 'trainingData') {
                        document.getElementById('data-count').textContent = value.length;
                    }
                    
                    if (key === 'learnedTopics') {
                        document.getElementById('topics-learned').textContent = value.length;
                        AITrainer.updateTopicsDisplay();
                    }
                    
                    // Save to localStorage
                    if (key !== 'appState') {
                        localStorage.setItem(key, JSON.stringify(value));
                    }
                    return true;
                },
                get(target, key) {
                    if (target[key] !== undefined) {
                        return target[key];
                    } else {
                        const stored = localStorage.getItem(key);
                        if (stored) {
                            return JSON.parse(stored);
                        }
                        return undefined;
                    }
                }
            }),
            
            navigate(view) {
                this.state.appState = view;
                
                ['chat', 'train', 'guide'].forEach(v => {
                    const element = document.getElementById(v);
                    if (element) element.classList.add('hidden');
                });
                
                document.getElementById(view).classList.remove('hidden');
                
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                const navElement = document.querySelector(`[data-nav="${view}"]`);
                if (navElement) navElement.classList.add('active');
            },
            
            sendChat() {
                const input = document.getElementById('chat-input');
                const message = input.value.trim();
                if (!message) return;
                
                const chatContainer = document.getElementById('chat-container');
                
                // Add user message
                chatContainer.innerHTML += `<div class="chat-message user-message">
                    <div class="font-bold">You</div>
                    <div>${message}</div>
                </div>`;
                
                // Add typing indicator
                chatContainer.innerHTML += `<div class="chat-message bot-message">
                    <div class="font-bold neon-text">AI Assistant</div>
                    <div class="typing-indicator">
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                        <span class="typing-dot"></span>
                    </div>
                </div>`;
                
                chatContainer.scrollTop = chatContainer.scrollHeight;
                input.value = '';
                
                // Generate response
                setTimeout(() => {
                    const messages = chatContainer.querySelectorAll('.chat-message');
                    messages[messages.length - 1].remove();
                    
                    const response = AITrainer.generateResponse(message);
                    
                    chatContainer.innerHTML += `<div class="chat-message bot-message">
                        <div class="font-bold neon-text">AI Assistant</div>
                        <div>${response.text}</div>
                        ${response.suggestions ? `<div class="suggestions-container mt-3">${response.suggestions}</div>` : ''}
                    </div>`;
                    
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                    
                    // Auto-trigger training if needed
                    if (this.state.trainingProgress < 100 && Math.random() > 0.7) {
                        AITrainer.autoTrain();
                    }
                }, 1000 + Math.random() * 1000);
            },
            
            useSuggestion(suggestion) {
                document.getElementById('chat-input').value = suggestion;
                this.sendChat();
            },
            
            showTrainingPage() {
                this.navigate('train');
            },
            
            init() {
                const loadingBar = document.querySelector('.loading-bar');
                let width = 0;
                const interval = setInterval(() => {
                    width += 5;
                    loadingBar.style.width = `${width}%`;
                    if (width >= 100) {
                        clearInterval(interval);
                        setTimeout(() => {
                            document.getElementById('loading-screen').classList.add('hidden');
                        }, 500);
                    }
                }, 100);
                
                AITrainer.init();
                this.navigate('chat');
            }
        };

        // AI Training Engine
        const AITrainer = {
            trainingData: [],
            learnedTopics: [],
            trainingProgress: 0,
            attentionGrid: [],
            trainingInterval: null,
            uploadedFiles: [],
            
            init() {
                this.loadSavedData();
                this.setupFileUpload();
                this.createAttentionGrid();
                this.startAutoTraining();
                this.updateDisplay();
            },
            
            loadSavedData() {
                // Load from WebXOS state
                this.trainingData = WebXOS.state.trainingData || [];
                this.learnedTopics = WebXOS.state.learnedTopics || [];
                this.trainingProgress = WebXOS.state.trainingProgress || 0;
                
                this.updateProgress();
            },
            
            setupFileUpload() {
                const fileUploadArea = document.getElementById('file-upload-area');
                const fileInput = document.getElementById('file-input');
                
                fileUploadArea.addEventListener('click', () => {
                    fileInput.click();
                });
                
                fileInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        this.handleFileSelect(Array.from(e.target.files));
                    }
                });
                
                // Drag and drop
                fileUploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    fileUploadArea.classList.add('dragover');
                });
                
                fileUploadArea.addEventListener('dragleave', () => {
                    fileUploadArea.classList.remove('dragover');
                });
                
                fileUploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    fileUploadArea.classList.remove('dragover');
                    
                    if (e.dataTransfer.files.length > 0) {
                        this.handleFileSelect(Array.from(e.dataTransfer.files));
                    }
                });
            },
            
            handleFileSelect(files) {
                this.uploadedFiles = files;
                
                // Update file info display
                if (files.length === 1) {
                    document.getElementById('file-name').textContent = files[0].name;
                    document.getElementById('file-size').textContent = this.formatFileSize(files[0].size);
                } else {
                    document.getElementById('file-name').textContent = `${files.length} files selected`;
                    document.getElementById('file-size').textContent = `${files.reduce((acc, file) => acc + file.size, 0)} bytes total`;
                }
                
                document.getElementById('file-info').classList.remove('hidden');
                document.getElementById('process-file-btn').disabled = false;
                
                // Clear previous content
                document.getElementById('parsed-content').classList.add('hidden');
                document.getElementById('parsing-progress-text').textContent = '0%';
                document.getElementById('parsing-progress-bar').style.width = '0%';
            },
            
            async processFiles() {
                if (this.uploadedFiles.length === 0) return;
                
                const processBtn = document.getElementById('process-file-btn');
                processBtn.disabled = true;
                processBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Training...';
                
                let totalProcessed = 0;
                
                for (const file of this.uploadedFiles) {
                    await this.processSingleFile(file, totalProcessed, this.uploadedFiles.length);
                    totalProcessed++;
                }
                
                this.updateProgress();
                this.forceTraining();
                
                processBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Training Complete!';
                setTimeout(() => {
                    processBtn.innerHTML = '<i class="fas fa-cogs mr-2"></i>Auto-Train';
                    processBtn.disabled = false;
                }, 2000);
                
                // Show success message
                this.showMessage(`Successfully processed ${this.uploadedFiles.length} files! Training in progress...`, 'success');
            },
            
            async processSingleFile(file, current, total) {
                const progress = Math.round((current / total) * 100);
                this.updateProcessingProgress(progress, `Processing ${file.name}...`);
                
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    
                    reader.onload = async (e) => {
                        try {
                            if (file.type === 'application/json') {
                                const data = JSON.parse(e.target.result);
                                if (data.trainingData) {
                                    this.trainingData = this.trainingData.concat(data.trainingData);
                                }
                            } else if (file.type === 'text/plain' || file.name.endsWith('.txt')) {
                                await this.processTextFile(e.target.result, file.name);
                            } else if (file.name.endsWith('.md')) {
                                await this.processMarkdownFile(e.target.result, file.name);
                            } else if (file.type === 'application/pdf') {
                                await this.processPdfFile(e.target.result, file.name);
                            }
                            
                            resolve();
                        } catch (error) {
                            this.showMessage(`Error processing ${file.name}: ${error.message}`, 'error');
                            resolve();
                        }
                    };
                    
                    if (file.type === 'application/pdf') {
                        reader.readAsArrayBuffer(file);
                    } else {
                        reader.readAsText(file);
                    }
                });
            },
            
            async processTextFile(content, filename) {
                const lines = content.split('\n').filter(line => line.trim().length > 0);
                
                lines.forEach((line, index) => {
                    if (line.length > 10) {
                        const words = line.split(' ').filter(word => word.length > 3);
                        const topic = words.slice(0, Math.min(3, words.length)).join(' ');
                        
                        if (topic && !this.learnedTopics.includes(topic)) {
                            this.learnedTopics.push(topic);
                        }
                        
                        this.trainingData.push({
                            input: `tell me about ${topic}`,
                            response: line
                        });
                    }
                });
                
                WebXOS.state.learnedTopics = this.learnedTopics;
                WebXOS.state.trainingData = this.trainingData;
            },
            
            async processMarkdownFile(content, filename) {
                const lines = content.split('\n');
                let currentSection = '';
                let currentContent = [];
                
                for (const line of lines) {
                    const trimmed = line.trim();
                    
                    if (trimmed.startsWith('#') && !trimmed.startsWith('```')) {
                        if (currentSection && currentContent.length > 0) {
                            const contentText = currentContent.join(' ').trim();
                            if (contentText.length > 10) {
                                this.trainingData.push({
                                    input: `tell me about ${currentSection}`,
                                    response: contentText
                                });
                                
                                if (!this.learnedTopics.includes(currentSection)) {
                                    this.learnedTopics.push(currentSection);
                                }
                            }
                        }
                        
                        currentSection = trimmed.replace(/^#+\s*/, '');
                        currentContent = [];
                    } else if (trimmed.length > 0 && !trimmed.startsWith('```')) {
                        currentContent.push(trimmed);
                    }
                }
                
                WebXOS.state.learnedTopics = this.learnedTopics;
                WebXOS.state.trainingData = this.trainingData;
            },
            
            async processPdfFile(content, filename) {
                // Simplified PDF processing
                pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
                
                try {
                    const pdf = await pdfjsLib.getDocument(content).promise;
                    let fullText = '';
                    
                    for (let i = 1; i <= pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        const text = textContent.items.map(item => item.str).join(' ');
                        fullText += text + ' ';
                    }
                    
                    // Process as text
                    await this.processTextFile(fullText, filename);
                } catch (error) {
                    this.showMessage(`PDF processing error: ${error.message}`, 'error');
                }
            },
            
            addExample(input, response) {
                this.trainingData.push({ input, response });
                WebXOS.state.trainingData = this.trainingData;
                this.updateProgress();
                this.showMessage('Example added successfully!', 'success');
            },
            
            clearFiles() {
                this.uploadedFiles = [];
                document.getElementById('file-info').classList.add('hidden');
                document.getElementById('process-file-btn').disabled = true;
                document.getElementById('file-input').value = '';
            },
            
            updateProcessingProgress(percent, text) {
                document.getElementById('parsing-progress-text').textContent = text;
                document.getElementById('parsing-progress-bar').style.width = percent + '%';
            },
            
            formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' bytes';
                else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
                else return (bytes / 1048576).toFixed(1) + ' MB';
            },
            
            createAttentionGrid() {
                const gridElement = document.getElementById('attention-grid');
                gridElement.innerHTML = '';
                this.attentionGrid = [];
                
                for (let y = 0; y < 12; y++) {
                    this.attentionGrid[y] = [];
                    for (let x = 0; x < 12; x++) {
                        const cell = document.createElement('div');
                        cell.className = 'attention-cell';
                        gridElement.appendChild(cell);
                        this.attentionGrid[y][x] = { element: cell, value: 0 };
                    }
                }
            },
            
            updateAttentionGrid() {
                const isTraining = WebXOS.state.trainingProgress > 0 && WebXOS.state.trainingProgress < 100;
                
                for (let y = 0; y < 12; y++) {
                    for (let x = 0; x < 12; x++) {
                        let value;
                        if (isTraining) {
                            value = Math.random() * 0.8 + 
                                    Math.sin(Date.now() / 1000 + x * 0.3 + y * 0.2) * 0.2;
                        } else {
                            value = Math.random() * 0.3;
                        }
                        
                        this.attentionGrid[y][x].value = value;
                        const brightness = Math.floor(value * 100);
                        this.attentionGrid[y][x].element.style.backgroundColor = `hsl(120, 100%, ${brightness}%)`;
                        
                        if (value > 0.5) {
                            this.attentionGrid[y][x].element.classList.add('active');
                        } else {
                            this.attentionGrid[y][x].element.classList.remove('active');
                        }
                    }
                }
            },
            
            startAutoTraining() {
                this.trainingInterval = setInterval(() => {
                    this.updateAttentionGrid();
                    
                    if (this.trainingData.length > 0 && WebXOS.state.trainingProgress < 100) {
                        this.autoTrain();
                    }
                }, 100);
            },
            
            autoTrain() {
                // Simulate training progress
                if (this.trainingData.length === 0) return;
                
                const progressIncrement = Math.min(0.1, (100 - WebXOS.state.trainingProgress) / 100);
                WebXOS.state.trainingProgress += progressIncrement;
                
                // Occasionally discover new topics
                if (Math.random() > 0.95 && this.trainingData.length > 0) {
                    const randomData = this.trainingData[Math.floor(Math.random() * this.trainingData.length)];
                    const words = randomData.input.split(' ').filter(word => word.length > 4);
                    if (words.length > 0) {
                        const newTopic = words[0];
                        if (!this.learnedTopics.includes(newTopic)) {
                            this.learnedTopics.push(newTopic);
                            WebXOS.state.learnedTopics = this.learnedTopics;
                        }
                    }
                }
            },
            
            forceTraining() {
                // Intensive training session
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => this.autoTrain(), i * 100);
                }
                this.showMessage('Intensive training cycle started!', 'success');
            },
            
            updateProgress() {
                // Calculate progress based on data quantity and diversity
                const dataScore = Math.min(this.trainingData.length * 2, 70);
                const topicsScore = Math.min(this.learnedTopics.length * 5, 30);
                const newProgress = Math.min(100, dataScore + topicsScore);
                
                if (newProgress > WebXOS.state.trainingProgress) {
                    WebXOS.state.trainingProgress = newProgress;
                }
            },
            
            updateTopicsDisplay() {
                const container = document.getElementById('learned-topics');
                container.innerHTML = '';
                
                if (this.learnedTopics.length === 0) {
                    container.innerHTML = '<span class="text-gray-400 text-sm">No topics learned yet. Add data to see topics here.</span>';
                    return;
                }
                
                this.learnedTopics.slice(0, 15).forEach(topic => {
                    const badge = document.createElement('span');
                    badge.className = 'topic-badge';
                    badge.textContent = topic;
                    container.appendChild(badge);
                });
                
                if (this.learnedTopics.length > 15) {
                    const more = document.createElement('span');
                    more.className = 'topic-badge';
                    more.textContent = `+${this.learnedTopics.length - 15} more`;
                    container.appendChild(more);
                }
            },
            
            generateResponse(input) {
                const lowerInput = input.toLowerCase();
                
                // Error handling for insufficient training
                if (this.trainingData.length === 0) {
                    return {
                        text: "I need training data to help you effectively. Please use the 'Add Training Data' button to upload documents or add example questions and answers. I'll automatically learn from whatever you provide!",
                        suggestions: `
                            <div class="suggestion-chip" onclick="WebXOS.useSuggestion('How do I add training data?')">How to add data?</div>
                            <div class="suggestion-chip" onclick="WebXOS.showTrainingPage()">Go to Training Page</div>
                            <div class="suggestion-chip" onclick="WebXOS.useSuggestion('What kind of files can I upload?')">Supported files</div>
                        `
                    };
                }
                
                if (WebXOS.state.trainingProgress < 20) {
                    return {
                        text: "I'm still in early training (only " + WebXOS.state.trainingProgress + "% trained). I can answer basic questions, but for better results, please add more training data. The more data you provide, the smarter I become!",
                        suggestions: `
                            <div class="suggestion-chip" onclick="WebXOS.showTrainingPage()">Add More Data</div>
                            <div class="suggestion-chip" onclick="WebXOS.useSuggestion('What topics have you learned?')">Show learned topics</div>
                        `
                    };
                }
                
                // Find matching training data
                for (const item of this.trainingData) {
                    if (lowerInput.includes(item.input.toLowerCase()) || 
                        this.calculateSimilarity(lowerInput, item.input.toLowerCase()) > 0.6) {
                        return {
                            text: item.response,
                            suggestions: this.generateSuggestions(input)
                        };
                    }
                }
                
                // Generic response based on training progress
                if (WebXOS.state.trainingProgress < 50) {
                    return {
                        text: "I'm still learning (" + WebXOS.state.trainingProgress + "% trained). I can answer questions about the specific topics I've been trained on. Try asking about things in your uploaded documents, or add more diverse training data for better coverage.",
                        suggestions: `
                            <div class="suggestion-chip" onclick="WebXOS.useSuggestion('What topics have you learned?')">Show learned topics</div>
                            <div class="suggestion-chip" onclick="WebXOS.showTrainingPage()">Add More Data</div>
                        `
                    };
                } else {
                    return {
                        text: "Based on my training (" + WebXOS.state.trainingProgress + "% complete), I can help you with topics from your uploaded documents. I'm continuously learning and improving as you add more data!",
                        suggestions: this.generateSuggestions(input)
                    };
                }
            },
            
            generateSuggestions(input) {
                const suggestions = [];
                
                if (this.learnedTopics.length > 0) {
                    // Suggest topics from learned data
                    const randomTopics = [...this.learnedTopics]
                        .sort(() => 0.5 - Math.random())
                        .slice(0, 2);
                    
                    randomTopics.forEach(topic => {
                        suggestions.push(`<div class="suggestion-chip" onclick="WebXOS.useSuggestion('Tell me about ${topic}')">About ${topic}</div>`);
                    });
                }
                
                // Add general suggestions
                suggestions.push('<div class="suggestion-chip" onclick="WebXOS.useSuggestion(\'What topics have you learned?\')">Learned topics</div>');
                
                if (WebXOS.state.trainingProgress < 80) {
                    suggestions.push('<div class="suggestion-chip" onclick="WebXOS.showTrainingPage()">Add more data</div>');
                }
                
                return suggestions.join('');
            },
            
            calculateSimilarity(str1, str2) {
                const words1 = new Set(str1.split(/\s+/));
                const words2 = new Set(str2.split(/\s+/));
                const intersection = new Set([...words1].filter(x => words2.has(x)));
                const union = new Set([...words1, ...words2]);
                return intersection.size / union.size;
            },
            
            showMessage(message, type = 'info') {
                const chatContainer = document.getElementById('chat-container');
                const messageClass = type === 'error' ? 'error-message' : 'success-message';
                
                chatContainer.innerHTML += `<div class="${messageClass}">
                    <div class="font-bold">${type === 'error' ? '⚠️ Training Alert' : '✅ Training Update'}</div>
                    <div>${message}</div>
                </div>`;
                
                chatContainer.scrollTop = chatContainer.scrollHeight;
            },
            
            updateDisplay() {
                this.updateProgress();
                this.updateTopicsDisplay();
            }
        };

        window.addEventListener('DOMContentLoaded', () => {
            WebXOS.init();
        });
    </script>
</body>
</html>