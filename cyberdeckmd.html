<!DOCTYPE html>
<html lang="en" class="cyber-theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CyberDeck .MD • webXOS 2025</title>
    <meta name="description" content="Cyberdeck Markdown to HTML/PDF Converter">
    <meta name="theme-color" content="#000000">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;charset=utf-8,%7B%22name%22%3A%22CyberDeck%20MD%22%2C%22short_name%22%3A%22CyberMD%22%2C%22description%22%3A%22Cyberdeck%20Terminal%20Markdown%20Converter%22%2C%22start_url%22%3A%22.%2F%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22000000%22%2C%22theme_color%22%3A%2200ff00%22%2C%22orientation%22%3A%22any%22%2C%22categories%22%3A%5B%22productivity%22%2C%22utilities%22%5D%2C%22icons%22%3A%5B%7B%22src%22%3A%22data%3Aimage%2Fsvg%2Bxml%3Bbase64%2CPHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxyZWN0IHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgZmlsbD0iIzAwZmYwMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBkb21pbmFudC1iYXNlbGluZT0iY2VudHJhbCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzAwMDAwMCI%2BQ008L3RleHQ%2BPC9zdmc%2B%22%2C%22sizes%22%3A%22192x192%22%2C%22type%22%3A%22image%2Fsvg%2Bxml%22%7D%5D%7D">
    
    <!-- iOS PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="CyberDeck MD">
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* Cyberdeck Theme Variables */
        :root {
            --neon-green: #00ff00;
            --neon-green-glow: #00ff0080;
            --dark-0: #000000;
            --dark-1: #0a0a0a;
            --dark-2: #111111;
            --dark-3: #1a1a1a;
            --dark-4: #222222;
            --terminal-green: #00ff00;
            --terminal-glow: 0 0 10px var(--neon-green-glow);
            --scanline: linear-gradient(
                to bottom,
                transparent 50%,
                rgba(0, 255, 0, 0.05) 50%
            );
            --scanline-size: 4px;
            --font-mono: 'Courier New', 'Cascadia Code', 'Consolas', monospace;
            --font-terminal: 'Share Tech Mono', 'Courier New', monospace;
        }

        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-terminal);
            background: var(--dark-0);
            color: var(--neon-green);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            line-height: 1.6;
        }

        /* Scanline Effect */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--scanline);
            background-size: 100% var(--scanline-size);
            pointer-events: none;
            z-index: 9999;
            animation: scanline 10s linear infinite;
            opacity: 0.3;
        }

        @keyframes scanline {
            0% { background-position: 0 0; }
            100% { background-position: 0 calc(var(--scanline-size) * 100); }
        }

        /* Terminal Header */
        .terminal-header {
            background: var(--dark-1);
            border-bottom: 1px solid var(--neon-green);
            box-shadow: var(--terminal-glow);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .terminal-title {
            font-size: 1.5rem;
            font-weight: normal;
            letter-spacing: 2px;
            text-shadow: 0 0 5px var(--neon-green);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .terminal-title::before {
            content: ">>>";
            color: var(--neon-green);
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .metrics-panel {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
        }

        .metric {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .metric-value {
            color: var(--neon-green);
            font-weight: bold;
            text-shadow: 0 0 5px var(--neon-green-glow);
        }

        .metric-label {
            font-size: 0.7rem;
            opacity: 0.8;
        }

        /* Main Container */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
            height: calc(100vh - 80px);
        }

        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr 1fr;
            }
        }

        /* Panel Styles */
        .panel {
            background: var(--dark-2);
            border: 1px solid var(--dark-4);
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }

        .panel::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--neon-green), 
                transparent);
        }

        .panel-header {
            background: var(--dark-3);
            padding: 10px 15px;
            border-bottom: 1px solid var(--dark-4);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-title {
            font-size: 1rem;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .panel-status {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        /* Input Panel */
        .input-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        #markdown-input {
            flex: 1;
            background: var(--dark-1);
            color: var(--neon-green);
            border: none;
            padding: 20px;
            font-family: var(--font-mono);
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            outline: none;
            overflow-y: auto;
        }

        #markdown-input:focus {
            box-shadow: inset 0 0 20px rgba(0, 255, 0, 0.1);
        }

        /* Preview Panel */
        .preview-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        #preview-output {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: var(--dark-1);
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        /* Cyberpunk Styled HTML Preview */
        #preview-output h1, 
        #preview-output h2, 
        #preview-output h3 {
            color: var(--neon-green);
            border-bottom: 1px solid var(--neon-green);
            padding-bottom: 5px;
            margin-bottom: 15px;
            text-shadow: 0 0 5px var(--neon-green-glow);
        }

        #preview-output h1 { font-size: 2em; }
        #preview-output h2 { font-size: 1.5em; }
        #preview-output h3 { font-size: 1.2em; }

        #preview-output p {
            margin-bottom: 15px;
            line-height: 1.6;
            color: #e0e0e0;
        }

        #preview-output code {
            background: var(--dark-3);
            color: var(--neon-green);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: var(--font-mono);
            font-size: 0.9em;
            border: 1px solid var(--dark-4);
        }

        #preview-output pre {
            background: var(--dark-2);
            border: 1px solid var(--dark-4);
            border-left: 3px solid var(--neon-green);
            padding: 15px;
            overflow-x: auto;
            margin: 15px 0;
            position: relative;
        }

        #preview-output pre::before {
            content: "CODE";
            position: absolute;
            top: 0;
            right: 0;
            background: var(--neon-green);
            color: var(--dark-0);
            padding: 2px 8px;
            font-size: 0.7em;
            font-weight: bold;
        }

        #preview-output blockquote {
            border-left: 3px solid var(--neon-green);
            margin: 15px 0;
            padding-left: 15px;
            color: #b0b0b0;
            font-style: italic;
            background: linear-gradient(90deg, rgba(0,255,0,0.1), transparent);
        }

        #preview-output table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            border: 1px solid var(--dark-4);
        }

        #preview-output th {
            background: var(--dark-3);
            color: var(--neon-green);
            padding: 10px;
            text-align: left;
            border: 1px solid var(--dark-4);
        }

        #preview-output td {
            padding: 10px;
            border: 1px solid var(--dark-4);
            color: #e0e0e0;
        }

        #preview-output tr:nth-child(even) {
            background: rgba(0, 255, 0, 0.05);
        }

        /* Control Panel */
        .control-panel {
            padding: 20px;
            background: var(--dark-2);
            border-top: 1px solid var(--dark-4);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        /* Button Styles */
        .cyber-button {
            background: var(--dark-3);
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
            padding: 12px 20px;
            font-family: var(--font-terminal);
            font-size: 14px;
            letter-spacing: 1px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .cyber-button:hover {
            background: var(--neon-green);
            color: var(--dark-0);
            box-shadow: var(--terminal-glow);
            transform: translateY(-2px);
        }

        .cyber-button:active {
            transform: translateY(0);
        }

        .cyber-button::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,255,0,0.2), transparent);
            transition: left 0.5s;
        }

        .cyber-button:hover::before {
            left: 100%;
        }

        .button-primary {
            background: linear-gradient(45deg, var(--dark-3), var(--dark-4));
            border-width: 2px;
        }

        .button-danger {
            border-color: #ff0033;
            color: #ff0033;
        }

        .button-danger:hover {
            background: #ff0033;
            color: var(--dark-0);
        }

        /* Modal for PDF Preview */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--dark-1);
            border: 2px solid var(--neon-green);
            padding: 20px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            position: relative;
            box-shadow: 0 0 30px var(--neon-green-glow);
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--dark-3);
            color: var(--neon-green);
            border: 1px solid var(--neon-green);
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-family: var(--font-terminal);
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: var(--neon-green);
            color: var(--dark-0);
        }

        /* Loading Animation */
        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--dark-3);
            border-top: 3px solid var(--neon-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Status Messages */
        .status-message {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--dark-3);
            border: 1px solid var(--neon-green);
            padding: 10px 20px;
            color: var(--neon-green);
            font-family: var(--font-terminal);
            display: none;
            z-index: 1000;
            box-shadow: var(--terminal-glow);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--dark-2);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--dark-4);
            border: 2px solid var(--dark-2);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--neon-green);
        }

        /* Terminal Typing Effect */
        .typing-effect {
            overflow: hidden;
            border-right: 2px solid var(--neon-green);
            white-space: nowrap;
            animation: typing 3.5s steps(40, end), blink-caret 0.75s step-end infinite;
        }

        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }

        @keyframes blink-caret {
            from, to { border-color: transparent }
            50% { border-color: var(--neon-green) }
        }

        /* Grid Background Effect */
        .grid-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 255, 0, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 0, 0.05) 1px, transparent 1px);
            background-size: 50px 50px;
            z-index: -1;
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <!-- Background Grid -->
    <div class="grid-bg"></div>

    <!-- Terminal Header -->
    <header class="terminal-header">
        <div class="terminal-title">
            <span class="typing-effect">CYBERDECK .MD v2.1</span>
        </div>
        <div class="metrics-panel">
            <div class="metric">
                <div class="metric-value" id="char-count">0</div>
                <div class="metric-label">CHARS</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="word-count">0</div>
                <div class="metric-label">WORDS</div>
            </div>
            <div class="metric">
                <div class="metric-value" id="line-count">0</div>
                <div class="metric-label">LINES</div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Input Panel -->
        <div class="panel input-container">
            <div class="panel-header">
                <div class="panel-title">MARKDOWN_INPUT [RAW]</div>
                <div class="panel-status" id="input-status">SYNCED</div>
            </div>
            <textarea 
                id="markdown-input" 
                placeholder="# Welcome to CyberDeck MD\n\nType your markdown here...\n\n## Features:\n- **Real-time** preview\n- **HTML** export\n- **PDF** generation\n- Cyberpunk theme\n\n```javascript\nconsole.log('Hello Cyberdeck!');\n```"
                spellcheck="false"
                autofocus
            ></textarea>
        </div>

        <!-- Preview Panel -->
        <div class="panel preview-container">
            <div class="panel-header">
                <div class="panel-title">PREVIEW_OUTPUT [RENDERED]</div>
                <div class="panel-status" id="preview-status">LIVE</div>
            </div>
            <div id="preview-output"></div>
        </div>
    </main>

    <!-- Control Panel -->
    <div class="control-panel">
        <button class="cyber-button button-primary" onclick="exportHTML()">
            <span>EXPORT HTML</span>
        </button>
        <button class="cyber-button button-primary" onclick="exportPDF()">
            <span>GENERATE PDF</span>
        </button>
        <button class="cyber-button" onclick="clearAll()">
            <span>CLEAR ALL</span>
        </button>
        <button class="cyber-button" onclick="insertSample()">
            <span>LOAD SAMPLE</span>
        </button>
        <button class="cyber-button" onclick="toggleFullscreen()">
            <span>FULLSCREEN</span>
        </button>
        <button class="cyber-button" onclick="copyToClipboard()">
            <span>COPY HTML</span>
        </button>
    </div>

    <!-- Loading Overlay -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
    </div>

    <!-- Status Message -->
    <div class="status-message" id="status-message"></div>

    <!-- PDF Preview Modal -->
    <div class="modal" id="pdf-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">×</button>
            <div id="pdf-preview"></div>
        </div>
    </div>

    <script>
        // Initialize Showdown with custom extensions
        const converter = new showdown.Converter({
            tables: true,
            tasklists: true,
            strikethrough: true,
            simpleLineBreaks: true,
            openLinksInNewWindow: true,
            emoji: true,
            underline: true,
            extensions: []
        });

        // DOM Elements
        const markdownInput = document.getElementById('markdown-input');
        const previewOutput = document.getElementById('preview-output');
        const charCount = document.getElementById('char-count');
        const wordCount = document.getElementById('word-count');
        const lineCount = document.getElementById('line-count');
        const statusMessage = document.getElementById('status-message');
        const loading = document.getElementById('loading');
        const pdfModal = document.getElementById('pdf-modal');
        const pdfPreview = document.getElementById('pdf-preview');
        const inputStatus = document.getElementById('input-status');
        const previewStatus = document.getElementById('preview-status');

        // Stats tracking
        let stats = {
            chars: 0,
            words: 0,
            lines: 0,
            lastUpdate: Date.now()
        };

        // Initial content
        const initialMarkdown = `# CyberDeck Markdown Terminal
## Real-time Markdown to HTML/PDF Converter

### Features:
- **Real-time preview** with cyberpunk theme
- **HTML export** with styling preserved
- **PDF generation** using jsPDF
- **Progressive Web App** capabilities
- **Offline functionality**
- **Clipboard integration**

### Sample Code Block:
\`\`\`javascript
// Cyberdeck initialization
function initCyberdeck() {
    const terminal = new CyberTerminal();
    terminal.boot();
    console.log('System ready.');
}

// Markdown conversion
const converter = new showdown.Converter();
const html = converter.makeHtml(markdown);
\`\`\`

### Task List:
- [x] Implement real-time preview
- [x] Add HTML export
- [x] Integrate PDF generation
- [x] Design cyberpunk UI
- [ ] Add custom templates
- [ ] Implement cloud sync

### Table Example:
| Component | Status | Version |
|-----------|--------|---------|
| Parser    | Online | 2.1     |
| Renderer  | Online | 2.0     |
| Exporter  | Online | 1.8     |
| UI        | Online | 3.2     |

> "The only way to predict the future is to invent it."
> — Alan Kay

---

*Ready for conversion.*`;

        // Initialize editor
        markdownInput.value = initialMarkdown;
        updatePreview();

        // Real-time preview update
        markdownInput.addEventListener('input', () => {
            updatePreview();
            updateStats();
            updateStatus('INPUT_UPDATED', 'success');
        });

        // Update statistics
        function updateStats() {
            const text = markdownInput.value;
            stats.chars = text.length;
            stats.words = text.trim() ? text.trim().split(/\s+/).length : 0;
            stats.lines = text.split('\n').length;
            
            charCount.textContent = stats.chars;
            wordCount.textContent = stats.words;
            lineCount.textContent = stats.lines;
            stats.lastUpdate = Date.now();
        }

        // Update preview
        function updatePreview() {
            const markdownText = markdownInput.value;
            const html = converter.makeHtml(markdownText);
            previewOutput.innerHTML = html;
            updateStats();
            previewStatus.textContent = 'LIVE';
            previewStatus.style.color = 'var(--neon-green)';
        }

        // Export HTML
        function exportHTML() {
            showLoading(true);
            const html = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberDeck Export</title>
    <style>
        :root {
            --neon-green: #00ff00;
            --dark-0: #000000;
            --dark-1: #0a0a0a;
            --dark-2: #111111;
            --dark-3: #1a1a1a;
            --dark-4: #222222;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: var(--dark-0);
            color: #e0e0e0;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        h1, h2, h3, h4, h5, h6 {
            color: var(--neon-green);
            border-bottom: 1px solid var(--neon-green);
            padding-bottom: 5px;
        }
        
        code {
            background: var(--dark-3);
            color: var(--neon-green);
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        pre {
            background: var(--dark-2);
            border: 1px solid var(--dark-4);
            border-left: 3px solid var(--neon-green);
            padding: 15px;
            overflow-x: auto;
        }
        
        blockquote {
            border-left: 3px solid var(--neon-green);
            margin: 15px 0;
            padding-left: 15px;
            color: #b0b0b0;
            font-style: italic;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            border: 1px solid var(--dark-4);
        }
        
        th, td {
            padding: 10px;
            border: 1px solid var(--dark-4);
        }
        
        th {
            background: var(--dark-3);
            color: var(--neon-green);
        }
        
        tr:nth-child(even) {
            background: rgba(0, 255, 0, 0.05);
        }
        
        a {
            color: var(--neon-green);
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    ${previewOutput.innerHTML}
    <footer style="margin-top: 50px; padding-top: 20px; border-top: 1px solid var(--dark-4); font-size: 0.8em; color: #666;">
        Generated by CyberDeck MD Terminal | ${new Date().toLocaleString()}
    </footer>
</body>
</html>`;
            
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cyberdeck-export-${Date.now()}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showLoading(false);
            showStatus('HTML_EXPORTED', 'success');
        }

        // Export PDF
        async function exportPDF() {
            showLoading(true);
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                // Capture the preview output
                const element = document.getElementById('preview-output');
                
                // Add some styling for PDF
                const tempElement = element.cloneNode(true);
                tempElement.style.padding = '20px';
                tempElement.style.fontFamily = 'Arial, sans-serif';
                tempElement.style.color = '#000000';
                tempElement.style.backgroundColor = '#ffffff';
                
                // Create a container for PDF
                const pdfContainer = document.createElement('div');
                pdfContainer.style.cssText = `
                    position: absolute;
                    left: -9999px;
                    top: -9999px;
                    width: 210mm;
                    padding: 20mm;
                    background: white;
                    color: black;
                    font-family: Arial, sans-serif;
                `;
                pdfContainer.innerHTML = element.innerHTML;
                document.body.appendChild(pdfContainer);

                // Convert to canvas
                const canvas = await html2canvas(pdfContainer, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                });
                
                document.body.removeChild(pdfContainer);

                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 210; // A4 width in mm
                const pageHeight = 297; // A4 height in mm
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                let heightLeft = imgHeight;
                let position = 0;
                
                // Add first page
                doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                // Add additional pages if content is too long
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    doc.addPage();
                    doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                // Add footer
                const totalPages = doc.internal.getNumberOfPages();
                for (let i = 1; i <= totalPages; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(100);
                    doc.text(
                        `CyberDeck MD Export - Page ${i} of ${totalPages}`,
                        105,
                        287,
                        { align: 'center' }
                    );
                    doc.text(
                        new Date().toLocaleDateString(),
                        200,
                        287,
                        { align: 'right' }
                    );
                }
                
                doc.save(`cyberdeck-export-${Date.now()}.pdf`);
                showLoading(false);
                showStatus('PDF_GENERATED', 'success');
                
            } catch (error) {
                console.error('PDF Generation Error:', error);
                showLoading(false);
                showStatus('PDF_GENERATION_FAILED', 'error');
            }
        }

        // Clear all content
        function clearAll() {
            if (confirm('Clear all content?')) {
                markdownInput.value = '';
                updatePreview();
                showStatus('CONTENT_CLEARED', 'warning');
            }
        }

        // Insert sample markdown
        function insertSample() {
            markdownInput.value = initialMarkdown;
            updatePreview();
            showStatus('SAMPLE_LOADED', 'success');
        }

        // Copy HTML to clipboard
        async function copyToClipboard() {
            try {
                const html = previewOutput.innerHTML;
                await navigator.clipboard.writeText(html);
                showStatus('HTML_COPIED', 'success');
            } catch (err) {
                console.error('Copy failed:', err);
                showStatus('COPY_FAILED', 'error');
            }
        }

        // Toggle fullscreen
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.error(`Error attempting to enable fullscreen: ${err.message}`);
                });
                showStatus('FULLSCREEN_ENABLED', 'success');
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                    showStatus('FULLSCREEN_DISABLED', 'info');
                }
            }
        }

        // Show/hide loading
        function showLoading(show) {
            loading.style.display = show ? 'block' : 'none';
        }

        // Show status message
        function showStatus(message, type = 'info') {
            statusMessage.textContent = `[${getTimestamp()}] ${message}`;
            statusMessage.style.borderColor = type === 'error' ? '#ff0033' : 
                                           type === 'warning' ? '#ff9900' : 
                                           type === 'success' ? 'var(--neon-green)' : 
                                           'var(--neon-green)';
            statusMessage.style.display = 'block';
            
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 3000);
        }

        // Update status indicator
        function updateStatus(message, type) {
            inputStatus.textContent = message;
            inputStatus.style.color = type === 'success' ? 'var(--neon-green)' : 
                                    type === 'error' ? '#ff0033' : 
                                    '#ff9900';
        }

        // Get timestamp
        function getTimestamp() {
            const now = new Date();
            return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
        }

        // Close modal
        function closeModal() {
            pdfModal.style.display = 'none';
        }

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Create inline service worker
                const swContent = `
self.addEventListener('install', (event) => {
    event.waitUntil(
        caches.open('cyberdeck-v1').then((cache) => {
            return cache.addAll([
                './',
                'https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js',
                'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js',
                'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js'
            ]);
        })
    );
});

self.addEventListener('fetch', (event) => {
    event.respondWith(
        caches.match(event.request).then((response) => {
            return response || fetch(event.request);
        })
    );
});
                `;

                const blob = new Blob([swContent], { type: 'application/javascript' });
                const swURL = URL.createObjectURL(blob);

                navigator.serviceWorker.register(swURL)
                    .then(registration => {
                        console.log('Service Worker registered:', registration);
                        showStatus('PWA_READY', 'success');
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + S - Save HTML
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                exportHTML();
            }
            
            // Ctrl/Cmd + P - Export PDF
            if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                e.preventDefault();
                exportPDF();
            }
            
            // Ctrl/Cmd + E - Clear
            if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                e.preventDefault();
                clearAll();
            }
            
            // Ctrl/Cmd + L - Load sample
            if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
                e.preventDefault();
                insertSample();
            }
            
            // Escape - Close modal
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Initialize
        updateStats();
        showStatus('SYSTEM_READY', 'success');

        // Before install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showStatus('PWA_INSTALL_AVAILABLE', 'info');
        });

        // Offline/Online detection
        window.addEventListener('online', () => {
            showStatus('CONNECTION_RESTORED', 'success');
        });

        window.addEventListener('offline', () => {
            showStatus('OFFLINE_MODE_ACTIVE', 'warning');
        });

        // Auto-save to localStorage
        setInterval(() => {
            if (markdownInput.value) {
                localStorage.setItem('cyberdeck-autosave', markdownInput.value);
                updateStatus('AUTOSAVED', 'info');
            }
        }, 30000);

        // Load auto-saved content
        const autosave = localStorage.getItem('cyberdeck-autosave');
        if (autosave) {
            if (confirm('Load auto-saved content?')) {
                markdownInput.value = autosave;
                updatePreview();
                showStatus('AUTOSAVE_LOADED', 'success');
            }
        }
    </script>
</body>
</html>
