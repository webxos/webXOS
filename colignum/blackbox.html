<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>MYSTERIUM BLACKBOX · COLIGNUM TESSERACT (MONOCHROME)</title>
    <style>
        /* ---------- GROUNDING: PURE BLACK & WHITE ---------- */
        body {
            margin: 0;
            overflow: hidden;
            background-color: black;
            font-family: 'Courier New', Courier, monospace;
        }
        /* buttons: black bg, white border, white text, invert on hover */
        .action-btn {
            position: absolute;
            background: black;
            color: white;
            border: 2.5px solid white;
            padding: 12px 28px;
            font-family: 'Courier New', monospace;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 5px;
            font-size: 15px;
            cursor: pointer;
            z-index: 300;
            transition: 0.2s cubic-bezier(0.2, 0.9, 0.4, 1);
            box-shadow: 0 0 0 rgba(255,255,255,0);
            backdrop-filter: blur(2px);
        }
        .action-btn:hover {
            background: white;
            color: black;
            border-color: black;
            box-shadow: 0 0 28px white;
            letter-spacing: 8px;
        }
        #grounding-btn {
            top: 18px;
            right: 24px;
        }
        #fullscreen-btn {
            top: 18px;
            right: 240px; /* adjust based on grounding button width */
        }
        /* info badge — now white on black */
        #info-badge {
            position: absolute;
            top: 18px;
            left: 24px;
            color: white;
            background: black;
            border: 1.5px solid white;
            padding: 8px 18px;
            z-index: 300;
            font-size: 14px;
            letter-spacing: 3px;
            text-transform: uppercase;
            box-shadow: 0 0 12px rgba(255,255,255,0.2);
            backdrop-filter: blur(2px);
            pointer-events: none;
        }
        /* CLI: black & white only */
        #cli-container {
            position: absolute;
            bottom: 24px;
            left: 24px;
            right: 24px;
            background: rgba(0,0,0,0.92);
            border: 2px solid white;
            color: white;
            padding: 18px 22px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            z-index: 400;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 40px rgba(255,255,255,0.15), inset 0 0 8px rgba(255,255,255,0.2);
            display: flex;
            flex-direction: column;
            border-radius: 0px;
        }
        #cli-output {
            height: 100px;
            overflow-y: auto;
            margin-bottom: 14px;
            border-bottom: 1px solid white;
            padding-bottom: 12px;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: white;
            text-shadow: 0 0 4px white;
            font-size: 15px;
            line-height: 1.5;
        }
        #cli-input-line {
            display: flex;
            align-items: center;
            border-top: 1px dashed white;
            padding-top: 10px;
        }
        .prompt {
            color: white;
            margin-right: 15px;
            font-weight: bold;
            text-shadow: 0 0 5px white;
            font-size: 17px;
        }
        #cli-input {
            flex: 1;
            background: black;
            border: 1.5px solid white;
            color: white;
            padding: 12px 18px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            outline: none;
            box-shadow: inset 0 0 10px rgba(255,255,255,0.1);
            caret-color: white;
        }
        #cli-input:focus {
            border-color: white;
            box-shadow: 0 0 18px white, inset 0 0 8px black;
        }
        /* FACE TERMINALS — now white borders, white text */
        .face-terminal {
            background: black;
            border: 2.5px solid white;
            color: white;
            padding: 16px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            width: 220px;
            height: 160px;
            overflow: auto;
            box-shadow: 0 0 24px rgba(255,255,255,0.2), inset 0 0 12px black;
            text-shadow: 0 0 6px white;
            backdrop-filter: blur(1px);
            word-wrap: break-word;
            line-height: 1.5;
            transition: border 0.1s;
            resize: none;
            scrollbar-width: thin;
            scrollbar-color: white black;
        }
        .face-terminal::-webkit-scrollbar {
            width: 6px;
        }
        .face-terminal::-webkit-scrollbar-track {
            background: black;
            border-left: 1px solid white;
        }
        .face-terminal::-webkit-scrollbar-thumb {
            background: white;
            border-radius: 0px;
        }
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: black;
        }
    </style>
</head>
<body>
    <div id="info-badge">⚿ COLIGNUM: MYSTERIUM BLACKBOX // TESSERACT:6 FACES ⚿</div>
    
    <button id="grounding-btn" class="action-btn">⌨ GROUNDING MODE ⌨</button>
    <button id="fullscreen-btn" class="action-btn">⛶ FULLSCREEN</button>

    <div id="cli-container">
        <div id="cli-output">
> MYSTERIUM BLACKBOX [BOOT]: TESSERACT WIREFRAME ACTIVE.
> MONOCHROME MODE: ALL GREEN PURGED.
        </div>
        <div id="cli-input-line">
            <span class="prompt">BLACKBOX:/modify $</span>
            <input type="text" id="cli-input" placeholder="/modify 1 &lt;h1&gt;HELLO&lt;/h1&gt;   or   /help" autofocus spellcheck="false">
        </div>
    </div>

    <div id="canvas-container"></div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.128.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.128.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { CSS2DRenderer, CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';

        // ---------- SCENE: PURE BLACK INFINITE VOID ----------
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000000);

        // ---------- CAMERA: CENTERED & CLOSER FOR IMPACT ----------
        const camera = new THREE.PerspectiveCamera(48, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(2.5, 1.5, 4.5);  // more centered
        camera.lookAt(0, 0, 0);

        // ---------- RENDERERS ----------
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const css2DRenderer = new CSS2DRenderer();
        css2DRenderer.setSize(window.innerWidth, window.innerHeight);
        css2DRenderer.domElement.style.position = 'absolute';
        css2DRenderer.domElement.style.top = '0px';
        css2DRenderer.domElement.style.left = '0px';
        css2DRenderer.domElement.style.pointerEvents = 'none';
        document.getElementById('canvas-container').appendChild(css2DRenderer.domElement);

        // ---------- CONTROLS: AUTO-ROTATE, SMOOTHER ----------
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.06;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.8;
        controls.enableZoom = true;
        controls.enablePan = true;
        controls.enableRotate = true;
        controls.rotateSpeed = 0.7;
        controls.zoomSpeed = 1.0;

        // subtle ambient to reveal depth
        const ambient = new THREE.AmbientLight(0x404040);
        scene.add(ambient);
        const backLight = new THREE.DirectionalLight(0xffffff, 0.3);
        backLight.position.set(-1, 0.5, -1);
        scene.add(backLight);

        // ---------- TESSERACT WIREFRAME (MONOCHROME) ----------
        // OUTER CUBE (size 2.0) — bright white
        const outerGeo = new THREE.BoxGeometry(2.0, 2.0, 2.0);
        const outerEdges = new THREE.EdgesGeometry(outerGeo);
        const outerLines = new THREE.LineSegments(outerEdges, new THREE.LineBasicMaterial({ color: 0xffffff }));
        scene.add(outerLines);

        // INNER CUBE (size 1.0) — light grey
        const innerGeo = new THREE.BoxGeometry(1.0, 1.0, 1.0);
        const innerEdges = new THREE.EdgesGeometry(innerGeo);
        const innerLines = new THREE.LineSegments(innerEdges, new THREE.LineBasicMaterial({ color: 0xaaaaaa }));
        scene.add(innerLines);

        // CONNECTORS: white with low opacity? let's use 0x888888
        const outerCorners = [
            new THREE.Vector3(-1, -1, -1), new THREE.Vector3( 1, -1, -1), new THREE.Vector3( 1, -1,  1), new THREE.Vector3(-1, -1,  1),
            new THREE.Vector3(-1,  1, -1), new THREE.Vector3( 1,  1, -1), new THREE.Vector3( 1,  1,  1), new THREE.Vector3(-1,  1,  1)
        ];
        const innerCorners = [
            new THREE.Vector3(-0.5, -0.5, -0.5), new THREE.Vector3( 0.5, -0.5, -0.5), new THREE.Vector3( 0.5, -0.5,  0.5), new THREE.Vector3(-0.5, -0.5,  0.5),
            new THREE.Vector3(-0.5,  0.5, -0.5), new THREE.Vector3( 0.5,  0.5, -0.5), new THREE.Vector3( 0.5,  0.5,  0.5), new THREE.Vector3(-0.5,  0.5,  0.5)
        ];

        const connectorVertices = [];
        for (let i = 0; i < 8; i++) {
            connectorVertices.push(outerCorners[i], innerCorners[i]);
        }
        const connectorGeo = new THREE.BufferGeometry().setFromPoints(connectorVertices);
        const connectorLines = new THREE.LineSegments(connectorGeo, new THREE.LineBasicMaterial({ color: 0x888888 }));
        scene.add(connectorLines);

        // ---------- 6 FACES WITH TERMINAL DIVS (now white text) ----------
        const facePositions = [
            { pos: [ 1, 0, 0], name: 'RIGHT: FACE 1' },
            { pos: [-1, 0, 0], name: 'LEFT: FACE 2' },
            { pos: [ 0, 1, 0], name: 'TOP: FACE 3' },
            { pos: [ 0,-1, 0], name: 'BOTTOM: FACE 4' },
            { pos: [ 0, 0, 1], name: 'FRONT: FACE 5' },
            { pos: [ 0, 0,-1], name: 'BACK: FACE 6' }
        ];

        const faceDivs = [];

        facePositions.forEach((face, idx) => {
            const div = document.createElement('div');
            div.className = 'face-terminal';
            div.id = `face-${idx + 1}`;
            
            // Default terminal content — white only
            div.innerHTML = `
                <span style="color:white; font-weight:bold;">⚡ MYSTERIUM BLACKBOX [FACE ${idx+1}]</span><br>
                <span style="color:#ccc;">> tesseract terminal</span><br>
                <span style="color:#888;">HTML template ready.</span><br>
                <span style="color:white;">$ /modify ${idx+1} &lt;your&gt;html&lt;/your&gt;</span>
            `;

            const css2dLabel = new CSS2DObject(div);
            css2dLabel.position.set(face.pos[0], face.pos[1], face.pos[2]);
            scene.add(css2dLabel);
            
            faceDivs.push(div);
        });

        // ---------- GROUNDING MODE (monochrome version) ----------
        function groundingMode() {
            const output = document.getElementById('cli-output');
            const glRenderer = renderer.capabilities?.renderer || 'unknown (WebGL)';
            const glVendor = renderer.capabilities?.vendor || 'unknown';
            
            const specs = {
                'BROWSER': navigator.userAgent.substring(0, 80) + '…',
                'SCREEN': `${window.screen.width}×${window.screen.height}`,
                'VIEWPORT': `${window.innerWidth}×${window.innerHeight}`,
                'PIXEL RATIO': window.devicePixelRatio.toFixed(2),
                'WEBGL': glRenderer,
                'VENDOR': glVendor,
                'MAX TEXTURE': renderer.capabilities?.maxTextureSize || 'n/a',
                'AUTO-ROTATE': controls.autoRotate ? 'ON' : 'OFF'
            };

            let report = '\n> ⌲⌲ GROUNDING MODE ⌲⌲ (MONOCHROME TESSERACT)\n';
            for (let [k, v] of Object.entries(specs)) {
                report += `  ${k.padEnd(14)}: ${v}\n`;
            }
            report += '> Renderer pixel ratio capped to 2 for performance.\n';
            report += '> TESSERACT: 6 FACES ACTIVE — READY FOR HTML INJECTION.\n';
            output.innerHTML += report;
            output.scrollTop = output.scrollHeight;

            const ratio = Math.min(window.devicePixelRatio, 2.0);
            renderer.setPixelRatio(ratio);
            css2DRenderer.setPixelRatio(ratio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            css2DRenderer.setSize(window.innerWidth, window.innerHeight);
        }

        // ---------- CLI COMMAND PARSER (unchanged except colors) ----------
        const cliInput = document.getElementById('cli-input');
        const cliOutput = document.getElementById('cli-output');

        function processCommand(cmd) {
            const trimmed = cmd.trim();
            if (!trimmed) return;

            cliOutput.innerHTML += `> ${trimmed}\n`;

            if (trimmed === '/help') {
                cliOutput.innerHTML += `  AVAILABLE COMMANDS:\n`;
                cliOutput.innerHTML += `  /modify [1-6] [HTML]  — set face content (raw HTML)\n`;
                cliOutput.innerHTML += `  /grounding            — run GUI grounding / spec probe\n`;
                cliOutput.innerHTML += `  /rotate toggle        — auto-rotation on/off\n`;
                cliOutput.innerHTML += `  /clear                — clear output\n`;
                cliOutput.innerHTML += `  /reset-faces          — reset all faces to default template\n`;
            }
            else if (trimmed === '/grounding') {
                groundingMode();
            }
            else if (trimmed === '/clear') {
                cliOutput.innerHTML = '> output cleared.\n';
            }
            else if (trimmed === '/rotate toggle') {
                controls.autoRotate = !controls.autoRotate;
                cliOutput.innerHTML += `  auto-rotation: ${controls.autoRotate ? 'ON' : 'OFF'}\n`;
            }
            else if (trimmed === '/reset-faces') {
                faceDivs.forEach((div, i) => {
                    div.innerHTML = `
                        <span style="color:white; font-weight:bold;">⚡ MYSTERIUM BLACKBOX [FACE ${i+1}]</span><br>
                        <span style="color:#ccc;">> tesseract terminal</span><br>
                        <span style="color:#888;">HTML template ready.</span><br>
                        <span style="color:white;">$ /modify ${i+1} &lt;html&gt;</span>
                    `;
                });
                cliOutput.innerHTML += `  all faces reset to default template.\n`;
            }
            else if (trimmed.startsWith('/modify')) {
                const parts = trimmed.split(' ');
                if (parts.length < 3) {
                    cliOutput.innerHTML += `  ERROR: /modify requires face number and HTML content.\n`;
                } else {
                    const faceIndex = parseInt(parts[1]);
                    if (faceIndex >= 1 && faceIndex <= 6) {
                        const firstSpace = trimmed.indexOf(' ');
                        const secondSpace = trimmed.indexOf(' ', firstSpace + 1);
                        let htmlContent = '';
                        if (secondSpace === -1) {
                            htmlContent = '';
                        } else {
                            htmlContent = trimmed.slice(secondSpace + 1).trim();
                            if ((htmlContent.startsWith('"') && htmlContent.endsWith('"')) || 
                                (htmlContent.startsWith("'") && htmlContent.endsWith("'"))) {
                                htmlContent = htmlContent.slice(1, -1);
                            }
                        }
                        const targetDiv = faceDivs[faceIndex - 1];
                        if (htmlContent === '') {
                            targetDiv.innerHTML = '<span style="color:#888;">[empty HTML]</span>';
                        } else {
                            targetDiv.innerHTML = htmlContent;
                        }
                        cliOutput.innerHTML += `  ✅ FACE ${faceIndex} updated with HTML.\n`;
                    } else {
                        cliOutput.innerHTML += `  ERROR: face must be 1–6.\n`;
                    }
                }
            }
            else if (trimmed.startsWith('/')) {
                cliOutput.innerHTML += `  unknown command. try /help\n`;
            }
            else if (trimmed !== '') {
                cliOutput.innerHTML += `  commands start with /. use /help\n`;
            }

            cliOutput.scrollTop = cliOutput.scrollHeight;
        }

        cliInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                processCommand(cliInput.value);
                cliInput.value = '';
            }
        });

        // ---------- FULLSCREEN TOGGLE ----------
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        fullscreenBtn.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                fullscreenBtn.textContent = '⛶ EXIT FULLSCREEN';
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                    fullscreenBtn.textContent = '⛶ FULLSCREEN';
                }
            }
        });
        // Update button text if user exits via ESC
        document.addEventListener('fullscreenchange', () => {
            if (!document.fullscreenElement) {
                fullscreenBtn.textContent = '⛶ FULLSCREEN';
            }
        });

        // ---------- WINDOW RESIZE ----------
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            css2DRenderer.setSize(window.innerWidth, window.innerHeight);
        });

        // ---------- INIT ----------
        window.addEventListener('load', () => {
            groundingMode();
            cliOutput.innerHTML += '> WELCOME TO COLIGNUM: MYSTERIUM BLACKBOX (MONOCHROME).\n';
            cliOutput.innerHTML += '> Try: /modify 1 <marquee>⚡ DEEP HTML ⚡</marquee>\n';
            cliOutput.innerHTML += '> Each face is an isolated page. /help for more.\n';
        });

        document.getElementById('grounding-btn').addEventListener('click', groundingMode);

        // ---------- ANIMATION LOOP ----------
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
            css2DRenderer.render(scene, camera);
        }
        animate();

        css2DRenderer.domElement.style.pointerEvents = 'none';
    </script>
</body>
</html>
