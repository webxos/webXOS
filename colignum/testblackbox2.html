<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>MYSTERIUM BLACKBOX · 6× POINT CLOUD EXPLOSIONS</title>
    <style>
        /* ---------- GROUNDING: PURE BLACK & WHITE ---------- */
        body {
            margin: 0;
            overflow: hidden;
            background-color: black;
            font-family: 'Courier New', Courier, monospace;
        }
        .action-btn {
            position: absolute;
            background: black;
            color: white;
            border: 2.5px solid white;
            padding: 12px 28px;
            font-family: 'Courier New', monospace;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 5px;
            font-size: 15px;
            cursor: pointer;
            z-index: 300;
            transition: 0.2s cubic-bezier(0.2, 0.9, 0.4, 1);
            box-shadow: 0 0 0 rgba(255,255,255,0);
            backdrop-filter: blur(2px);
        }
        .action-btn:hover {
            background: white;
            color: black;
            border-color: black;
            box-shadow: 0 0 28px white;
            letter-spacing: 8px;
        }
        #grounding-btn {
            top: 18px;
            right: 24px;
        }
        #fullscreen-btn {
            top: 18px;
            right: 240px;
        }
        #info-badge {
            position: absolute;
            top: 18px;
            left: 24px;
            color: white;
            background: black;
            border: 1.5px solid white;
            padding: 8px 18px;
            z-index: 300;
            font-size: 14px;
            letter-spacing: 3px;
            text-transform: uppercase;
            box-shadow: 0 0 12px rgba(255,255,255,0.2);
            backdrop-filter: blur(2px);
            pointer-events: none;
        }
        /* CLI container */
        #cli-container {
            position: absolute;
            bottom: 24px;
            left: 24px;
            right: 24px;
            background: rgba(0,0,0,0.92);
            border: 2px solid white;
            color: white;
            padding: 18px 22px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            z-index: 400;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 40px rgba(255,255,255,0.15), inset 0 0 8px rgba(255,255,255,0.2);
            display: flex;
            flex-direction: column;
            border-radius: 0px;
        }
        #cli-output {
            height: 120px;
            overflow-y: auto;
            margin-bottom: 14px;
            border-bottom: 1px solid white;
            padding-bottom: 12px;
            white-space: pre-wrap;
            word-wrap: break-word;
            color: white;
            text-shadow: 0 0 4px white;
            font-size: 15px;
            line-height: 1.5;
        }
        #cli-input-line {
            display: flex;
            align-items: center;
            border-top: 1px dashed white;
            padding-top: 10px;
        }
        .prompt {
            color: white;
            margin-right: 15px;
            font-weight: bold;
            text-shadow: 0 0 5px white;
            font-size: 17px;
        }
        #cli-input {
            flex: 1;
            background: black;
            border: 1.5px solid white;
            color: white;
            padding: 12px 18px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            outline: none;
            box-shadow: inset 0 0 10px rgba(255,255,255,0.1);
            caret-color: white;
        }
        #cli-input:focus {
            border-color: white;
            box-shadow: 0 0 18px white, inset 0 0 8px black;
        }
        /* FACE TERMINALS — contain iframes */
        .face-terminal {
            background: black;
            border: 3px solid white;
            color: white;
            padding: 0;
            width: 320px;
            height: 240px;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(255,255,255,0.25), inset 0 0 15px black;
            backdrop-filter: blur(1px);
            pointer-events: auto;
            cursor: default;
        }
        .face-terminal iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: black;
            pointer-events: auto;
        }
        /* EDITOR MODAL – split screen, black/white */
        #editor-modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            width: 90%;
            max-width: 1400px;
            height: 80%;
            background: black;
            border: 3px solid white;
            box-shadow: 0 0 60px white;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid white;
            padding-bottom: 12px;
            margin-bottom: 20px;
        }
        .modal-header h2 {
            color: white;
            font-size: 24px;
            letter-spacing: 4px;
            margin: 0;
            text-transform: uppercase;
        }
        .modal-close {
            background: black;
            color: white;
            border: 2px solid white;
            font-size: 24px;
            width: 50px;
            height: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }
        .modal-close:hover {
            background: white;
            color: black;
        }
        .split-pane {
            display: flex;
            flex: 1;
            gap: 20px;
            min-height: 0;
        }
        .editor-pane, .preview-pane {
            flex: 1;
            display: flex;
            flex-direction: column;
            border: 1px solid white;
            background: black;
        }
        .pane-label {
            color: white;
            padding: 10px;
            border-bottom: 1px solid white;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        #html-editor {
            flex: 1;
            background: black;
            color: white;
            border: none;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: none;
            outline: none;
            white-space: pre-wrap;
        }
        #preview-frame {
            flex: 1;
            width: 100%;
            border: none;
            background: white;
        }
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 20px;
            margin-top: 20px;
            border-top: 1px solid white;
            padding-top: 20px;
        }
        .modal-btn {
            background: black;
            color: white;
            border: 2px solid white;
            padding: 12px 36px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: bold;
            letter-spacing: 3px;
            cursor: pointer;
            transition: 0.2s;
        }
        .modal-btn:hover {
            background: white;
            color: black;
        }
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: black;
        }
    </style>
</head>
<body>
    <div id="info-badge">⚿ 6× POINT CLOUD EXPLOSIONS (DOUBLE‑CLICK TO EDIT) ⚿</div>
    
    <button id="grounding-btn" class="action-btn">⌨ GROUNDING MODE ⌨</button>
    <button id="fullscreen-btn" class="action-btn">⛶ FULLSCREEN</button>

    <div id="cli-container">
        <div id="cli-output">
> MYSTERIUM BLACKBOX [BOOT]: TESSERACT WIREFRAME ACTIVE.
> ALL SIX FACES RUNNING INDEPENDENT POINT CLOUD EXPLOSIONS.
        </div>
        <div id="cli-input-line">
            <span class="prompt">BLACKBOX:/modify $</span>
            <input type="text" id="cli-input" placeholder="/modify 1 &lt;h1&gt;HELLO&lt;/h1&gt;   or   /help" autofocus spellcheck="false">
        </div>
    </div>

    <!-- EDITOR MODAL -->
    <div id="editor-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>✎ EDIT FACE · RAW HTML (standalone page)</h2>
                <div class="modal-close" id="modal-close">✕</div>
            </div>
            <div class="split-pane">
                <div class="editor-pane">
                    <div class="pane-label">⌨ HTML SOURCE</div>
                    <textarea id="html-editor" spellcheck="false" placeholder="Paste any full HTML document here..."></textarea>
                </div>
                <div class="preview-pane">
                    <div class="pane-label">⚡ LIVE PREVIEW</div>
                    <iframe id="preview-frame" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn" id="save-btn">SAVE TO FACE</button>
                <button class="modal-btn" id="cancel-btn">CANCEL</button>
            </div>
        </div>
    </div>

    <div id="canvas-container"></div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.128.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.128.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { CSS2DRenderer, CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';

        // ---------- POINT CLOUD EXPLOSION HTML (standalone) ----------
        const pointCloudHTML = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automated Point Cloud Explosion</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.128.0/build/three.module.js"
            }
        }
    <\/script>

    <script type="module">
        import * as THREE from 'three';

        // --- Configuration ---
        const PARTICLE_COUNT = 15000;
        const EXPLOSION_SPEED = 0.5;        // base speed multiplier
        const PARTICLE_SIZE = 0.15;          // size of each point

        // --- Scene Setup ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 100;

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        // --- Point Cloud Creation ---
        const geometry = new THREE.BufferGeometry();
        const positions = new Float32Array(PARTICLE_COUNT * 3);
        const velocities = new Float32Array(PARTICLE_COUNT * 3);

        for (let i = 0; i < PARTICLE_COUNT; i++) {
            // Start all particles at the center (0,0,0)
            positions[i * 3] = 0;
            positions[i * 3 + 1] = 0;
            positions[i * 3 + 2] = 0;

            // Assign a random outward velocity (spherical distribution)
            const theta = Math.random() * Math.PI * 2;
            const phi = Math.acos((Math.random() * 2) - 1);
            const speed = Math.random() * EXPLOSION_SPEED;

            velocities[i * 3] = speed * Math.sin(phi) * Math.cos(theta);
            velocities[i * 3 + 1] = speed * Math.sin(phi) * Math.sin(theta);
            velocities[i * 3 + 2] = speed * Math.cos(phi);
        }

        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

        const material = new THREE.PointsMaterial({
            color: 0xffffff,               // pure white
            size: PARTICLE_SIZE,
            transparent: true,
            opacity: 0.9,                   // slightly more opaque
            blending: THREE.AdditiveBlending // glowing effect
        });

        const points = new THREE.Points(geometry, material);
        scene.add(points);

        // --- Animation Loop ---
        function animate() {
            requestAnimationFrame(animate);

            const positionAttr = geometry.attributes.position;
            const posArray = positionAttr.array;

            for (let i = 0; i < PARTICLE_COUNT; i++) {
                // Update position by adding velocity
                posArray[i * 3]     += velocities[i * 3];
                posArray[i * 3 + 1] += velocities[i * 3 + 1];
                posArray[i * 3 + 2] += velocities[i * 3 + 2];
            }

            // Mark the attribute as needing an update
            positionAttr.needsUpdate = true;

            // Subtle camera rotation for depth (rotates the entire cloud)
            points.rotation.y += 0.002;

            renderer.render(scene, camera);
        }

        // --- Handle Resize ---
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Start automatically
        animate();
    <\/script>
</body>
</html>`;

        // ---------- SCENE ----------
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000000);

        // ---------- CAMERA ----------
        const camera = new THREE.PerspectiveCamera(48, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(2.8, 1.8, 4.8);
        camera.lookAt(0, 0, 0);

        // ---------- RENDERERS ----------
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const css2DRenderer = new CSS2DRenderer();
        css2DRenderer.setSize(window.innerWidth, window.innerHeight);
        css2DRenderer.domElement.style.position = 'absolute';
        css2DRenderer.domElement.style.top = '0px';
        css2DRenderer.domElement.style.left = '0px';
        css2DRenderer.domElement.style.pointerEvents = 'none';
        document.getElementById('canvas-container').appendChild(css2DRenderer.domElement);

        // ---------- CONTROLS ----------
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.06;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.8;
        controls.enableZoom = true;
        controls.enablePan = true;
        controls.enableRotate = true;
        controls.rotateSpeed = 0.7;
        controls.zoomSpeed = 1.0;

        // subtle lights
        const ambient = new THREE.AmbientLight(0x404040);
        scene.add(ambient);
        const backLight = new THREE.DirectionalLight(0xffffff, 0.3);
        backLight.position.set(-1, 0.5, -1);
        scene.add(backLight);

        // ---------- TESSERACT WIREFRAME ----------
        const outerGeo = new THREE.BoxGeometry(2.0, 2.0, 2.0);
        const outerEdges = new THREE.EdgesGeometry(outerGeo);
        const outerLines = new THREE.LineSegments(outerEdges, new THREE.LineBasicMaterial({ color: 0xffffff }));
        scene.add(outerLines);

        const innerGeo = new THREE.BoxGeometry(1.0, 1.0, 1.0);
        const innerEdges = new THREE.EdgesGeometry(innerGeo);
        const innerLines = new THREE.LineSegments(innerEdges, new THREE.LineBasicMaterial({ color: 0xcccccc }));
        scene.add(innerLines);

        const outerCorners = [
            new THREE.Vector3(-1, -1, -1), new THREE.Vector3( 1, -1, -1), new THREE.Vector3( 1, -1,  1), new THREE.Vector3(-1, -1,  1),
            new THREE.Vector3(-1,  1, -1), new THREE.Vector3( 1,  1, -1), new THREE.Vector3( 1,  1,  1), new THREE.Vector3(-1,  1,  1)
        ];
        const innerCorners = [
            new THREE.Vector3(-0.5, -0.5, -0.5), new THREE.Vector3( 0.5, -0.5, -0.5), new THREE.Vector3( 0.5, -0.5,  0.5), new THREE.Vector3(-0.5, -0.5,  0.5),
            new THREE.Vector3(-0.5,  0.5, -0.5), new THREE.Vector3( 0.5,  0.5, -0.5), new THREE.Vector3( 0.5,  0.5,  0.5), new THREE.Vector3(-0.5,  0.5,  0.5)
        ];

        const connectorVertices = [];
        for (let i = 0; i < 8; i++) {
            connectorVertices.push(outerCorners[i], innerCorners[i]);
        }
        const connectorGeo = new THREE.BufferGeometry().setFromPoints(connectorVertices);
        const connectorLines = new THREE.LineSegments(connectorGeo, new THREE.LineBasicMaterial({ color: 0x888888 }));
        scene.add(connectorLines);

        // ---------- 6 FACES WITH IFRAMES (all running the explosion) ----------
        const facePositions = [
            { pos: [ 1, 0, 0], name: 'RIGHT: FACE 1' },
            { pos: [-1, 0, 0], name: 'LEFT: FACE 2' },
            { pos: [ 0, 1, 0], name: 'TOP: FACE 3' },
            { pos: [ 0,-1, 0], name: 'BOTTOM: FACE 4' },
            { pos: [ 0, 0, 1], name: 'FRONT: FACE 5' },
            { pos: [ 0, 0,-1], name: 'BACK: FACE 6' }
        ];

        const faceIframes = []; // store iframe elements for each face

        facePositions.forEach((face, idx) => {
            const div = document.createElement('div');
            div.className = 'face-terminal';
            div.id = `face-${idx + 1}`;
            
            // Create iframe with the point cloud explosion
            const iframe = document.createElement('iframe');
            iframe.setAttribute('sandbox', 'allow-scripts allow-same-origin allow-forms');
            iframe.srcdoc = pointCloudHTML; // set to explosion
            div.appendChild(iframe);
            
            faceIframes.push(iframe);

            // attach double-click listener to the div
            div.addEventListener('dblclick', (e) => {
                e.stopPropagation();
                openEditor(iframe, idx);
            });

            const css2dLabel = new CSS2DObject(div);
            css2dLabel.position.set(face.pos[0], face.pos[1], face.pos[2]);
            scene.add(css2dLabel);
        });

        // ---------- EDITOR MODAL LOGIC ----------
        const modal = document.getElementById('editor-modal');
        const editorTextarea = document.getElementById('html-editor');
        const previewFrame = document.getElementById('preview-frame');
        const saveBtn = document.getElementById('save-btn');
        const cancelBtn = document.getElementById('cancel-btn');
        const closeBtn = document.getElementById('modal-close');

        let currentIframe = null;
        let currentFaceIndex = -1;

        function openEditor(iframe, idx) {
            currentIframe = iframe;
            currentFaceIndex = idx;
            let content = iframe.srcdoc || '';
            editorTextarea.value = content;
            updatePreview(content);
            modal.style.display = 'flex';
        }

        function updatePreview(html) {
            previewFrame.srcdoc = html || '<!DOCTYPE html><html><body style="background:black;color:white;">(empty)</body></html>';
        }

        editorTextarea.addEventListener('input', () => {
            updatePreview(editorTextarea.value);
        });

        function saveChanges() {
            if (currentIframe) {
                currentIframe.srcdoc = editorTextarea.value;
            }
            closeModal();
        }

        function closeModal() {
            modal.style.display = 'none';
            currentIframe = null;
            currentFaceIndex = -1;
            editorTextarea.value = '';
            previewFrame.srcdoc = '';
        }

        saveBtn.addEventListener('click', saveChanges);
        cancelBtn.addEventListener('click', closeModal);
        closeBtn.addEventListener('click', closeModal);

        // ---------- GROUNDING MODE ----------
        function groundingMode() {
            const output = document.getElementById('cli-output');
            const glRenderer = renderer.capabilities ? (renderer.capabilities.renderer || 'unknown') : 'unknown';
            const glVendor = renderer.capabilities ? (renderer.capabilities.vendor || 'unknown') : 'unknown';
            
            const specs = {
                'BROWSER': navigator.userAgent.substring(0, 80) + '…',
                'SCREEN': `${window.screen.width}×${window.screen.height}`,
                'VIEWPORT': `${window.innerWidth}×${window.innerHeight}`,
                'PIXEL RATIO': window.devicePixelRatio.toFixed(2),
                'WEBGL': glRenderer,
                'VENDOR': glVendor,
                'MAX TEXTURE': renderer.capabilities ? renderer.capabilities.maxTextureSize : 'n/a',
                'AUTO-ROTATE': controls.autoRotate ? 'ON' : 'OFF'
            };

            let report = '\n> ⌲⌲ GROUNDING MODE ⌲⌲ (6× POINT CLOUD EXPLOSIONS)\n';
            for (let [k, v] of Object.entries(specs)) {
                report += `  ${k.padEnd(14)}: ${v}\n`;
            }
            report += '> Each face runs its own independent Three.js explosion.\n';
            report += '> Double‑click any face to edit its HTML.\n';
            output.innerHTML += report;
            output.scrollTop = output.scrollHeight;

            const ratio = Math.min(window.devicePixelRatio, 2.0);
            renderer.setPixelRatio(ratio);
            css2DRenderer.setPixelRatio(ratio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            css2DRenderer.setSize(window.innerWidth, window.innerHeight);
        }

        // ---------- CLI COMMAND PARSER ----------
        const cliInput = document.getElementById('cli-input');
        const cliOutput = document.getElementById('cli-output');

        function processCommand(cmd) {
            const trimmed = cmd.trim();
            if (!trimmed) return;

            cliOutput.innerHTML += `> ${trimmed}\n`;

            if (trimmed === '/help') {
                cliOutput.innerHTML += `  AVAILABLE COMMANDS:\n`;
                cliOutput.innerHTML += `  /modify [1-6] [HTML]  — set face content (full HTML document)\n`;
                cliOutput.innerHTML += `  /grounding            — run GUI grounding / spec probe\n`;
                cliOutput.innerHTML += `  /rotate toggle        — auto-rotation on/off\n`;
                cliOutput.innerHTML += `  /clear                — clear output\n`;
                cliOutput.innerHTML += `  /reset-faces          — reset all faces to point cloud explosion\n`;
            }
            else if (trimmed === '/grounding') {
                groundingMode();
            }
            else if (trimmed === '/clear') {
                cliOutput.innerHTML = '> output cleared.\n';
            }
            else if (trimmed === '/rotate toggle') {
                controls.autoRotate = !controls.autoRotate;
                cliOutput.innerHTML += `  auto-rotation: ${controls.autoRotate ? 'ON' : 'OFF'}\n`;
            }
            else if (trimmed === '/reset-faces') {
                faceIframes.forEach((iframe) => {
                    iframe.srcdoc = pointCloudHTML;
                });
                cliOutput.innerHTML += `  all faces reset to point cloud explosion.\n`;
            }
            else if (trimmed.startsWith('/modify')) {
                const parts = trimmed.split(' ');
                if (parts.length < 3) {
                    cliOutput.innerHTML += `  ERROR: /modify requires face number and HTML content.\n`;
                } else {
                    const faceIndex = parseInt(parts[1]);
                    if (faceIndex >= 1 && faceIndex <= 6) {
                        const firstSpace = trimmed.indexOf(' ');
                        const secondSpace = trimmed.indexOf(' ', firstSpace + 1);
                        let htmlContent = '';
                        if (secondSpace === -1) {
                            htmlContent = '';
                        } else {
                            htmlContent = trimmed.slice(secondSpace + 1).trim();
                            if ((htmlContent.startsWith('"') && htmlContent.endsWith('"')) || 
                                (htmlContent.startsWith("'") && htmlContent.endsWith("'"))) {
                                htmlContent = htmlContent.slice(1, -1);
                            }
                        }
                        const targetIframe = faceIframes[faceIndex - 1];
                        if (htmlContent === '') {
                            targetIframe.srcdoc = '<!DOCTYPE html><html><body style="background:black;color:white;">[empty]</body></html>';
                        } else {
                            targetIframe.srcdoc = htmlContent;
                        }
                        cliOutput.innerHTML += `  ✅ FACE ${faceIndex} updated with HTML.\n`;
                    } else {
                        cliOutput.innerHTML += `  ERROR: face must be 1–6.\n`;
                    }
                }
            }
            else if (trimmed.startsWith('/')) {
                cliOutput.innerHTML += `  unknown command. try /help\n`;
            }
            else if (trimmed !== '') {
                cliOutput.innerHTML += `  commands start with /. use /help\n`;
            }

            cliOutput.scrollTop = cliOutput.scrollHeight;
        }

        cliInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                processCommand(cliInput.value);
                cliInput.value = '';
            }
        });

        // ---------- FULLSCREEN TOGGLE ----------
        const fullscreenBtn = document.getElementById('fullscreen-btn');
        fullscreenBtn.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
                fullscreenBtn.textContent = '⛶ EXIT FULLSCREEN';
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                    fullscreenBtn.textContent = '⛶ FULLSCREEN';
                }
            }
        });
        document.addEventListener('fullscreenchange', () => {
            fullscreenBtn.textContent = document.fullscreenElement ? '⛶ EXIT FULLSCREEN' : '⛶ FULLSCREEN';
        });

        // ---------- WINDOW RESIZE ----------
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            css2DRenderer.setSize(window.innerWidth, window.innerHeight);
        });

        // ---------- INITIALIZATION ----------
        window.addEventListener('load', () => {
            groundingMode();
            cliOutput.innerHTML += '> WELCOME TO COLIGNUM: 6× POINT CLOUD EXPLOSIONS.\n';
            cliOutput.innerHTML += '> Double‑click any face to edit – paste your own HTML!\n';
        });

        document.getElementById('grounding-btn').addEventListener('click', groundingMode);

        // ---------- ANIMATION LOOP ----------
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
            css2DRenderer.render(scene, camera);
        }
        animate();

        // CSS2D container does not block clicks
        css2DRenderer.domElement.style.pointerEvents = 'none';
    </script>
</body>
</html>