<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>webXOS 2026</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.20.0/dist/tf.min.js"></script>
    <!-- GPU.js -->
    <script src="https://unpkg.com/gpu.js@latest/dist/gpu-browser.min.js"></script>
    <style>
        /* === EXACT ORIGINAL CSS === */
        :root {
            --terminal-black: #000000;
            --terminal-green: #00FF00;
            --terminal-red: #FF0000;
            --terminal-gray: #1E1E1E;
            --terminal-light-gray: #2D2D2D;
            --terminal-medium-gray: #3A3A3A;
            --terminal-border: #7A7A7A;
            --terminal-yellow: #FFFF00;
            --terminal-blue: #0000FF;
            --terminal-cyan: #00FFFF;
            --gpu-active: #00FF88;
            --gpu-inactive: #FF4444;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            image-rendering: pixelated;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            font-family: 'Courier New', monospace;
            background-color: var(--terminal-black);
            color: var(--terminal-green);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            touch-action: manipulation;
        }
        
        /* === GPU STATUS BAR === */
        .gpu-status-bar {
            position: fixed;
            top: 0;
            right: 0;
            background: rgba(30, 30, 30, 0.9);
            border-left: 2px solid var(--terminal-green);
            border-bottom: 2px solid var(--terminal-green);
            padding: 8px 16px;
            z-index: 2000;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 0.9rem;
            backdrop-filter: blur(5px);
        }
        .gpu-status-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .gpu-status-led {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        .gpu-status-led.active {
            background-color: var(--gpu-active);
            box-shadow: 0 0 10px var(--gpu-active);
        }
        .gpu-status-led.inactive {
            background-color: var(--gpu-inactive);
        }
        .gpu-kernel {
            color: var(--terminal-cyan);
            font-weight: bold;
        }
        .memory-usage {
            color: var(--terminal-yellow);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* === NEURAL DOT GALAXY BACKGROUND === */
        #galaxyCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        
        /* === ENHANCED LOADING SCREEN === */
        .loading-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--terminal-black);
            display: flex; align-items: center; justify-content: center;
            z-index: 9999; flex-direction: column;
            font-size: 1.2rem;
            text-align: center;
        }
        .loading-screen.hidden {
            display: none;
        }
        .loading-bar {
            width: 400px; height: 20px;
            background: var(--terminal-light-gray);
            margin-top: 40px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid var(--terminal-green);
            box-shadow: 0 0 20px var(--terminal-green), 0 0 40px var(--terminal-green);
        }
        .loading-fill {
            width: 0%; height: 100%;
            background: var(--terminal-green);
            box-shadow: 0 0 15px var(--terminal-green), 0 0 30px var(--terminal-green);
            transition: width 0.3s;
        }
        .webxos-logo {
            font-size: 6rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-shadow:
                0 0 10px var(--terminal-green),
                0 0 20px var(--terminal-green),
                0 0 30px var(--terminal-green),
                0 0 40px var(--terminal-green);
            animation: glow 2s infinite alternate, flow 3s infinite alternate;
            color: var(--terminal-green);
        }
        .webxos-subtitle {
            font-size: 1.5rem;
            color: var(--terminal-yellow);
            margin-bottom: 40px;
            text-shadow: 0 0 10px var(--terminal-yellow);
        }
        @keyframes glow {
            0% { text-shadow: 0 0 10px var(--terminal-green), 0 0 20px var(--terminal-green); }
            100% { text-shadow: 0 0 20px var(--terminal-green), 0 0 40px var(--terminal-green), 0 0 60px var(--terminal-green); }
        }
        @keyframes flow {
            0% { transform: translateY(0); }
            100% { transform: translateY(-15px); }
        }
        
        /* === TASKBAR === */
        .taskbar {
            height: 42px;
            background: var(--terminal-gray);
            border-top: 1px solid #fff;
            display: flex;
            align-items: center;
            padding: 0 6px;
            box-shadow: 0 -1px 3px rgba(0,0,0,0.5);
            z-index: 1000;
        }
        .start-btn {
            background: var(--terminal-black);
            border: 1px outset var(--terminal-green);
            padding: 4px 14px;
            font-weight: bold;
            color: var(--terminal-green);
            cursor: pointer;
            margin-right: 8px;
            font-size: 1rem;
            min-height: 32px;
        }
        .start-btn:active {
            border: 1px inset var(--terminal-green);
        }
        .taskbar-icons {
            display: flex;
            gap: 6px;
            flex-grow: 1;
        }
        .task-icon {
            width: 32px; height: 32px;
            background: var(--terminal-light-gray);
            border: 1px solid var(--terminal-medium-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
            color: var(--terminal-green);
        }
        .task-icon.active {
            background: var(--terminal-green);
            color: black;
        }
        .task-icon.admin {
            background: var(--terminal-blue);
            color: white;
        }
        .task-icon.metrics {
            background: var(--terminal-light-gray);
            color: var(--terminal-green);
        }
        .clock {
            margin-left: auto;
            font-size: 1rem;
            padding: 0 10px;
        }
        
        /* === DESKTOP === */
        .desktop {
            flex: 1;
            padding: 10px;
            overflow: auto;
            position: relative;
            background: transparent;
        }
        .desktop-icon {
            width: 90px;
            text-align: center;
            margin: 10px;
            cursor: pointer;
            font-size: 0.85rem;
            color: var(--terminal-green);
            transition: all 0.2s;
            position: absolute;
            user-select: none;
            -webkit-user-select: none;
            padding: 5px;
            border-radius: 5px;
        }
        .desktop-icon:hover {
            color: var(--terminal-yellow);
            background: rgba(0, 255, 0, 0.1);
            border-radius: 4px;
        }
        .desktop-icon.selected {
            background: rgba(0, 128, 0, 0.5);
            color: white;
        }
        .desktop-icon i {
            font-size: 36px;
            display: block;
            margin-bottom: 6px;
            filter: drop-shadow(0 0 3px var(--terminal-green));
        }
        .desktop-icon.folder i {
            color: var(--terminal-yellow);
            filter: drop-shadow(0 0 3px var(--terminal-yellow));
        }
        .desktop-icon.trash i {
            color: var(--terminal-red);
            filter: drop-shadow(0 0 3px var(--terminal-red));
        }
        .desktop-icon.metrics i {
            color: var(--terminal-green);
            filter: drop-shadow(0 0 3px var(--terminal-green));
        }
        
        /* === WINDOWS === */
        .win95-window {
            position: absolute;
            background: var(--terminal-gray);
            border: 2px solid var(--terminal-border);
            border-top-color: #fff;
            border-left-color: #fff;
            box-shadow: 3px 3px 8px rgba(0,0,0,0.8);
            min-width: 300px;
            min-height: 300px;
            display: none;
            flex-direction: column;
            max-width: 95vw;
            max-height: 85vh;
        }
        .win95-window.active {
            display: flex;
            z-index: 100;
        }
        .win95-window.maximized {
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: calc(100% - 42px) !important;
            max-width: 100vw;
            max-height: calc(100vh - 42px);
        }
        .title-bar {
            background: linear-gradient(90deg, #000080, #1084d0);
            color: white;
            padding: 6px 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            user-select: none;
            min-height: 32px;
        }
        .title-bar.admin {
            background: linear-gradient(90deg, #4B0082, #8A2BE2);
        }
        .title-bar.metrics {
            background: linear-gradient(90deg, #000080, #1084d0);
        }
        .title-bar button {
            width: 22px; height: 20px;
            background: var(--terminal-gray);
            border: 1px solid #fff;
            font-size: 12px;
            text-align: center;
            line-height: 12px;
            margin-left: 4px;
            cursor: pointer;
        }
        .title-bar button:last-child {
            background-color: var(--terminal-red);
            color: white;
        }
        .window-content {
            flex: 1;
            padding: 10px;
            overflow: auto;
            background: var(--terminal-black);
            display: flex;
            flex-direction: column;
        }
        
        /* === KERNEL OPS WINDOW === */
        .kernel-ops-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            flex-direction: column;
        }
        .kernel-header {
            padding: 12px 15px;
            background-color: var(--terminal-light-gray);
            border-bottom: 1px solid var(--terminal-medium-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1rem;
            color: var(--terminal-green);
            min-height: 44px;
        }
        .kernel-toolbar {
            display: flex;
            gap: 10px;
            padding: 10px 15px;
            background-color: var(--terminal-gray);
            border-bottom: 1px solid var(--terminal-medium-gray);
            align-items: center;
            flex-wrap: wrap;
            min-height: 50px;
        }
        .kernel-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: var(--terminal-black);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .kernel-panel {
            background: rgba(30, 30, 30, 0.8);
            border: 1px solid var(--terminal-medium-gray);
            border-radius: 5px;
            padding: 15px;
        }
        .kernel-panel-title {
            color: var(--terminal-yellow);
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--terminal-medium-gray);
            padding-bottom: 8px;
        }
        .agent-controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        .control-group {
            margin-bottom: 15px;
        }
        .control-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            color: var(--terminal-cyan);
        }
        input[type="range"] {
            width: 100%;
            height: 6px;
            background: var(--terminal-light-gray);
            border-radius: 3px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--terminal-green);
            border-radius: 50%;
            cursor: pointer;
        }
        .kernel-output {
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: var(--terminal-green);
            background: rgba(0, 20, 0, 0.5);
            padding: 10px;
            border: 1px solid var(--terminal-medium-gray);
            border-radius: 5px;
            overflow-x: auto;
            margin-bottom: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
        .btn {
            background: none;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--terminal-green);
            font-size: 0.9rem;
            background: var(--terminal-gray);
            border: 1px solid var(--terminal-medium-gray);
            min-height: 36px;
        }
        .btn:hover {
            background-color: var(--terminal-medium-gray);
        }
        .btn-primary {
            background-color: var(--terminal-blue);
            color: white;
        }
        .btn-primary:hover {
            background-color: #3367d6;
        }
        .kernel-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        .stat-item {
            background: rgba(40, 40, 40, 0.8);
            padding: 8px;
            border: 1px solid var(--terminal-medium-gray);
            border-radius: 4px;
        }
        .stat-label {
            font-size: 0.8rem;
            color: var(--terminal-yellow);
        }
        .stat-value {
            font-size: 1rem;
            color: var(--terminal-green);
            font-weight: bold;
        }
        
        /* === EDITOR STYLES === */
        .editor-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            flex-direction: column;
        }
        .editor-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-right: 1px solid var(--terminal-medium-gray);
        }
        .editor-panel:last-child {
            border-right: none;
        }
        .editor-header {
            padding: 12px 15px;
            background-color: var(--terminal-light-gray);
            border-bottom: 1px solid var(--terminal-medium-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1rem;
            color: var(--terminal-green);
            min-height: 44px;
        }
        .editor-toolbar {
            display: flex;
            gap: 10px;
            padding: 10px 15px;
            background-color: var(--terminal-gray);
            border-bottom: 1px solid var(--terminal-medium-gray);
            align-items: center;
            flex-wrap: wrap;
            min-height: 50px;
        }
        .editor-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: var(--terminal-black);
        }
        .editor {
            width: 100%;
            height: 100%;
            border: none;
            outline: none;
            resize: none;
            background-color: transparent;
            color: var(--terminal-green);
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            line-height: 1.5;
        }
        .preview {
            line-height: 1.6;
            font-size: 0.95rem;
            font-family: 'Courier New', monospace;
            color: var(--terminal-green);
        }
        
        /* === GUIDE STYLES === */
        .guide-content {
            padding: 20px;
            line-height: 1.6;
        }
        .guide-section {
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(30, 30, 30, 0.8);
            border: 1px solid var(--terminal-medium-gray);
            border-radius: 5px;
        }
        .guide-section h3 {
            color: var(--terminal-yellow);
            margin-bottom: 10px;
            border-bottom: 1px solid var(--terminal-medium-gray);
            padding-bottom: 5px;
        }
        .guide-section p {
            margin-bottom: 8px;
        }
        .guide-feature-list {
            list-style-type: none;
            margin-left: 20px;
        }
        .guide-feature-list li {
            margin-bottom: 5px;
            padding-left: 20px;
            position: relative;
        }
        .guide-feature-list li:before {
            content: "▶";
            color: var(--terminal-green);
            position: absolute;
            left: 0;
        }
        
        /* === DRAW STYLES === */
        .draw-tools {
            display: flex;
            gap: 10px;
            padding: 10px;
            background: var(--terminal-gray);
            border-bottom: 1px solid var(--terminal-medium-gray);
            flex-wrap: wrap;
        }
        .tool-group {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        .draw-tool {
            width: 40px;
            height: 40px;
            background: var(--terminal-light-gray);
            border: 1px solid var(--terminal-medium-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--terminal-green);
        }
        .draw-tool.active {
            background: var(--terminal-green);
            color: black;
        }
        .tool-size {
            margin-left: 10px;
        }
        .size-option {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--terminal-light-gray);
            border: 1px solid var(--terminal-medium-gray);
            cursor: pointer;
        }
        .size-option.active {
            background: var(--terminal-green);
            border-color: var(--terminal-green);
        }
        .size-option.small {
            width: 16px;
            height: 16px;
        }
        .size-option.medium {
            width: 20px;
            height: 20px;
        }
        .size-option.large {
            width: 24px;
            height: 24px;
        }
        .canvas-container {
            flex: 1;
            position: relative;
            overflow: auto;
        }
        #drawCanvas {
            background: black;
            display: block;
        }
        
        /* === RESPONSIVE TOUCH === */
        @media (max-width: 768px) {
            .desktop-icon { width: 80px; font-size: 0.8rem; }
            .desktop-icon i { font-size: 32px; }
            .webxos-logo { font-size: 4rem; }
            .loading-bar { width: 300px; }
            .kernel-body {
                flex-direction: column;
                grid-template-columns: 1fr;
            }
            .kernel-panel {
                min-height: 40vh;
            }
            .win95-window {
                min-width: 90vw;
                min-height: 70vh;
                left: 5vw !important;
                top: 10vh !important;
            }
            .title-bar button {
                width: 26px;
                height: 24px;
            }
            .taskbar {
                height: 48px;
            }
            .task-icon {
                width: 36px;
                height: 36px;
            }
            .start-btn {
                padding: 6px 16px;
                min-height: 36px;
            }
            .gpu-status-bar {
                font-size: 0.7rem;
                padding: 6px 10px;
                gap: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- GPU STATUS BAR -->
    <div class="gpu-status-bar" id="gpuStatusBar">
        <div class="gpu-status-item">
            <div class="gpu-status-led" id="gpuStatusLed"></div>
            <span>GPU.js</span>
        </div>
        <div class="gpu-status-item">
            <div class="gpu-status-led" id="tfStatusLed"></div>
            <span>TF.js</span>
        </div>
        <div class="gpu-status-item">
            <span class="gpu-kernel" id="kernelStatus">KERNEL: INIT</span>
        </div>
        <div class="gpu-status-item">
            <span class="memory-usage" id="memoryUsage">MEM: 0MB</span>
        </div>
    </div>

    <!-- NEURAL DOT GALAXY BACKGROUND -->
    <canvas id="galaxyCanvas"></canvas>
    
    <!-- ENHANCED LOADING SCREEN -->
    <div class="loading-screen" id="loadingScreen">
        <div class="webxos-logo">webXOS</div>
        <div class="webxos-subtitle">web based operating system</div>
        <div class="loading-bar"><div class="loading-fill" id="loadingFill"></div></div>
    </div>
    
    <!-- TASKBAR -->
    <div class="taskbar" id="taskbar" style="display: none;">
        <button class="start-btn" id="startBtn">webXOS</button>
        <div class="taskbar-icons">
            <div class="task-icon active" id="writeIcon"><i class="fas fa-edit"></i></div>
            <div class="task-icon" id="drawIcon"><i class="fas fa-paint-brush"></i></div>
            <div class="task-icon" id="kernelIcon"><i class="fas fa-microchip"></i></div>
            <div class="task-icon" id="guideIcon"><i class="fas fa-book"></i></div>
            <div class="task-icon" id="gamesIcon"><i class="fas fa-gamepad"></i></div>
        </div>
        <div class="clock" id="clock"></div>
    </div>
    
    <!-- DESKTOP -->
    <div class="desktop" id="desktop" style="display: none;">
        <!-- Desktop icons will be dynamically created -->
    </div>

    <!-- KERNEL OPS WINDOW -->
    <div class="win95-window" id="kernelWindow">
        <div class="title-bar">
            <span>KernelOps Agent</span>
            <div>
                <button id="maxKernel">□</button>
                <button id="closeKernel">×</button>
            </div>
        </div>
        <div class="window-content">
            <div class="kernel-ops-container">
                <div class="kernel-header">
                    <span>KernelOps Agent</span>
                    <div>
                        <button class="btn btn-primary" id="startKernelTest">
                            <i class="fas fa-play"></i> Start Test
                        </button>
                    </div>
                </div>
                
                <div class="kernel-toolbar">
                    <div class="format-controls">
                        <select class="font-size-selector" id="testType">
                            <option value="matrix">Matrix Multiplication</option>
                            <option value="gpu">GPU.js Test</option>
                            <option value="tf">TensorFlow.js Test</option>
                        </select>
                        <select class="font-size-selector" id="matrixSize">
                            <option value="64">64x64</option>
                            <option value="128">128x128</option>
                            <option value="256" selected>256x256</option>
                            <option value="512">512x512</option>
                            <option value="1024">1024x1024</option>
                        </select>
                    </div>
                    <button class="btn" id="exportKernelData">
                        <i class="fas fa-download"></i> Export Data
                    </button>
                    <button class="btn" id="clearKernelLog">
                        <i class="fas fa-eraser"></i> Clear Log
                    </button>
                </div>
                
                <div class="kernel-body">
                    <div class="kernel-panel">
                        <div class="kernel-panel-title">Configuration</div>
                        <div class="agent-controls-grid">
                            <div class="control-group">
                                <div class="control-label">
                                    <span>Matrix Size:</span>
                                    <span id="matrixSizeValue">256</span>
                                </div>
                                <input type="range" id="matrixSlider" min="64" max="1024" value="256" step="64">
                            </div>
                            <div class="control-group">
                                <div class="control-label">
                                    <span>Memory Limit (MB):</span>
                                    <span id="memoryLimitValue">512</span>
                                </div>
                                <input type="range" id="memorySlider" min="128" max="2048" value="512" step="64">
                            </div>
                            <div class="control-group">
                                <div class="control-label">
                                    <span>Iterations:</span>
                                    <span id="iterationsValue">10</span>
                                </div>
                                <input type="range" id="iterationsSlider" min="1" max="100" value="10">
                            </div>
                            <div class="control-group">
                                <div class="control-label">
                                    <span>Agent Mode:</span>
                                </div>
                                <select id="agentMode" class="btn" style="width: 100%;">
                                    <option value="gpu">GPU Accelerated</option>
                                    <option value="cpu">CPU Only</option>
                                    <option value="auto">Auto-detect</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="kernel-panel-title">Agent Status</div>
                        <div class="kernel-stats">
                            <div class="stat-item">
                                <div class="stat-label">Status</div>
                                <div class="stat-value" id="agentStatus">IDLE</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Mode</div>
                                <div class="stat-value" id="agentModeValue">GPU</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Tests</div>
                                <div class="stat-value" id="testsCount">0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Avg Time</div>
                                <div class="stat-value" id="avgTime">0ms</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <button class="btn btn-primary" id="singleTest">Single Test</button>
                            <button class="btn" id="continuousTest">Continuous</button>
                            <button class="btn" id="stopTest" style="display:none">Stop</button>
                        </div>
                    </div>
                    
                    <div class="kernel-panel">
                        <div class="kernel-panel-title">Test Output</div>
                        <div class="kernel-output" id="kernelOutput">
                            > Kernel Agent Initialized<br>
                            > GPU.js: Loading...<br>
                            > TensorFlow.js: Loading...<br>
                            > Adjust settings and start test<br>
                        </div>
                        
                        <div class="kernel-panel-title" style="margin-top: 15px;">Performance Metrics</div>
                        <div class="kernel-stats">
                            <div class="stat-item">
                                <div class="stat-label">Matrix Ops</div>
                                <div class="stat-value" id="matrixOps">0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Total Time</div>
                                <div class="stat-value" id="totalTime">0ms</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Memory Used</div>
                                <div class="stat-value" id="memoryUsed">0MB</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Errors</div>
                                <div class="stat-value" id="errorCount">0</div>
                            </div>
                        </div>
                        
                        <div class="kernel-panel-title" style="margin-top: 15px;">Resource Usage</div>
                        <div style="margin-top: 10px;">
                            <div class="control-label">
                                <span>Memory Usage:</span>
                                <span id="currentMemory">0MB / 512MB</span>
                            </div>
                            <div style="width: 100%; height: 10px; background: var(--terminal-light-gray); border-radius: 5px; overflow: hidden;">
                                <div id="memoryBar" style="width: 0%; height: 100%; background: var(--terminal-green);"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- WRITE WINDOW -->
    <div class="win95-window" id="writeWindow">
        <div class="title-bar">
            <span>webXOS Write</span>
            <div>
                <button id="maxWrite">□</button>
                <button id="closeWrite">×</button>
            </div>
        </div>
        <div class="window-content">
            <div class="editor-container">
                <div class="editor-panel">
                    <div class="editor-header">
                        <span>Markdown Editor</span>
                        <button class="btn" id="clearWriteBtn">
                            <i class="fas fa-eraser"></i>
                            Clear
                        </button>
                    </div>
                    <div class="editor-toolbar">
                        <div class="format-controls">
                            <select class="font-selector" id="fontSelector">
                                <option value="default">Default Font</option>
                                <option value="times">Times New Roman</option>
                                <option value="arial">Arial</option>
                            </select>
                            <select class="font-size-selector" id="fontSizeSelector">
                                <option value="12">12px</option>
                                <option value="14">14px</option>
                                <option value="16" selected>16px</option>
                                <option value="18">18px</option>
                                <option value="20">20px</option>
                                <option value="24">24px</option>
                            </select>
                            <input type="color" class="color-selector" id="colorSelector" value="#00FF00">
                        </div>
                        <button class="btn" id="exportWriteBtn">
                            <i class="fas fa-download"></i>
                            Export
                        </button>
                    </div>
                    <div class="editor-body">
                        <textarea class="editor" id="markdownEditor" placeholder="Start writing your Markdown here..." spellcheck="false"># Welcome to webXOS Write
A powerful Markdown editor integrated into the webXOS operating system.

## Features
- **Markdown Support** - Write with full Markdown syntax
- **Live Preview** - See your formatted content as you type
- **Export Options** - Save your work in multiple formats
- **Terminal Styling** - Consistent with webXOS design

## Markdown Tips
- Use # for headings
- Use **bold** and *italic* text
- Create lists with - or 1. 2. 3.
- Add [links](https://example.com)
- Insert `code` and code blocks</textarea>
                    </div>
                </div>
                <div class="editor-panel">
                    <div class="editor-header">
                        <span>Live Preview</span>
                        <button class="btn" id="refreshPreviewBtn">
                            <i class="fas fa-sync-alt"></i>
                            Refresh
                        </button>
                    </div>
                    <div class="editor-body">
                        <div class="preview" id="markdownPreview"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DRAW WINDOW -->
    <div class="win95-window" id="drawWindow">
        <div class="title-bar">
            <span>webXOS Draw</span>
            <div>
                <button id="maxDraw">□</button>
                <button id="closeDraw">×</button>
            </div>
        </div>
        <div class="window-content">
            <div class="draw-tools">
                <div class="tool-group">
                    <div class="draw-tool active" data-tool="pencil" title="Pencil">
                        <i class="fas fa-pencil-alt"></i>
                    </div>
                    <div class="draw-tool" data-tool="line" title="Line">
                        <i class="fas fa-minus"></i>
                    </div>
                </div>
                <div class="tool-group">
                    <div class="draw-tool" data-tool="rectangle" title="Rectangle">
                        <i class="fas fa-square"></i>
                    </div>
                    <div class="draw-tool" data-tool="circle" title="Circle">
                        <i class="fas fa-circle"></i>
                    </div>
                </div>
                <div class="tool-group">
                    <div class="draw-tool" data-tool="eraser" title="Eraser">
                        <i class="fas fa-eraser"></i>
                    </div>
                    <div class="draw-tool" data-tool="eyedropper" title="Sample Color">
                        <i class="fas fa-eye-dropper"></i>
                    </div>
                    <div class="draw-tool" id="undoDraw" title="Undo">
                        <i class="fas fa-undo"></i>
                    </div>
                    <div class="draw-tool" id="toggleGrid" title="Toggle Grid">
                        <i class="fas fa-th"></i>
                    </div>
                    <div class="draw-tool" id="clearCanvas" title="Clear Canvas">
                        <i class="fas fa-trash"></i>
                    </div>
                </div>
                <div class="tool-group">
                    <input type="color" id="colorPicker" value="#00FF00" title="Color">
                </div>
                <div class="tool-group tool-size">
                    <div class="size-option small active" data-size="2"></div>
                    <div class="size-option medium" data-size="5"></div>
                    <div class="size-option large" data-size="10"></div>
                </div>
                <div class="tool-group">
                    <button class="btn" id="exportDrawBtn">
                        <i class="fas fa-download"></i>
                        Export
                    </button>
                </div>
            </div>
            <div class="canvas-container">
                <canvas id="drawCanvas" width="800" height="600"></canvas>
                <div id="gridOverlay"></div>
            </div>
        </div>
    </div>

    <!-- GUIDE WINDOW (Enhanced) -->
    <div class="win95-window" id="guideWindow">
        <div class="title-bar">
            <span>webXOS 2026 Edition</span>
            <div>
                <button id="maxGuide">□</button>
                <button id="closeGuide">×</button>
            </div>
        </div>
        <div class="window-content">
            <div class="guide-content" id="guideContent">
                <div class="guide-section">
                    <h3>Welcome to webXOS 2026</h3>
                    <p>Welcome to webXOS 2026 Edition with demoscene design and modular applications.</p>
                    <p>This version includes modular tools and agents designed for minimal systems.</p>
                </div>
                
                <div class="guide-section">
                    <h3>Applications</h3>
                    <ul class="guide-feature-list">
                        <li><strong>Write:</strong> Markdown editor with live preview, syntax highlighting, and export options</li>
                        <li><strong>Draw:</strong> Drawing application with various tools, colors, and export functionality</li>
                        <li><strong>KernelOps:</strong> GPU/CPU matrix testing system with real-time performance metrics</li>
                        <li><strong>Games:</strong> Collection of browser-based games and simulations</li>
                        <li><strong>Tools:</strong> Various utilities including encryption, chat agents, and system tools</li>
                        <li><strong>Research:</strong> Information and knowledge base for advanced topics</li>
                        <li><strong>Links:</strong> Quick access to web resources and social media</li>
                    </ul>
                </div>
                
                <div class="guide-section">
                    <h3>KernelOps</h3>
                    <p>The Kernel Ops system is a powerful matrix computation engine that can leverage both GPU and CPU resources.</p>
                    <p><strong>Features:</strong></p>
                    <ul class="guide-feature-list">
                        <li>Single kernel agent with adjustable parameters</li>
                        <li>Matrix size configuration from 64x64 to 1024x1024</li>
                        <li>Memory usage monitoring and limits</li>
                        <li>Real-time performance metrics</li>
                        <li>Continuous testing mode</li>
                        <li>Export test results as markdown</li>
                        <li>GPU.js and TensorFlow.js integration</li>
                    </ul>
                    <p><strong>Usage:</strong></p>
                    <ol>
                        <li>Adjust matrix size using the slider (64-1024)</li>
                        <li>Set memory limit to control resource usage</li>
                        <li>Choose between GPU, CPU, or Auto-detect mode</li>
                        <li>Click "Single Test" for one-time computation</li>
                        <li>Use "Continuous" for ongoing performance testing</li>
                        <li>Monitor results in real-time output window</li>
                        <li>Export data for analysis</li>
                    </ol>
                </div>
                
                <div class="guide-section">
                    <h3>Write</h3>
                    <p>The Write application is a full-featured Markdown editor with the following capabilities:</p>
                    <ul class="guide-feature-list">
                        <li>Live preview of Markdown formatting</li>
                        <li>Font and size selection</li>
                        <li>Color customization</li>
                        <li>Export to multiple formats</li>
                        <li>Auto-save functionality</li>
                        <li>Code syntax highlighting</li>
                    </ul>
                </div>
                
                <div class="guide-section">
                    <h3>Draw</h3>
                    <p>The Draw application provides a complete drawing environment:</p>
                    <ul class="guide-feature-list">
                        <li>Multiple drawing tools (pencil, line, rectangle, circle)</li>
                        <li>Eraser and color picker</li>
                        <li>Adjustable brush sizes</li>
                        <li>Undo functionality</li>
                        <li>Grid overlay option</li>
                        <li>Export as PNG image</li>
                    </ul>
                </div>
                
                <div class="guide-section">
                    <h3>System Requirements</h3>
                    <p><strong>Minimum:</strong> Modern browser with JavaScript enabled</p>
                    <p><strong>Recommended:</strong> Browser with WebGL support for GPU acceleration</p>
                    <p><strong>Memory:</strong> 512MB+ for large matrix operations</p>
                </div>
            </div>
        </div>
    </div>

    <!-- GAMES WINDOW -->
    <div class="win95-window" id="gamesWindow">
        <div class="title-bar">
            <span>webXOS Games</span>
            <div>
                <button id="maxGames">□</button>
                <button id="closeGames">×</button>
            </div>
        </div>
        <div class="window-content">
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; padding: 10px;">
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/chess.html', '_blank')">
                    <i class="fas fa-chess"></i>
                    <div>AI CHESS</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/paintball.html', '_blank')">
                    <i class="fas fa-crosshairs"></i>
                    <div>PAINTBALL</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/codecrunch.html', '_blank')">
                    <i class="fas fa-code"></i>
                    <div>CODE CRUNCH</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/command.html', '_blank')">
                    <i class="fas fa-atom"></i>
                    <div>COMMAND AND QUANTIFY</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/dronefall.html', '_blank')">
                    <i class="fas fa-space-shuttle"></i>
                    <div>DRONE FALL</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/emojiquest.html', '_blank')">
                    <i class="fas fa-shield"></i>
                    <div>EMOJI QUEST</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/galaxycraft.html', '_blank')">
                    <i class="fas fa-jet-fighter"></i>
                    <div>GALAXYCRAFT</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/3deditor.html', '_blank')">
                    <i class="fas fa-tint"></i>
                    <div>3D EDITOR</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/trios.html', '_blank')">
                    <i class="fas fa-university"></i>
                    <div>TRIOS</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/xforc3d.html', '_blank')">
                    <i class="fas fa-times"></i>
                    <div>XFORC3D</div>
                </div>
            </div>
        </div>
    </div>

    <!-- TOOLS WINDOW -->
    <div class="win95-window" id="toolsWindow">
        <div class="title-bar">
            <span>webXOS Tools</span>
            <div>
                <button id="maxTools">□</button>
                <button id="closeTools">×</button>
            </div>
        </div>
        <div class="window-content">
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; padding: 10px;">
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/atomic.html', '_blank')">
                    <i class="fas fa-clock"></i>
                    <div>GLOBAL ATOMIC CLOCK</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/arcr.html', '_blank')">
                    <i class="fas fa-robot"></i>
                    <div>PROMPT AGENT</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/exoskeleton.html', '_blank')">
                    <i class="fas fa-robot"></i>
                    <div>ENCRYPTION AGENT</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/booki.html', '_blank')">
                    <i class="fas fa-robot"></i>
                    <div>BOOK AGENT</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/chatbot.html', '_blank')">
                    <i class="fas fa-robot"></i>
                    <div>CHAT AGENT</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/sacred.html', '_blank')">
                    <i class="fas fa-robot"></i>
                    <div>2D IMAGE AGENT</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/codesign.html', '_blank')">
                    <i class="fas fa-signature"></i>
                    <div>SIGNATURE ENCRYPTION</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/gridlocker.html', '_blank')">
                    <i class="fas fa-lock"></i>
                    <div>FILE ENCRYPTION</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/injector.html', '_blank')">
                    <i class="fas fa-code"></i>
                    <div>PY TERMINAL</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/lattest.html', '_blank')">
                    <i class="fas fa-signal"></i>
                    <div>LATENCY TEST</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/mirror.html', '_blank')">
                    <i class="fas fa-toggle-on"></i>
                    <div>DRONE SIM</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/KERNELOPS.html', '_blank')">
                    <i class="fas fa-spinner"></i>
                    <div>KERNELOPS</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/tempserver.html', '_blank')">
                    <i class="fas fa-server"></i>
                    <div>LOCAL SERVER</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/watchdog.html', '_blank')">
                    <i class="fas fa-tachometer"></i>
                    <div>ENERGY METRICS</div>
                </div>
            </div>
        </div>
    </div>

    <!-- RESEARCH WINDOW -->
    <div class="win95-window" id="researchWindow">
        <div class="title-bar">
            <span>webXOS Research</span>
            <div>
                <button id="maxResearch">□</button>
                <button id="closeResearch">×</button>
            </div>
        </div>
        <div class="window-content">
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; padding: 10px;">
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/anything.html', '_blank')">
                    <i class="fas fa-search"></i>
                    <div>ANYTHING: POINT CLOUD</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/VIAL.html', '_blank')">
                    <i class="fas fa-flask"></i>
                    <div>VIAL</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/launch.html', '_blank')">
                    <i class="fas fa-map"></i>
                    <div>QNN DRONE TRAINING</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/greenstudy.html', '_blank')">
                    <i class="fas fa-leaf"></i>
                    <div>CARBON STAT SHEET</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/farm.html', '_blank')">
                    <i class="fas fa-water"></i>
                    <div>QNN FARM ROBOT TRAINING</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/radical.html', '_blank')">
                    <i class="fas fa-lightbulb"></i>
                    <div>RADICAL</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/tokenforged.html', '_blank')">
                    <i class="fas fa-network-wired"></i>
                    <div>Token Forged</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/mlm.html', '_blank')">
                    <i class="fas fa-brain"></i>
                    <div>Micro LMs</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/greencodeinfo.html', '_blank')">
                    <i class="fas fa-code"></i>
                    <div>Green Coding</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/regeninfo.html', '_blank')">
                    <i class="fas fa-recycle"></i>
                    <div>Regenerative Data</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/promptguide.html', '_blank')">
                    <i class="fas fa-book-open"></i>
                    <div>Prompt Guide</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/promptinjection.html', '_blank')">
                    <i class="fas fa-syringe"></i>
                    <div>Prompt Injection</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/gem.html', '_blank')">
                    <i class="fas fa-globe"></i>
                    <div>Global Entity Map</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/editor.html', '_blank')">
                    <i class="fas fa-scroll"></i>
                    <div>Editor</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/markdown.html', '_blank')">
                    <i class="fas fa-file"></i>
                    <div>Markdown as a Medium</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/drone.html', '_blank')">
                    <i class="fas fa-rocket"></i>
                    <div>Drone Tech</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/subm.html', '_blank')">
                    <i class="fas fa-water"></i>
                    <div>Submarine Tech</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://webxos.netlify.app/subt.html', '_blank')">
                    <i class="fas fa-mountain"></i>
                    <div>Subterrain Tech</div>
                </div>
            </div>
        </div>
    </div>

    <!-- LINKS WINDOW -->
    <div class="win95-window" id="linksWindow">
        <div class="title-bar">
            <span>webXOS Links</span>
            <div>
                <button id="maxLinks">□</button>
                <button id="closeLinks">×</button>
            </div>
        </div>
        <div class="window-content">
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; padding: 10px;">
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://x.com/webxos', '_blank')">
                    <i class="fab fa-twitter"></i>
                    <div>x.com/webxos</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://x.com/galaxycraft3d', '_blank')">
                    <i class="fab fa-twitter"></i>
                    <div>x.com/galaxycraft3d</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://github.com/webxos', '_blank')">
                    <i class="fab fa-github"></i>
                    <div>GitHub</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://kick.com/webxos', '_blank')">
                    <i class="fas fa-video"></i>
                    <div>Kick</div>
                </div>
                <div class="desktop-icon" style="position: relative; width: 100%; height: 80px;" onclick="window.open('https://www.tiktok.com/@webxos', '_blank')">
                    <i class="fab fa-tiktok"></i>
                    <div>TikTok</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === NEURAL DOT GALAXY BACKGROUND ===
        const canvas = document.getElementById('galaxyCanvas');
        const ctx = canvas.getContext('2d');
        let dots = [];
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initDots();
        }
        
        function initDots() {
            dots = [];
            const dotCount = Math.floor((canvas.width * canvas.height) / 5000);
           
            for (let i = 0; i < dotCount; i++) {
                dots.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 2 + 0.5,
                    speed: Math.random() * 0.5 + 0.1,
                    color: Math.random() > 0.7 ? '#00FF00' : '#FFFFFF'
                });
            }
        }
        
        function drawDots() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
           
            for (let i = 0; i < dots.length; i++) {
                const dot = dots[i];
               
                // Draw dot
                ctx.beginPath();
                ctx.arc(dot.x, dot.y, dot.size, 0, Math.PI * 2);
                ctx.fillStyle = dot.color;
                ctx.fill();
               
                // Move dot
                dot.y += dot.speed;
               
                // Reset dot if it goes off screen
                if (dot.y > canvas.height) {
                    dot.y = 0;
                    dot.x = Math.random() * canvas.width;
                }
            }
           
            requestAnimationFrame(drawDots);
        }

        // Initialize canvas and dots
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        drawDots();

        // === ENHANCED LOADING ANIMATION ===
        document.addEventListener('DOMContentLoaded', function() {
            const loadingFill = document.getElementById('loadingFill');
            const loadingScreen = document.getElementById('loadingScreen');
            const taskbar = document.getElementById('taskbar');
            const desktop = document.getElementById('desktop');
           
            let loadProgress = 0;
            const loadInterval = setInterval(() => {
                loadProgress += 2;
                loadingFill.style.width = loadProgress + '%';
               
                // Add glowing effect during loading
                if (loadProgress % 10 === 0) {
                    loadingFill.style.boxShadow = `0 0 ${10 + loadProgress/5}px var(--terminal-green), 0 0 ${20 + loadProgress/3}px var(--terminal-green)`;
                }
               
                if (loadProgress >= 100) {
                    clearInterval(loadInterval);
                    setTimeout(() => {
                        loadingScreen.classList.add('hidden');
                        taskbar.style.display = 'flex';
                        desktop.style.display = 'flex';
                        initializeOS();
                    }, 800);
                }
            }, 40);
        });

        // === CLOCK ===
        function updateClock() {
            const now = new Date();
            const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            document.getElementById('clock').textContent = time;
        }

        // === KERNEL AGENT SYSTEM ===
        class KernelAgent {
            constructor() {
                this.gpu = null;
                this.tf = null;
                this.status = 'idle';
                this.mode = 'gpu';
                this.testsCompleted = 0;
                this.totalOperations = 0;
                this.totalTime = 0;
                this.errors = 0;
                this.isContinuous = false;
                this.testLog = [];
                this.memoryLimit = 512; // MB
                this.currentMemory = 0;
                
                this.initialize();
            }

            async initialize() {
                // Initialize GPU.js
                try {
                    this.gpu = new GPU();
                    document.getElementById('gpuStatusLed').classList.add('active');
                    this.log('GPU.js initialized successfully');
                } catch (error) {
                    document.getElementById('gpuStatusLed').classList.add('inactive');
                    this.mode = 'cpu';
                    this.log(`GPU.js Error: ${error.message}`, 'error');
                }

                // Initialize TensorFlow.js
                try {
                    this.tf = tf;
                    await tf.ready();
                    document.getElementById('tfStatusLed').classList.add('active');
                    this.log('TensorFlow.js initialized successfully');
                } catch (error) {
                    document.getElementById('tfStatusLed').classList.add('inactive');
                    this.log(`TensorFlow.js Error: ${error.message}`, 'error');
                }

                // Update UI
                this.updateUI();
                this.log('Kernel Agent ready');
            }

            async runTest() {
                if (this.status === 'testing') return;
                
                const size = parseInt(document.getElementById('matrixSize').value);
                this.memoryLimit = parseInt(document.getElementById('memorySlider').value);
                const iterations = parseInt(document.getElementById('iterationsSlider').value);
                this.mode = document.getElementById('agentMode').value;
                
                // Check memory
                const estimatedMemory = (size * size * 8 * 2) / (1024 * 1024); // Two matrices
                if (estimatedMemory > this.memoryLimit) {
                    this.log(`Memory limit exceeded: ${estimatedMemory.toFixed(1)}MB > ${this.memoryLimit}MB`, 'error');
                    return;
                }
                
                this.status = 'testing';
                this.updateUI();
                
                let totalTestTime = 0;
                let totalOps = 0;
                
                try {
                    for (let i = 0; i < iterations; i++) {
                        if (!this.isContinuous && this.status !== 'testing') break;
                        
                        const startTime = performance.now();
                        
                        if (this.mode === 'gpu' && this.gpu) {
                            await this.runGPUTest(size);
                        } else {
                            await this.runCPUTest(size);
                        }
                        
                        const endTime = performance.now();
                        const testTime = endTime - startTime;
                        const operations = size * size * size; // O(n³)
                        
                        totalTestTime += testTime;
                        totalOps += operations;
                        
                        this.log(`Test ${i+1}: ${size}x${size} matrix in ${testTime.toFixed(2)}ms`);
                        
                        // Update memory usage
                        this.currentMemory = Math.min(this.memoryLimit, this.currentMemory + estimatedMemory * 0.1);
                        this.updateMemoryBar();
                        
                        // Small delay between iterations
                        if (i < iterations - 1) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                        }
                    }
                    
                    // Update stats
                    this.testsCompleted += iterations;
                    this.totalOperations += totalOps;
                    this.totalTime += totalTestTime;
                    
                    const avgTime = totalTestTime / iterations;
                    this.log(`Completed ${iterations} tests, average: ${avgTime.toFixed(2)}ms`);
                    
                } catch (error) {
                    this.errors++;
                    this.log(`Test failed: ${error.message}`, 'error');
                } finally {
                    this.status = 'idle';
                    this.updateUI();
                    
                    // Continue if in continuous mode
                    if (this.isContinuous) {
                        setTimeout(() => this.runTest(), 500);
                    }
                }
            }

            async runGPUTest(size) {
                if (!this.gpu) throw new Error('GPU not available');
                
                const kernel = this.gpu.createKernel(function(a, b) {
                    let sum = 0;
                    for (let k = 0; k < this.constants.size; k++) {
                        sum += a[this.thread.y][k] * b[k][this.thread.x];
                    }
                    return sum;
                }).setOutput([size, size]).setConstants({ size: size });
                
                // Create random matrices
                const a = [];
                const b = [];
                for (let i = 0; i < size; i++) {
                    a[i] = [];
                    b[i] = [];
                    for (let j = 0; j < size; j++) {
                        a[i][j] = Math.random();
                        b[i][j] = Math.random();
                    }
                }
                
                // Run kernel
                kernel(a, b);
            }

            async runCPUTest(size) {
                if (!this.tf) throw new Error('TensorFlow not available');
                
                const a = tf.randomNormal([size, size]);
                const b = tf.randomNormal([size, size]);
                const result = tf.matMul(a, b);
                
                await result.data();
                
                a.dispose();
                b.dispose();
                result.dispose();
            }

            startContinuous() {
                this.isContinuous = true;
                document.getElementById('continuousTest').style.display = 'none';
                document.getElementById('stopTest').style.display = 'inline-block';
                this.runTest();
            }

            stopContinuous() {
                this.isContinuous = false;
                this.status = 'idle';
                document.getElementById('continuousTest').style.display = 'inline-block';
                document.getElementById('stopTest').style.display = 'none';
                this.updateUI();
                this.log('Continuous testing stopped');
            }

            log(message, type = 'info') {
                const output = document.getElementById('kernelOutput');
                const timestamp = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
                
                const color = type === 'error' ? '#FF0000' : '#00FF00';
                const line = `<span style="color: ${color}">[${timestamp}] ${message}</span><br>`;
                
                output.innerHTML += line;
                output.scrollTop = output.scrollHeight;
                
                // Keep only last 20 lines
                const lines = output.innerHTML.split('<br>');
                if (lines.length > 20) {
                    output.innerHTML = lines.slice(-20).join('<br>');
                }
                
                this.testLog.push({ timestamp: new Date(), message, type });
            }

            updateUI() {
                document.getElementById('agentStatus').textContent = this.status.toUpperCase();
                document.getElementById('agentModeValue').textContent = this.mode.toUpperCase();
                document.getElementById('testsCount').textContent = this.testsCompleted;
                
                const avgTime = this.testsCompleted > 0 ? 
                    (this.totalTime / this.testsCompleted).toFixed(2) : '0';
                document.getElementById('avgTime').textContent = `${avgTime}ms`;
                
                document.getElementById('matrixOps').textContent = this.totalOperations.toLocaleString();
                document.getElementById('totalTime').textContent = `${this.totalTime.toFixed(0)}ms`;
                document.getElementById('memoryUsed').textContent = `${this.currentMemory.toFixed(1)}MB`;
                document.getElementById('errorCount').textContent = this.errors;
                
                // Update status bar
                document.getElementById('kernelStatus').textContent = 
                    `KERNEL: ${this.status === 'testing' ? 'TESTING' : 'READY'}`;
                document.getElementById('memoryUsage').textContent = 
                    `MEM: ${this.currentMemory.toFixed(1)}MB`;
            }

            updateMemoryBar() {
                const percent = (this.currentMemory / this.memoryLimit) * 100;
                document.getElementById('memoryBar').style.width = `${percent}%`;
                document.getElementById('currentMemory').textContent = 
                    `${this.currentMemory.toFixed(1)}MB / ${this.memoryLimit}MB`;
            }

            exportData() {
                const timestamp = new Date().toISOString();
                let markdown = `# Kernel Agent Test Results\n\n`;
                markdown += `## Export Date: ${timestamp}\n`;
                markdown += `## Agent Configuration\n`;
                markdown += `- Mode: ${this.mode}\n`;
                markdown += `- Matrix Size: ${document.getElementById('matrixSize').value}\n`;
                markdown += `- Memory Limit: ${this.memoryLimit}MB\n`;
                markdown += `- Tests Completed: ${this.testsCompleted}\n\n`;
                
                markdown += `## Performance Metrics\n`;
                markdown += `- Total Operations: ${this.totalOperations.toLocaleString()}\n`;
                markdown += `- Total Time: ${this.totalTime.toFixed(2)}ms\n`;
                markdown += `- Average Time: ${this.testsCompleted > 0 ? (this.totalTime / this.testsCompleted).toFixed(2) : '0'}ms\n`;
                markdown += `- Errors: ${this.errors}\n\n`;
                
                markdown += `## Test Log\n`;
                this.testLog.slice(-20).forEach(log => {
                    markdown += `- [${log.timestamp.toLocaleTimeString()}] ${log.message}\n`;
                });
                
                const blob = new Blob([markdown], { type: 'text/markdown' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `kernel_agent_results_${Date.now()}.md`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.log('Test data exported');
            }

            clearLog() {
                document.getElementById('kernelOutput').innerHTML = 
                    '> Log cleared<br>> Ready for new tests<br>';
                this.testLog = [];
                this.log('Test log cleared');
            }
        }

        // === WINDOW MANAGEMENT ===
        let kernelAgent;

        function initializeOS() {
            // Start clock
            setInterval(updateClock, 1000);
            updateClock();

            // Initialize Kernel Agent
            kernelAgent = new KernelAgent();

            // Create desktop icons
            createDesktopIcons();

            const windows = {
                kernel: document.getElementById('kernelWindow'),
                write: document.getElementById('writeWindow'),
                draw: document.getElementById('drawWindow'),
                guide: document.getElementById('guideWindow'),
                games: document.getElementById('gamesWindow'),
                tools: document.getElementById('toolsWindow'),
                research: document.getElementById('researchWindow'),
                links: document.getElementById('linksWindow')
            };

            // Window control functions
            function setupWindowControls(winId, maxBtnId, closeBtnId) {
                document.getElementById(maxBtnId).onclick = () => windows[winId].classList.toggle('maximized');
                document.getElementById(closeBtnId).onclick = () => {
                    windows[winId].classList.remove('active');
                    windows[winId].classList.remove('maximized');
                };
            }

            // Setup window controls
            setupWindowControls('kernel', 'maxKernel', 'closeKernel');
            setupWindowControls('write', 'maxWrite', 'closeWrite');
            setupWindowControls('draw', 'maxDraw', 'closeDraw');
            setupWindowControls('guide', 'maxGuide', 'closeGuide');
            setupWindowControls('games', 'maxGames', 'closeGames');
            setupWindowControls('tools', 'maxTools', 'closeTools');
            setupWindowControls('research', 'maxResearch', 'closeResearch');
            setupWindowControls('links', 'maxLinks', 'closeLinks');

            function openWindow(win) {
                Object.values(windows).forEach(w => {
                    w.classList.remove('active');
                    w.classList.remove('maximized');
                });
                win.classList.add('active');
                
                // Center window on screen
                const winWidth = win.offsetWidth;
                const winHeight = win.offsetHeight;
                const screenWidth = window.innerWidth;
                const screenHeight = window.innerHeight;
                
                win.style.left = Math.max(0, (screenWidth - winWidth) / 2) + 'px';
                win.style.top = Math.max(0, (screenHeight - winHeight - 42) / 2) + 'px';
            }

            // Desktop icons event handlers
            document.addEventListener('click', (e) => {
                if (e.target.closest('.desktop-icon')) {
                    const icon = e.target.closest('.desktop-icon');
                    const iconId = icon.id;
                   
                    // Deselect all icons
                    document.querySelectorAll('.desktop-icon').forEach(i => i.classList.remove('selected'));
                    // Select clicked icon
                    icon.classList.add('selected');
                   
                    switch(iconId) {
                        case 'desktopWrite':
                            openWindow(windows.write);
                            break;
                        case 'desktopDraw':
                            openWindow(windows.draw);
                            break;
                        case 'desktopKernel':
                            openWindow(windows.kernel);
                            break;
                        case 'desktopGuide':
                            openWindow(windows.guide);
                            break;
                        case 'desktopGames':
                            openWindow(windows.games);
                            break;
                        case 'desktopTools':
                            openWindow(windows.tools);
                            break;
                        case 'desktopResearch':
                            openWindow(windows.research);
                            break;
                        case 'desktopLinks':
                            openWindow(windows.links);
                            break;
                    }
                }
            });

            // Taskbar icons
            document.getElementById('writeIcon').onclick = () => openWindow(windows.write);
            document.getElementById('drawIcon').onclick = () => openWindow(windows.draw);
            document.getElementById('kernelIcon').onclick = () => openWindow(windows.kernel);
            document.getElementById('guideIcon').onclick = () => openWindow(windows.guide);
            document.getElementById('gamesIcon').onclick = () => openWindow(windows.games);

            // Kernel controls
            document.getElementById('startKernelTest').addEventListener('click', () => {
                kernelAgent.runTest();
            });
            
            document.getElementById('singleTest').addEventListener('click', () => {
                kernelAgent.runTest();
            });
            
            document.getElementById('continuousTest').addEventListener('click', () => {
                kernelAgent.startContinuous();
            });
            
            document.getElementById('stopTest').addEventListener('click', () => {
                kernelAgent.stopContinuous();
            });
            
            document.getElementById('exportKernelData').addEventListener('click', () => {
                kernelAgent.exportData();
            });
            
            document.getElementById('clearKernelLog').addEventListener('click', () => {
                kernelAgent.clearLog();
            });
            
            // Slider updates
            document.getElementById('matrixSlider').addEventListener('input', function() {
                const value = this.value;
                document.getElementById('matrixSizeValue').textContent = value;
                document.getElementById('matrixSize').value = value;
            });
            
            document.getElementById('memorySlider').addEventListener('input', function() {
                const value = this.value;
                document.getElementById('memoryLimitValue').textContent = value;
                kernelAgent.memoryLimit = parseInt(value);
                kernelAgent.updateMemoryBar();
            });
            
            document.getElementById('iterationsSlider').addEventListener('input', function() {
                document.getElementById('iterationsValue').textContent = this.value;
            });
            
            document.getElementById('agentMode').addEventListener('change', function() {
                kernelAgent.mode = this.value;
                kernelAgent.updateUI();
            });

            // === WRITE APPLICATION ===
            const markdownEditor = document.getElementById('markdownEditor');
            const markdownPreview = document.getElementById('markdownPreview');
            let currentTextColor = '#00FF00';
            
            // Configure marked for GitHub-flavored markdown
            marked.setOptions({
                breaks: true,
                gfm: true,
                headerIds: true,
                highlight: function(code, lang) {
                    return code;
                }
            });
            
            function updatePreview() {
                const markdownText = markdownEditor.value;
                try {
                    markdownPreview.innerHTML = marked.parse(markdownText);
                    // Apply current text color to preview
                    markdownPreview.style.color = currentTextColor;
                } catch (error) {
                    markdownPreview.innerHTML = `<p style="color: red;">Error rendering markdown: ${error.message}</p>`;
                }
            }
            
            function autoSave() {
                localStorage.setItem('webxosWriteContent', markdownEditor.value);
            }
            
            // Editor event listeners
            markdownEditor.addEventListener('input', () => {
                updatePreview();
                autoSave();
            });
            
            document.getElementById('clearWriteBtn').addEventListener('click', () => {
                if (confirm('Are you sure you want to clear the editor?')) {
                    markdownEditor.value = '';
                    updatePreview();
                    autoSave();
                }
            });
            
            document.getElementById('refreshPreviewBtn').addEventListener('click', updatePreview);
            document.getElementById('fontSelector').addEventListener('change', (e) => {
                applyFontTheme(e.target.value);
            });
            
            document.getElementById('fontSizeSelector').addEventListener('change', (e) => {
                applyFontSize(e.target.value);
            });
            
            document.getElementById('colorSelector').addEventListener('input', (e) => {
                applyTextColor(e.target.value);
            });
            
            document.getElementById('exportWriteBtn').addEventListener('click', exportWriteDocument);
            
            function applyFontTheme(font) {
                const editorArea = document.querySelector('.editor-area');
                editorArea.classList.remove('font-times', 'font-arial');
               
                if (font && font !== 'default') {
                    editorArea.classList.add(`font-${font}`);
                }
                updatePreview();
            }
            
            function applyFontSize(size) {
                if (size) {
                    markdownEditor.style.fontSize = `${size}px`;
                    markdownPreview.style.fontSize = `${size}px`;
                    updatePreview();
                }
            }
            
            function applyTextColor(color) {
                if (color) {
                    currentTextColor = color;
                    markdownEditor.style.color = color;
                    markdownPreview.style.color = color;
                    updatePreview();
                }
            }
            
            function exportWriteDocument() {
                const content = markdownEditor.value;
                const blob = new Blob([content], { type: 'text/markdown' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'document.md';
                a.click();
                URL.revokeObjectURL(url);
            }
            
            // Load autosaved content
            const savedContent = localStorage.getItem('webxosWriteContent');
            if (savedContent) {
                markdownEditor.value = savedContent;
                updatePreview();
            }
            
            // Initialize editor
            updatePreview();

            // === DRAW APPLICATION ===
            const drawCanvas = document.getElementById('drawCanvas');
            const drawCtx = drawCanvas.getContext('2d');
            const gridOverlay = document.getElementById('gridOverlay');
           
            // Initialize canvas
            drawCtx.fillStyle = '#000000';
            drawCtx.fillRect(0, 0, drawCanvas.width, drawCanvas.height);
           
            // Drawing state
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            let currentDrawTool = 'pencil';
            let brushSizeValue = 2;
            let startX, startY;
            let snapshot;
            let history = [];
            let currentStep = -1;
            
            // Set initial drawing styles
            drawCtx.strokeStyle = document.getElementById('colorPicker').value;
            drawCtx.lineWidth = brushSizeValue;
            drawCtx.lineCap = 'round';
            drawCtx.lineJoin = 'round';
            
            // Drawing tools selection
            document.querySelectorAll('.draw-tool[data-tool]').forEach(tool => {
                tool.addEventListener('click', () => {
                    document.querySelectorAll('.draw-tool[data-tool]').forEach(t => t.classList.remove('active'));
                    tool.classList.add('active');
                    currentDrawTool = tool.dataset.tool;
                });
            });
            
            // Brush size selection
            document.querySelectorAll('.size-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelectorAll('.size-option').forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    brushSizeValue = parseInt(option.dataset.size);
                    drawCtx.lineWidth = brushSizeValue;
                });
            });
           
            // Color picker
            document.getElementById('colorPicker').addEventListener('input', () => {
                drawCtx.strokeStyle = document.getElementById('colorPicker').value;
            });
           
            // Clear canvas
            document.getElementById('clearCanvas').addEventListener('click', () => {
                if (confirm('Are you sure you want to clear the canvas?')) {
                    drawCtx.fillStyle = '#000000';
                    drawCtx.fillRect(0, 0, drawCanvas.width, drawCanvas.height);
                    history = [];
                    currentStep = -1;
                }
            });
            
            // Undo
            document.getElementById('undoDraw').addEventListener('click', () => {
                if (currentStep > 0) {
                    currentStep--;
                    drawCtx.putImageData(history[currentStep], 0, 0);
                }
            });
            
            // Toggle grid
            document.getElementById('toggleGrid').addEventListener('click', () => {
                gridOverlay.style.display = gridOverlay.style.display === 'block' ? 'none' : 'block';
            });
            
            // Export drawing
            document.getElementById('exportDrawBtn').addEventListener('click', () => {
                const dataURL = drawCanvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.download = 'drawing.png';
                link.href = dataURL;
                link.click();
            });
            
            // Drawing functions
            function startDrawing(e) {
                isDrawing = true;
                [lastX, lastY] = [e.offsetX, e.offsetY];
                startX = e.offsetX;
                startY = e.offsetY;
                if (['pencil', 'eraser', 'line', 'rectangle', 'circle'].includes(currentDrawTool)) {
                    if (history.length > currentStep + 1) {
                        history = history.slice(0, currentStep + 1);
                    }
                    history.push(drawCtx.getImageData(0, 0, drawCanvas.width, drawCanvas.height));
                    currentStep++;
                }
                if (currentDrawTool === 'eyedropper') {
                    const pixel = drawCtx.getImageData(e.offsetX, e.offsetY, 1, 1).data;
                    const color = rgbToHex(pixel[0], pixel[1], pixel[2]);
                    document.getElementById('colorPicker').value = color;
                    drawCtx.strokeStyle = color;
                    isDrawing = false;
                } else if (['line', 'rectangle', 'circle'].includes(currentDrawTool)) {
                    snapshot = drawCtx.getImageData(0, 0, drawCanvas.width, drawCanvas.height);
                }
            }
           
            function draw(e) {
                if (!isDrawing) return;
               
                const x = e.offsetX;
                const y = e.offsetY;
               
                switch(currentDrawTool) {
                    case 'pencil':
                        drawCtx.beginPath();
                        drawCtx.moveTo(lastX, lastY);
                        drawCtx.lineTo(x, y);
                        drawCtx.stroke();
                        [lastX, lastY] = [x, y];
                        break;
                    case 'eraser':
                        drawCtx.save();
                        drawCtx.globalCompositeOperation = 'destination-out';
                        drawCtx.beginPath();
                        drawCtx.moveTo(lastX, lastY);
                        drawCtx.lineTo(x, y);
                        drawCtx.stroke();
                        drawCtx.restore();
                        [lastX, lastY] = [x, y];
                        break;
                    case 'line':
                    case 'rectangle':
                    case 'circle':
                        drawCtx.putImageData(snapshot, 0, 0);
                        drawCtx.beginPath();
                        if (currentDrawTool === 'line') {
                            drawCtx.moveTo(startX, startY);
                            drawCtx.lineTo(x, y);
                        } else if (currentDrawTool === 'rectangle') {
                            drawCtx.rect(Math.min(startX, x), Math.min(startY, y), Math.abs(x - startX), Math.abs(y - startY));
                        } else if (currentDrawTool === 'circle') {
                            const radius = Math.sqrt(Math.pow(x - startX, 2) + Math.pow(y - startY, 2));
                            drawCtx.arc(startX, startY, radius, 0, Math.PI * 2);
                        }
                        drawCtx.stroke();
                        break;
                }
            }
           
            function stopDrawing() {
                if (!isDrawing) return;
               
                isDrawing = false;
            }
            
            // Helper function for eyedropper
            function rgbToHex(r, g, b) {
                return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
            }
            
            // Drawing events
            drawCanvas.addEventListener('mousedown', startDrawing);
            drawCanvas.addEventListener('mousemove', draw);
            drawCanvas.addEventListener('mouseup', stopDrawing);
            drawCanvas.addEventListener('mouseout', stopDrawing);

            // === DRAG WINDOWS ===
            document.querySelectorAll('.title-bar').forEach(bar => {
                let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
                let isMaximized = false;
               
                const startDrag = (e) => {
                    if (e.target.tagName === 'BUTTON') return;
                    e.preventDefault();
                   
                    isMaximized = bar.parentElement.classList.contains('maximized');
                    if (isMaximized) {
                        bar.parentElement.classList.remove('maximized');
                        bar.parentElement.style.left = (e.clientX - bar.parentElement.offsetWidth/2) + 'px';
                        bar.parentElement.style.top = e.clientY + 'px';
                    }
                   
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    document.addEventListener('mouseup', closeDragElement);
                    document.addEventListener('mousemove', elementDrag);
                };
               
                const elementDrag = (e) => {
                    e.preventDefault();
                    pos1 = pos3 - e.clientX;
                    pos2 = pos4 - e.clientY;
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    const win = bar.parentElement;
                    win.style.top = (win.offsetTop - pos2) + "px";
                    win.style.left = (win.offsetLeft - pos1) + "px";
                };
               
                const closeDragElement = () => {
                    document.removeEventListener('mouseup', closeDragElement);
                    document.removeEventListener('mousemove', elementDrag);
                };
               
                bar.addEventListener('mousedown', startDrag);
            });

            // === CREATE DESKTOP ICONS ===
            function createDesktopIcons() {
                const desktop = document.getElementById('desktop');
                const icons = [
                    { id: 'desktopWrite', icon: 'edit', name: 'Write', x: 20, y: 20 },
                    { id: 'desktopDraw', icon: 'paint-brush', name: 'Draw', x: 20, y: 100 },
                    { id: 'desktopKernel', icon: 'microchip', name: 'Kernel Ops', x: 20, y: 180 },
                    { id: 'desktopGuide', icon: 'book', name: 'Guide', x: 120, y: 20 },
                    { id: 'desktopGames', icon: 'gamepad', name: 'Games', x: 120, y: 100, folder: true },
                    { id: 'desktopTools', icon: 'tools', name: 'Tools', x: 120, y: 180, folder: true },
                    { id: 'desktopResearch', icon: 'search', name: 'Research', x: 20, y: 260, folder: true },
                    { id: 'desktopLinks', icon: 'link', name: 'Links', x: 120, y: 260, folder: true }
                ];
               
                icons.forEach(iconConfig => {
                    const icon = document.createElement('div');
                    icon.id = iconConfig.id;
                    icon.className = `desktop-icon ${iconConfig.folder ? 'folder' : ''} ${iconConfig.icon === 'microchip' ? 'metrics' : ''}`;
                    icon.style.left = iconConfig.x + 'px';
                    icon.style.top = iconConfig.y + 'px';
                    icon.innerHTML = `
                        <i class="fas fa-${iconConfig.icon}"></i>
                        <div>${iconConfig.name}</div>
                    `;
                    desktop.appendChild(icon);
                });
            }

            // Open kernel window on startup
            setTimeout(() => openWindow(windows.kernel), 100);
        }
    </script>
</body>
</html>
