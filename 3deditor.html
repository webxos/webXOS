<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D STUDIO - webXOS</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/TransformControls.js"></script>
    <style>
        :root {
            --primary: #00c8ff;
            --secondary: #ff0080;
            --accent: #00ff99;
            --bg-dark: rgba(10, 15, 25, 0.95);
            --bg-panel: rgba(20, 30, 40, 0.85);
            --text-primary: #00ffcc;
            --text-secondary: #0099ff;
            --border-glow: 0 0 10px var(--primary);
            --danger: #ff3366;
            --warning: #ffaa00;
            --success: #00ff99;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Share Tech Mono', monospace;
            background: #000;
            overflow: hidden;
            color: var(--text-primary);
            height: 100vh;
        }

        #three-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #ui-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }

        /* Header Bar */
        #header-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 20, 40, 0.8);
            border-bottom: 1px solid var(--primary);
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            pointer-events: all;
        }

        .logo {
            font-size: 1.2em;
            font-weight: bold;
            text-shadow: 0 0 5px var(--primary);
            color: var(--accent);
        }

        .header-controls {
            display: flex;
            gap: 10px;
        }

        /* UI Windows */
        .ui-window {
            position: absolute;
            background: var(--bg-panel);
            border: 1px solid var(--primary);
            box-shadow: var(--border-glow), inset 0 0 20px rgba(0, 200, 255, 0.1);
            border-radius: 4px;
            pointer-events: all;
            min-width: 300px;
            min-height: 200px;
            backdrop-filter: blur(5px);
            overflow: hidden;
        }

        .title-bar {
            background: linear-gradient(90deg, rgba(0, 100, 255, 0.3), rgba(0, 200, 255, 0.1));
            padding: 8px 12px;
            border-bottom: 1px solid var(--primary);
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            text-shadow: 0 0 5px var(--primary);
            user-select: none;
        }

        .window-controls button {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--text-primary);
            width: 20px;
            height: 20px;
            margin-left: 5px;
            cursor: pointer;
            border-radius: 2px;
            font-size: 14px;
            line-height: 1;
        }

        .window-controls button:hover {
            background: rgba(0, 200, 255, 0.2);
        }

        .window-content {
            padding: 15px;
            height: calc(100% - 40px);
            overflow-y: auto;
        }

        /* Toolbar */
        .toolbar {
            position: absolute;
            top: 50px;
            left: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 5px;
            background: rgba(0, 20, 40, 0.8);
            border-radius: 5px;
            padding: 5px;
            border: 1px solid var(--primary);
            pointer-events: all;
        }

        .tool-btn {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--text-primary);
            width: 40px;
            height: 40px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tool-btn.active {
            background: var(--primary);
            color: #000;
        }

        /* Mode Switcher */
        #mode-switcher {
            position: absolute;
            top: 50px;
            right: 20px;
            z-index: 1000;
            display: flex;
            background: rgba(0, 20, 40, 0.8);
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid var(--primary);
            pointer-events: all;
        }

        .mode-btn {
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-size: 0.9em;
        }

        .mode-btn.active {
            background: var(--primary);
            color: #000;
        }

        /* Properties Panel */
        .properties-panel {
            background: rgba(0, 30, 60, 0.8);
            border: 1px solid var(--primary);
            border-radius: 4px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .properties-panel h3 {
            background: rgba(0, 100, 200, 0.3);
            padding: 8px 12px;
            margin: 0;
            font-size: 0.9em;
            border-bottom: 1px solid var(--primary);
        }

        .properties-content {
            padding: 10px;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .control-input {
            width: 100%;
            background: rgba(0, 40, 80, 0.5);
            border: 1px solid var(--primary);
            color: var(--text-primary);
            padding: 5px 8px;
            border-radius: 3px;
            font-family: 'Share Tech Mono', monospace;
        }

        .control-input:focus {
            outline: none;
            box-shadow: 0 0 5px var(--primary);
        }

        /* Buttons */
        .btn {
            background: rgba(0, 100, 200, 0.3);
            border: 1px solid var(--primary);
            color: var(--text-primary);
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 3px;
            font-family: 'Share Tech Mono', monospace;
            transition: all 0.2s;
            font-size: 0.9em;
        }

        .btn:hover {
            background: rgba(0, 150, 255, 0.5);
            box-shadow: 0 0 10px var(--primary);
        }

        .btn-primary {
            background: rgba(0, 150, 255, 0.5);
        }

        .btn-danger {
            background: rgba(255, 50, 100, 0.3);
            border-color: var(--danger);
        }

        .btn-danger:hover {
            background: rgba(255, 50, 100, 0.5);
            box-shadow: 0 0 10px var(--danger);
        }

        /* Template Categories */
        .template-category {
            margin-bottom: 15px;
        }

        .category-title {
            color: var(--text-secondary);
            border-bottom: 1px solid rgba(0, 200, 255, 0.3);
            padding-bottom: 5px;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .template-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
        }

        .template-item {
            padding: 8px;
            background: rgba(0, 40, 80, 0.3);
            border: 1px solid var(--primary);
            cursor: pointer;
            text-align: center;
            border-radius: 3px;
            transition: all 0.2s;
            font-size: 0.8em;
        }

        .template-item:hover {
            background: rgba(0, 100, 200, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 0 8px var(--primary);
        }

        /* Status Bar */
        #status-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 20, 40, 0.8);
            border-top: 1px solid var(--primary);
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            pointer-events: all;
        }

        .status-item {
            display: flex;
            align-items: center;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-ok {
            background: var(--success);
            box-shadow: 0 0 5px var(--success);
        }

        .status-warning {
            background: var(--warning);
            box-shadow: 0 0 5px var(--warning);
        }

        /* JSON Editor */
        .json-editor {
            width: 100%;
            height: 300px;
            background: rgba(0, 20, 40, 0.8);
            border: 1px solid var(--primary);
            color: var(--text-primary);
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 10px;
            resize: vertical;
            border-radius: 3px;
        }

        /* Responsive adjustments */
        @media (max-width: 1200px) {
            .ui-window {
                min-width: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- Header Bar -->
    <div id="header-bar">
        <div class="logo">3D STUDIO - webXOS</div>
        <div class="header-controls">
            <button class="btn" id="new-project">NEW</button>
            <button class="btn" id="save-project">SAVE</button>
            <button class="btn" id="load-project">LOAD</button>
            <button class="btn" id="export-json">EXPORT JSON</button>
            <button class="btn" id="import-json">IMPORT JSON</button>
        </div>
    </div>

    <!-- Toolbar -->
    <div class="toolbar">
        <button class="tool-btn active" id="select-tool" title="Select">üîç</button>
        <button class="tool-btn" id="move-tool" title="Move">‚ÜîÔ∏è</button>
        <button class="tool-btn" id="rotate-tool" title="Rotate">üîÑ</button>
        <button class="tool-btn" id="scale-tool" title="Scale">üìè</button>
        <div style="height: 10px;"></div>
        <button class="tool-btn" id="add-cube" title="Add Cube">‚¨õ</button>
        <button class="tool-btn" id="add-sphere" title="Add Sphere">üî¥</button>
        <button class="tool-btn" id="add-cylinder" title="Add Cylinder">üü¶</button>
        <button class="tool-btn" id="add-plane" title="Add Plane">‚¨ú</button>
    </div>

    <!-- Mode Switcher -->
    <div id="mode-switcher">
        <div class="mode-btn active" id="model-mode-btn">MODEL</div>
        <div class="mode-btn" id="level-mode-btn">LEVEL</div>
        <div class="mode-btn" id="json-mode-btn">JSON</div>
    </div>

    <!-- Three.js Canvas Container -->
    <div id="three-container"></div>
    
    <!-- UI Overlay Container -->
    <div id="ui-container">
        <!-- Model Mode Windows -->
        <div class="ui-window model-mode" id="model-templates" style="top: 100px; left: 5%; width: 350px; height: 500px;">
            <div class="title-bar">
                <span>üì¶ TEMPLATES LIBRARY</span>
                <div class="window-controls">
                    <button class="btn-minimize">‚àí</button>
                    <button class="btn-close">√ó</button>
                </div>
            </div>
            <div class="window-content">
                <div class="template-category">
                    <div class="category-title">BASIC SHAPES</div>
                    <div class="template-list">
                        <div class="template-item" data-template="cube">Cube</div>
                        <div class="template-item" data-template="sphere">Sphere</div>
                        <div class="template-item" data-template="cylinder">Cylinder</div>
                        <div class="template-item" data-template="cone">Cone</div>
                        <div class="template-item" data-template="torus">Torus</div>
                        <div class="template-item" data-template="plane">Plane</div>
                    </div>
                </div>
                
                <div class="template-category">
                    <div class="category-title">RPG FANTASY</div>
                    <div class="template-list">
                        <div class="template-item" data-template="sword">Sword</div>
                        <div class="template-item" data-template="shield">Shield</div>
                        <div class="template-item" data-template="chest">Treasure Chest</div>
                        <div class="template-item" data-template="potion">Health Potion</div>
                        <div class="template-item" data-template="dragon">Dragon</div>
                        <div class="template-item" data-template="castle">Castle</div>
                    </div>
                </div>
                
                <div class="template-category">
                    <div class="category-title">FPS GAME</div>
                    <div class="template-list">
                        <div class="template-item" data-template="assault_rifle">Assault Rifle</div>
                        <div class="template-item" data-template="pistol">Pistol</div>
                        <div class="template-item" data-template="shotgun">Shotgun</div>
                        <div class="template-item" data-template="sniper">Sniper Rifle</div>
                        <div class="template-item" data-template="ammo">Ammo Crate</div>
                        <div class="template-item" data-template="barrel">Explosive Barrel</div>
                    </div>
                </div>
                
                <div class="template-category">
                    <div class="category-title">VEHICLES</div>
                    <div class="template-list">
                        <div class="template-item" data-template="car">Car</div>
                        <div class="template-item" data-template="tank">Tank</div>
                        <div class="template-item" data-template="spaceship">Spaceship</div>
                        <div class="template-item" data-template="helicopter">Helicopter</div>
                    </div>
                </div>
                
                <div class="template-category">
                    <div class="category-title">ENVIRONMENT</div>
                    <div class="template-list">
                        <div class="template-item" data-template="tree">Tree</div>
                        <div class="template-item" data-template="rock">Rock</div>
                        <div class="template-item" data-template="house">House</div>
                        <div class="template-item" data-template="bridge">Bridge</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="ui-window model-mode" id="model-properties" style="top: 100px; right: 5%; width: 350px; height: 400px;">
            <div class="title-bar">
                <span>‚öôÔ∏è OBJECT PROPERTIES</span>
                <div class="window-controls">
                    <button class="btn-minimize">‚àí</button>
                    <button class="btn-close">√ó</button>
                </div>
            </div>
            <div class="window-content">
                <div class="properties-panel">
                    <h3>TRANSFORM</h3>
                    <div class="properties-content">
                        <div class="control-group">
                            <label class="control-label">POSITION</label>
                            <div style="display: flex; gap: 5px;">
                                <input type="number" class="control-input" id="pos-x" placeholder="X" value="0" step="0.1">
                                <input type="number" class="control-input" id="pos-y" placeholder="Y" value="0" step="0.1">
                                <input type="number" class="control-input" id="pos-z" placeholder="Z" value="0" step="0.1">
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">ROTATION</label>
                            <div style="display: flex; gap: 5px;">
                                <input type="number" class="control-input" id="rot-x" placeholder="X" value="0" step="1">
                                <input type="number" class="control-input" id="rot-y" placeholder="Y" value="0" step="1">
                                <input type="number" class="control-input" id="rot-z" placeholder="Z" value="0" step="1">
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">SCALE</label>
                            <div style="display: flex; gap: 5px;">
                                <input type="number" class="control-input" id="scale-x" placeholder="X" value="1" step="0.1">
                                <input type="number" class="control-input" id="scale-y" placeholder="Y" value="1" step="0.1">
                                <input type="number" class="control-input" id="scale-z" placeholder="Z" value="1" step="0.1">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="properties-panel">
                    <h3>MATERIAL</h3>
                    <div class="properties-content">
                        <div class="control-group">
                            <label class="control-label">COLOR</label>
                            <input type="color" class="control-input" id="object-color" value="#00ff00">
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">WIREFRAME</label>
                            <input type="checkbox" id="wireframe-toggle">
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-primary" style="flex: 1;" id="apply-properties">APPLY</button>
                    <button class="btn btn-danger" style="flex: 1;" id="delete-object">DELETE</button>
                </div>
            </div>
        </div>

        <!-- Level Mode Windows -->
        <div class="ui-window level-mode" style="display: none; top: 100px; left: 5%; width: 350px; height: 500px;">
            <div class="title-bar">
                <span>üó∫Ô∏è LEVEL EDITOR</span>
                <div class="window-controls">
                    <button class="btn-minimize">‚àí</button>
                    <button class="btn-close">√ó</button>
                </div>
            </div>
            <div class="window-content">
                <div class="properties-panel">
                    <h3>LEVEL SETTINGS</h3>
                    <div class="properties-content">
                        <div class="control-group">
                            <label class="control-label">LEVEL NAME</label>
                            <input type="text" class="control-input" id="level-name" value="Level_1">
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">LEVEL SIZE</label>
                            <div style="display: flex; gap: 5px;">
                                <input type="number" class="control-input" id="level-width" placeholder="Width" value="100" step="1">
                                <input type="number" class="control-input" id="level-height" placeholder="Height" value="100" step="1">
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">BACKGROUND</label>
                            <select class="control-input" id="level-background">
                                <option>Space</option>
                                <option>Forest</option>
                                <option>Desert</option>
                                <option>City</option>
                                <option>Underwater</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="properties-panel">
                    <h3>LEVEL OBJECTS</h3>
                    <div class="properties-content">
                        <div class="control-group">
                            <label class="control-label">SPAWN POINT</label>
                            <div style="display: flex; gap: 5px;">
                                <input type="number" class="control-input" id="spawn-x" placeholder="X" value="0" step="1">
                                <input type="number" class="control-input" id="spawn-y" placeholder="Y" value="0" step="1">
                                <input type="number" class="control-input" id="spawn-z" placeholder="Z" value="0" step="1">
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">ENEMY COUNT</label>
                            <input type="number" class="control-input" id="enemy-count" value="10" min="0" max="100">
                        </div>
                        
                        <div class="control-group">
                            <label class="control-label">ITEMS COUNT</label>
                            <input type="number" class="control-input" id="item-count" value="5" min="0" max="50">
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-primary" style="flex: 1;" id="generate-level">GENERATE</button>
                    <button class="btn" style="flex: 1;" id="clear-level">CLEAR</button>
                </div>
            </div>
        </div>

        <!-- JSON Mode Window -->
        <div class="ui-window json-mode" style="display: none; top: 100px; left: 50%; transform: translateX(-50%); width: 600px; height: 500px;">
            <div class="title-bar">
                <span>üìÑ JSON EDITOR</span>
                <div class="window-controls">
                    <button class="btn-minimize">‚àí</button>
                    <button class="btn-close">√ó</button>
                </div>
            </div>
            <div class="window-content">
                <div class="control-group">
                    <label class="control-label">SCENE DATA (JSON)</label>
                    <textarea class="json-editor" id="json-editor"></textarea>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-primary" style="flex: 1;" id="update-from-json">UPDATE SCENE</button>
                    <button class="btn" style="flex: 1;" id="copy-json">COPY TO CLIPBOARD</button>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div id="status-bar">
            <div class="status-item">
                <div class="status-indicator status-ok"></div>
                <span id="mode-status">MODEL MODE: ACTIVE</span>
            </div>
            <div class="status-item">
                <span>OBJECTS: <span id="object-count">1</span></span>
            </div>
            <div class="status-item">
                <span>TOOL: <span id="tool-status">SELECT</span></span>
            </div>
            <div class="status-item">
                <span>FPS: <span id="fps-counter">60</span></span>
            </div>
        </div>
    </div>

    <script>
        // 3D Studio Application
        class Studio3D {
            constructor() {
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.controls = null;
                this.transformControls = null;
                
                this.objects = [];
                this.selectedObject = null;
                this.currentMode = 'model'; // 'model', 'level', 'json'
                this.currentTool = 'select'; // 'select', 'move', 'rotate', 'scale'
                
                this.init();
            }

            init() {
                this.setupThreeJS();
                this.setupUI();
                this.setupEventListeners();
                this.addDefaultObject();
                this.animate();
            }

            setupThreeJS() {
                // Scene
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0x000010);
                
                // Camera
                this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                this.camera.position.set(5, 5, 5);
                this.camera.lookAt(0, 0, 0);
                
                // Renderer
                this.renderer = new THREE.WebGLRenderer({ antialias: true });
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.shadowMap.enabled = true;
                document.getElementById('three-container').appendChild(this.renderer.domElement);
                
                // Lighting
                const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
                this.scene.add(ambientLight);

                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(5, 10, 7);
                directionalLight.castShadow = true;
                this.scene.add(directionalLight);

                // Controls
                this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                
                // Transform controls
                this.transformControls = new THREE.TransformControls(this.camera, this.renderer.domElement);
                this.transformControls.addEventListener('dragging-changed', (event) => {
                    this.controls.enabled = !event.value;
                });
                this.scene.add(this.transformControls);
                
                // Grid
                const gridHelper = new THREE.GridHelper(20, 20, 0x333333, 0x222222);
                this.scene.add(gridHelper);
                
                // Axes helper
                const axesHelper = new THREE.AxesHelper(5);
                this.scene.add(axesHelper);
                
                // Handle window resize
                window.addEventListener('resize', () => {
                    this.camera.aspect = window.innerWidth / window.innerHeight;
                    this.camera.updateProjectionMatrix();
                    this.renderer.setSize(window.innerWidth, window.innerHeight);
                });
            }

            setupUI() {
                // Make windows draggable
                this.makeWindowsDraggable();
                
                // Set initial mode
                this.switchMode('model');
            }

            setupEventListeners() {
                // Mode switcher
                document.getElementById('model-mode-btn').addEventListener('click', () => {
                    this.switchMode('model');
                });
                
                document.getElementById('level-mode-btn').addEventListener('click', () => {
                    this.switchMode('level');
                });
                
                document.getElementById('json-mode-btn').addEventListener('click', () => {
                    this.switchMode('json');
                    this.updateJSONEditor();
                });
                
                // Tool buttons
                document.getElementById('select-tool').addEventListener('click', () => {
                    this.switchTool('select');
                });
                
                document.getElementById('move-tool').addEventListener('click', () => {
                    this.switchTool('move');
                });
                
                document.getElementById('rotate-tool').addEventListener('click', () => {
                    this.switchTool('rotate');
                });
                
                document.getElementById('scale-tool').addEventListener('click', () => {
                    this.switchTool('scale');
                });
                
                // Add shape buttons
                document.getElementById('add-cube').addEventListener('click', () => {
                    this.addCube();
                });
                
                document.getElementById('add-sphere').addEventListener('click', () => {
                    this.addSphere();
                });
                
                document.getElementById('add-cylinder').addEventListener('click', () => {
                    this.addCylinder();
                });
                
                document.getElementById('add-plane').addEventListener('click', () => {
                    this.addPlane();
                });
                
                // Template items
                document.querySelectorAll('.template-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const template = item.dataset.template;
                        this.addTemplate(template);
                    });
                });
                
                // Properties panel
                document.getElementById('apply-properties').addEventListener('click', () => {
                    this.applyProperties();
                });
                
                document.getElementById('delete-object').addEventListener('click', () => {
                    this.deleteSelectedObject();
                });
                
                // JSON editor
                document.getElementById('update-from-json').addEventListener('click', () => {
                    this.updateSceneFromJSON();
                });
                
                document.getElementById('copy-json').addEventListener('click', () => {
                    this.copyJSONToClipboard();
                });
                
                // File operations
                document.getElementById('new-project').addEventListener('click', () => {
                    this.newProject();
                });
                
                document.getElementById('save-project').addEventListener('click', () => {
                    this.saveProject();
                });
                
                document.getElementById('load-project').addEventListener('click', () => {
                    this.loadProject();
                });
                
                document.getElementById('export-json').addEventListener('click', () => {
                    this.exportJSON();
                });
                
                document.getElementById('import-json').addEventListener('click', () => {
                    this.importJSON();
                });
                
                // Level editor
                document.getElementById('generate-level').addEventListener('click', () => {
                    this.generateLevel();
                });
                
                document.getElementById('clear-level').addEventListener('click', () => {
                    this.clearLevel();
                });
                
                // Object selection
                this.renderer.domElement.addEventListener('click', (event) => {
                    this.handleObjectSelection(event);
                });
            }

            addDefaultObject() {
                this.addCube();
            }

            addCube() {
                const geometry = new THREE.BoxGeometry(1, 1, 1);
                const material = new THREE.MeshPhongMaterial({ 
                    color: 0x00ff00,
                    wireframe: false
                });
                const cube = new THREE.Mesh(geometry, material);
                cube.name = "Cube_" + (this.objects.length + 1);
                cube.userData = { type: 'cube' };
                this.scene.add(cube);
                this.objects.push(cube);
                this.selectObject(cube);
                this.updateObjectCount();
            }

            addSphere() {
                const geometry = new THREE.SphereGeometry(0.5, 32, 32);
                const material = new THREE.MeshPhongMaterial({ 
                    color: 0x00ff00,
                    wireframe: false
                });
                const sphere = new THREE.Mesh(geometry, material);
                sphere.name = "Sphere_" + (this.objects.length + 1);
                sphere.userData = { type: 'sphere' };
                this.scene.add(sphere);
                this.objects.push(sphere);
                this.selectObject(sphere);
                this.updateObjectCount();
            }

            addCylinder() {
                const geometry = new THREE.CylinderGeometry(0.5, 0.5, 1, 32);
                const material = new THREE.MeshPhongMaterial({ 
                    color: 0x00ff00,
                    wireframe: false
                });
                const cylinder = new THREE.Mesh(geometry, material);
                cylinder.name = "Cylinder_" + (this.objects.length + 1);
                cylinder.userData = { type: 'cylinder' };
                this.scene.add(cylinder);
                this.objects.push(cylinder);
                this.selectObject(cylinder);
                this.updateObjectCount();
            }

            addPlane() {
                const geometry = new THREE.PlaneGeometry(2, 2);
                const material = new THREE.MeshPhongMaterial({ 
                    color: 0x00ff00,
                    wireframe: false,
                    side: THREE.DoubleSide
                });
                const plane = new THREE.Mesh(geometry, material);
                plane.name = "Plane_" + (this.objects.length + 1);
                plane.userData = { type: 'plane' };
                this.scene.add(plane);
                this.objects.push(plane);
                this.selectObject(plane);
                this.updateObjectCount();
            }

            addTemplate(templateType) {
                let geometry, material, mesh;
                
                switch(templateType) {
                    case 'sword':
                        // Simple sword representation
                        const bladeGeometry = new THREE.BoxGeometry(0.1, 1, 0.02);
                        const hiltGeometry = new THREE.BoxGeometry(0.15, 0.3, 0.15);
                        const blade = new THREE.Mesh(bladeGeometry, new THREE.MeshPhongMaterial({ color: 0xcccccc }));
                        const hilt = new THREE.Mesh(hiltGeometry, new THREE.MeshPhongMaterial({ color: 0x8B4513 }));
                        hilt.position.y = -0.65;
                        mesh = new THREE.Group();
                        mesh.add(blade);
                        mesh.add(hilt);
                        mesh.name = "Sword";
                        break;
                    case 'shield':
                        geometry = new THREE.CylinderGeometry(0.8, 0.8, 0.1, 32);
                        material = new THREE.MeshPhongMaterial({ color: 0x8B4513 });
                        mesh = new THREE.Mesh(geometry, material);
                        mesh.name = "Shield";
                        break;
                    case 'chest':
                        geometry = new THREE.BoxGeometry(1, 0.7, 0.8);
                        material = new THREE.MeshPhongMaterial({ color: 0x8B4513 });
                        mesh = new THREE.Mesh(geometry, material);
                        mesh.name = "Treasure_Chest";
                        break;
                    case 'potion':
                        geometry = new THREE.CylinderGeometry(0.2, 0.2, 0.5, 32);
                        material = new THREE.MeshPhongMaterial({ color: 0xff0000 });
                        mesh = new THREE.Mesh(geometry, material);
                        mesh.name = "Health_Potion";
                        break;
                    case 'assault_rifle':
                        const bodyGeometry = new THREE.BoxGeometry(1.5, 0.2, 0.3);
                        const barrelGeometry = new THREE.CylinderGeometry(0.05, 0.05, 1, 16);
                        const body = new THREE.Mesh(bodyGeometry, new THREE.MeshPhongMaterial({ color: 0x333333 }));
                        const barrel = new THREE.Mesh(barrelGeometry, new THREE.MeshPhongMaterial({ color: 0x666666 }));
                        barrel.rotation.z = Math.PI / 2;
                        barrel.position.x = 1.25;
                        mesh = new THREE.Group();
                        mesh.add(body);
                        mesh.add(barrel);
                        mesh.name = "Assault_Rifle";
                        break;
                    case 'car':
                        const carBodyGeometry = new THREE.BoxGeometry(2, 0.5, 1);
                        const wheelGeometry = new THREE.CylinderGeometry(0.3, 0.3, 0.2, 16);
                        const carBody = new THREE.Mesh(carBodyGeometry, new THREE.MeshPhongMaterial({ color: 0xff0000 }));
                        const wheels = [];
                        for (let i = 0; i < 4; i++) {
                            const wheel = new THREE.Mesh(wheelGeometry, new THREE.MeshPhongMaterial({ color: 0x333333 }));
                            const x = i % 2 === 0 ? -0.8 : 0.8;
                            const z = i < 2 ? -0.5 : 0.5;
                            wheel.position.set(x, -0.4, z);
                            wheel.rotation.z = Math.PI / 2;
                            wheels.push(wheel);
                        }
                        mesh = new THREE.Group();
                        mesh.add(carBody);
                        wheels.forEach(wheel => mesh.add(wheel));
                        mesh.name = "Car";
                        break;
                    case 'tree':
                        const trunkGeometry = new THREE.CylinderGeometry(0.1, 0.15, 2, 16);
                        const leavesGeometry = new THREE.SphereGeometry(1, 16, 16);
                        const trunk = new THREE.Mesh(trunkGeometry, new THREE.MeshPhongMaterial({ color: 0x8B4513 }));
                        const leaves = new THREE.Mesh(leavesGeometry, new THREE.MeshPhongMaterial({ color: 0x00aa00 }));
                        leaves.position.y = 1.5;
                        mesh = new THREE.Group();
                        mesh.add(trunk);
                        mesh.add(leaves);
                        mesh.name = "Tree";
                        break;
                    default:
                        // Default to cube if template not found
                        geometry = new THREE.BoxGeometry(1, 1, 1);
                        material = new THREE.MeshPhongMaterial({ color: 0x00ff00 });
                        mesh = new THREE.Mesh(geometry, material);
                        mesh.name = "Template_" + templateType;
                }
                
                mesh.userData = { type: templateType };
                this.scene.add(mesh);
                this.objects.push(mesh);
                this.selectObject(mesh);
                this.updateObjectCount();
            }

            handleObjectSelection(event) {
                if (this.currentMode !== 'model') return;
                
                const mouse = new THREE.Vector2();
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
                
                const raycaster = new THREE.Raycaster();
                raycaster.setFromCamera(mouse, this.camera);
                
                const intersects = raycaster.intersectObjects(this.objects);
                
                if (intersects.length > 0) {
                    this.selectObject(intersects[0].object);
                } else {
                    this.selectObject(null);
                }
            }

            selectObject(object) {
                if (this.selectedObject) {
                    // Reset previous selection appearance if needed
                }
                
                this.selectedObject = object;
                
                if (this.selectedObject) {
                    this.transformControls.attach(this.selectedObject);
                    this.updatePropertiesPanel();
                } else {
                    this.transformControls.detach();
                }
            }

            updatePropertiesPanel() {
                if (this.selectedObject) {
                    document.getElementById('pos-x').value = this.selectedObject.position.x.toFixed(2);
                    document.getElementById('pos-y').value = this.selectedObject.position.y.toFixed(2);
                    document.getElementById('pos-z').value = this.selectedObject.position.z.toFixed(2);
                    
                    document.getElementById('rot-x').value = (this.selectedObject.rotation.x * (180 / Math.PI)).toFixed(2);
                    document.getElementById('rot-y').value = (this.selectedObject.rotation.y * (180 / Math.PI)).toFixed(2);
                    document.getElementById('rot-z').value = (this.selectedObject.rotation.z * (180 / Math.PI)).toFixed(2);
                    
                    document.getElementById('scale-x').value = this.selectedObject.scale.x.toFixed(2);
                    document.getElementById('scale-y').value = this.selectedObject.scale.y.toFixed(2);
                    document.getElementById('scale-z').value = this.selectedObject.scale.z.toFixed(2);
                    
                    if (this.selectedObject.material && this.selectedObject.material.color) {
                        document.getElementById('object-color').value = '#' + this.selectedObject.material.color.getHexString();
                    }
                    
                    document.getElementById('wireframe-toggle').checked = 
                        this.selectedObject.material ? this.selectedObject.material.wireframe : false;
                }
            }

            applyProperties() {
                if (this.selectedObject) {
                    this.selectedObject.position.set(
                        parseFloat(document.getElementById('pos-x').value) || 0,
                        parseFloat(document.getElementById('pos-y').value) || 0,
                        parseFloat(document.getElementById('pos-z').value) || 0
                    );
                    
                    this.selectedObject.rotation.set(
                        (parseFloat(document.getElementById('rot-x').value) || 0) * (Math.PI / 180),
                        (parseFloat(document.getElementById('rot-y').value) || 0) * (Math.PI / 180),
                        (parseFloat(document.getElementById('rot-z').value) || 0) * (Math.PI / 180)
                    );
                    
                    this.selectedObject.scale.set(
                        parseFloat(document.getElementById('scale-x').value) || 1,
                        parseFloat(document.getElementById('scale-y').value) || 1,
                        parseFloat(document.getElementById('scale-z').value) || 1
                    );
                    
                    if (this.selectedObject.material) {
                        const color = document.getElementById('object-color').value;
                        this.selectedObject.material.color.setStyle(color);
                        this.selectedObject.material.wireframe = document.getElementById('wireframe-toggle').checked;
                    }
                    
                    // Update transform controls
                    this.transformControls.update();
                }
            }

            deleteSelectedObject() {
                if (this.selectedObject) {
                    this.scene.remove(this.selectedObject);
                    this.objects = this.objects.filter(obj => obj !== this.selectedObject);
                    this.selectedObject = null;
                    this.transformControls.detach();
                    this.updateObjectCount();
                }
            }

            switchMode(mode) {
                this.currentMode = mode;
                
                // Update UI
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                document.getElementById(mode + '-mode-btn').classList.add('active');
                document.getElementById('mode-status').textContent = mode.toUpperCase() + ' MODE: ACTIVE';
                
                // Show/hide mode-specific windows
                document.querySelectorAll('.ui-window').forEach(window => {
                    window.style.display = 'none';
                });
                
                if (mode === 'model') {
                    document.getElementById('model-templates').style.display = 'block';
                    document.getElementById('model-properties').style.display = 'block';
                    this.transformControls.enabled = true;
                } else if (mode === 'level') {
                    document.querySelector('.level-mode').style.display = 'block';
                    this.transformControls.enabled = false;
                } else if (mode === 'json') {
                    document.querySelector('.json-mode').style.display = 'block';
                    this.transformControls.enabled = false;
                }
            }

            switchTool(tool) {
                this.currentTool = tool;
                
                // Update UI
                document.querySelectorAll('.tool-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                document.getElementById(tool + '-tool').classList.add('active');
                document.getElementById('tool-status').textContent = tool.toUpperCase();
                
                // Update transform controls mode
                switch(tool) {
                    case 'select':
                        this.transformControls.setMode('translate');
                        break;
                    case 'move':
                        this.transformControls.setMode('translate');
                        break;
                    case 'rotate':
                        this.transformControls.setMode('rotate');
                        break;
                    case 'scale':
                        this.transformControls.setMode('scale');
                        break;
                }
            }

            updateObjectCount() {
                document.getElementById('object-count').textContent = this.objects.length;
            }

            updateJSONEditor() {
                const sceneData = {
                    metadata: {
                        version: "1.0",
                        generator: "3D STUDIO - webXOS"
                    },
                    objects: this.objects.map(obj => ({
                        name: obj.name,
                        type: obj.userData.type,
                        position: {
                            x: obj.position.x,
                            y: obj.position.y,
                            z: obj.position.z
                        },
                        rotation: {
                            x: obj.rotation.x,
                            y: obj.rotation.y,
                            z: obj.rotation.z
                        },
                        scale: {
                            x: obj.scale.x,
                            y: obj.scale.y,
                            z: obj.scale.z
                        },
                        material: {
                            color: obj.material ? '#' + obj.material.color.getHexString() : '#00ff00',
                            wireframe: obj.material ? obj.material.wireframe : false
                        }
                    }))
                };
                
                document.getElementById('json-editor').value = JSON.stringify(sceneData, null, 2);
            }

            updateSceneFromJSON() {
                try {
                    const jsonText = document.getElementById('json-editor').value;
                    const sceneData = JSON.parse(jsonText);
                    
                    // Clear current scene
                    this.objects.forEach(obj => this.scene.remove(obj));
                    this.objects = [];
                    this.selectedObject = null;
                    this.transformControls.detach();
                    
                    // Add objects from JSON
                    if (sceneData.objects) {
                        sceneData.objects.forEach(objData => {
                            let geometry, material, mesh;
                            
                            switch(objData.type) {
                                case 'cube':
                                    geometry = new THREE.BoxGeometry(1, 1, 1);
                                    break;
                                case 'sphere':
                                    geometry = new THREE.SphereGeometry(0.5, 32, 32);
                                    break;
                                case 'cylinder':
                                    geometry = new THREE.CylinderGeometry(0.5, 0.5, 1, 32);
                                    break;
                                case 'plane':
                                    geometry = new THREE.PlaneGeometry(2, 2);
                                    break;
                                default:
                                    geometry = new THREE.BoxGeometry(1, 1, 1);
                            }
                            
                            material = new THREE.MeshPhongMaterial({ 
                                color: objData.material ? objData.material.color : 0x00ff00,
                                wireframe: objData.material ? objData.material.wireframe : false
                            });
                            
                            mesh = new THREE.Mesh(geometry, material);
                            mesh.name = objData.name;
                            mesh.position.set(
                                objData.position.x,
                                objData.position.y,
                                objData.position.z
                            );
                            mesh.rotation.set(
                                objData.rotation.x,
                                objData.rotation.y,
                                objData.rotation.z
                            );
                            mesh.scale.set(
                                objData.scale.x,
                                objData.scale.y,
                                objData.scale.z
                            );
                            mesh.userData = { type: objData.type };
                            
                            this.scene.add(mesh);
                            this.objects.push(mesh);
                        });
                    }
                    
                    this.updateObjectCount();
                    alert('Scene updated from JSON!');
                } catch (error) {
                    alert('Error parsing JSON: ' + error.message);
                }
            }

            copyJSONToClipboard() {
                const jsonText = document.getElementById('json-editor');
                jsonText.select();
                document.execCommand('copy');
                alert('JSON copied to clipboard!');
            }

            newProject() {
                if (confirm('Are you sure you want to create a new project? All unsaved changes will be lost.')) {
                    this.objects.forEach(obj => this.scene.remove(obj));
                    this.objects = [];
                    this.selectedObject = null;
                    this.transformControls.detach();
                    this.addDefaultObject();
                    this.updateObjectCount();
                }
            }

            saveProject() {
                this.updateJSONEditor();
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(document.getElementById('json-editor').value);
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "3dstudio_project.json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            }

            loadProject() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = e => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = event => {
                        document.getElementById('json-editor').value = event.target.result;
                        this.updateSceneFromJSON();
                    };
                    reader.readAsText(file);
                };
                input.click();
            }

            exportJSON() {
                this.updateJSONEditor();
                this.switchMode('json');
            }

            importJSON() {
                this.loadProject();
            }

            generateLevel() {
                // Clear existing objects
                this.objects.forEach(obj => this.scene.remove(obj));
                this.objects = [];
                
                // Add ground plane
                const groundGeometry = new THREE.PlaneGeometry(
                    parseInt(document.getElementById('level-width').value) || 100,
                    parseInt(document.getElementById('level-height').value) || 100
                );
                const groundMaterial = new THREE.MeshPhongMaterial({ 
                    color: 0x3a7d3a,
                    side: THREE.DoubleSide
                });
                const ground = new THREE.Mesh(groundGeometry, groundMaterial);
                ground.rotation.x = Math.PI / 2;
                ground.name = "Ground";
                ground.userData = { type: 'ground' };
                this.scene.add(ground);
                this.objects.push(ground);
                
                // Add some random objects based on level settings
                const enemyCount = parseInt(document.getElementById('enemy-count').value) || 10;
                const itemCount = parseInt(document.getElementById('item-count').value) || 5;
                
                for (let i = 0; i < enemyCount; i++) {
                    const geometry = new THREE.ConeGeometry(0.5, 1, 8);
                    const material = new THREE.MeshPhongMaterial({ color: 0xff0000 });
                    const enemy = new THREE.Mesh(geometry, material);
                    enemy.position.set(
                        (Math.random() - 0.5) * (parseInt(document.getElementById('level-width').value) || 100) * 0.8,
                        0.5,
                        (Math.random() - 0.5) * (parseInt(document.getElementById('level-height').value) || 100) * 0.8
                    );
                    enemy.name = "Enemy_" + (i + 1);
                    enemy.userData = { type: 'enemy' };
                    this.scene.add(enemy);
                    this.objects.push(enemy);
                }
                
                for (let i = 0; i < itemCount; i++) {
                    const geometry = new THREE.SphereGeometry(0.3, 16, 16);
                    const material = new THREE.MeshPhongMaterial({ color: 0xffff00 });
                    const item = new THREE.Mesh(geometry, material);
                    item.position.set(
                        (Math.random() - 0.5) * (parseInt(document.getElementById('level-width').value) || 100) * 0.8,
                        0.3,
                        (Math.random() - 0.5) * (parseInt(document.getElementById('level-height').value) || 100) * 0.8
                    );
                    item.name = "Item_" + (i + 1);
                    item.userData = { type: 'item' };
                    this.scene.add(item);
                    this.objects.push(item);
                }
                
                // Add spawn point
                const spawnX = parseFloat(document.getElementById('spawn-x').value) || 0;
                const spawnY = parseFloat(document.getElementById('spawn-y').value) || 0;
                const spawnZ = parseFloat(document.getElementById('spawn-z').value) || 0;
                
                const spawnGeometry = new THREE.CylinderGeometry(0.5, 0.5, 0.1, 16);
                const spawnMaterial = new THREE.MeshPhongMaterial({ color: 0x00ff00 });
                const spawn = new THREE.Mesh(spawnGeometry, spawnMaterial);
                spawn.position.set(spawnX, 0.05, spawnZ);
                spawn.name = "Spawn_Point";
                spawn.userData = { type: 'spawn' };
                this.scene.add(spawn);
                this.objects.push(spawn);
                
                this.updateObjectCount();
                alert('Level generated with ' + enemyCount + ' enemies and ' + itemCount + ' items!');
            }

            clearLevel() {
                if (confirm('Are you sure you want to clear the level?')) {
                    this.objects.forEach(obj => this.scene.remove(obj));
                    this.objects = [];
                    this.selectedObject = null;
                    this.transformControls.detach();
                    this.updateObjectCount();
                }
            }

            makeWindowsDraggable() {
                const windows = document.querySelectorAll('.ui-window');
                
                windows.forEach(window => {
                    const titleBar = window.querySelector('.title-bar');
                    let isDragging = false;
                    let offsetX, offsetY;

                    titleBar.addEventListener('mousedown', (e) => {
                        isDragging = true;
                        offsetX = e.clientX - window.offsetLeft;
                        offsetY = e.clientY - window.offsetTop;
                        window.style.zIndex = 1000;
                        
                        // Bring other windows to a lower z-index
                        windows.forEach(w => {
                            if (w !== window) w.style.zIndex = 1;
                        });
                    });

                    document.addEventListener('mousemove', (e) => {
                        if (!isDragging) return;
                        
                        window.style.left = (e.clientX - offsetX) + 'px';
                        window.style.top = (e.clientY - offsetY) + 'px';
                    });

                    document.addEventListener('mouseup', () => {
                        isDragging = false;
                    });
                });
                
                // Window controls
                document.querySelectorAll('.btn-close').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.target.closest('.ui-window').style.display = 'none';
                    });
                });
                
                document.querySelectorAll('.btn-minimize').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const window = e.target.closest('.ui-window');
                        const content = window.querySelector('.window-content');
                        content.style.display = content.style.display === 'none' ? 'block' : 'none';
                    });
                });
            }

            animate() {
                requestAnimationFrame(() => this.animate());
                
                // Update controls
                this.controls.update();
                
                // Render scene
                this.renderer.render(this.scene, this.camera);
                
                // Update FPS counter occasionally
                if (Math.random() < 0.1) {
                    document.getElementById('fps-counter').textContent = 
                        Math.floor(60 + Math.random() * 10); // Simulated FPS
                }
            }
        }

        // Initialize the application when the page loads
        window.addEventListener('DOMContentLoaded', () => {
            new Studio3D();
        });
    </script>
</body>
</html>