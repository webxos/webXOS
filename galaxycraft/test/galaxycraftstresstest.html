<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GalaxyCraft - Ultimate Space MMO</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Orbitron', 'Roboto', sans-serif;
    }
    
    body {
      background: #000;
      color: #fff;
      overflow: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    #cosmicCanvas {
      flex: 1;
      width: 100%;
      touch-action: none;
      position: relative;
    }
    
    .hud {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      opacity: 0.4;
      z-index: 1;
    }
    
    .hud::before {
      content: '';
      position: absolute;
      top: 10%;
      left: 10%;
      right: 10%;
      bottom: 10%;
      border: 2px solid rgba(74, 144, 226, 0);
      border-radius: 20px;
      box-shadow: none;
    }
    
    .hud::after {
      content: '+';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #4a90e2;
      font-size: 24px;
    }
    
    .status-overlay {
      position: absolute;
      top: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.3);
      padding: 5px 10px;
      font-size: 12px;
      text-align: left;
      color: #fff;
      text-shadow: 0 0 2px #000;
      z-index: 5;
      pointer-events: none;
    }
    
    .console {
      position: absolute;
      bottom: 60px;
      width: 100%;
      height: 25%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      flex-direction: column;
      z-index: 5;
      padding: 5px;
    }
    
    .console-log {
      flex: 1;
      overflow-y: auto;
      font-size: 12px;
      color: #fff;
      text-shadow: 0 0 2px #000;
      padding: 5px;
    }
    
    .console-log p {
      margin: 2px 0;
    }
    
    .console-input {
      width: 100%;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid #4a90e2;
      color: #fff;
      padding: 5px;
      font-size: 12px;
      outline: none;
    }
    
    .console-input::placeholder {
      color: #aaa;
    }
    
    .console::-webkit-scrollbar {
      width: 8px;
    }
    
    .console::-webkit-scrollbar-thumb {
      background: #4a90e2;
      border-radius: 4px;
    }
    
    .controls {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: rgba(20, 20, 50, 0.9);
      padding: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      backdrop-filter: blur(5px);
      z-index: 10;
    }
    
    .control-item {
      flex: 1;
      min-width: 70px;
      text-align: center;
    }
    
    button {
      background: #4a90e2;
      border: none;
      padding: 8px 12px;
      color: white;
      border-radius: 16px;
      cursor: pointer;
      font-size: 14px;
      transition: transform 0.2s, background 0.2s;
    }
    
    button:hover {
      background: #357abd;
    }
    
    button.active {
      background: #ff4444;
    }
    
    button:active {
      transform: scale(0.95);
    }
    
    .compact-btn {
      padding: 6px 10px;
      font-size: 12px;
    }
    
    .wallet-status {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.5);
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 12px;
      z-index: 20;
    }
    
    .wallet-address {
      color: #4a90e2;
      font-weight: bold;
    }
    
    .mining-overlay {
      position: absolute;
      bottom: 150px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      padding: 10px;
      border-radius: 10px;
      display: none;
      z-index: 15;
    }
    
    .mining-overlay.active {
      display: block;
    }
    
    .mining-progress {
      width: 200px;
      height: 10px;
      background: #333;
      border-radius: 5px;
      overflow: hidden;
      margin: 5px 0;
    }
    
    .mining-progress-bar {
      height: 100%;
      background: #4a90e2;
      width: 0%;
      transition: width 0.3s;
    }
    
    .chat-overlay {
      position: absolute;
      bottom: 60px;
      right: 10px;
      width: 250px;
      height: 180px;
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid #4a90e2;
      border-radius: 8px;
      z-index: 15;
      display: flex;
      flex-direction: column;
      resize: both;
      overflow: auto;
      min-width: 200px;
      min-height: 120px;
    }
    
    .chat-header {
      background: rgba(74, 144, 226, 0.5);
      padding: 4px 8px;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      font-size: 11px;
      display: flex;
      justify-content: space-between;
      cursor: move;
    }
    
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 4px;
      font-size: 11px;
    }
    
    .chat-input {
      border: none;
      border-top: 1px solid #4a90e2;
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      padding: 4px;
      outline: none;
      font-size: 11px;
    }
    
    .stats-window {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 200px;
      background: rgba(0, 0, 0, 0.7);
      border: 1px solid #4a90e2;
      border-radius: 8px;
      z-index: 15;
      display: flex;
      flex-direction: column;
      resize: both;
      overflow: auto;
      min-height: 200px;
    }
    
    .stats-header {
      background: rgba(74, 144, 226, 0.5);
      padding: 4px 8px;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      font-size: 11px;
      display: flex;
      justify-content: space-between;
      cursor: move;
    }
    
    .stats-content {
      padding: 8px;
      font-size: 11px;
    }
    
    .stats-resource {
      margin-bottom: 5px;
      display: flex;
      justify-content: space-between;
    }
    
    .stats-bar {
      height: 5px;
      background: #333;
      border-radius: 3px;
      margin: 2px 0;
      overflow: hidden;
    }
    
    .stats-fill {
      height: 100%;
      background: #4a90e2;
    }
    
    .drone-controls {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px;
      border-radius: 8px;
      z-index: 15;
      font-size: 12px;
      width: 150px;
    }
    
    .drone-list {
      max-height: 100px;
      overflow-y: auto;
      margin-top: 5px;
      font-size: 11px;
    }
    
    .drone-item {
      padding: 3px;
      border-bottom: 1px solid #4a90e2;
      cursor: pointer;
    }
    
    .drone-item:hover {
      background: rgba(74, 144, 226, 0.2);
    }
    
    .planet-controls {
      position: absolute;
      top: 50px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px;
      border-radius: 8px;
      z-index: 15;
      font-size: 12px;
      width: 150px;
    }
    
    .planet-list {
      max-height: 100px;
      overflow-y:auto;
      margin-top: 5px;
      font-size: 11px;
    }
    
    .planet-item {
      padding: 3px;
      border-bottom: 1px solid #4a90e2;
      cursor: pointer;
    }
    
    .planet-item:hover {
      background: rgba(74, 144, 226, 0.2);
    }
    
    .central-menu {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      max-width: 600px;
      background: rgba(10, 20, 40, 0.95);
      border: 2px solid #4a90e2;
      border-radius: 15px;
      padding: 20px;
      z-index: 100;
      display: none;
      backdrop-filter: blur(10px);
      box-shadow: 0 0 30px rgba(74, 144, 226, 0.5);
    }
    
    .central-menu.active {
      display: block;
    }
    
    .menu-tabs {
      display: flex;
      border-bottom: 1px solid #4a90e2;
      margin-bottom: 15px;
    }
    
    .menu-tab {
      padding: 10px 15px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      font-size: 14px;
    }
    
    .menu-tab.active {
      border-bottom: 3px solid #4a90e2;
      color: #4a90e2;
    }
    
    .menu-content {
      max-height: 400px;
      overflow-y: auto;
    }
    
    .menu-section {
      margin-bottom: 20px;
    }
    
    .menu-section h3 {
      margin-bottom: 10px;
      color: #4a90e2;
      border-bottom: 1px solid #4a90e2;
      padding-bottom: 5px;
      font-size: 16px;
    }
    
    .resource-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }
    
    .resource-item {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid #4a90e2;
      border-radius: 5px;
      padding: 8px;
      text-align: center;
      font-size: 12px;
    }
    
    .resource-icon {
      font-size: 20px;
      margin-bottom: 5px;
    }
    
    .close-menu {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      color: #fff;
      font-size: 20px;
      cursor: pointer;
    }
    
    .auction-house {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      max-width: 500px;
      background: rgba(10, 20, 40, 0.95);
      border: 2px solid #4a90e2;
      border-radius: 15px;
      padding: 15px;
      z-index: 100;
      display: none;
      backdrop-filter: blur(10px);
    }
    
    .auction-house.active {
      display: block;
    }
    
    .auction-item {
      display: flex;
      justify-content: space-between;
      padding: 6px;
      border-bottom: 1px solid #4a90e2;
      font-size: 12px;
    }
    
    .auction-action {
      background: #4a90e2;
      border: none;
      color: white;
      padding: 3px 8px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 11px;
    }
    
    .nft-item {
      background: linear-gradient(135deg, #6e48aa, #9d50bb);
      border: 1px solid #ff00ff;
      border-radius: 5px;
      padding: 8px;
      text-align: center;
      font-size: 12px;
      box-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
    }
    
    .nft-icon {
      font-size: 20px;
      margin-bottom: 5px;
      color: gold;
    }
    
    .mining-path {
      position: absolute;
      background: rgba(0, 255, 0, 0.2);
      z-index: 4;
      pointer-events: none;
    }
    
    .mining-node {
      position: absolute;
      width: 10px;
      height: 10px;
      background: red;
      border-radius: 50%;
      box-shadow: 0 0 10px red;
      z-index: 5;
      pointer-events: none;
      animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 0.3; }
      50% { opacity: 1; }
      100% { opacity: 0.3; }
    }
    
    .crosshair {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 20px;
      height: 20px;
      border: 2px solid red;
      border-radius: 50%;
      pointer-events: none;
      z-index: 10;
    }
    
    .crosshair.active {
      border-color: #0f0;
    }
    
    .controls-help {
      position: absolute;
      bottom: 40px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px;
      border-radius: 8px;
      z-index: 15;
      font-size: 11px;
      width: 200px;
    }
    
    .prompt {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      padding: 10px;
      border-radius: 10px;
      font-size: 14px;
      max-width: 90%;
      text-align: center;
      opacity: 0;
      transition: opacity 0.5s;
      z-index: 5;
    }
    
    .prompt.active {
      opacity: 1;
    }
    
    .throttle-indicator {
      position: absolute;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      color: #4a90e2;
      font-size: 12px;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 5;
    }
    
    .throttle-indicator.active {
      opacity: 1;
    }
    
    .chat-controls {
      display: flex;
      justify-content: flex-end;
      padding: 2px;
    }
    
    .chat-controls button {
      background: transparent;
      border: none;
      color: #4a90e2;
      font-size: 12px;
      padding: 2px 5px;
      cursor: pointer;
    }
    
    /* Chat message colors */
    .chat-sector {
      color: #00ffff; /* Light blue for sector messages */
    }
    
    .chat-market {
      color: #00ff00; /* Green for market messages */
    }
    
    .chat-player {
      color: #ffa500; /* Orange for player messages */
    }
    
    .chat-dm {
      color: #ff7700; /* Darker orange for direct messages */
      font-style: italic;
    }
    
    .chat-tag {
      background-color: rgba(255, 255, 255, 0.1);
      padding: 1px 4px;
      border-radius: 3px;
      margin: 0 2px;
    }
    
    .chat-corporation {
      color: #ff55ff; /* Pink for corporation messages */
    }
    
    .chat-global {
      color: #ffff00; /* Yellow for global messages */
    }
    
    /* Sector management styles */
    .sector-management {
      position: absolute;
      top: 100px;
      left: 10px;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px;
      border-radius: 8px;
      z-index: 15;
      font-size: 12px;
      width: 180px;
      display: none;
    }
    
    .sector-management.active {
      display: block;
    }
    
    .sector-list {
      max-height: 120px;
      overflow-y: auto;
      margin-top: 5px;
      font-size: 11px;
    }
    
    .sector-item {
      padding: 3px;
      border-bottom: 1px solid #4a90e2;
      cursor: pointer;
    }
    
    .sector-item:hover {
      background: rgba(74, 144, 226, 0.2);
    }
    
    .node-indicator {
      position: absolute;
      width: 12px;
      height: 12px;
      background: #ff00ff;
      border-radius: 50%;
      box-shadow: 0 0 10px #ff00ff;
      z-index: 5;
      pointer-events: none;
      animation: nodePulse 2s infinite;
    }
    
    @keyframes nodePulse {
      0% { transform: scale(1); opacity: 0.7; }
      50% { transform: scale(1.3); opacity: 1; }
      100% { transform: scale(1); opacity: 0.7; }
    }
    
    .drone-indicator {
      position: absolute;
      width: 0;
      height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-bottom: 14px solid #00ff00;
      z-index: 5;
      pointer-events: none;
    }
    
    .trade-request {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      border: 2px solid #4a90e2;
      border-radius: 10px;
      padding: 15px;
      z-index: 100;
      display: none;
      text-align: center;
    }
    
    .trade-request.active {
      display: block;
    }
  </style>
</head>
<body>
  <div id="cosmicCanvas">
    <div class="hud"></div>
    <div class="crosshair"></div>
    <div id="statusOverlay" class="status-overlay"></div>
    <div id="throttleIndicator" class="throttle-indicator"></div>
    
    <div class="stats-window" id="statsWindow">
      <div class="stats-header" id="statsHeader">
        <span>Ship Status</span>
        <span id="onlineStatus">Online</span>
      </div>
      <div class="stats-content">
        <div class="stats-resource">Credits: <span id="creditsValue">1000</span></div>
        <div class="stats-resource">$WEBXOS: <span id="webxosValue">100</span></div>
        <div class="stats-resource">Energy: <span id="energyValue">100</span>/100</div>
        <div class="stats-bar"><div id="energyBar" class="stats-fill" style="width:100%"></div></div>
        <div class="stats-resource">Fuel: <span id="fuelValue">1000</span>/1000</div>
        <div class="stats-bar"><div id="fuelBar" class="stats-fill" style="width:100%"></div></div>
        <div class="stats-resource">Storage: <span id="storageValue">0</span>/1000</div>
        <div class="stats-bar"><div id="storageBar" class="stats-fill" style="width:0%"></div></div>
        <div class="stats-resource">Iron: <span id="resourceIron">125</span></div>
        <div class="stats-resource">Silicon: <span id="resourceSilicon">80</span></div>
        <div class="stats-resource">Gold: <span id="resourceGold">15</span></div>
        <div class="stats-resource">Platinum: <span id="resourcePlatinum">8</span></div>
        <div class="stats-resource">Titanium: <span id="resourceTitanium">22</span></div>
        <div class="stats-resource">Uranium: <span id="resourceUranium">5</span></div>
        <div class="stats-resource">Quantum: <span id="resourceQuantum">3</span></div>
        <div class="stats-resource">Dark Matter: <span id="resourceDarkMatter">1</span></div>
      </div>
    </div>
    
    <div class="wallet-status">
      <span id="walletAddress" class="wallet-address">Not Connected</span>
    </div>
    
    <div class="drone-controls">
      <div>Drones: <span id="droneCount">0</span>/5 | Fuel: <span id="droneFuel">100</span></div>
      <div class="drone-list" id="droneList"></div>
      <button id="deployDroneBtn" class="compact-btn" style="margin-top:5px;width:100%">Deploy Drone (50 Iron)</button>
    </div>
    
    <div class="planet-controls">
      <div>Planets: <span id="planetCount">0</span>/3</div>
      <div class="planet-list" id="planetList"></div>
      <button id="managePlanetBtn" class="compact-btn" style="margin-top:5px;width:100%">Manage Planets</button>
    </div>
    
    <div class="sector-management" id="sectorManagement">
      <div>Sectors: <span id="sectorCount">0</span>/3</div>
      <div class="sector-list" id="sectorList"></div>
      <button id="nodeBtn" class="compact-btn" style="margin-top:5px;width:100%">Add Node</button>
      <button id="federateBtn" class="compact-btn" style="margin-top:5px;width:100%">Federate Sector</button>
    </div>
    
    <div id="miningOverlay" class="mining-overlay">
      <div>Mining: <span id="miningResource">Unknown</span></div>
      <div class="mining-progress">
        <div id="miningProgress" class="mining-progress-bar"></div>
      </div>
      <div>Yield: <span id="miningYield">0</span> units</div>
    </div>
    
    <div class="chat-overlay" id="chatWindow">
      <div class="chat-header" id="chatHeader">
        <span>Global Chat</span>
        <span>Online: <span id="onlineCount">1</span></span>
      </div>
      <div class="chat-controls">
        <button id="minimizeChat">_</button>
        <button id="maximizeChat">□</button>
        <button id="closeChat">×</button>
      </div>
      <div id="chatMessages" class="chat-messages">
        <p><span class="wallet-address">GalaxyCraft-Agent:</span> Welcome to GalaxyCraft! Type /help for assistance.</p>
        <p><span class="chat-market">[Market]</span> New quantum crystals available for trade!</p>
        <p><span class="chat-sector">[Sector-7B]</span> Player1 discovered a new asteroid field</p>
      </div>
      <input id="chatInput" class="chat-input" type="text" placeholder="Type message or /dm player message..." autocomplete="off">
    </div>
    
    <div class="controls-help">
      <div>CONTROLS: WASD/Arrows = Steer</div>
      <div>SHIFT = Full Throttle</div>
      <div>SPACE = Mine, CTRL = Scan</div>
      <div>C = Claim Planet, M = Menu</div>
      <div>N = Nodes, F = Federation</div>
    </div>
    
    <div id="console" class="console">
      <div id="consoleLog" class="console-log"></div>
      <input id="consoleInput" class="console-input" type="text" placeholder="Type /help for commands..." autocomplete="off">
    </div>
    
    <div id="tradeRequest" class="trade-request">
      <h3>Trade Request</h3>
      <p>Player1 wants to trade with you</p>
      <div style="display:flex;justify-content:space-around;margin:10px 0">
        <button id="acceptTrade" class="compact-btn">Accept</button>
        <button id="declineTrade" class="compact-btn">Decline</button>
      </div>
    </div>
  </div>
  
  <div class="controls">
    <div class="control-item"><button id="throttleBtn" class="compact-btn">Full Throttle</button></div>
    <div class="control-item"><button id="mineBtn" class="compact-btn">Mine</button></div>
    <div class="control-item"><button id="scanBtn" class="compact-btn">Scan</button></div>
    <div class="control-item"><button id="planetBtn" class="compact-btn">Claim</button></div>
    <div class="control-item"><button id="menuBtn" class="compact-btn">Menu</button></div>
    <div class="control-item"><button id="droneBtn" class="compact-btn">Drones</button></div>
    <div class="control-item"><button id="auctionBtn" class="compact-btn">Auction</button></div>
    <div class="control-item"><button id="sectorBtn" class="compact-btn">Sectors</button></div>
    <div class="control-item"><button id="resetBtn" class="compact-btn">Reset</button></div>
  </div>
  
  <div id="centralMenu" class="central-menu">
    <button class="close-menu" id="closeMenu">×</button>
    <div class="menu-tabs">
      <div class="menu-tab active" data-tab="resources">Resources</div>
      <div class="menu-tab" data-tab="crafting">Crafting</div>
      <div class="menu-tab" data-tab="market">Market</div>
      <div class="menu-tab" data-tab="missions">Missions</div>
      <div class="menu-tab" data-tab="sectors">Sectors</div>
      <div class="menu-tab" data-tab="nfts">NFT Items</div>
      <div class="menu-tab" data-tab="settings">Settings</div>
    </div>
    <div class="menu-content">
      <div class="menu-section" id="resourcesTab">
        <h3>Available Resources</h3>
        <div class="resource-grid">
          <div class="resource-item"><div class="resource-icon">●</div><div>Iron Ore</div><div id="resourceIronMenu">125</div></div>
          <div class="resource-item"><div class="resource-icon">◆</div><div>Silicon</div><div id="resourceSiliconMenu">80</div></div>
          <div class="resource-item"><div class="resource-icon">★</div><div>Gold</div><div id="resourceGoldMenu">15</div></div>
          <div class="resource-item"><div class="resource-icon">❖</div><div>Platinum</div><div id="resourcePlatinumMenu">8</div></div>
          <div class="resource-item"><div class="resource-icon">✦</div><div>Titanium</div><div id="resourceTitaniumMenu">22</div></div>
          <div class="resource-item"><div class="resource-icon">◈</div><div>Uranium</div><div id="resourceUraniumMenu">5</div></div>
          <div class="resource-item"><div class="resource-icon">⦿</div><div>Quantum Crystals</div><div id="resourceQuantumMenu">3</div></div>
          <div class="resource-item"><div class="resource-icon">⌬</div><div>Dark Matter</div><div id="resourceDarkMatterMenu">1</div></div>
          <div class="resource-item"><div class="resource-icon">🔥</div><div>Fuel</div><div id="resourceFuelMenu">1000</div></div>
        </div>
      </div>
      
      <div class="menu-section" id="craftingTab" style="display:none">
        <h3>Crafting Recipes</h3>
        <div class="resource-item"><div>Basic Drone</div><div>50 Iron, 20 Silicon</div><button class="auction-action" id="craftDroneBtn">Craft</button></div>
        <div class="resource-item"><div>Storage Upgrade</div><div>100 Iron, 50 Titanium</div><button class="auction-action" id="craftStorageBtn">Craft</button></div>
        <div class="resource-item"><div>Engine Upgrade</div><div>80 Platinum, 30 Uranium</div><button class="auction-action" id="craftEngineBtn">Craft</button></div>
        <div class="resource-item"><div>Fuel Extractor</div><div>150 Iron, 75 Titanium</div><button class="auction-action" id="craftFuelBtn">Craft</button></div>
      </div>
      
      <div class="menu-section" id="marketTab" style="display:none">
        <h3>Global Market</h3>
        <p>Buy and sell resources with other players</p>
        <div class="resource-item"><div>Sell Iron (per unit)</div><div>Current: 5 credits</div><button class="auction-action" id="sellIronBtn">Sell</button></div>
        <div class="resource-item"><div>Buy Silicon (per unit)</div><div>Current: 8 credits</div><button class="auction-action" id="buySiliconBtn">Buy</button></div>
        <div class="resource-item"><div>Sell Fuel (per unit)</div><div>Current: 3 credits</div><button class="auction-action" id="sellFuelBtn">Sell</button></div>
      </div>
      
      <div class="menu-section" id="missionsTab" style="display:none">
        <h3>Available Missions</h3>
        <div class="resource-item"><div>Mine 100 Iron</div><div>Reward: 500 credits</div><button class="auction-action" id="missionIronBtn">Accept</button></div>
        <div class="resource-item"><div>Discover 5 Planets</div><div>Reward: Storage Upgrade</div><button class="auction-action" id="missionPlanetBtn">Accept</button></div>
        <div class="resource-item"><div>Deploy 3 Drones</div><div>Reward: 1000 credits</div><button class="auction-action" id="missionDroneBtn">Accept</button></div>
        <div class="resource-item"><div>Extract 500 Fuel</div><div>Reward: Fuel Extractor</div><button class="auction-action" id="missionFuelBtn">Accept</button></div>
      </div>
      
      <div class="menu-section" id="sectorsTab" style="display:none">
        <h3>Your Sectors</h3>
        <div id="sectorsContainer" class="resource-grid">
          <div class="resource-item"><div>No sectors claimed yet</div><div>Find and claim planets to create sectors</div></div>
        </div>
        <h3>Sector Management</h3>
        <div class="resource-item"><div>Federation Status</div><div>Not Federated</div><button class="auction-action" id="federateSectorBtn">Create Federation</button></div>
        <div class="resource-item"><div>Node Network</div><div>0/10 Nodes</div><button class="auction-action" id="addNodeBtn">Add Node (50 Iron)</button></div>
      </div>
      
      <div class="menu-section" id="nftsTab" style="display:none">
        <h3>NFT Items</h3>
        <div class="resource-grid">
          <div class="nft-item"><div class="nft-icon">🚀</div><div>NFT Engine</div><div>+20% Speed</div><div>Rare</div></div>
          <div class="nft-item"><div class="nft-icon">🛡️</div><div>NFT Hull</div><div>+30% Storage</div><div>Epic</div></div>
          <div class="nft-item"><div class="nft-icon">⚡</div><div>NFT Reactor</div><div>-50% Fuel Use</div><div>Legendary</div></div>
        </div>
        <h3>Your NFT Collection</h3>
        <div class="resource-item" id="nftCollection"><div>No NFTs yet</div><div>Find rare resources to craft NFTs</div></div>
      </div>
      
      <div class="menu-section" id="settingsTab" style="display:none">
        <h3>Settings & Wallet</h3>
        <p>Connect your $WEBXOS wallet to participate in the economy</p>
        <button id="connectWalletBtn" class="auction-action" style="width:100%">Connect Wallet</button>
        <div style="margin-top:10px">
          <div>Session ID: <span id="sessionId">Not connected</span></div>
          <div>API Status: <span style="color:#4a90e2">Online (Simulated)</span></div>
        </div>
      </div>
    </div>
  </div>
  
  <div id="auctionHouse" class="auction-house">
    <button class="close-menu" id="closeAuction">×</button>
    <h2>Universal Auction House</h2>
    <p>List items for sale (max 3 active listings)</p>
    
    <div class="auction-item"><div>Quantum Crystal (5 units)</div><div>2500 credits</div><button class="auction-action">Buy</button></div>
    <div class="auction-item"><div>Storage Upgrade Blueprint</div><div>1500 credits</div><button class="auction-action">Buy</button></div>
    <div class="auction-item"><div>Titanium (50 units)</div><div>800 credits</div><button class="auction-action">Buy</button></div>
    <div class="auction-item"><div>NFT Engine</div><div>5000 $WEBXOS</div><button class="auction-action">Buy</button></div>
    
    <h3 style="margin-top:20px">Your Listings</h3>
    <div class="auction-item"><div>Iron (100 units)</div><div>500 credits</div><button class="auction-action">Cancel</button></div>
    
    <div style="margin-top:20px">
      <h3>List New Item</h3>
      <select id="auctionItemSelect" style="width:100%;padding:5px;margin-bottom:5px;background:#1a1a2e;color:white;border:1px solid #4a90e2">
        <option value="iron">Iron Ore</option><option value="silicon">Silicon</option><option value="gold">Gold</option>
        <option value="platinum">Platinum</option><option value="titanium">Titanium</option><option value="uranium">Uranium</option>
        <option value="fuel">Fuel</option><option value="nft">NFT Item</option>
      </select>
      <input type="number" id="auctionQuantity" placeholder="Quantity" min="1" style="width:100%;padding:5px;margin-bottom:5px;background:#1a1a2e;color:white;border:1px solid #4a90e2">
      <input type="number" id="auctionPrice" placeholder="Price" min="1" style="width:100%;padding:5px;margin-bottom:5px;background:#1a1a2e;color:white;border:1px solid #4a90e2">
      <select id="auctionCurrency" style="width:100%;padding:5px;margin-bottom:5px;background:#1a1a2e;color:white;border:1px solid #4a90e2">
        <option value="credits">Credits</option><option value="webxos">$WEBXOS</option>
      </select>
      <button id="listAuctionBtn" class="auction-action" style="width:100%">List Item</button>
    </div>
  </div>
  
  <div id="prompt" class="prompt"></div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    // Game state
    const gameState = {
      connected: false,
      credits: 1000,
      webxos: 100,
      energy: 100,
      maxEnergy: 100,
      fuel: 1000,
      maxFuel: 1000,
      storage: 0,
      maxStorage: 1000,
      resources: {
        iron: 125,
        silicon: 80,
        gold: 15,
        platinum: 8,
        titanium: 22,
        uranium: 5,
        quantum: 3,
        darkMatter: 1
      },
      drones: [],
      planets: [],
      sectors: [],
      nodes: [],
      currentPlanet: null,
      mining: false,
      miningProgress: 0,
      miningTarget: null,
      throttle: false,
      speed: 0,
      maxSpeed: 10,
      position: { x: 0, y: 0, z: 0 },
      rotation: { x: 0, y: 0, z: 0 },
      velocity: { x: 0, y: 0, z: 0 },
      cameraMode: 'fpv',
      onlinePlayers: 1,
      chatHistory: [],
      auctionItems: [],
      playerList: ['Player1', 'Player2', 'Player3', 'Player4', 'Player5'],
      nfts: [],
      missions: [
        { id: 1, name: 'Mine 100 Iron', reward: { credits: 500 }, completed: false },
        { id: 2, name: 'Discover 5 Planets', reward: { storageUpgrade: 1 }, completed: false },
        { id: 3, name: 'Deploy 3 Drones', reward: { credits: 1000 }, completed: false },
        { id: 4, name: 'Extract 500 Fuel', reward: { fuelExtractor: 1 }, completed: false }
      ],
      spaceObjects: {
        stars: [],
        planets: [],
        asteroids: [],
        comets: []
      }
    };

    // Three.js variables
    let scene, camera, renderer;
    let stars, planets, asteroids, comets, drones, nodes;
    
    // DOM elements
    const cosmicCanvas = document.getElementById('cosmicCanvas');
    const statusOverlay = document.getElementById('statusOverlay');
    const throttleIndicator = document.getElementById('throttleIndicator');
    const consoleLog = document.getElementById('consoleLog');
    const consoleInput = document.getElementById('consoleInput');
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const centralMenu = document.getElementById('centralMenu');
    const auctionHouse = document.getElementById('auctionHouse');
    const sectorManagement = document.getElementById('sectorManagement');
    const prompt = document.getElementById('prompt');
    const crosshair = document.querySelector('.crosshair');
    const miningOverlay = document.getElementById('miningOverlay');
    const miningProgressBar = document.getElementById('miningProgress');
    const miningYield = document.getElementById('miningYield');
    const miningResource = document.getElementById('miningResource');
    const tradeRequest = document.getElementById('tradeRequest');
    
    // Initialize Three.js and game
    function initGame() {
      initThreeJS();
      createSpaceEnvironment();
      updateStatusOverlay();
      updateResourceDisplay();
      setupEventListeners();
      setupDraggableWindows();
      gameLoop();
      
      // Add initial chat messages
      addChatMessage('GalaxyCraft-Agent', 'Welcome to GalaxyCraft! Type /help for assistance.', 'system');
      addChatMessage('Market', 'New quantum crystals available for trade!', 'market');
      addChatMessage('Sector-7B', 'Player1 discovered a new asteroid field', 'sector');
      
      // Simulate player activity
      setTimeout(() => {
        addChatMessage('Player1', 'Anyone found any dark matter yet?', 'player');
      }, 3000);
      
      setTimeout(() => {
        addChatMessage('Player2', 'Found some in sector 8C near the blue nebula', 'player');
      }, 7000);
      
      // Simulate a direct message
      setTimeout(() => {
        addChatMessage('Player1', 'Thanks for the tip!', 'dm');
      }, 10000);
    }
    
    // Initialize Three.js
    function initThreeJS() {
      // Create scene
      scene = new THREE.Scene();
      
      // Create camera
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 10000);
      camera.position.z = 5;
      
      // Create renderer
      renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      cosmicCanvas.appendChild(renderer.domElement);
      
      // Add ambient light
      const ambientLight = new THREE.AmbientLight(0x333333);
      scene.add(ambientLight);
      
      // Add directional light
      const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
      directionalLight.position.set(5, 3, 5);
      scene.add(directionalLight);
    }
    
    // Create space environment with stars, planets, etc.
    function createSpaceEnvironment() {
      // Create starfield
      createStarfield();
      
      // Create planets
      createPlanets();
      
      // Create asteroid belts
      createAsteroidBelts();
      
      // Create comets
      createComets();
    }
    
    // Create starfield
    function createStarfield() {
      const starGeometry = new THREE.BufferGeometry();
      const starCount = 5000;
      const positions = new Float32Array(starCount * 3);
      const colors = new Float32Array(starCount * 3);
      const sizes = new Float32Array(starCount);
      
      for (let i = 0; i < starCount; i++) {
        const i3 = i * 3;
        
        // Random positions in a large sphere
        const radius = 1000 + Math.random() * 4000;
        const theta = Math.random() * Math.PI * 2;
        const phi = Math.acos((Math.random() * 2) - 1);
        
        positions[i3] = radius * Math.sin(phi) * Math.cos(theta);
        positions[i3 + 1] = radius * Math.sin(phi) * Math.sin(theta);
        positions[i3 + 2] = radius * Math.cos(phi);
        
        // Random colors (mostly white with some blue/red stars)
        const colorVariation = Math.random();
        if (colorVariation < 0.7) {
          colors[i3] = 1;
          colors[i3 + 1] = 1;
          colors[i3 + 2] = 1;
        } else if (colorVariation < 0.85) {
          colors[i3] = 0.7;
          colors[i3 + 1] = 0.8;
          colors[i3 + 2] = 1;
        } else {
          colors[i3] = 1;
          colors[i3 + 1] = 0.7;
          colors[i3 + 2] = 0.7;
        }
        
        // Random sizes
        sizes[i] = Math.random() * 2 + 0.5;
      }
      
      starGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
      starGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
      starGeometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));
      
      const starMaterial = new THREE.PointsMaterial({
        size: 2,
        sizeAttenuation: true,
        vertexColors: true,
        transparent: true
      });
      
      stars = new THREE.Points(starGeometry, starMaterial);
      scene.add(stars);
    }
    
    // Create planets
    function createPlanets() {
      const planetCount = 15;
      planets = new THREE.Group();
      
      for (let i = 0; i < planetCount; i++) {
        const size = 5 + Math.random() * 10;
        const geometry = new THREE.SphereGeometry(size, 32, 32);
        
        // Create different planet types
        let material;
        const planetType = Math.random();
        
        if (planetType < 0.3) {
          // Earth-like planet
          material = new THREE.MeshPhongMaterial({
            color: new THREE.Color(0.2, 0.5, 0.8),
            specular: new THREE.Color(0.2, 0.2, 0.2),
            shininess: 10
          });
        } else if (planetType < 0.6) {
          // Desert planet
          material = new THREE.MeshPhongMaterial({
            color: new THREE.Color(0.8, 0.7, 0.4),
            specular: new THREE.Color(0.2, 0.2, 0.2),
            shininess: 10
          });
        } else if (planetType < 0.8) {
          // Ice planet
          material = new THREE.MeshPhongMaterial({
            color: new THREE.Color(0.8, 0.9, 1),
            specular: new THREE.Color(0.5, 0.5, 0.5),
            shininess: 30
          });
        } else {
          // Lava planet
          material = new THREE.MeshPhongMaterial({
            color: new THREE.Color(0.8, 0.3, 0.1),
            specular: new THREE.Color(0.8, 0.4, 0.1),
            shininess: 20
          });
        }
        
        const planet = new THREE.Mesh(geometry, material);
        
        // Position planets in orbits at different distances
        const orbitRadius = 100 + i * 50;
        const angle = Math.random() * Math.PI * 2;
        const inclination = (Math.random() - 0.5) * 0.5;
        
        planet.position.x = orbitRadius * Math.cos(angle);
        planet.position.y = orbitRadius * Math.sin(angle) * inclination;
        planet.position.z = orbitRadius * Math.sin(angle);
        
        // Add planet data
        planet.userData = {
          type: 'planet',
          id: i,
          name: `Planet ${String.fromCharCode(65 + i)}-${Math.floor(Math.random() * 1000)}`,
          size: size,
          resources: {
            iron: Math.floor(Math.random() * 1000) + 500,
            silicon: Math.floor(Math.random() * 800) + 300,
            gold: Math.floor(Math.random() * 100) + 50,
            platinum: Math.floor(Math.random() * 50) + 20,
            titanium: Math.floor(Math.random() * 300) + 100,
            uranium: Math.floor(Math.random() * 30) + 10,
            quantum: Math.floor(Math.random() * 10) + 5,
            darkMatter: Math.floor(Math.random() * 5) + 1
          },
          claimed: false,
          owner: null
        };
        
        planets.add(planet);
        gameState.spaceObjects.planets.push(planet);
      }
      
      scene.add(planets);
    }
    
    // Create asteroid belts
    function createAsteroidBelts() {
      const beltCount = 3;
      asteroids = new THREE.Group();
      
      for (let b = 0; b < beltCount; b++) {
        const beltRadius = 200 + b * 100;
        const asteroidCount = 100 + b * 50;
        
        for (let i = 0; i < asteroidCount; i++) {
          const size = 0.5 + Math.random() * 3;
          const geometry = new THREE.SphereGeometry(size, 12, 12);
          const material = new THREE.MeshPhongMaterial({
            color: new THREE.Color(0.5, 0.5, 0.5),
            specular: new THREE.Color(0.2, 0.2, 0.2),
            shininess: 5
          });
          
          const asteroid = new THREE.Mesh(geometry, material);
          
          // Position in belt
          const angle = Math.random() * Math.PI * 2;
          const distance = beltRadius + (Math.random() - 0.5) * 20;
          const height = (Math.random() - 0.5) * 10;
          
          asteroid.position.x = distance * Math.cos(angle);
          asteroid.position.y = height;
          asteroid.position.z = distance * Math.sin(angle);
          
          // Add rotation animation data
          asteroid.userData = {
            rotationSpeed: {
              x: (Math.random() - 0.5) * 0.02,
              y: (Math.random() - 0.5) * 0.02,
              z: (Math.random() - 0.5) * 0.02
            },
            orbitSpeed: (0.2 + Math.random() * 0.3) / (b + 1)
          };
          
          asteroids.add(asteroid);
          gameState.spaceObjects.asteroids.push(asteroid);
        }
      }
      
      scene.add(asteroids);
    }
    
    // Create comets
    function createComets() {
      const cometCount = 5;
      comets = new THREE.Group();
      
      for (let i = 0; i < cometCount; i++) {
        const size = 2 + Math.random() * 3;
        const geometry = new THREE.SphereGeometry(size, 16, 16);
        const material = new THREE.MeshPhongMaterial({
          color: new THREE.Color(0.8, 0.8, 0.9),
          specular: new THREE.Color(0.8, 0.8, 0.9),
          shininess: 50,
          transparent: true,
          opacity: 0.9
        });
        
        const comet = new THREE.Mesh(geometry, material);
        
        // Create comet tail (using a cone)
        const tailLength = 10 + Math.random() * 20;
        const tailGeometry = new THREE.ConeGeometry(size * 0.7, tailLength, 8);
        tailGeometry.translate(0, -tailLength/2, 0);
        const tailMaterial = new THREE.MeshBasicMaterial({
          color: new THREE.Color(0.7, 0.8, 1),
          transparent: true,
          opacity: 0.6
        });
        
        const tail = new THREE.Mesh(tailGeometry, tailMaterial);
        tail.rotation.x = Math.PI / 2;
        tail.position.x = -tailLength/2;
        comet.add(tail);
        
        // Position comets in elliptical orbits
        const a = 500 + Math.random() * 500; // semi-major axis
        const e = 0.7 + Math.random() * 0.25; // eccentricity
        const b = a * Math.sqrt(1 - e*e); // semi-minor axis
        const angle = Math.random() * Math.PI * 2;
        
        comet.position.x = a * Math.cos(angle);
        comet.position.z = b * Math.sin(angle);
        comet.position.y = (Math.random() - 0.5) * 50;
        
        // Add comet data
        comet.userData = {
          a: a,
          b: b,
          e: e,
          angle: angle,
          speed: (0.05 + Math.random() * 0.05) * (Math.random() > 0.5 ? 1 : -1)
        };
        
        comets.add(comet);
        gameState.spaceObjects.comets.push(comet);
      }
      
      scene.add(comets);
    }
    
    // Update status overlay with position and resources
    function updateStatusOverlay() {
      statusOverlay.innerHTML = `POS: ${gameState.position.x.toFixed(1)}, ${gameState.position.y.toFixed(1)}, ${gameState.position.z.toFixed(1)} | SPD: ${gameState.speed.toFixed(1)} | ENG: ${gameState.energy} | FUE: ${gameState.fuel} | CRED: ${gameState.credits}`;
    }
    
    // Update resource display in the stats window
    function updateResourceDisplay() {
      document.getElementById('creditsValue').textContent = gameState.credits;
      document.getElementById('webxosValue').textContent = gameState.webxos;
      document.getElementById('energyValue').textContent = gameState.energy;
      document.getElementById('fuelValue').textContent = gameState.fuel;
      document.getElementById('storageValue').textContent = gameState.storage;
      
      document.getElementById('energyBar').style.width = `${(gameState.energy / gameState.maxEnergy) * 100}%`;
      document.getElementById('fuelBar').style.width = `${(gameState.fuel / gameState.maxFuel) * 100}%`;
      document.getElementById('storageBar').style.width = `${(gameState.storage / gameState.maxStorage) * 100}%`;
      
      document.getElementById('resourceIron').textContent = gameState.resources.iron;
      document.getElementById('resourceSilicon').textContent = gameState.resources.silicon;
      document.getElementById('resourceGold').textContent = gameState.resources.gold;
      document.getElementById('resourcePlatinum').textContent = gameState.resources.platinum;
      document.getElementById('resourceTitanium').textContent = gameState.resources.titanium;
      document.getElementById('resourceUranium').textContent = gameState.resources.uranium;
      document.getElementById('resourceQuantum').textContent = gameState.resources.quantum;
      document.getElementById('resourceDarkMatter').textContent = gameState.resources.darkMatter;
      
      // Update menu resources
      document.getElementById('resourceIronMenu').textContent = gameState.resources.iron;
      document.getElementById('resourceSiliconMenu').textContent = gameState.resources.silicon;
      document.getElementById('resourceGoldMenu').textContent = gameState.resources.gold;
      document.getElementById('resourcePlatinumMenu').textContent = gameState.resources.platinum;
      document.getElementById('resourceTitaniumMenu').textContent = gameState.resources.titanium;
      document.getElementById('resourceUraniumMenu').textContent = gameState.resources.uranium;
      document.getElementById('resourceQuantumMenu').textContent = gameState.resources.quantum;
      document.getElementById('resourceDarkMatterMenu').textContent = gameState.resources.darkMatter;
      document.getElementById('resourceFuelMenu').textContent = gameState.fuel;
    }
    
    // Setup event listeners for controls and inputs
    function setupEventListeners() {
      // Control buttons
      document.getElementById('throttleBtn').addEventListener('click', toggleThrottle);
      document.getElementById('mineBtn').addEventListener('click', startMining);
      document.getElementById('scanBtn').addEventListener('click', scanArea);
      document.getElementById('planetBtn').addEventListener('click', claimPlanet);
      document.getElementById('menuBtn').addEventListener('click', toggleMenu);
      document.getElementById('droneBtn').addEventListener('click', deployDrone);
      document.getElementById('auctionBtn').addEventListener('click', toggleAuctionHouse);
      document.getElementById('sectorBtn').addEventListener('click', toggleSectorManagement);
      document.getElementById('resetBtn').addEventListener('click', resetGame);
      
      // Menu buttons
      document.getElementById('closeMenu').addEventListener('click', toggleMenu);
      document.getElementById('closeAuction').addEventListener('click', toggleAuctionHouse);
      document.getElementById('connectWalletBtn').addEventListener('click', connectWallet);
      document.getElementById('nodeBtn').addEventListener('click', addNode);
      document.getElementById('federateBtn').addEventListener('click', federateSector);
      
      // Menu tabs
      const menuTabs = document.querySelectorAll('.menu-tab');
      menuTabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const tabName = tab.getAttribute('data-tab');
          switchTab(tabName);
          
          // Update active tab styling
          menuTabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
        });
      });
      
      // Console input
      consoleInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          const command = consoleInput.value.trim();
          if (command) {
            handleConsoleCommand(command);
            consoleInput.value = '';
          }
        }
      });
      
      // Chat input
      chatInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          const message = chatInput.value.trim();
          if (message) {
            handleChatMessage(message);
            chatInput.value = '';
          }
        }
      });
      
      // Trade request buttons
      document.getElementById('acceptTrade').addEventListener('click', acceptTrade);
      document.getElementById('declineTrade').addEventListener('click', declineTrade);
      
      // Keyboard controls
      document.addEventListener('keydown', handleKeyDown);
      document.addEventListener('keyup', handleKeyUp);
      
      // Window resize
      window.addEventListener('resize', onWindowResize);
    }
    
    // Setup draggable windows
    function setupDraggableWindows() {
      makeDraggable(document.getElementById('statsWindow'), document.getElementById('statsHeader'));
      makeDraggable(document.getElementById('chatWindow'), document.getElementById('chatHeader'));
      makeDraggable(document.getElementById('sectorManagement'), document.getElementById('sectorManagement'));
    }
    
    // Make an element draggable
    function makeDraggable(element, handle) {
      let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
      
      if (!handle) handle = element;
      
      handle.onmousedown = dragMouseDown;
      
      function dragMouseDown(e) {
        e.preventDefault();
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        document.onmousemove = elementDrag;
      }
      
      function elementDrag(e) {
        e.preventDefault();
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        
        element.style.top = (element.offsetTop - pos2) + "px";
        element.style.left = (element.offsetLeft - pos1) + "px";
      }
      
      function closeDragElement() {
        document.onmouseup = null;
        document.onmousemove = null;
      }
    }
    
    // Handle keyboard input
    function handleKeyDown(e) {
      switch(e.key) {
        case 'w':
        case 'ArrowUp':
          gameState.velocity.z = -1;
          break;
        case 's':
        case 'ArrowDown':
          gameState.velocity.z = 1;
          break;
        case 'a':
        case 'ArrowLeft':
          gameState.velocity.x = -1;
          break;
        case 'd':
        case 'ArrowRight':
          gameState.velocity.x = 1;
          break;
        case 'q':
          gameState.velocity.y = -1;
          break;
        case 'e':
          gameState.velocity.y = 1;
          break;
        case 'Shift':
          toggleThrottle();
          break;
        case ' ':
          startMining();
          break;
        case 'Control':
          scanArea();
          break;
        case 'c':
          claimPlanet();
          break;
        case 'm':
          toggleMenu();
          break;
        case 'n':
          addNode();
          break;
        case 'f':
          federateSector();
          break;
      }
    }
    
    // Handle keyboard release
    function handleKeyUp(e) {
      switch(e.key) {
        case 'w':
        case 'ArrowUp':
        case 's':
        case 'ArrowDown':
          gameState.velocity.z = 0;
          break;
        case 'a':
        case 'ArrowLeft':
        case 'd':
        case 'ArrowRight':
          gameState.velocity.x = 0;
          break;
        case 'q':
        case 'e':
          gameState.velocity.y = 0;
          break;
      }
    }
    
    // Handle window resize
    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }
    
    // Toggle throttle state
    function toggleThrottle() {
      gameState.throttle = !gameState.throttle;
      const throttleBtn = document.getElementById('throttleBtn');
      
      if (gameState.throttle) {
        throttleBtn.classList.add('active');
        throttleIndicator.textContent = 'FULL THROTTLE ENGAGED';
        throttleIndicator.classList.add('active');
      } else {
        throttleBtn.classList.remove('active');
        throttleIndicator.classList.remove('active');
      }
    }
    
    // Start mining process
    function startMining() {
      if (gameState.mining) return;
      
      gameState.mining = true;
      miningOverlay.classList.add('active');
      crosshair.classList.add('active');
      
      const mineBtn = document.getElementById('mineBtn');
      mineBtn.classList.add('active');
      
      // Simulate mining process
      const resources = ['Iron', 'Silicon', 'Gold', 'Platinum', 'Titanium', 'Uranium', 'Quantum', 'Dark Matter'];
      const resource = resources[Math.floor(Math.random() * resources.length)];
      miningResource.textContent = resource;
      
      let progress = 0;
      const miningInterval = setInterval(() => {
        progress += 5;
        miningProgressBar.style.width = `${progress}%`;
        miningYield.textContent = Math.floor(progress / 2);
        
        if (progress >= 100) {
          clearInterval(miningInterval);
          finishMining(resource.toLowerCase());
        }
      }, 100);
    }
    
    // Finish mining and add resources
    function finishMining(resourceType) {
      gameState.mining = false;
      miningOverlay.classList.remove('active');
      crosshair.classList.remove('active');
      
      const mineBtn = document.getElementById('mineBtn');
      mineBtn.classList.remove('active');
      
      // Add resources based on mining yield
      const yieldAmount = parseInt(miningYield.textContent);
      
      if (gameState.resources[resourceType] !== undefined) {
        gameState.resources[resourceType] += yieldAmount;
        gameState.storage += yieldAmount;
        
        // Update UI
        updateResourceDisplay();
        
        // Add console message
        addConsoleMessage(`Mined ${yieldAmount} units of ${resourceType}`);
        
        // Add chat message for rare resources
        if (resourceType === 'quantum' || resourceType === 'darkMatter') {
          addChatMessage('Sector-7B', `Mined ${yieldAmount} ${resourceType}`, 'sector');
        }
      }
      
      // Reset mining UI
      miningProgressBar.style.width = '0%';
      miningYield.textContent = '0';
    }
    
    // Scan area for resources and points of interest
    function scanArea() {
      if (gameState.energy < 10) {
        showPrompt('Not enough energy to scan');
        return;
      }
      
      gameState.energy -= 10;
      updateResourceDisplay();
      
      const scanBtn = document.getElementById('scanBtn');
      scanBtn.classList.add('active');
      
      // Simulate scan results
      setTimeout(() => {
        const findings = [
          'Asteroid field detected',
          'Planet with resources found',
          'Unknown signal source',
          'Derelict ship detected',
          'Rich mineral deposit located'
        ];
        
        const finding = findings[Math.floor(Math.random() * findings.length)];
        addConsoleMessage(`Scan complete: ${finding}`);
        scanBtn.classList.remove('active');
      }, 2000);
    }
    
    // Claim a planet
    function claimPlanet() {
      if (gameState.planets.length >= 3) {
        showPrompt('Maximum planets claimed');
        return;
      }
      
      // Find the closest planet
      let closestPlanet = null;
      let closestDistance = Infinity;
      
      gameState.spaceObjects.planets.forEach(planet => {
        if (planet.userData.claimed) return;
        
        const dx = planet.position.x - gameState.position.x;
        const dy = planet.position.y - gameState.position.y;
        const dz = planet.position.z - gameState.position.z;
        const distance = Math.sqrt(dx*dx + dy*dy + dz*dz);
        
        if (distance < 50 && distance < closestDistance) {
          closestDistance = distance;
          closestPlanet = planet;
        }
      });
      
      if (!closestPlanet) {
        showPrompt('No planet in range');
        return;
      }
      
      // Claim the planet
      closestPlanet.userData.claimed = true;
      closestPlanet.userData.owner = gameState.connected ? gameState.walletAddress : "Player";
      gameState.planets.push(closestPlanet.userData);
      
      // Create a sector for this planet
      const sectorId = gameState.sectors.length + 1;
      const sector = {
        id: sectorId,
        name: `Sector-${String.fromCharCode(64 + sectorId)}`,
        planet: closestPlanet.userData,
        nodes: [],
        drones: [],
        resources: JSON.parse(JSON.stringify(closestPlanet.userData.resources)),
        stashedResources: {},
        federation: null
      };
      
      gameState.sectors.push(sector);
      
      document.getElementById('planetCount').textContent = gameState.planets.length;
      document.getElementById('sectorCount').textContent = gameState.sectors.length;
      
      // Update planet list
      const planetList = document.getElementById('planetList');
      planetList.innerHTML = '';
      gameState.planets.forEach(planet => {
        const planetItem = document.createElement('div');
        planetItem.className = 'planet-item';
        planetItem.textContent = planet.name;
        planetList.appendChild(planetItem);
      });
      
      // Update sector list
      const sectorList = document.getElementById('sectorList');
      sectorList.innerHTML = '';
      gameState.sectors.forEach(sector => {
        const sectorItem = document.createElement('div');
        sectorItem.className = 'sector-item';
        sectorItem.textContent = sector.name;
        sectorList.appendChild(sectorItem);
      });
      
      // Update sectors tab
      updateSectorsTab();
      
      showPrompt(`Planet ${closestPlanet.userData.name} claimed! Sector ${sector.name} created.`);
      addChatMessage('Sector-7B', `Discovered and claimed ${closestPlanet.userData.name}`, 'sector');
    }
    
    // Update sectors tab in menu
    function updateSectorsTab() {
      const sectorsContainer = document.getElementById('sectorsContainer');
      sectorsContainer.innerHTML = '';
      
      if (gameState.sectors.length === 0) {
        sectorsContainer.innerHTML = '<div class="resource-item"><div>No sectors claimed yet</div><div>Find and claim planets to create sectors</div></div>';
        return;
      }
      
      gameState.sectors.forEach(sector => {
        const sectorItem = document.createElement('div');
        sectorItem.className = 'resource-item';
        sectorItem.innerHTML = `
          <div><strong>${sector.name}</strong></div>
          <div>Planet: ${sector.planet.name}</div>
          <div>Nodes: ${sector.nodes.length}/10</div>
          <div>Drones: ${sector.drones.length}/3</div>
          <button class="auction-action" onclick="manageSector(${sector.id})">Manage</button>
        `;
        sectorsContainer.appendChild(sectorItem);
      });
    }
    
    // Deploy a mining drone
    function deployDrone() {
      if (gameState.resources.iron < 50) {
        showPrompt('Not enough iron to deploy drone (50 required)');
        return;
      }
      
      if (gameState.drones.length >= 5) {
        showPrompt('Maximum drones deployed');
        return;
      }
      
      // Check if we're in a sector
      let currentSector = null;
      gameState.sectors.forEach(sector => {
        const dx = sector.planet.position.x - gameState.position.x;
        const dy = sector.planet.position.y - gameState.position.y;
        const dz = sector.planet.position.z - gameState.position.z;
        const distance = Math.sqrt(dx*dx + dy*dy + dz*dz);
        
        if (distance < 100) {
          currentSector = sector;
        }
      });
      
      if (!currentSector) {
        showPrompt('Must be in a sector to deploy drones');
        return;
      }
      
      if (currentSector.drones.length >= 3) {
        showPrompt('Sector drone limit reached (3 per sector)');
        return;
      }
      
      gameState.resources.iron -= 50;
      updateResourceDisplay();
      
      const droneId = gameState.drones.length + 1;
      const drone = {
        id: droneId,
        sector: currentSector.id,
        status: 'mining',
        resource: 'iron',
        yield: 5,
        efficiency: 1,
        position: {
          x: gameState.position.x + (Math.random() - 0.5) * 10,
          y: gameState.position.y + (Math.random() - 0.5) * 10,
          z: gameState.position.z + (Math.random() - 0.5) * 10
        }
      };
      
      gameState.drones.push(drone);
      currentSector.drones.push(drone);
      
      document.getElementById('droneCount').textContent = gameState.drones.length;
      
      // Update drone list
      const droneList = document.getElementById('droneList');
      droneList.innerHTML = '';
      gameState.drones.forEach(drone => {
        const droneItem = document.createElement('div');
        droneItem.className = 'drone-item';
        droneItem.textContent = `Drone ${drone.id} (${drone.status})`;
        droneList.appendChild(droneItem);
      });
      
      // Create visual drone indicator
      createDroneIndicator(drone);
      
      showPrompt(`Drone ${droneId} deployed in ${currentSector.name}!`);
      addConsoleMessage(`Drone ${droneId} deployed and mining iron`);
    }
    
    // Create visual indicator for drone
    function createDroneIndicator(drone) {
      const indicator = document.createElement('div');
      indicator.className = 'drone-indicator';
      indicator.id = `drone-${drone.id}`;
      document.body.appendChild(indicator);
      
      // Update drone position in game loop
    }
    
    // Add a node to the current sector
    function addNode() {
      if (gameState.resources.iron < 50) {
        showPrompt('Not enough iron to add node (50 required)');
        return;
      }
      
      // Check if we're in a sector
      let currentSector = null;
      gameState.sectors.forEach(sector => {
        const dx = sector.planet.position.x - gameState.position.x;
        const dy = sector.planet.position.y - gameState.position.y;
        const dz = sector.planet.position.z - gameState.position.z;
        const distance = Math.sqrt(dx*dx + dy*dy + dz*dz);
        
        if (distance < 100) {
          currentSector = sector;
        }
      });
      
      if (!currentSector) {
        showPrompt('Must be in a sector to add nodes');
        return;
      }
      
      if (currentSector.nodes.length >= 10) {
        showPrompt('Sector node limit reached (10 per sector)');
        return;
      }
      
      gameState.resources.iron -= 50;
      updateResourceDisplay();
      
      const nodeId = currentSector.nodes.length + 1;
      const node = {
        id: nodeId,
        sector: currentSector.id,
        position: {
          x: gameState.position.x,
          y: gameState.position.y,
          z: gameState.position.z
        }
      };
      
      currentSector.nodes.push(node);
      gameState.nodes.push(node);
      
      // Create visual node indicator
      createNodeIndicator(node);
      
      showPrompt(`Node ${nodeId} added to ${currentSector.name}!`);
      addConsoleMessage(`Node ${nodeId} deployed at current position`);
      
      // Update sectors tab
      updateSectorsTab();
    }
    
    // Create visual indicator for node
    function createNodeIndicator(node) {
      const indicator = document.createElement('div');
      indicator.className = 'node-indicator';
      indicator.id = `node-${node.id}`;
      document.body.appendChild(indicator);
      
      // Update node position in game loop
    }
    
    // Federate a sector
    function federateSector() {
      // Check if we're in a sector
      let currentSector = null;
      gameState.sectors.forEach(sector => {
        const dx = sector.planet.position.x - gameState.position.x;
        const dy = sector.planet.position.y - gameState.position.y;
        const dz = sector.planet.position.z - gameState.position.z;
        const distance = Math.sqrt(dx*dx + dy*dy + dz*dz);
        
        if (distance < 100) {
          currentSector = sector;
        }
      });
      
      if (!currentSector) {
        showPrompt('Must be in a sector to federate');
        return;
      }
      
      if (currentSector.federation) {
        showPrompt('Sector is already federated');
        return;
      }
      
      const federationName = prompt('Enter federation name:');
      if (!federationName) return;
      
      currentSector.federation = {
        name: federationName,
        members: [gameState.connected ? gameState.walletAddress : "Player"],
        level: 1
      };
      
      showPrompt(`Sector ${currentSector.name} federated as ${federationName}!`);
      addChatMessage('Corporation', `${federationName} federation created in ${currentSector.name}`, 'corporation');
      
      // Update sectors tab
      updateSectorsTab();
    }
    
    // Toggle central menu
    function toggleMenu() {
      centralMenu.classList.toggle('active');
      
      // Update sectors tab when menu is opened
      if (centralMenu.classList.contains('active')) {
        updateSectorsTab();
      }
    }
    
    // Toggle auction house
    function toggleAuctionHouse() {
      auctionHouse.classList.toggle('active');
    }
    
    // Toggle sector management
    function toggleSectorManagement() {
      sectorManagement.classList.toggle('active');
    }
    
    // Switch between menu tabs
    function switchTab(tabName) {
      // Hide all tabs
      document.getElementById('resourcesTab').style.display = 'none';
      document.getElementById('craftingTab').style.display = 'none';
      document.getElementById('marketTab').style.display = 'none';
      document.getElementById('missionsTab').style.display = 'none';
      document.getElementById('sectorsTab').style.display = 'none';
      document.getElementById('nftsTab').style.display = 'none';
      document.getElementById('settingsTab').style.display = 'none';
      
      // Show selected tab
      document.getElementById(`${tabName}Tab`).style.display = 'block';
    }
    
    // Connect wallet
    function connectWallet() {
      if (gameState.connected) return;
      
      // Simulate wallet connection
      gameState.connected = true;
      gameState.walletAddress = '0x' + Math.random().toString(16).substr(2, 10) + '...' + Math.random().toString(16).substr(2, 10);
      document.getElementById('walletAddress').textContent = gameState.walletAddress;
      document.getElementById('sessionId').textContent = Math.random().toString(36).substr(2, 9).toUpperCase();
      
      const connectBtn = document.getElementById('connectWalletBtn');
      connectBtn.textContent = 'Wallet Connected';
      connectBtn.disabled = true;
      
      showPrompt('Wallet connected successfully!');
      addConsoleMessage('Wallet connected to $WEBXOS network');
    }
    
    // Reset game
    function resetGame() {
      if (confirm('Are you sure you want to reset your progress?')) {
        // Reset game state
        Object.assign(gameState, {
          credits: 1000,
          webxos: 100,
          energy: 100,
          fuel: 1000,
          storage: 0,
          resources: {
            iron: 125,
            silicon: 80,
            gold: 15,
            platinum: 8,
            titanium: 22,
            uranium: 5,
            quantum: 3,
            darkMatter: 1
          },
          drones: [],
          planets: [],
          sectors: [],
          nodes: [],
          mining: false
        });
        
        // Reset planet claims
        gameState.spaceObjects.planets.forEach(planet => {
          planet.userData.claimed = false;
          planet.userData.owner = null;
        });
        
        // Remove visual indicators
        document.querySelectorAll('.drone-indicator, .node-indicator').forEach(el => el.remove());
        
        // Update UI
        updateResourceDisplay();
        document.getElementById('droneCount').textContent = '0';
        document.getElementById('planetCount').textContent = '0';
        document.getElementById('sectorCount').textContent = '0';
        document.getElementById('droneList').innerHTML = '';
        document.getElementById('planetList').innerHTML = '';
        document.getElementById('sectorList').innerHTML = '';
        
        // Update sectors tab
        updateSectorsTab();
        
        showPrompt('Game reset successfully');
        addConsoleMessage('Game state reset to initial values');
      }
    }
    
    // Handle console commands
    function handleConsoleCommand(command) {
      addConsoleMessage(`> ${command}`);
      
      if (command.startsWith('/')) {
        const parts = command.substring(1).split(' ');
        const cmd = parts[0].toLowerCase();
        const args = parts.slice(1);
        
        switch(cmd) {
          case 'help':
            addConsoleMessage('Available commands:');
            addConsoleMessage('/help - Show this help');
            addConsoleMessage('/dm [player] [message] - Send direct message');
            addConsoleMessage('/list - List online players');
            addConsoleMessage('/resources - Show your resources');
            addConsoleMessage('/move [x] [y] [z] - Move to coordinates');
            addConsoleMessage('/scan - Scan for resources');
            addConsoleMessage('/sectors - List your sectors');
            addConsoleMessage('/federate [name] - Federate current sector');
            break;
            
          case 'dm':
            if (args.length < 2) {
              addConsoleMessage('Usage: /dm [player] [message]');
            } else {
              const player = args[0];
              const message = args.slice(1).join(' ');
              addChatMessage(player, message, 'dm');
            }
            break;
            
          case 'list':
            addConsoleMessage('Online players:');
            gameState.playerList.forEach(player => {
              addConsoleMessage(`- ${player}`);
            });
            break;
            
          case 'resources':
            addConsoleMessage('Your resources:');
            for (const [resource, amount] of Object.entries(gameState.resources)) {
              addConsoleMessage(`- ${resource}: ${amount}`);
            }
            break;
            
          case 'move':
            if (args.length === 3) {
              const x = parseFloat(args[0]);
              const y = parseFloat(args[1]);
              const z = parseFloat(args[2]);
              
              if (!isNaN(x) && !isNaN(y) && !isNaN(z)) {
                gameState.position.x = x;
                gameState.position.y = y;
                gameState.position.z = z;
                updateStatusOverlay();
                addConsoleMessage(`Moved to coordinates: ${x}, ${y}, ${z}`);
              } else {
                addConsoleMessage('Invalid coordinates');
              }
            } else {
              addConsoleMessage('Usage: /move [x] [y] [z]');
            }
            break;
            
          case 'scan':
            scanArea();
            break;
            
          case 'sectors':
            addConsoleMessage('Your sectors:');
            gameState.sectors.forEach(sector => {
              addConsoleMessage(`- ${sector.name}: ${sector.planet.name} (${sector.nodes.length} nodes, ${sector.drones.length} drones)`);
            });
            break;
            
          case 'federate':
            if (args.length < 1) {
              addConsoleMessage('Usage: /federate [name]');
            } else {
              const name = args.join(' ');
              // This would call the federateSector function with the name
              addConsoleMessage(`Would federate sector as: ${name}`);
            }
            break;
            
          default:
            addConsoleMessage(`Unknown command: ${cmd}`);
        }
      } else {
        // Regular message, send to chat
        handleChatMessage(command);
      }
    }
    
    // Handle chat messages
    function handleChatMessage(message) {
      if (message.startsWith('/')) {
        // Handle chat commands
        const parts = message.substring(1).split(' ');
        const cmd = parts[0].toLowerCase();
        const args = parts.slice(1);
        
        switch(cmd) {
          case 'dm':
            if (args.length < 2) {
              addChatMessage('System', 'Usage: /dm [player] [message]', 'system');
            } else {
              const player = args[0];
              const dmMessage = args.slice(1).join(' ');
              addChatMessage(player, dmMessage, 'dm');
            }
            break;
            
          case 'sector':
            const sectorMessage = args.join(' ');
            addChatMessage('Sector-7B', sectorMessage, 'sector');
            break;
            
          case 'market':
            const marketMessage = args.join(' ');
            addChatMessage('Market', marketMessage, 'market');
            break;
            
          case 'corp':
          case 'corporation':
            const corpMessage = args.join(' ');
            addChatMessage('Corporation', corpMessage, 'corporation');
            break;
            
          case 'global':
            const globalMessage = args.join(' ');
            addChatMessage('Global', globalMessage, 'global');
            break;
            
          case 'tag':
            if (args.length < 2) {
              addChatMessage('System', 'Usage: /tag [player] [message]', 'system');
            } else {
              const player = args[0];
              const tagMessage = args.slice(1).join(' ');
              addChatMessage(player, tagMessage, 'tag');
            }
            break;
            
          default:
            addChatMessage('Player', message, 'player');
        }
      } else {
        // Regular message
        addChatMessage('Player', message, 'player');
      }
    }
    
    // Add message to chat
    function addChatMessage(sender, message, type) {
      const messageElement = document.createElement('p');
      
      switch(type) {
        case 'system':
          messageElement.innerHTML = `<span class="wallet-address">${sender}:</span> ${message}`;
          break;
        case 'market':
          messageElement.innerHTML = `<span class="chat-market">[Market]</span> ${message}`;
          break;
        case 'sector':
          messageElement.innerHTML = `<span class="chat-sector">[Sector-7B]</span> ${message}`;
          break;
        case 'player':
          messageElement.innerHTML = `<span class="chat-player">${sender}:</span> ${message}`;
          break;
        case 'dm':
          messageElement.innerHTML = `<span class="chat-dm">DM from ${sender}:</span> ${message}`;
          break;
        case 'tag':
          messageElement.innerHTML = `<span class="chat-tag">@${sender}</span> ${message}`;
          break;
        case 'corporation':
          messageElement.innerHTML = `<span class="chat-corporation">[Corporation]</span> ${message}`;
          break;
        case 'global':
          messageElement.innerHTML = `<span class="chat-global">[Global]</span> ${message}`;
          break;
        default:
          messageElement.innerHTML = `<span>${sender}:</span> ${message}`;
      }
      
      chatMessages.appendChild(messageElement);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      // Add to chat history
      gameState.chatHistory.push({ sender, message, type, timestamp: Date.now() });
    }
    
    // Add message to console
    function addConsoleMessage(message) {
      const messageElement = document.createElement('p');
      messageElement.textContent = message;
      consoleLog.appendChild(messageElement);
      consoleLog.scrollTop = consoleLog.scrollHeight;
    }
    
    // Show prompt message
    function showPrompt(message) {
      prompt.textContent = message;
      prompt.classList.add('active');
      
      setTimeout(() => {
        prompt.classList.remove('active');
      }, 3000);
    }
    
    // Accept trade request
    function acceptTrade() {
      tradeRequest.classList.remove('active');
      showPrompt('Trade accepted! Opening trade window.');
      // Here you would open the trade interface
    }
    
    // Decline trade request
    function declineTrade() {
      tradeRequest.classList.remove('active');
      showPrompt('Trade declined.');
    }
    
    // Check for trade proximity
    function checkTradeProximity() {
      // Simulate trade request when near another player
      if (Math.random() < 0.001) {
        tradeRequest.classList.add('active');
      }
    }
    
    // Update visual indicators (drones, nodes)
    function updateVisualIndicators() {
      // Update drone indicators
      gameState.drones.forEach(drone => {
        const indicator = document.getElementById(`drone-${drone.id}`);
        if (indicator) {
          // Convert 3D position to screen position
          const vector = new THREE.Vector3(drone.position.x, drone.position.y, drone.position.z);
          vector.project(camera);
          
          const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
          const y = (-(vector.y * 0.5 - 0.5)) * window.innerHeight;
          
          indicator.style.left = `${x - 8}px`;
          indicator.style.top = `${y - 14}px`;
        }
      });
      
      // Update node indicators
      gameState.nodes.forEach(node => {
        const indicator = document.getElementById(`node-${node.id}`);
        if (indicator) {
          // Convert 3D position to screen position
          const vector = new THREE.Vector3(node.position.x, node.position.y, node.position.z);
          vector.project(camera);
          
          const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
          const y = (-(vector.y * 0.5 - 0.5)) * window.innerHeight;
          
          indicator.style.left = `${x - 6}px`;
          indicator.style.top = `${y - 6}px`;
        }
      });
    }
    
    // Animate space objects
    function animateSpaceObjects() {
      // Animate asteroids
      gameState.spaceObjects.asteroids.forEach(asteroid => {
        asteroid.rotation.x += asteroid.userData.rotationSpeed.x;
        asteroid.rotation.y += asteroid.userData.rotationSpeed.y;
        asteroid.rotation.z += asteroid.userData.rotationSpeed.z;
        
        // Orbit around center
        const angle = Math.atan2(asteroid.position.z, asteroid.position.x);
        const newAngle = angle + asteroid.userData.orbitSpeed;
        const radius = Math.sqrt(asteroid.position.x*asteroid.position.x + asteroid.position.z*asteroid.position.z);
        
        asteroid.position.x = radius * Math.cos(newAngle);
        asteroid.position.z = radius * Math.sin(newAngle);
      });
      
      // Animate comets
      gameState.spaceObjects.comets.forEach(comet => {
        comet.userData.angle += comet.userData.speed;
        
        // Elliptical orbit
        comet.position.x = comet.userData.a * Math.cos(comet.userData.angle);
        comet.position.z = comet.userData.b * Math.sin(comet.userData.angle);
        
        // Always point away from center
        comet.lookAt(0, 0, 0);
      });
    }
    
    // Main game loop
    function gameLoop() {
      // Update position based on velocity
      if (gameState.throttle) {
        gameState.speed = gameState.maxSpeed;
      } else {
        gameState.speed = Math.max(0, Math.min(gameState.maxSpeed, gameState.speed + gameState.velocity.z));
      }
      
      gameState.position.x += gameState.velocity.x * 0.1;
      gameState.position.y += gameState.velocity.y * 0.1;
      gameState.position.z += gameState.speed * 0.1;
      
      // Update camera position
      camera.position.set(gameState.position.x, gameState.position.y, gameState.position.z);
      
      // Consume fuel when moving
      if (gameState.speed > 0) {
        gameState.fuel -= gameState.speed * 0.01;
        if (gameState.fuel < 0) gameState.fuel = 0;
      }
      
      // Regenerate energy
      if (gameState.energy < gameState.maxEnergy) {
        gameState.energy += 0.1;
        if (gameState.energy > gameState.maxEnergy) gameState.energy = gameState.maxEnergy;
      }
      
      // Update drones
      gameState.drones.forEach(drone => {
        // Simulate drone mining
        if (drone.status === 'mining') {
          // Find the sector this drone belongs to
          const sector = gameState.sectors.find(s => s.id === drone.sector);
          if (sector) {
            // Add resources to sector stash
            if (!sector.stashedResources[drone.resource]) {
              sector.stashedResources[drone.resource] = 0;
            }
            sector.stashedResources[drone.resource] += drone.yield * drone.efficiency;
          }
        }
        
        // Move drone randomly
        drone.position.x += (Math.random() - 0.5) * 0.5;
        drone.position.y += (Math.random() - 0.5) * 0.5;
        drone.position.z += (Math.random() - 0.5) * 0.5;
      });
      
      // Animate space objects
      animateSpaceObjects();
      
      // Update visual indicators
      updateVisualIndicators();
      
      // Check for trade proximity
      checkTradeProximity();
      
      // Update UI
      updateStatusOverlay();
      updateResourceDisplay();
      
      // Render the scene
      renderer.render(scene, camera);
      
      // Continue the game loop
      requestAnimationFrame(gameLoop);
    }
    
    // Initialize the game when the page loads
    window.addEventListener('load', initGame);
    
    // Make these functions available globally for HTML onclick handlers
    window.manageSector = function(sectorId) {
      const sector = gameState.sectors.find(s => s.id === sectorId);
      if (sector) {
        showPrompt(`Managing sector: ${sector.name}`);
        // Here you would open a detailed sector management interface
      }
    };
  </script>
</body>
</html>