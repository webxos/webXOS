<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>webXOS: TOKEN FORGED ∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
    <style>
        /* ========== 8-BIT RESET & BASE ========== */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            image-rendering: pixelated;
            font-family: 'VT323', monospace;
            text-shadow: 0 0 1px currentColor;
        }
        
        html, body { 
            height: 100vh; 
            overflow: hidden; 
            background: #000; 
            color: #0f0; 
            display: flex; 
            flex-direction: column;
            position: relative;
            font-size: 16px;
            letter-spacing: 0.5px;
        }
        
        /* ========== CRT SCREEN EFFECT ========== */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15) 0px,
                rgba(0, 0, 0, 0.15) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 9999;
        }
        
        body::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(
                    rgba(0, 255, 0, 0.03) 50%,
                    transparent 50%
                ),
                linear-gradient(
                    90deg,
                    rgba(0, 255, 0, 0.03) 50%,
                    transparent 50%
                );
            background-size: 20px 20px;
            pointer-events: none;
            z-index: -1;
        }
        
        /* ========== 8-BIT TERMINAL HEADER ========== */
        header {
            padding: 10px 15px;
            border-bottom: 3px solid #0f0;
            background: #111;
            position: relative;
            z-index: 10;
            box-shadow: 0 0 10px #0f0;
            flex-shrink: 0;
        }
        
        .header-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        h1 {
            font-family: 'Press Start 2P', monospace;
            font-size: 18px;
            color: #0f0;
            text-shadow: 2px 2px 0 #000;
        }
        
        .version-badge {
            background: #0f0;
            color: #000;
            padding: 2px 8px;
            font-size: 12px;
            border: 1px solid #000;
        }
        
        .header-stats {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .stat-value {
            color: #fff;
            font-weight: bold;
        }
        
        /* ========== 4-AGENT DISPLAY ========== */
        .agent-display {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin: 10px 15px;
            height: 100px;
            flex-shrink: 0;
        }
        
        .agent-box {
            background: rgba(0, 30, 0, 0.8);
            border: 2px solid #0f0;
            padding: 8px;
            position: relative;
            overflow: hidden;
        }
        
        .agent-box::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(0, 255, 0, 0.1) 50%,
                transparent 70%
            );
            animation: agent-scan 4s infinite linear;
        }
        
        @keyframes agent-scan {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .agent-name {
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            color: #0f0;
            margin-bottom: 5px;
            position: relative;
            z-index: 2;
        }
        
        .agent-status {
            font-size: 12px;
            color: #8f8;
            position: relative;
            z-index: 2;
        }
        
        .agent-hash {
            font-size: 10px;
            color: #0ff;
            position: relative;
            z-index: 2;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-top: 5px;
        }
        
        .agent-mining {
            border-color: #ff0;
            background: rgba(30, 30, 0, 0.8);
        }
        
        /* ========== MAIN TERMINAL CONTAINER ========== */
        #terminal-container {
            flex: 1;
            margin: 0 15px 15px;
            display: flex;
            flex-direction: column;
            position: relative;
            min-height: 0; /* Important for flex scrolling */
        }
        
        #terminal {
            flex: 1;
            background: rgba(0, 20, 0, 0.9);
            border: 3px solid #0f0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0, 255, 0, 0.3);
        }
        
        #log {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            font-size: 16px;
            line-height: 1.4;
            font-family: 'VT323', monospace;
            scroll-behavior: auto;
        }
        
        .terminal-footer {
            border-top: 2px solid #0f0;
            background: rgba(0, 25, 0, 0.9);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }
        
        .button-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            padding: 10px;
            border-bottom: 2px solid #0f0;
        }
        
        .input-area {
            display: flex;
            padding: 10px;
        }
        
        #command-input {
            flex: 1;
            background: #000;
            border: 2px solid #0f0;
            color: #0f0;
            padding: 10px;
            font-family: 'VT323', monospace;
            font-size: 16px;
        }
        
        #execute-btn {
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 10px 20px;
            margin-left: 10px;
            cursor: pointer;
            font-family: 'Press Start 2P', monospace;
            font-size: 12px;
            min-width: 100px;
            white-space: nowrap;
        }
        
        #execute-btn:hover {
            background: #0f0;
            color: #000;
        }
        
        #execute-btn:active {
            transform: translateY(2px);
        }
        
        /* ========== 8-BIT BUTTON STYLES ========== */
        .pixel-btn {
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 12px 5px;
            cursor: pointer;
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            text-align: center;
            transition: all 0.1s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .pixel-btn:hover {
            background: #0f0;
            color: #000;
            transform: translateY(-2px);
        }
        
        .pixel-btn:active {
            transform: translateY(0);
        }
        
        /* ========== TEXT COLORS ========== */
        .command { color: #0ff; }
        .success { color: #0f0; }
        .error { color: #f00; }
        .warning { color: #ff0; }
        .info { color: #0af; }
        .balance { color: #f0f; }
        .network { color: #ff8000; }
        .hash { color: #0f0; }
        .agent { color: #0ff; }
        .markdown { color: #8f8; }
        
        /* ========== SCROLLBAR ========== */
        #log::-webkit-scrollbar {
            width: 12px;
        }
        
        #log::-webkit-scrollbar-track {
            background: rgba(0, 30, 0, 0.5);
            border: 1px solid #0f0;
        }
        
        #log::-webkit-scrollbar-thumb {
            background: #0f0;
            border: 1px solid #000;
        }
        
        /* ========== MINING INDICATOR ========== */
        .mining-indicator {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 30, 0, 0.95);
            border: 2px solid #ff0;
            padding: 8px 12px;
            font-family: 'Press Start 2P', monospace;
            font-size: 10px;
            display: none;
            z-index: 100;
            box-shadow: 0 0 10px #ff0;
        }
        
        /* ========== MODAL ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: #000;
            border: 4px solid #0f0;
            padding: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            font-family: 'VT323', monospace;
            font-size: 14px;
        }
        
        .modal-content textarea {
            width: 100%;
            height: 300px;
            background: #000;
            color: #0f0;
            border: 2px solid #0f0;
            padding: 10px;
            font-family: 'VT323', monospace;
            font-size: 14px;
            margin: 10px 0;
            resize: none;
        }
        
        /* ========== RESPONSIVE ========== */
        @media (max-width: 768px) {
            .button-bar {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .agent-display {
                grid-template-columns: repeat(2, 1fr);
                height: 200px;
            }
            
            h1 {
                font-size: 14px;
            }
            
            #execute-btn {
                min-width: 80px;
                padding: 10px 15px;
                font-size: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .button-bar {
                grid-template-columns: 1fr;
            }
            
            .agent-display {
                grid-template-columns: 1fr;
                height: 400px;
            }
            
            .header-stats {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .input-area {
                flex-direction: column;
                gap: 10px;
            }
            
            #execute-btn {
                margin-left: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- 8-Bit Terminal Header -->
    <header>
        <div class="header-title">
            <h1>webXOS: TOKEN FORGED</h1>
            <div class="version-badge">v2.0 ∞</div>
        </div>
        <div class="header-stats">
            <div class="stat">NET: <span class="stat-value" id="network-status">AUTO-AUTH</span></div>
            <div class="stat">WALLET: <span class="stat-value" id="wallet-address">0x...</span></div>
            <div class="stat">TOKENS: <span class="stat-value" id="token-count">∞</span></div>
            <div class="stat">HASH/S: <span class="stat-value" id="hash-rate">0</span></div>
            <div class="stat">AGENTS: <span class="stat-value">4/4</span></div>
        </div>
    </header>
    
    <!-- 4-Agent Display -->
    <div class="agent-display" id="agent-display">
        <!-- Agents will be populated here -->
    </div>
    
    <!-- Main 8-Bit Terminal -->
    <div id="terminal-container">
        <div id="terminal">
            <div id="log">
                <p>> webXOS: TOKEN FORGED v2.0</p>
                <p class="success">✓ System: AUTO-AUTHENTICATED</p>
                <p class="agent">[AGENT-1] Initialized: Sequential Network</p>
                <p class="agent">[AGENT-2] Initialized: Convolutional Network</p>
                <p class="agent">[AGENT-3] Initialized: Transformer Network</p>
                <p class="agent">[AGENT-4] Initialized: Modular Network</p>
                <p class="success">✓ 4-Agent System: READY</p>
                <p class="warning">! TOKEN SUPPLY: UNLIMITED ∞</p>
                <p class="info">Type 'help' for commands</p>
            </div>
            
            <!-- Terminal Footer with Buttons and Input -->
            <div class="terminal-footer">
                <div class="button-bar">
                    <button class="pixel-btn" onclick="createNetwork()">CREATE</button>
                    <button class="pixel-btn" onclick="startMining()">MINE</button>
                    <button class="pixel-btn" onclick="stopMining()">STOP</button>
                    <button class="pixel-btn" onclick="exportWallet()">EXPORT</button>
                    <button class="pixel-btn" onclick="importWallet()">IMPORT</button>
                    <button class="pixel-btn" onclick="showBalance()">BALANCE</button>
                    <button class="pixel-btn" onclick="showAgents()">AGENTS</button>
                    <button class="pixel-btn" onclick="clearTerminal()">CLEAR</button>
                </div>
                
                <div class="input-area">
                    <input type="text" id="command-input" placeholder="> Enter command..." autofocus>
                    <button id="execute-btn" onclick="executeCommand()">EXECUTE</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Mining Indicator -->
    <div class="mining-indicator" id="mining-indicator">
        ⚡ MINING: <span id="mining-network">NONE</span>
    </div>
    
    <!-- Export Modal -->
    <div class="modal" id="export-modal">
        <div class="modal-content">
            <h2 style="color:#0f0; margin-bottom:10px;">MARKDOWN WALLET EXPORT</h2>
            <p class="markdown">Exporting in webXOS Markdown format...</p>
            <textarea id="export-text" readonly></textarea>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button onclick="downloadWallet()" style="flex:1; background:#000;color:#0f0;border:2px solid #0f0;padding:10px;cursor:pointer;font-family:'Press Start 2P', monospace;font-size:10px;">
                    DOWNLOAD .MD
                </button>
                <button onclick="closeModal('export-modal')" style="flex:1; background:#000;color:#f00;border:2px solid #f00;padding:10px;cursor:pointer;font-family:'Press Start 2P', monospace;font-size:10px;">
                    CLOSE
                </button>
            </div>
        </div>
    </div>
    
    <!-- Hidden File Input -->
    <input type="file" id="file-input" accept=".md,.txt" style="display: none;">

    <script>
        // ============================================
        // GLOBAL STATE & CONFIGURATION
        // ============================================
        
        const AGENT_TEMPLATES = [
            `# AGENT-1: Sequential
nn.Sequential(
    nn.Linear(128, 64),
    nn.ReLU(),
    nn.Linear(64, 32)
)`,
            `# AGENT-2: Convolutional
nn.Sequential(
    nn.Conv1d(1, 32, 3),
    nn.ReLU(),
    nn.Flatten(),
    nn.Linear(32 * 30, 64)
)`,
            `# AGENT-3: Transformer
nn.TransformerEncoder(
    nn.TransformerEncoderLayer(
        d_model=512,
        nhead=8
    ),
    num_layers=3
)`,
            `# AGENT-4: Modular
class ModularNet(nn.Module):
    def __init__(self):
        super().__init__()
        self.layer1 = nn.Linear(256, 128)
        self.layer2 = nn.Linear(128, 64)
        self.dropout = nn.Dropout(0.2)
    
    def forward(self, x):
        x = F.relu(self.layer1(x))
        x = self.dropout(x)
        return self.layer2(x)`
        ];
        
        let agents = [];
        let wallet = {
            address: null,
            balance: 0,
            tokens: 0,
            hashes: 0,
            networks: [],
            created: Date.now()
        };
        
        let miningActive = false;
        let currentNetwork = null;
        let hashRate = 0;
        let hashInterval = null;
        let hashesThisSecond = 0;
        let lastHashRateUpdate = Date.now();

        // ============================================
        // 4-AGENT SYSTEM
        // ============================================
        
        class Agent {
            constructor(id, template) {
                this.id = id;
                this.name = `AGENT-${String.fromCharCode(65 + id)}`;
                this.template = template;
                this.hash = null;
                this.status = 'idle';
                this.hashRate = 0;
                this.hashesGenerated = 0;
                this.lastHashTime = Date.now();
                
                this.initialize();
            }
            
            async initialize() {
                this.hash = await this.generateHash(this.template);
                this.updateDisplay();
                this.log(`${this.name} initialized`, 'agent');
            }
            
            async generateHash(data) {
                const combined = this.template + data + Date.now() + Math.random();
                const encoder = new TextEncoder();
                const hashBuffer = await crypto.subtle.digest('SHA-256', encoder.encode(combined));
                const hashArray = Array.from(new Uint8Array(hashBuffer));
                
                this.hashesGenerated++;
                this.status = 'mining';
                
                // Update hash rate
                const now = Date.now();
                if (now - this.lastHashTime >= 1000) {
                    this.hashRate = Math.round(this.hashesGenerated / ((now - this.lastHashTime) / 1000));
                    this.lastHashTime = now;
                }
                
                this.hash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                this.updateDisplay();
                
                return this.hash;
            }
            
            updateDisplay() {
                const agentBox = document.querySelector(`[data-agent-id="${this.id}"]`);
                if (!agentBox) return;
                
                const nameEl = agentBox.querySelector('.agent-name');
                const statusEl = agentBox.querySelector('.agent-status');
                const hashEl = agentBox.querySelector('.agent-hash');
                
                if (nameEl) nameEl.textContent = this.name;
                if (statusEl) {
                    statusEl.textContent = this.status.toUpperCase();
                    statusEl.style.color = this.status === 'mining' ? '#ff0' : '#8f8';
                }
                if (hashEl) {
                    hashEl.textContent = this.hash ? `${this.hash.substring(0, 16)}...` : 'GENERATING...';
                }
                
                // Update box style
                if (this.status === 'mining') {
                    agentBox.classList.add('agent-mining');
                } else {
                    agentBox.classList.remove('agent-mining');
                }
            }
            
            getInfo() {
                return {
                    id: this.id,
                    name: this.name,
                    template: this.template,
                    hash: this.hash,
                    status: this.status,
                    hashRate: this.hashRate,
                    hashesGenerated: this.hashesGenerated
                };
            }
            
            log(message, type = '') {
                logEvent(`[${this.name}] ${message}`, type);
            }
        }
        
        // ============================================
        // TERMINAL FUNCTIONS
        // ============================================
        
        function logEvent(message, type = '') {
            const log = document.getElementById('log');
            const p = document.createElement('p');
            p.textContent = message;
            if (type) p.className = type;
            log.appendChild(p);
            // Auto-scroll to bottom
            log.scrollTop = log.scrollHeight;
        }
        
        function clearTerminal() {
            document.getElementById('log').innerHTML = '';
            logEvent('Terminal cleared', 'info');
        }
        
        // ============================================
        // WALLET FUNCTIONS
        // ============================================
        
        function generateAddress() {
            const bytes = crypto.getRandomValues(new Uint8Array(20));
            return '0x' + Array.from(bytes)
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        }
        
        function updateWalletDisplay() {
            document.getElementById('wallet-address').textContent = 
                wallet.address ? `${wallet.address.substring(0, 8)}...` : '0x...';
            document.getElementById('token-count').textContent = wallet.tokens;
            document.getElementById('hash-rate').textContent = hashRate;
        }
        
        // ============================================
        // NETWORK FUNCTIONS
        // ============================================
        
        async function createNetwork() {
            const name = prompt("Enter network name:");
            if (!name) return;
            
            const network = {
                id: generateId(),
                name: name,
                symbol: name.substring(0, 4).toUpperCase(),
                created: Date.now(),
                creator: wallet.address,
                genesisHash: await generateGenesisHash(name),
                agentHashes: [],
                tokens: 0
            };
            
            // Generate agent hashes for this network
            const agentPromises = agents.map(agent =>
                agent.generateHash(`NETWORK-${name}`)
            );
            
            const agentHashes = await Promise.all(agentPromises);
            network.agentHashes = agentHashes;
            
            wallet.networks.push(network);
            currentNetwork = network.id;
            
            logEvent(`Network "${name}" created!`, 'success');
            logEvent(`Symbol: ${network.symbol}`, 'network');
            logEvent(`Genesis Hash: ${network.genesisHash.substring(0, 32)}...`, 'hash');
            logEvent(`Agent validation: 4/4`, 'agent');
            
            saveToLocalStorage();
            return network;
        }
        
        async function generateGenesisHash(name) {
            const encoder = new TextEncoder();
            const data = `${name}-${Date.now()}-${wallet.address}`;
            const hash = await crypto.subtle.digest('SHA-256', encoder.encode(data));
            const hashArray = Array.from(new Uint8Array(hash));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }
        
        // ============================================
        // MINING FUNCTIONS
        // ============================================
        
        async function startMining() {
            if (miningActive) {
                logEvent('Mining already active', 'warning');
                return;
            }
            
            if (!currentNetwork) {
                logEvent('No active network. Create one first.', 'error');
                return;
            }
            
            miningActive = true;
            document.getElementById('mining-indicator').style.display = 'block';
            
            const network = wallet.networks.find(n => n.id === currentNetwork);
            if (network) {
                document.getElementById('mining-network').textContent = network.name;
            }
            
            logEvent('Starting 4-agent mining...', 'info');
            logEvent('Each agent generating hashes...', 'agent');
            
            hashesThisSecond = 0;
            lastHashRateUpdate = Date.now();
            
            hashInterval = setInterval(async () => {
                if (!miningActive) return;
                
                try {
                    // Each agent generates a hash
                    const miningData = `MINING-${Date.now()}-${Math.random()}`;
                    await Promise.all(agents.map(agent => 
                        agent.generateHash(miningData)
                    ));
                    
                    // Award unlimited tokens
                    const reward = 1;
                    wallet.tokens += reward;
                    wallet.balance += reward;
                    wallet.hashes++;
                    hashesThisSecond++;
                    
                    // Update hash rate every second
                    const now = Date.now();
                    if (now - lastHashRateUpdate >= 1000) {
                        hashRate = Math.round((hashesThisSecond * 1000) / (now - lastHashRateUpdate));
                        hashesThisSecond = 0;
                        lastHashRateUpdate = now;
                        updateWalletDisplay();
                        
                        // Show mining status
                        document.getElementById('hash-rate').textContent = hashRate;
                    }
                    
                    // Log every 10 hashes
                    if (wallet.hashes % 10 === 0) {
                        logEvent(`Mined ${wallet.hashes} hashes | Tokens: ∞`, 'hash');
                    }
                    
                    saveToLocalStorage();
                    
                } catch (error) {
                    console.error('Mining error:', error);
                }
            }, 100);
        }
        
        function stopMining() {
            miningActive = false;
            if (hashInterval) {
                clearInterval(hashInterval);
                hashInterval = null;
            }
            
            agents.forEach(agent => {
                agent.status = 'idle';
                agent.updateDisplay();
            });
            
            document.getElementById('mining-indicator').style.display = 'none';
            logEvent('Mining stopped', 'warning');
            logEvent(`Total hashes: ${wallet.hashes}`, 'info');
            logEvent(`Total tokens: ∞`, 'balance');
            
            // Reset hash rate
            hashRate = 0;
            updateWalletDisplay();
        }
        
        // ============================================
        // MARKDOWN WALLET FORMAT
        // ============================================
        
        function exportWallet() {
            const markdown = generateMarkdownWallet();
            
            document.getElementById('export-text').value = markdown;
            document.getElementById('export-modal').style.display = 'flex';
            
            logEvent('Wallet exported in webXOS Markdown format', 'markdown');
        }
        
        function generateMarkdownWallet() {
            let md = `# webXOS: TOKEN FORGED WALLET\n\n`;
            md += `## WALLET INFORMATION\n`;
            md += `- Address: ${wallet.address}\n`;
            md += `- Created: ${new Date(wallet.created).toISOString()}\n`;
            md += `- Balance: ${wallet.balance} tokens\n`;
            md += `- Total Hashes: ${wallet.hashes}\n`;
            md += `- Networks: ${wallet.networks.length}\n\n`;
            
            md += `## 4-AGENT SYSTEM\n`;
            agents.forEach((agent, i) => {
                md += `### ${agent.name}\n`;
                md += `- Status: ${agent.status}\n`;
                md += `- Hashes Generated: ${agent.hashesGenerated}\n`;
                md += `- Current Hash: ${agent.hash}\n`;
                md += `- PyTorch Template:\n\`\`\`python\n${agent.template}\n\`\`\`\n\n`;
            });
            
            md += `## NETWORKS\n`;
            wallet.networks.forEach((network, i) => {
                md += `### Network: ${network.name}\n`;
                md += `- Symbol: ${network.symbol}\n`;
                md += `- Created: ${new Date(network.created).toISOString()}\n`;
                md += `- Genesis Hash: ${network.genesisHash}\n`;
                md += `- Creator: ${network.creator}\n`;
                if (network.agentHashes && network.agentHashes.length > 0) {
                    md += `- Agent Validation: ${network.agentHashes.length}/4\n`;
                }
                md += `\n`;
            });
            
            md += `## SYSTEM INFO\n`;
            md += `- App: webXOS: TOKEN FORGED v2.0\n`;
            md += `- Tokens: UNLIMITED ∞\n`;
            md += `- Agents: 4 PyTorch Networks\n`;
            md += `- Export Date: ${new Date().toISOString()}\n\n`;
            
            md += `## IMPORT INSTRUCTIONS\n`;
            md += `1. Load this .md file in webXOS: TOKEN FORGED\n`;
            md += `2. System will restore wallet and agents\n`;
            md += `3. Continue mining with unlimited tokens\n`;
            
            return md;
        }
        
        function importWallet() {
            document.getElementById('file-input').click();
        }
        
        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    parseMarkdownWallet(content);
                    logEvent('Wallet imported successfully', 'success');
                    logEvent(`Balance: ${wallet.balance} tokens`, 'balance');
                    logEvent(`Networks: ${wallet.networks.length}`, 'network');
                    
                    // Update agents with imported data
                    updateAgentDisplay();
                    saveToLocalStorage();
                    
                } catch (error) {
                    logEvent(`Import failed: ${error.message}`, 'error');
                }
            };
            reader.readAsText(file);
        }
        
        function parseMarkdownWallet(markdown) {
            const lines = markdown.split('\n');
            let inAgent = false;
            let currentAgent = null;
            let agentData = [];
            
            for (let line of lines) {
                line = line.trim();
                
                if (line.startsWith('- Address:')) {
                    wallet.address = line.split(':')[1].trim();
                } else if (line.startsWith('- Balance:')) {
                    wallet.balance = parseInt(line.split(':')[1].trim()) || 0;
                    wallet.tokens = wallet.balance;
                } else if (line.startsWith('- Total Hashes:')) {
                    wallet.hashes = parseInt(line.split(':')[1].trim()) || 0;
                } else if (line.startsWith('### Network:')) {
                    const name = line.split(':')[1].trim();
                    const network = {
                        id: generateId(),
                        name: name,
                        symbol: name.substring(0, 4).toUpperCase(),
                        created: Date.now(),
                        creator: wallet.address,
                        genesisHash: generateId(),
                        tokens: 0
                    };
                    wallet.networks.push(network);
                } else if (line.startsWith('### AGENT-')) {
                    inAgent = true;
                    currentAgent = {
                        name: line.substring(4),
                        template: ''
                    };
                } else if (line.startsWith('```python')) {
                    // Skip
                } else if (line.startsWith('```')) {
                    if (currentAgent) {
                        agentData.push(currentAgent);
                        currentAgent = null;
                    }
                    inAgent = false;
                } else if (inAgent && currentAgent) {
                    currentAgent.template += line + '\n';
                }
            }
            
            updateWalletDisplay();
        }
        
        // ============================================
        // UI FUNCTIONS
        // ============================================
        
        function showBalance() {
            logEvent(`=== WALLET BALANCE ===`, 'command');
            logEvent(`Address: ${wallet.address}`, 'balance');
            logEvent(`Tokens: ∞`, 'balance');
            logEvent(`Hashes: ${wallet.hashes}`, 'hash');
            logEvent(`Networks: ${wallet.networks.length}`, 'network');
            logEvent(`Active Network: ${currentNetwork ? 'YES' : 'NONE'}`, 'network');
        }
        
        function showAgents() {
            logEvent(`=== 4-AGENT SYSTEM ===`, 'command');
            agents.forEach(agent => {
                logEvent(`${agent.name}:`, 'agent');
                logEvent(`  Status: ${agent.status}`, agent.status === 'mining' ? 'warning' : 'info');
                logEvent(`  Hashes: ${agent.hashesGenerated}`, 'hash');
                logEvent(`  Rate: ${agent.hashRate}/s`, 'hash');
                logEvent(`  Current: ${agent.hash ? agent.hash.substring(0, 16) + '...' : 'N/A'}`, 'info');
            });
        }
        
        function updateAgentDisplay() {
            const display = document.getElementById('agent-display');
            display.innerHTML = '';
            
            agents.forEach(agent => {
                const box = document.createElement('div');
                box.className = 'agent-box';
                box.setAttribute('data-agent-id', agent.id);
                box.innerHTML = `
                    <div class="agent-name">${agent.name}</div>
                    <div class="agent-status">${agent.status.toUpperCase()}</div>
                    <div class="agent-hash">${agent.hash ? agent.hash.substring(0, 16) + '...' : 'GENERATING...'}</div>
                `;
                display.appendChild(box);
            });
        }
        
        // ============================================
        // COMMAND SYSTEM
        // ============================================
        
        function executeCommand() {
            const input = document.getElementById('command-input');
            const command = input.value.trim();
            
            if (!command) return;
            
            logEvent(`> ${command}`, 'command');
            input.value = '';
            
            const parts = command.split(' ');
            const action = parts[0].toLowerCase();
            const args = parts.slice(1);
            
            switch (action) {
                case 'help':
                    showHelp();
                    break;
                    
                case 'create':
                    createNetwork();
                    break;
                    
                case 'mine':
                    startMining();
                    break;
                    
                case 'stop':
                    stopMining();
                    break;
                    
                case 'export':
                    exportWallet();
                    break;
                    
                case 'import':
                    importWallet();
                    break;
                    
                case 'balance':
                    showBalance();
                    break;
                    
                case 'agents':
                    showAgents();
                    break;
                    
                case 'clear':
                    clearTerminal();
                    break;
                    
                case 'networks':
                    showNetworks();
                    break;
                    
                case 'void':
                    voidSession();
                    break;
                    
                default:
                    logEvent(`Unknown command: ${action}`, 'error');
                    logEvent("Type 'help' for commands", 'info');
            }
            
            // Keep input focused
            input.focus();
        }
        
        function showHelp() {
            logEvent(`=== webXOS: TOKEN FORGED ===`, 'command');
            logEvent(`create - Create new network`, 'info');
            logEvent(`mine - Start 4-agent mining`, 'info');
            logEvent(`stop - Stop mining`, 'info');
            logEvent(`export - Export markdown wallet`, 'info');
            logEvent(`import - Import markdown wallet`, 'info');
            logEvent(`balance - Show wallet info`, 'info');
            logEvent(`agents - Show agent status`, 'info');
            logEvent(`networks - List networks`, 'info');
            logEvent(`clear - Clear terminal`, 'info');
            logEvent(`void - Clear all data`, 'info');
            logEvent(`help - Show this help`, 'info');
        }
        
        function showNetworks() {
            if (wallet.networks.length === 0) {
                logEvent('No networks created', 'info');
                return;
            }
            
            logEvent(`=== NETWORKS (${wallet.networks.length}) ===`, 'command');
            wallet.networks.forEach((network, i) => {
                logEvent(`${i + 1}. ${network.name}`, 'network');
                logEvent(`   Symbol: ${network.symbol}`, 'info');
                logEvent(`   Created: ${new Date(network.created).toLocaleDateString()}`, 'info');
                logEvent(`   Genesis: ${network.genesisHash.substring(0, 16)}...`, 'hash');
            });
        }
        
        function voidSession() {
            if (!confirm('VOID will clear ALL data. Continue?')) return;
            
            wallet = {
                address: generateAddress(),
                balance: 0,
                tokens: 0,
                hashes: 0,
                networks: [],
                created: Date.now()
            };
            
            currentNetwork = null;
            miningActive = false;
            hashRate = 0;
            
            if (hashInterval) {
                clearInterval(hashInterval);
                hashInterval = null;
            }
            
            agents.forEach(agent => {
                agent.status = 'idle';
                agent.hashesGenerated = 0;
                agent.hashRate = 0;
            });
            
            document.getElementById('mining-indicator').style.display = 'none';
            
            localStorage.removeItem('tokenforged_wallet');
            
            updateWalletDisplay();
            updateAgentDisplay();
            
            logEvent('Session voided. New wallet generated.', 'warning');
            logEvent(`Address: ${wallet.address}`, 'balance');
            logEvent('Tokens: ∞', 'balance');
        }
        
        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        function generateId() {
            const bytes = crypto.getRandomValues(new Uint8Array(16));
            return Array.from(bytes)
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        }
        
        function saveToLocalStorage() {
            try {
                const data = {
                    wallet: wallet,
                    agents: agents.map(a => a.getInfo()),
                    currentNetwork: currentNetwork,
                    timestamp: Date.now()
                };
                localStorage.setItem('tokenforged_wallet', JSON.stringify(data));
            } catch (error) {
                console.error('Save error:', error);
            }
        }
        
        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem('tokenforged_wallet');
                if (!saved) return;
                
                const data = JSON.parse(saved);
                
                if (data.wallet) {
                    wallet = { ...wallet, ...data.wallet };
                }
                
                if (data.currentNetwork) {
                    currentNetwork = data.currentNetwork;
                }
                
                // Update agents with saved data
                if (data.agents && data.agents.length >= 4) {
                    agents.forEach((agent, i) => {
                        if (data.agents[i]) {
                            agent.hash = data.agents[i].hash || agent.hash;
                            agent.status = data.agents[i].status || agent.status;
                            agent.hashesGenerated = data.agents[i].hashesGenerated || 0;
                            agent.hashRate = data.agents[i].hashRate || 0;
                        }
                    });
                }
                
                updateWalletDisplay();
                
            } catch (error) {
                console.error('Load error:', error);
            }
        }
        
        // ============================================
        // INITIALIZATION
        // ============================================
        
        function initialize() {
            // Initialize wallet
            wallet.address = generateAddress();
            
            // Initialize 4 agents
            for (let i = 0; i < 4; i++) {
                const agent = new Agent(i, AGENT_TEMPLATES[i]);
                agents.push(agent);
            }
            
            // Load saved data
            loadFromLocalStorage();
            
            // Update UI
            updateWalletDisplay();
            updateAgentDisplay();
            
            // Set up event listeners
            const commandInput = document.getElementById('command-input');
            commandInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    executeCommand();
                }
            });
            
            // Prevent scrolling on the whole page
            document.addEventListener('touchmove', (e) => {
                e.preventDefault();
            }, { passive: false });
            
            document.getElementById('file-input').addEventListener('change', handleFileImport);
            
            // Auto-scroll log to bottom
            const log = document.getElementById('log');
            const scrollToBottom = () => {
                log.scrollTop = log.scrollHeight;
            };
            
            // Scroll on new content
            const observer = new MutationObserver(scrollToBottom);
            observer.observe(log, { childList: true, subtree: true });
            
            // Focus input
            commandInput.focus();
            
            logEvent('webXOS: TOKEN FORGED initialized', 'success');
            logEvent(`Wallet: ${wallet.address}`, 'balance');
            logEvent('Ready for unlimited token forging', 'info');
        }
        
        // ============================================
        // MODAL FUNCTIONS
        // ============================================
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function downloadWallet() {
            const text = document.getElementById('export-text').value;
            const blob = new Blob([text], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `webxos_wallet_${Date.now()}.md`;
            a.click();
            URL.revokeObjectURL(url);
            
            logEvent('Wallet downloaded as .md file', 'success');
            closeModal('export-modal');
        }
        
        // ============================================
        // GLOBAL EXPORTS
        // ============================================
        
        window.createNetwork = createNetwork;
        window.startMining = startMining;
        window.stopMining = stopMining;
        window.exportWallet = exportWallet;
        window.importWallet = importWallet;
        window.showBalance = showBalance;
        window.showAgents = showAgents;
        window.clearTerminal = clearTerminal;
        
        // Start the application
        window.addEventListener('load', initialize);
    </script>
</body>
</html>