CREATE TABLE IF NOT EXISTS users (
    user_id TEXT PRIMARY KEY,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS api_keys (
    api_key TEXT PRIMARY KEY,
    user_id TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);

CREATE TABLE IF NOT EXISTS roles (
    user_id TEXT,
    role TEXT,
    PRIMARY KEY (user_id, role),
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);

CREATE TABLE IF NOT EXISTS wallets (
    wallet_id TEXT PRIMARY KEY,
    user_id TEXT,
    balance REAL DEFAULT 0.0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);

CREATE TABLE IF NOT EXISTS legacy_data (
    id TEXT PRIMARY KEY,
    content TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

INSERT OR IGNORE INTO users (user_id) VALUES ('user123');
INSERT OR IGNORE INTO roles (user_id, role) VALUES ('user123', 'read:data');
INSERT OR IGNORE INTO roles (user_id, role) VALUES ('user123', 'read:llm');
INSERT OR IGNORE INTO roles (user_id, role) VALUES ('user123', 'write:git');
INSERT OR IGNORE INTO api_keys (api_key, user_id) VALUES ('key123', 'user123');
INSERT OR IGNORE INTO wallets (wallet_id, user_id, balance) VALUES ('wallet123', 'user123', 100.0);
