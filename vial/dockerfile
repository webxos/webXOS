FROM node:20-alpine
WORKDIR /app
COPY package.json .
RUN npm install --production
RUN apk add --no-cache python3 py3-pip
RUN pip install --no-cache-dir fastapi uvicorn python-lzstring
COPY . .
RUN npx esbuild static/bundle.js --bundle --minify --outfile=static/assets/bundle.min.js --tree-shaking=true
EXPOSE 8080
CMD ["node", "src/server.js"]

# Instructions:
# - Builds Node.js server and bundles JavaScript
# - Installs minimal Python dependencies for FastAPI
# - Build: `docker build -t vial-mcp .`
# - Run: `docker-compose up -d`
