<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOS CLONE TERMINAL by webXOS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }
        
        body {
            background-color: #000;
            color: #0f0;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }
        
        /* Classic CRT monitor effect */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15) 0px,
                rgba(0, 0, 0, 0.15) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 1000;
        }
        
        .container {
            display: flex;
            height: 100vh;
            padding: 10px;
            gap: 10px;
        }
        
        /* Main terminal window */
        .terminal-container {
            flex: 3;
            display: flex;
            flex-direction: column;
            background-color: #001100;
            border: 2px solid #0a0;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
            overflow: hidden;
        }
        
        .terminal-header {
            background-color: #002200;
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #0a0;
        }
        
        .terminal-title {
            font-weight: bold;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .terminal-controls {
            display: flex;
            gap: 10px;
        }
        
        .control-btn {
            background: #003300;
            border: 1px solid #0a0;
            color: #0f0;
            width: 25px;
            height: 25px;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .control-btn:hover {
            background: #005500;
        }
        
        .terminal-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            line-height: 1.4;
        }
        
        /* Terminal output styling */
        .terminal-output {
            flex: 1;
            margin-bottom: 10px;
        }
        
        .terminal-line {
            margin-bottom: 5px;
            word-wrap: break-word;
        }
        
        .prompt {
            color: #0f0;
            font-weight: bold;
        }
        
        .command {
            color: #0f0;
        }
        
        .output {
            color: #0f0;
        }
        
        .error {
            color: #f00;
        }
        
        .success {
            color: #0f0;
        }
        
        .info {
            color: #0af;
        }
        
        .warning {
            color: #ff0;
        }
        
        .input-line {
            display: flex;
            align-items: center;
        }
        
        #command-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #0f0;
            font-size: 16px;
            padding: 5px;
            outline: none;
            font-family: 'Courier New', monospace;
        }
        
        .cursor {
            display: inline-block;
            width: 8px;
            height: 16px;
            background-color: #0f0;
            animation: blink 1s infinite;
            margin-left: 2px;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        /* Sidebar with features */
        .sidebar {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .panel {
            background-color: #001100;
            border: 2px solid #0a0;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.2);
        }
        
        .panel-title {
            color: #0f0;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid #0a0;
            padding-bottom: 5px;
        }
        
        /* AI Assistant Panel */
        #ai-response {
            height: 200px;
            overflow-y: auto;
            margin-bottom: 10px;
            font-size: 14px;
            line-height: 1.3;
        }
        
        #ai-input {
            width: 100%;
            background: #002200;
            border: 1px solid #0a0;
            color: #0f0;
            padding: 8px;
            border-radius: 3px;
            margin-bottom: 10px;
        }
        
        .btn {
            background: #003300;
            border: 1px solid #0a0;
            color: #0f0;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background: #005500;
        }
        
        /* Calculator Panel */
        .calc-display {
            background: #002200;
            border: 1px solid #0a0;
            padding: 10px;
            margin-bottom: 10px;
            text-align: right;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            min-height: 40px;
        }
        
        .calc-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
        }
        
        .calc-btn {
            background: #003300;
            border: 1px solid #0a0;
            color: #0f0;
            padding: 10px;
            text-align: center;
            cursor: pointer;
        }
        
        .calc-btn:hover {
            background: #005500;
        }
        
        .calc-btn.operator {
            background: #004400;
        }
        
        .calc-btn.matrix {
            background: #003344;
        }
        
        /* Status Bar */
        .status-bar {
            background-color: #002200;
            border-top: 1px solid #0a0;
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Matrix modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: #001100;
            border: 2px solid #0a0;
            border-radius: 5px;
            padding: 20px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #0a0;
            padding-bottom: 10px;
        }
        
        .matrix-input-grid {
            display: grid;
            gap: 5px;
            margin-bottom: 15px;
        }
        
        .matrix-input {
            background: #002200;
            border: 1px solid #0a0;
            color: #0f0;
            padding: 5px;
            text-align: center;
            width: 100%;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #002200;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #005500;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #007700;
        }
        
        /* Responsive design */
        @media (max-width: 1024px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                flex-direction: row;
            }
            
            .panel {
                flex: 1;
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Main Terminal Window -->
        <div class="terminal-container">
            <div class="terminal-header">
                <div class="terminal-title">
                    <i class="fas fa-terminal"></i>
                    DOS CLONE TERMINAL - by webXOS
                </div>
                <div class="terminal-controls">
                    <div class="control-btn" id="minimize-btn"><i class="fas fa-window-minimize"></i></div>
                    <div class="control-btn" id="maximize-btn"><i class="fas fa-window-maximize"></i></div>
                    <div class="control-btn" id="close-btn"><i class="fas fa-times"></i></div>
                </div>
            </div>
            
            <div class="terminal-body">
                <div class="terminal-output" id="terminal-output">
                    <div class="terminal-line">
                        <span class="prompt">C:\></span> <span class="command">VER</span>
                    </div>
                    <div class="terminal-line output">
                        4HTML by webXOS - Enhanced 4DOS Clone Version 1.0 (Build 2023.10.15)
                    </div>
                    <div class="terminal-line">
                        <span class="prompt">C:\></span> <span class="command">HELP</span>
                    </div>
                    <div class="terminal-line output">
                        Welcome to 4HTML, the web-based 4DOS clone with modern enhancements!
                    </div>
                    <div class="terminal-line output">
                        Available commands: HELP, DIR, CLS, DATE, TIME, CALC, MATRIX, AI, RAG, ABOUT, EXIT
                    </div>
                    <div class="terminal-line output">
                        Type <span class="info">HELP [command]</span> for more information on a specific command.
                    </div>
                    <div class="terminal-line">
                        <span class="prompt">C:\></span> <span class="command">ABOUT</span>
                    </div>
                    <div class="terminal-line output">
                        4HTML recreates the classic 4DOS command-line interpreter with a modern twist.
                        Includes AI assistant (RAG web worker), matrix calculator, and TensorFlow.js capabilities.
                    </div>
                </div>
                
                <div class="input-line">
                    <span class="prompt">C:\></span>
                    <input type="text" id="command-input" autocomplete="off" autofocus>
                    <div class="cursor"></div>
                </div>
            </div>
        </div>
        
        <!-- Sidebar with features -->
        <div class="sidebar">
            <!-- AI Assistant Panel -->
            <div class="panel">
                <div class="panel-title">
                    <i class="fas fa-robot"></i>
                    AI Assistant (RAG Web Worker)
                </div>
                <div id="ai-response">
                    <div class="terminal-line output">
                        AI Assistant initialized. Type your question below or use the /ai command in the terminal.
                    </div>
                    <div class="terminal-line output">
                        I can help with programming questions, calculations, and 4DOS command explanations.
                    </div>
                </div>
                <input type="text" id="ai-input" placeholder="Ask AI assistant...">
                <button class="btn" id="ai-send-btn">
                    <i class="fas fa-paper-plane"></i> Send
                </button>
            </div>
            
            <!-- Calculator Panel -->
            <div class="panel">
                <div class="panel-title">
                    <i class="fas fa-calculator"></i>
                    Matrix Calculator (TensorFlow.js)
                </div>
                <div class="calc-display" id="calc-display">0</div>
                <div class="calc-buttons">
                    <div class="calc-btn" data-action="7">7</div>
                    <div class="calc-btn" data-action="8">8</div>
                    <div class="calc-btn" data-action="9">9</div>
                    <div class="calc-btn operator" data-action="/">/</div>
                    <div class="calc-btn" data-action="4">4</div>
                    <div class="calc-btn" data-action="5">5</div>
                    <div class="calc-btn" data-action="6">6</div>
                    <div class="calc-btn operator" data-action="*">*</div>
                    <div class="calc-btn" data-action="1">1</div>
                    <div class="calc-btn" data-action="2">2</div>
                    <div class="calc-btn" data-action="3">3</div>
                    <div class="calc-btn operator" data-action="-">-</div>
                    <div class="calc-btn" data-action="0">0</div>
                    <div class="calc-btn" data-action=".">.</div>
                    <div class="calc-btn operator" data-action="=">=</div>
                    <div class="calc-btn operator" data-action="+">+</div>
                    <div class="calc-btn matrix" data-action="matrix">Matrix</div>
                    <div class="calc-btn operator" data-action="clear">C</div>
                </div>
            </div>
            
            <!-- Status Panel -->
            <div class="panel">
                <div class="panel-title">
                    <i class="fas fa-microchip"></i>
                    System Status
                </div>
                <div class="terminal-line output">
                    <i class="fas fa-circle" style="color:#0f0; font-size:10px;"></i> RAG Web Worker: <span id="rag-status">Active</span>
                </div>
                <div class="terminal-line output">
                    <i class="fas fa-circle" style="color:#0f0; font-size:10px;"></i> TensorFlow.js: <span id="tf-status">Loaded</span>
                </div>
                <div class="terminal-line output">
                    <i class="fas fa-circle" style="color:#0f0; font-size:10px;"></i> Memory: <span id="memory-status">47%</span>
                </div>
                <div class="terminal-line output">
                    <i class="fas fa-circle" style="color:#0f0; font-size:10px;"></i> Session: <span id="session-status">Active</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-item">
            <i class="fas fa-keyboard"></i>
            <span id="current-command">Ready</span>
        </div>
        <div class="status-item">
            <i class="fas fa-clock"></i>
            <span id="current-time">00:00:00</span>
        </div>
        <div class="status-item">
            <i class="fas fa-bolt"></i>
            <span>4HTML v1.0 | Enhanced 4DOS Clone</span>
        </div>
    </div>
    
    <!-- Matrix Modal -->
    <div class="modal" id="matrix-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Matrix Operations (TensorFlow.js)</h3>
                <button class="btn" id="close-modal">Close</button>
            </div>
            <div class="terminal-line output">
                Create matrices for multiplication or other operations.
            </div>
            
            <div class="terminal-line output">
                <label>Matrix A Dimensions:</label>
                <select id="matrix-a-rows">
                    <option>1</option>
                    <option selected>2</option>
                    <option>3</option>
                    <option>4</option>
                </select>
                x
                <select id="matrix-a-cols">
                    <option selected>2</option>
                    <option>3</option>
                    <option>4</option>
                </select>
            </div>
            
            <div class="matrix-input-grid" id="matrix-a-grid">
                <!-- Dynamically generated matrix inputs -->
            </div>
            
            <div class="terminal-line output">
                <label>Matrix B Dimensions:</label>
                <select id="matrix-b-rows">
                    <option selected>2</option>
                    <option>3</option>
                    <option>4</option>
                </select>
                x
                <select id="matrix-b-cols">
                    <option>1</option>
                    <option selected>2</option>
                    <option>3</option>
                    <option>4</option>
                </select>
            </div>
            
            <div class="matrix-input-grid" id="matrix-b-grid">
                <!-- Dynamically generated matrix inputs -->
            </div>
            
            <button class="btn" id="calculate-matrix">
                <i class="fas fa-calculator"></i> Calculate Matrix Product
            </button>
            
            <div class="terminal-line output" id="matrix-result">
                Result will appear here.
            </div>
        </div>
    </div>

    <!-- Import TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    
    <script>
        // Terminal state and history
        let commandHistory = [];
        let historyIndex = -1;
        let currentDir = "C:\\";
        
        // DOM elements
        const terminalOutput = document.getElementById('terminal-output');
        const commandInput = document.getElementById('command-input');
        const aiResponse = document.getElementById('ai-response');
        const aiInput = document.getElementById('ai-input');
        const aiSendBtn = document.getElementById('ai-send-btn');
        const calcDisplay = document.getElementById('calc-display');
        const calcButtons = document.querySelectorAll('.calc-btn');
        const matrixModal = document.getElementById('matrix-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const calculateMatrixBtn = document.getElementById('calculate-matrix');
        const currentTimeEl = document.getElementById('current-time');
        
        // Initialize the terminal
        function initTerminal() {
            // Update time
            updateTime();
            setInterval(updateTime, 1000);
            
            // Set up command input
            commandInput.addEventListener('keydown', handleCommandInput);
            
            // Set up AI assistant
            aiSendBtn.addEventListener('click', sendAIQuery);
            aiInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') sendAIQuery();
            });
            
            // Set up calculator
            calcButtons.forEach(button => {
                button.addEventListener('click', handleCalcButton);
            });
            
            // Set up matrix modal
            closeModalBtn.addEventListener('click', () => {
                matrixModal.style.display = 'none';
            });
            
            calculateMatrixBtn.addEventListener('click', calculateMatrix);
            
            // Initialize matrix inputs
            updateMatrixInputs('matrix-a-grid', 'matrix-a-rows', 'matrix-a-cols');
            updateMatrixInputs('matrix-b-grid', 'matrix-b-rows', 'matrix-b-cols');
            
            // Add event listeners for matrix dimension changes
            document.getElementById('matrix-a-rows').addEventListener('change', () => {
                updateMatrixInputs('matrix-a-grid', 'matrix-a-rows', 'matrix-a-cols');
            });
            document.getElementById('matrix-a-cols').addEventListener('change', () => {
                updateMatrixInputs('matrix-a-grid', 'matrix-a-rows', 'matrix-a-cols');
            });
            document.getElementById('matrix-b-rows').addEventListener('change', () => {
                updateMatrixInputs('matrix-b-grid', 'matrix-b-rows', 'matrix-b-cols');
            });
            document.getElementById('matrix-b-cols').addEventListener('change', () => {
                updateMatrixInputs('matrix-b-grid', 'matrix-b-rows', 'matrix-b-cols');
            });
            
            // Terminal control buttons
            document.getElementById('minimize-btn').addEventListener('click', () => {
                addTerminalOutput("Minimize functionality simulated.");
            });
            
            document.getElementById('maximize-btn').addEventListener('click', () => {
                addTerminalOutput("Maximize functionality simulated.");
            });
            
            document.getElementById('close-btn').addEventListener('click', () => {
                if (confirm("Are you sure you want to exit 4HTML?")) {
                    addTerminalOutput("Thank you for using 4HTML by webXOS. Goodbye!");
                    setTimeout(() => {
                        document.body.innerHTML = "<div style='color:#0f0; padding:20px;'>Connection terminated. Refresh page to restart 4HTML.</div>";
                    }, 1000);
                }
            });
            
            // Set focus to command input
            commandInput.focus();
            
            // Simulate TensorFlow.js loading
            setTimeout(() => {
                document.getElementById('tf-status').textContent = "Ready for matrix ops";
            }, 1500);
        }
        
        // Update current time
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            currentTimeEl.textContent = timeString;
        }
        
        // Handle terminal command input
        function handleCommandInput(e) {
            if (e.key === 'Enter') {
                const command = commandInput.value.trim();
                if (command) {
                    // Add to history
                    commandHistory.push(command);
                    historyIndex = commandHistory.length;
                    
                    // Display command
                    addTerminalOutput(`<span class="prompt">${currentDir}</span> <span class="command">${command}</span>`);
                    
                    // Process command
                    processCommand(command);
                    
                    // Clear input
                    commandInput.value = '';
                }
            } else if (e.key === 'ArrowUp') {
                // Navigate command history up
                if (commandHistory.length > 0) {
                    historyIndex = Math.max(0, historyIndex - 1);
                    commandInput.value = commandHistory[historyIndex] || '';
                }
                e.preventDefault();
            } else if (e.key === 'ArrowDown') {
                // Navigate command history down
                if (commandHistory.length > 0) {
                    historyIndex = Math.min(commandHistory.length, historyIndex + 1);
                    commandInput.value = commandHistory[historyIndex] || '';
                }
                e.preventDefault();
            }
            
            // Update status bar with current command
            document.getElementById('current-command').textContent = 
                commandInput.value ? `Command: ${commandInput.value}` : 'Ready';
        }
        
        // Process terminal commands
        function processCommand(command) {
            const cmd = command.toLowerCase().split(' ')[0];
            const args = command.split(' ').slice(1);
            
            switch(cmd) {
                case 'help':
                    if (args.length > 0) {
                        showCommandHelp(args[0]);
                    } else {
                        addTerminalOutput("<div class='output'>Available commands:</div>");
                        addTerminalOutput("<div class='output'>  HELP     - Display this help information</div>");
                        addTerminalOutput("<div class='output'>  CLS      - Clear the terminal screen</div>");
                        addTerminalOutput("<div class='output'>  DIR      - List directory contents</div>");
                        addTerminalOutput("<div class='output'>  DATE     - Display current date</div>");
                        addTerminalOutput("<div class='output'>  TIME     - Display current time</div>");
                        addTerminalOutput("<div class='output'>  CALC     - Open the calculator</div>");
                        addTerminalOutput("<div class='output'>  MATRIX   - Open matrix operations panel</div>");
                        addTerminalOutput("<div class='output'>  AI       - Query the AI assistant</div>");
                        addTerminalOutput("<div class='output'>  RAG      - Test RAG web worker functionality</div>");
                        addTerminalOutput("<div class='output'>  ABOUT    - Display information about 4HTML</div>");
                        addTerminalOutput("<div class='output'>  EXIT     - Exit 4HTML terminal</div>");
                    }
                    break;
                    
                case 'cls':
                    clearTerminal();
                    break;
                    
                case 'dir':
                    showDirectory();
                    break;
                    
                case 'date':
                    const date = new Date().toLocaleDateString();
                    addTerminalOutput(`<div class='output'>Current date: ${date}</div>`);
                    break;
                    
                case 'time':
                    const time = new Date().toLocaleTimeString();
                    addTerminalOutput(`<div class='output'>Current time: ${time}</div>`);
                    break;
                    
                case 'calc':
                    addTerminalOutput(`<div class='output'>Opening calculator. Use sidebar panel or type expressions like: CALC 5+3*2</div>`);
                    if (args.length > 0) {
                        const expression = args.join('');
                        try {
                            const result = eval(expression);
                            addTerminalOutput(`<div class='output'>Result: ${expression} = ${result}</div>`);
                        } catch (e) {
                            addTerminalOutput(`<div class='error'>Invalid expression: ${expression}</div>`);
                        }
                    }
                    break;
                    
                case 'matrix':
                    matrixModal.style.display = 'flex';
                    addTerminalOutput(`<div class='output'>Opening matrix operations panel. Use the modal to perform matrix calculations.</div>`);
                    break;
                    
                case 'ai':
                    if (args.length > 0) {
                        const query = args.join(' ');
                        processAIQuery(query, 'terminal');
                    } else {
                        addTerminalOutput(`<div class='output'>Usage: AI [query] - Ask the AI assistant a question</div>`);
                        addTerminalOutput(`<div class='output'>Example: AI how do I multiply matrices in JavaScript?</div>`);
                    }
                    break;
                    
                case 'rag':
                    addTerminalOutput(`<div class='output'>Testing RAG web worker functionality...</div>`);
                    setTimeout(() => {
                        addTerminalOutput(`<div class='output'>RAG worker responded: Simulating retrieval of relevant 4DOS documentation for enhanced command completion.</div>`);
                        addTerminalOutput(`<div class='output'>Worker status: Active with 4DOS command database loaded.</div>`);
                    }, 800);
                    break;
                    
                case 'about':
                    addTerminalOutput(`<div class='output'>4HTML by webXOS - Enhanced 4DOS Clone</div>`);
                    addTerminalOutput(`<div class='output'>A web-based recreation of the classic 4DOS command-line interpreter</div>`);
                    addTerminalOutput(`<div class='output'>with modern AI and computational capabilities.</div>`);
                    addTerminalOutput(`<div class='output'>Features: RAG AI assistant, TensorFlow.js matrix operations,</div>`);
                    addTerminalOutput(`<div class='output'>and classic 4DOS command syntax with enhancements.</div>`);
                    break;
                    
                case 'exit':
                    addTerminalOutput(`<div class='output'>Type EXIT in the terminal controls to close 4HTML.</div>`);
                    break;
                    
                default:
                    addTerminalOutput(`<div class='error'>'${command}' is not recognized as a 4HTML command.</div>`);
                    addTerminalOutput(`<div class='output'>Type HELP for a list of available commands.</div>`);
            }
        }
        
        // Show help for specific command
        function showCommandHelp(cmd) {
            const helpText = {
                'help': 'HELP - Display help information. Usage: HELP [command]',
                'cls': 'CLS - Clear the terminal screen. Usage: CLS',
                'dir': 'DIR - List directory contents. Usage: DIR [path]',
                'date': 'DATE - Display current date. Usage: DATE',
                'time': 'TIME - Display current time. Usage: TIME',
                'calc': 'CALC - Open calculator or evaluate expression. Usage: CALC [expression]',
                'matrix': 'MATRIX - Open matrix operations panel. Usage: MATRIX',
                'ai': 'AI - Query the AI assistant. Usage: AI [question]',
                'rag': 'RAG - Test RAG web worker functionality. Usage: RAG',
                'about': 'ABOUT - Display information about 4HTML. Usage: ABOUT',
                'exit': 'EXIT - Exit 4HTML terminal. Usage: EXIT'
            };
            
            if (helpText[cmd.toLowerCase()]) {
                addTerminalOutput(`<div class='output'>${helpText[cmd.toLowerCase()]}</div>`);
            } else {
                addTerminalOutput(`<div class='error'>No help available for '${cmd}'.</div>`);
            }
        }
        
        // Show directory listing
        function showDirectory() {
            const dirContents = [
                {name: "4DOS", type: "<DIR>", date: "10-15-2023", size: ""},
                {name: "SYSTEM", type: "<DIR>", date: "10-15-2023", size: ""},
                {name: "AI_MODULES", type: "<DIR>", date: "10-15-2023", size: ""},
                {name: "MATRIX_LIB", type: "<DIR>", date: "10-15-2023", size: ""},
                {name: "COMMANDS.TXT", type: "TXT", date: "10-15-2023", size: "4,327"},
                {name: "README.MD", type: "MD", date: "10-15-2023", size: "1,245"},
                {name: "RAG_WORKER.JS", type: "JS", date: "10-15-2023", size: "12,584"},
                {name: "TF_MODEL.BIN", type: "BIN", date: "10-15-2023", size: "3,456,789"},
            ];
            
            addTerminalOutput(`<div class='output'>Directory of ${currentDir}</div>`);
            addTerminalOutput(`<div class='output'></div>`);
            
            dirContents.forEach(item => {
                if (item.type === "<DIR>") {
                    addTerminalOutput(`<div class='output'>${item.date}  ${item.type}      ${item.name}</div>`);
                } else {
                    addTerminalOutput(`<div class='output'>${item.date}        ${item.size.padStart(10)} ${item.name}</div>`);
                }
            });
            
            addTerminalOutput(`<div class='output'>${dirContents.length} file(s)</div>`);
        }
        
        // Clear terminal
        function clearTerminal() {
            terminalOutput.innerHTML = '';
        }
        
        // Add output to terminal
        function addTerminalOutput(html) {
            const line = document.createElement('div');
            line.className = 'terminal-line';
            line.innerHTML = html;
            terminalOutput.appendChild(line);
            terminalOutput.scrollTop = terminalOutput.scrollHeight;
        }
        
        // Handle AI queries
        function sendAIQuery() {
            const query = aiInput.value.trim();
            if (query) {
                processAIQuery(query, 'panel');
                aiInput.value = '';
            }
        }
        
        // Process AI query
        function processAIQuery(query, source) {
            // Simulate AI response with RAG knowledge
            const responses = [
                "Based on my 4DOS documentation, that command would be used for...",
                "I found in the TensorFlow.js documentation that matrix multiplication can be performed using tf.matMul().",
                "In classic 4DOS, you could use enhanced batch file capabilities for that task.",
                "The RAG system suggests looking at the MATRIX command for advanced tensor operations.",
                "4HTML enhances traditional DOS commands with AI capabilities as demonstrated here.",
                "I can help you write a batch file that automates that task in 4HTML.",
                "According to the 4DOS legacy documentation, you might want to use command redirection.",
                "For matrix calculations, you can use the sidebar calculator or the MATRIX command."
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            if (source === 'terminal') {
                addTerminalOutput(`<div class='output'>AI: ${randomResponse}</div>`);
            } else {
                const responseLine = document.createElement('div');
                responseLine.className = 'terminal-line output';
                responseLine.innerHTML = `<span class='prompt'>AI></span> ${randomResponse}`;
                aiResponse.appendChild(responseLine);
                aiResponse.scrollTop = aiResponse.scrollHeight;
            }
            
            // Update status
            document.getElementById('rag-status').textContent = "Processing query...";
            setTimeout(() => {
                document.getElementById('rag-status').textContent = "Active";
            }, 1000);
        }
        
        // Handle calculator buttons
        function handleCalcButton(e) {
            const action = e.target.getAttribute('data-action');
            let currentDisplay = calcDisplay.textContent;
            
            if (action === 'clear') {
                calcDisplay.textContent = '0';
            } else if (action === '=') {
                try {
                    const result = eval(currentDisplay);
                    calcDisplay.textContent = result;
                    
                    // Also show in terminal
                    addTerminalOutput(`<div class='output'>Calculator: ${currentDisplay} = ${result}</div>`);
                } catch (error) {
                    calcDisplay.textContent = 'Error';
                }
            } else if (action === 'matrix') {
                matrixModal.style.display = 'flex';
            } else {
                if (currentDisplay === '0' || currentDisplay === 'Error') {
                    calcDisplay.textContent = action;
                } else {
                    calcDisplay.textContent += action;
                }
            }
        }
        
        // Update matrix input grid
        function updateMatrixInputs(gridId, rowsId, colsId) {
            const rows = parseInt(document.getElementById(rowsId).value);
            const cols = parseInt(document.getElementById(colsId).value);
            const grid = document.getElementById(gridId);
            
            // Clear grid
            grid.innerHTML = '';
            
            // Set grid template
            grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            
            // Create input cells
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'matrix-input';
                    input.value = Math.floor(Math.random() * 10);
                    input.setAttribute('data-row', i);
                    input.setAttribute('data-col', j);
                    grid.appendChild(input);
                }
            }
        }
        
        // Calculate matrix product
        function calculateMatrix() {
            try {
                // Get matrix A values
                const rowsA = parseInt(document.getElementById('matrix-a-rows').value);
                const colsA = parseInt(document.getElementById('matrix-a-cols').value);
                const matrixA = [];
                
                const inputsA = document.querySelectorAll('#matrix-a-grid .matrix-input');
                for (let i = 0; i < rowsA; i++) {
                    matrixA[i] = [];
                    for (let j = 0; j < colsA; j++) {
                        const input = Array.from(inputsA).find(
                            inp => parseInt(inp.getAttribute('data-row')) === i && 
                                   parseInt(inp.getAttribute('data-col')) === j
                        );
                        matrixA[i][j] = parseFloat(input.value) || 0;
                    }
                }
                
                // Get matrix B values
                const rowsB = parseInt(document.getElementById('matrix-b-rows').value);
                const colsB = parseInt(document.getElementById('matrix-b-cols').value);
                const matrixB = [];
                
                const inputsB = document.querySelectorAll('#matrix-b-grid .matrix-input');
                for (let i = 0; i < rowsB; i++) {
                    matrixB[i] = [];
                    for (let j = 0; j < colsB; j++) {
                        const input = Array.from(inputsB).find(
                            inp => parseInt(inp.getAttribute('data-row')) === i && 
                                   parseInt(inp.getAttribute('data-col')) === j
                        );
                        matrixB[i][j] = parseFloat(input.value) || 0;
                    }
                }
                
                // Check if matrices can be multiplied
                if (colsA !== rowsB) {
                    document.getElementById('matrix-result').innerHTML = 
                        `<span class='error'>Error: Columns of A (${colsA}) must equal rows of B (${rowsB}) for multiplication.</span>`;
                    return;
                }
                
                // Perform matrix multiplication using TensorFlow.js
                const tfMatrixA = tf.tensor2d(matrixA);
                const tfMatrixB = tf.tensor2d(matrixB);
                const result = tf.matMul(tfMatrixA, tfMatrixB);
                const resultArray = result.arraySync();
                
                // Display result
                let resultHTML = `<span class='success'>Matrix Product (A Ã— B):</span><br>`;
                resultHTML += `<div style='margin-top:10px; font-family:monospace;'>`;
                
                for (let i = 0; i < resultArray.length; i++) {
                    resultHTML += `[${resultArray[i].map(num => num.toFixed(2)).join(', ')}]<br>`;
                }
                
                resultHTML += `</div>`;
                document.getElementById('matrix-result').innerHTML = resultHTML;
                
                // Clean up tensors
                tf.dispose([tfMatrixA, tfMatrixB, result]);
                
                // Also show in terminal
                addTerminalOutput(`<div class='output'>Matrix multiplication completed. Result: ${rowsA}x${colsB} matrix</div>`);
                
            } catch (error) {
                document.getElementById('matrix-result').innerHTML = 
                    `<span class='error'>Error calculating matrix product: ${error.message}</span>`;
            }
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', initTerminal);
    </script>
</body>
</html>
