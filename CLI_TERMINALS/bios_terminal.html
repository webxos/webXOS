<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced BIOS Terminal - by webXOS</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bios-green: #00ff00;
            --bios-dark: #000f1f;
            --bios-light: #e0e0e0;
            --bios-blue: #0066cc;
            --bios-gray: #333333;
            --bios-yellow: #ffff00;
            --bios-red: #ff3333;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Consolas', 'Courier New', monospace;
        }
        
        body {
            background-color: var(--bios-dark);
            color: var(--bios-green);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.4;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 2px solid var(--bios-green);
            margin-bottom: 30px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            color: var(--bios-green);
            font-size: 2.5rem;
            animation: pulse 2s infinite;
        }
        
        .logo-text {
            font-size: 1.8rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .status-bar {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Main Content */
        .dashboard {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        /* Main Display */
        .main-display {
            background-color: rgba(0, 20, 40, 0.8);
            border: 1px solid var(--bios-green);
            padding: 20px;
            min-height: 400px;
            overflow-y: auto;
        }
        
        .display-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--bios-gray);
        }
        
        .display-title {
            font-size: 1.4rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* BIOS Interface */
        .bios-interface {
            background-color: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border: 1px solid var(--bios-green);
            height: 100%;
            overflow-y: auto;
        }
        
        .bios-menu {
            list-style: none;
            margin-bottom: 30px;
        }
        
        .bios-menu-item {
            padding: 10px 15px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .bios-menu-item:hover, .bios-menu-item.active {
            background-color: rgba(0, 255, 0, 0.1);
            border-left: 3px solid var(--bios-green);
        }
        
        .bios-menu-item i {
            opacity: 0.7;
        }
        
        .bios-output {
            font-size: 0.9rem;
            line-height: 1.5;
            margin-top: 20px;
            max-height: 250px;
            overflow-y: auto;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--bios-gray);
        }
        
        .log-line {
            margin-bottom: 5px;
            padding-left: 10px;
            border-left: 2px solid transparent;
        }
        
        .log-line.info {
            border-left-color: var(--bios-green);
        }
        
        .log-line.warning {
            border-left-color: var(--bios-yellow);
            color: var(--bios-yellow);
        }
        
        .log-line.error {
            border-left-color: var(--bios-red);
            color: var(--bios-red);
        }
        
        .log-line.system {
            border-left-color: var(--bios-blue);
            color: var(--bios-blue);
        }
        
        /* Panels */
        .side-panels {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        
        .panel {
            background-color: rgba(0, 20, 40, 0.8);
            border: 1px solid var(--bios-green);
            padding: 20px;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--bios-gray);
        }
        
        .panel-title {
            font-size: 1.1rem;
            text-transform: uppercase;
        }
        
        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--bios-gray);
        }
        
        .stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        /* Progress bars */
        .progress-container {
            margin-bottom: 15px;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .progress-bar {
            height: 10px;
            background-color: var(--bios-gray);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--bios-green);
            width: 0%;
            transition: width 0.5s;
        }
        
        /* Controls */
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 15px;
            background-color: transparent;
            color: var(--bios-green);
            border: 1px solid var(--bios-green);
            cursor: pointer;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background-color: rgba(0, 255, 0, 0.1);
        }
        
        .btn-primary {
            background-color: rgba(0, 255, 0, 0.1);
        }
        
        .btn-primary:hover {
            background-color: rgba(0, 255, 0, 0.2);
        }
        
        .btn-danger {
            color: var(--bios-red);
            border-color: var(--bios-red);
        }
        
        .btn-danger:hover {
            background-color: rgba(255, 50, 50, 0.1);
        }
        
        /* AI Chat */
        .ai-chat-container {
            display: flex;
            flex-direction: column;
            height: 300px;
        }
        
        .ai-messages {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--bios-gray);
        }
        
        .message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 5px;
            max-width: 80%;
        }
        
        .message.user {
            background-color: rgba(0, 100, 255, 0.2);
            margin-left: auto;
            border: 1px solid var(--bios-blue);
        }
        
        .message.ai {
            background-color: rgba(0, 255, 0, 0.1);
            margin-right: auto;
            border: 1px solid var(--bios-green);
        }
        
        .ai-input-container {
            display: flex;
            gap: 10px;
        }
        
        .ai-input {
            flex-grow: 1;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--bios-green);
            color: var(--bios-light);
        }
        
        /* Footer */
        .footer {
            margin-top: 40px;
            padding: 20px 0;
            border-top: 2px solid var(--bios-green);
            text-align: center;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        /* Animations */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .blink {
            animation: blink 1s infinite;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 20, 40, 0.8);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--bios-green);
        }
        
        /* Keyboard shortcuts help */
        .shortcuts {
            margin-top: 30px;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid var(--bios-gray);
            font-size: 0.8rem;
        }
        
        .shortcuts h3 {
            margin-bottom: 10px;
            color: var(--bios-blue);
        }
        
        .shortcut-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Install PWA button */
        .install-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            background-color: var(--bios-blue);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: none;
            z-index: 100;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .install-btn:hover {
            background-color: #0055aa;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-microchip logo-icon"></i>
                <div class="logo-text">Advanced BIOS Terminal by WEBXOS</div>
            </div>
            <div class="status-bar">
                <div class="status-item">
                    <i class="fas fa-network-wired"></i>
                    <span id="network-status">Online</span>
                </div>
                <div class="status-item">
                    <i class="fas fa-memory"></i>
                    <span id="memory-status">84%</span>
                </div>
                <div class="status-item">
                    <i class="fas fa-robot"></i>
                    <span id="ai-status">Active</span>
                </div>
                <div class="status-item">
                    <i class="fas fa-battery-three-quarters"></i>
                    <span id="battery-status">87%</span>
                </div>
            </div>
        </header>
        
        <!-- Main Dashboard -->
        <main class="dashboard">
            <!-- Main Display -->
            <section class="main-display">
                <div class="display-header">
                    <h2 class="display-title">System Diagnostics</h2>
                    <div class="blink">
                        <i class="fas fa-caret-right"></i> ACTIVE
                    </div>
                </div>
                
                <div class="bios-interface">
                    <ul class="bios-menu">
                        <li class="bios-menu-item active" data-menu="system">
                            <span><i class="fas fa-desktop"></i> System Information</span>
                            <i class="fas fa-chevron-right"></i>
                        </li>
                        <li class="bios-menu-item" data-menu="diagnostics">
                            <span><i class="fas fa-stethoscope"></i> Hardware Diagnostics</span>
                            <i class="fas fa-chevron-right"></i>
                        </li>
                        <li class="bios-menu-item" data-menu="boot">
                            <span><i class="fas fa-power-off"></i> Boot Configuration</span>
                            <i class="fas fa-chevron-right"></i>
                        </li>
                        <li class="bios-menu-item" data-menu="security">
                            <span><i class="fas fa-shield-alt"></i> Security Settings</span>
                            <i class="fas fa-chevron-right"></i>
                        </li>
                        <li class="bios-menu-item" data-menu="performance">
                            <span><i class="fas fa-tachometer-alt"></i> Performance Monitor</span>
                            <i class="fas fa-chevron-right"></i>
                        </li>
                        <li class="bios-menu-item" data-menu="network">
                            <span><i class="fas fa-wifi"></i> Network Configuration</span>
                            <i class="fas fa-chevron-right"></i>
                        </li>
                    </ul>
                    
                    <div class="bios-output" id="bios-output">
                        <!-- BIOS output will be displayed here -->
                    </div>
                    
                    <div class="controls">
                        <button class="btn" id="refresh-btn">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                        <button class="btn btn-primary" id="run-diagnostics-btn">
                            <i class="fas fa-play"></i> Run Diagnostics
                        </button>
                        <button class="btn" id="clear-log-btn">
                            <i class="fas fa-trash"></i> Clear Log
                        </button>
                        <button class="btn btn-danger" id="emergency-btn">
                            <i class="fas fa-exclamation-triangle"></i> Emergency Stop
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- Side Panels -->
            <div class="side-panels">
                <!-- Performance Panel -->
                <div class="panel">
                    <div class="panel-header">
                        <h3 class="panel-title">Performance Monitor</h3>
                        <i class="fas fa-chart-line"></i>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">CPU Usage</div>
                            <div class="stat-value" id="cpu-usage">24%</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Memory Usage</div>
                            <div class="stat-value" id="memory-usage">84%</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Disk I/O</div>
                            <div class="stat-value" id="disk-io">12 MB/s</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Network I/O</div>
                            <div class="stat-value" id="network-io">45 KB/s</div>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>System Load</span>
                            <span id="system-load-value">42%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="system-load-bar"></div>
                        </div>
                    </div>
                    
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Web Worker Load</span>
                            <span id="worker-load-value">18%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="worker-load-bar"></div>
                        </div>
                    </div>
                </div>
                
                <!-- AI Assistant Panel -->
                <div class="panel">
                    <div class="panel-header">
                        <h3 class="panel-title">AI System Assistant</h3>
                        <i class="fas fa-robot"></i>
                    </div>
                    
                    <div class="ai-chat-container">
                        <div class="ai-messages" id="ai-messages">
                            <div class="message ai">
                                <strong>BIOS Assistant:</strong> System initialized. How can I assist with diagnostics or configuration?
                            </div>
                        </div>
                        
                        <div class="ai-input-container">
                            <input type="text" class="ai-input" id="ai-input" placeholder="Ask the AI assistant...">
                            <button class="btn btn-primary" id="ai-send-btn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Keyboard Shortcuts -->
        <div class="shortcuts">
            <h3>Keyboard Shortcuts</h3>
            <div class="shortcut-item">
                <span>Arrow Keys</span>
                <span>Navigate BIOS menu</span>
            </div>
            <div class="shortcut-item">
                <span>Enter</span>
                <span>Select menu item</span>
            </div>
            <div class="shortcut-item">
                <span>ESC</span>
                <span>Go back / Close</span>
            </div>
            <div class="shortcut-item">
                <span>F1</span>
                <span>Show help</span>
            </div>
            <div class="shortcut-item">
                <span>F5</span>
                <span>Refresh diagnostics</span>
            </div>
            <div class="shortcut-item">
                <span>Ctrl+Alt+Del</span>
                <span>Emergency restart</span>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="footer">
            <p>Advanced BIOS PWA | Web Workers: <span id="worker-count">2</span> active | System Uptime: <span id="uptime">00:00:00</span></p>
            <p>Press F1 for help | Use arrow keys to navigate | Enter to select</p>
        </footer>
        
        <!-- Install PWA Button -->
        <button class="install-btn" id="installBtn">
            <i class="fas fa-download"></i> Install App
        </button>
    </div>

    <!-- Web Workers will be created in JavaScript -->
    <script>
        // Main Application Script
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize variables
            let selectedMenuIndex = 0;
            let webWorker;
            let networkWorker;
            let aiWorker;
            let uptimeInterval;
            let performanceInterval;
            let deferredPrompt;
            let workerCount = 2; // Starting with 2 workers
            
            // DOM Elements
            const menuItems = document.querySelectorAll('.bios-menu-item');
            const biosOutput = document.getElementById('bios-output');
            const refreshBtn = document.getElementById('refresh-btn');
            const runDiagnosticsBtn = document.getElementById('run-diagnostics-btn');
            const clearLogBtn = document.getElementById('clear-log-btn');
            const emergencyBtn = document.getElementById('emergency-btn');
            const aiInput = document.getElementById('ai-input');
            const aiSendBtn = document.getElementById('ai-send-btn');
            const aiMessages = document.getElementById('ai-messages');
            const installBtn = document.getElementById('installBtn');
            
            // Status elements
            const networkStatus = document.getElementById('network-status');
            const memoryStatus = document.getElementById('memory-status');
            const aiStatus = document.getElementById('ai-status');
            const batteryStatus = document.getElementById('battery-status');
            const workerCountElement = document.getElementById('worker-count');
            const uptimeElement = document.getElementById('uptime');
            
            // Performance elements
            const cpuUsage = document.getElementById('cpu-usage');
            const memoryUsage = document.getElementById('memory-usage');
            const diskIo = document.getElementById('disk-io');
            const networkIo = document.getElementById('network-io');
            const systemLoadBar = document.getElementById('system-load-bar');
            const systemLoadValue = document.getElementById('system-load-value');
            const workerLoadBar = document.getElementById('worker-load-bar');
            const workerLoadValue = document.getElementById('worker-load-value');
            
            // Initialize the application
            function init() {
                logToBios('Initializing Advanced BIOS PWA...', 'system');
                logToBios('Loading system modules...', 'info');
                
                // Initialize Web Workers
                initWebWorkers();
                
                // Initialize keyboard navigation
                initKeyboardNavigation();
                
                // Initialize event listeners
                initEventListeners();
                
                // Start system monitoring
                startSystemMonitoring();
                
                // Initialize PWA capabilities
                initPWA();
                
                // Initial BIOS output
                simulateBootSequence();
                
                logToBios('System ready. Use arrow keys to navigate, Enter to select.', 'info');
                
                // Update worker count display
                workerCountElement.textContent = workerCount;
            }
            
            // Initialize Web Workers
            function initWebWorkers() {
                try {
                    // Create system diagnostics worker
                    webWorker = new Worker(URL.createObjectURL(
                        new Blob([`
                            // System Diagnostics Web Worker
                            let diagnosticsRunning = false;
                            let performanceData = {
                                cpu: 0,
                                memory: 0,
                                disk: 0,
                                network: 0
                            };
                            
                            // Simulate system diagnostics
                            function runDiagnostics() {
                                diagnosticsRunning = true;
                                
                                // Simulate various checks
                                const checks = [
                                    { name: 'CPU', time: 500, result: 'OK' },
                                    { name: 'Memory', time: 800, result: 'OK' },
                                    { name: 'Storage', time: 1200, result: 'OK' },
                                    { name: 'Network', time: 600, result: 'OK' },
                                    { name: 'Graphics', time: 900, result: 'OK' },
                                    { name: 'Peripherals', time: 400, result: 'OK' }
                                ];
                                
                                checks.forEach((check, index) => {
                                    setTimeout(() => {
                                        performanceData.cpu = Math.floor(Math.random() * 30) + 10;
                                        performanceData.memory = Math.floor(Math.random() * 30) + 60;
                                        performanceData.disk = Math.floor(Math.random() * 20) + 5;
                                        performanceData.network = Math.floor(Math.random() * 50) + 10;
                                        
                                        postMessage({
                                            type: 'diagnostics',
                                            check: check.name,
                                            result: check.result,
                                            performance: {...performanceData}
                                        });
                                        
                                        if (index === checks.length - 1) {
                                            postMessage({
                                                type: 'diagnostics_complete',
                                                performance: {...performanceData}
                                            });
                                            diagnosticsRunning = false;
                                        }
                                    }, check.time);
                                });
                            }
                            
                            // Monitor performance continuously
                            function monitorPerformance() {
                                setInterval(() => {
                                    performanceData.cpu = Math.floor(Math.random() * 10) + 20;
                                    performanceData.memory = Math.floor(Math.random() * 10) + 75;
                                    performanceData.disk = Math.floor(Math.random() * 10) + 8;
                                    performanceData.network = Math.floor(Math.random() * 30) + 20;
                                    
                                    postMessage({
                                        type: 'performance_update',
                                        performance: {...performanceData}
                                    });
                                }, 3000);
                            }
                            
                            // Handle messages from main thread
                            self.onmessage = function(e) {
                                const { command, data } = e.data;
                                
                                switch(command) {
                                    case 'run_diagnostics':
                                        if (!diagnosticsRunning) {
                                            runDiagnostics();
                                        }
                                        break;
                                    case 'get_performance':
                                        postMessage({
                                            type: 'performance_data',
                                            performance: {...performanceData}
                                        });
                                        break;
                                    case 'simulate_load':
                                        // Simulate heavy computation
                                        let result = 0;
                                        for (let i = 0; i < 10000000; i++) {
                                            result += Math.sqrt(i) * Math.random();
                                        }
                                        postMessage({
                                            type: 'load_complete',
                                            result: result
                                        });
                                        break;
                                }
                            };
                            
                            // Start performance monitoring
                            monitorPerformance();
                        `], { type: 'application/javascript' })
                    ));
                    
                    // Create network monitoring worker
                    networkWorker = new Worker(URL.createObjectURL(
                        new Blob([`
                            // Network Monitoring Web Worker
                            let networkStatus = 'online';
                            let latency = 0;
                            let bandwidth = 0;
                            
                            // Simulate network checks
                            function checkNetwork() {
                                // Simulate network latency
                                latency = Math.floor(Math.random() * 100) + 20;
                                
                                // Simulate bandwidth
                                bandwidth = Math.floor(Math.random() * 500) + 100;
                                
                                // Randomly change network status occasionally
                                if (Math.random() > 0.95) {
                                    networkStatus = networkStatus === 'online' ? 'degraded' : 'online';
                                }
                                
                                postMessage({
                                    type: 'network_update',
                                    status: networkStatus,
                                    latency: latency,
                                    bandwidth: bandwidth
                                });
                            }
                            
                            // Handle messages from main thread
                            self.onmessage = function(e) {
                                const { command } = e.data;
                                
                                if (command === 'check_network') {
                                    checkNetwork();
                                }
                            };
                            
                            // Check network periodically
                            setInterval(checkNetwork, 5000);
                        `], { type: 'application/javascript' })
                    ));
                    
                    // Set up worker message handlers
                    webWorker.onmessage = function(e) {
                        handleWorkerMessage(e.data, 'system');
                    };
                    
                    networkWorker.onmessage = function(e) {
                        handleWorkerMessage(e.data, 'network');
                    };
                    
                    logToBios('Web Workers initialized successfully', 'system');
                } catch (error) {
                    logToBios(`Error initializing Web Workers: ${error.message}`, 'error');
                }
            }
            
            // Handle messages from Web Workers
            function handleWorkerMessage(data, workerType) {
                switch(data.type) {
                    case 'diagnostics':
                        logToBios(`${data.check}: ${data.result}`, 'info');
                        updatePerformanceData(data.performance);
                        break;
                        
                    case 'diagnostics_complete':
                        logToBios('System diagnostics completed successfully', 'system');
                        updatePerformanceData(data.performance);
                        break;
                        
                    case 'performance_update':
                        updatePerformanceData(data.performance);
                        break;
                        
                    case 'network_update':
                        updateNetworkStatus(data);
                        break;
                        
                    case 'load_complete':
                        logToBios(`Heavy computation completed: ${data.result.toFixed(2)}`, 'system');
                        break;
                }
            }
            
            // Initialize keyboard navigation
            function initKeyboardNavigation() {
                document.addEventListener('keydown', function(e) {
                    // Handle menu navigation
                    if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        navigateMenu(1);
                    } else if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        navigateMenu(-1);
                    } else if (e.key === 'Enter') {
                        e.preventDefault();
                        selectMenuItem();
                    } else if (e.key === 'Escape') {
                        e.preventDefault();
                        logToBios('Escape pressed. Returning to main menu.', 'info');
                        selectMenuItem(0); // Return to first menu
                    } else if (e.key === 'F1') {
                        e.preventDefault();
                        showHelp();
                    } else if (e.key === 'F5') {
                        e.preventDefault();
                        refreshDiagnostics();
                    } else if (e.ctrlKey && e.altKey && e.key === 'Delete') {
                        e.preventDefault();
                        emergencyRestart();
                    }
                });
            }
            
            // Navigate BIOS menu
            function navigateMenu(direction) {
                // Remove active class from current item
                menuItems[selectedMenuIndex].classList.remove('active');
                
                // Calculate new index
                selectedMenuIndex += direction;
                
                // Ensure index stays within bounds
                if (selectedMenuIndex < 0) selectedMenuIndex = menuItems.length - 1;
                if (selectedMenuIndex >= menuItems.length) selectedMenuIndex = 0;
                
                // Add active class to new item
                menuItems[selectedMenuIndex].classList.add('active');
                
                // Update display based on selected menu
                updateMenuDisplay();
            }
            
            // Select menu item
            function selectMenuItem(index = null) {
                if (index !== null) {
                    selectedMenuIndex = index;
                    menuItems.forEach(item => item.classList.remove('active'));
                    menuItems[selectedMenuIndex].classList.add('active');
                }
                
                const selectedMenu = menuItems[selectedMenuIndex].dataset.menu;
                logToBios(`Selected: ${selectedMenu.toUpperCase()}`, 'system');
                updateMenuDisplay();
            }
            
            // Update display based on selected menu
            function updateMenuDisplay() {
                const selectedMenu = menuItems[selectedMenuIndex].dataset.menu;
                let output = '';
                
                switch(selectedMenu) {
                    case 'system':
                        output = `
                            <div class="log-line system">SYSTEM INFORMATION</div>
                            <div class="log-line info">OS: Advanced BIOS PWA v2.1.4</div>
                            <div class="log-line info">Architecture: Web-based Progressive Web App</div>
                            <div class="log-line info">Web Workers: ${workerCount} active</div>
                            <div class="log-line info">WebAssembly: Available</div>
                            <div class="log-line info">AI Integration: Active (Local LLM)</div>
                            <div class="log-line info">Network: ${networkStatus.textContent}</div>
                            <div class="log-line info">Memory: ${memoryStatus.textContent} available</div>
                        `;
                        break;
                        
                    case 'diagnostics':
                        output = `
                            <div class="log-line system">HARDWARE DIAGNOSTICS</div>
                            <div class="log-line info">CPU: Intel Core i9-13900K (Simulated)</div>
                            <div class="log-line info">Memory: 32GB DDR5 6000MHz</div>
                            <div class="log-line info">Storage: 2TB NVMe SSD</div>
                            <div class="log-line info">Graphics: NVIDIA RTX 4090</div>
                            <div class="log-line info">Network: 10Gb Ethernet + WiFi 6E</div>
                            <div class="log-line warning">Note: These are simulated values for demonstration</div>
                        `;
                        break;
                        
                    case 'boot':
                        output = `
                            <div class="log-line system">BOOT CONFIGURATION</div>
                            <div class="log-line info">Primary Boot: UEFI</div>
                            <div class="log-line info">Secure Boot: Enabled</div>
                            <div class="log-line info">Fast Boot: Enabled</div>
                            <div class="log-line info">Boot Order: [1] NVMe SSD, [2] Network, [3] USB</div>
                            <div class="log-line warning">Use caution when modifying boot settings</div>
                        `;
                        break;
                        
                    case 'security':
                        output = `
                            <div class="log-line system">SECURITY SETTINGS</div>
                            <div class="log-line info">TPM 2.0: Enabled</div>
                            <div class="log-line info">Secure Boot: Active</div>
                            <div class="log-line info">Disk Encryption: AES-256</div>
                            <div class="log-line info">Firewall: Active</div>
                            <div class="log-line info">AI Threat Detection: Enabled</div>
                        `;
                        break;
                        
                    case 'performance':
                        output = `
                            <div class="log-line system">PERFORMANCE MONITOR</div>
                            <div class="log-line info">CPU Usage: ${cpuUsage.textContent}</div>
                            <div class="log-line info">Memory Usage: ${memoryUsage.textContent}</div>
                            <div class="log-line info">Disk I/O: ${diskIo.textContent}</div>
                            <div class="log-line info">Network I/O: ${networkIo.textContent}</div>
                            <div class="log-line info">System Load: ${systemLoadValue.textContent}</div>
                            <div class="log-line info">Web Worker Load: ${workerLoadValue.textContent}</div>
                        `;
                        break;
                        
                    case 'network':
                        output = `
                            <div class="log-line system">NETWORK CONFIGURATION</div>
                            <div class="log-line info">Status: ${networkStatus.textContent}</div>
                            <div class="log-line info">IP Address: 192.168.1.105 (Simulated)</div>
                            <div class="log-line info">Gateway: 192.168.1.1</div>
                            <div class="log-line info">DNS: 8.8.8.8, 1.1.1.1</div>
                            <div class="log-line info">Bandwidth: ${Math.floor(Math.random() * 900) + 100} Mbps</div>
                        `;
                        break;
                }
                
                biosOutput.innerHTML = output;
                biosOutput.scrollTop = biosOutput.scrollHeight;
            }
            
            // Initialize event listeners
            function initEventListeners() {
                // Menu item click events
                menuItems.forEach((item, index) => {
                    item.addEventListener('click', () => {
                        selectedMenuIndex = index;
                        menuItems.forEach(i => i.classList.remove('active'));
                        item.classList.add('active');
                        selectMenuItem();
                    });
                });
                
                // Button click events
                refreshBtn.addEventListener('click', refreshDiagnostics);
                runDiagnosticsBtn.addEventListener('click', runDiagnostics);
                clearLogBtn.addEventListener('click', clearLog);
                emergencyBtn.addEventListener('click', emergencyRestart);
                
                // AI chat functionality
                aiSendBtn.addEventListener('click', sendAIMessage);
                aiInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendAIMessage();
                    }
                });
            }
            
            // Start system monitoring
            function startSystemMonitoring() {
                // Update uptime
                let uptimeSeconds = 0;
                uptimeInterval = setInterval(() => {
                    uptimeSeconds++;
                    const hours = Math.floor(uptimeSeconds / 3600);
                    const minutes = Math.floor((uptimeSeconds % 3600) / 60);
                    const seconds = uptimeSeconds % 60;
                    uptimeElement.textContent = 
                        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }, 1000);
                
                // Update performance metrics
                performanceInterval = setInterval(() => {
                    // Random performance updates (in a real app, these would come from Web Workers)
                    const cpu = Math.floor(Math.random() * 10) + 20;
                    const memory = Math.floor(Math.random() * 5) + 80;
                    const disk = Math.floor(Math.random() * 15) + 10;
                    const network = Math.floor(Math.random() * 40) + 30;
                    
                    cpuUsage.textContent = `${cpu}%`;
                    memoryUsage.textContent = `${memory}%`;
                    diskIo.textContent = `${disk} MB/s`;
                    networkIo.textContent = `${network} KB/s`;
                    
                    // Update progress bars
                    const systemLoad = Math.floor(Math.random() * 30) + 40;
                    systemLoadBar.style.width = `${systemLoad}%`;
                    systemLoadValue.textContent = `${systemLoad}%`;
                    
                    const workerLoad = Math.floor(Math.random() * 20) + 10;
                    workerLoadBar.style.width = `${workerLoad}%`;
                    workerLoadValue.textContent = `${workerLoad}%`;
                    
                    // Update status bar
                    memoryStatus.textContent = `${memory}%`;
                    
                    // Simulate battery drain
                    const battery = Math.max(10, 100 - Math.floor(uptimeSeconds / 60));
                    batteryStatus.textContent = `${battery}%`;
                    
                }, 3000);
            }
            
            // Initialize PWA capabilities
            function initPWA() {
                // Check if browser supports service workers
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('service-worker.js').then(function(registration) {
                        logToBios('Service Worker registered with scope: ' + registration.scope, 'system');
                    }).catch(function(error) {
                        logToBios('Service Worker registration failed: ' + error.message, 'error');
                    });
                }
                
                // Handle PWA installation
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    installBtn.style.display = 'block';
                });
                
                installBtn.addEventListener('click', async () => {
                    if (!deferredPrompt) return;
                    
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    
                    if (outcome === 'accepted') {
                        logToBios('PWA installed successfully', 'system');
                    }
                    
                    deferredPrompt = null;
                    installBtn.style.display = 'none';
                });
                
                // Check if app is already installed
                window.addEventListener('appinstalled', () => {
                    installBtn.style.display = 'none';
                    logToBios('Application installed', 'system');
                });
            }
            
            // Simulate boot sequence
            function simulateBootSequence() {
                const bootMessages = [
                    "Initializing BIOS...",
                    "Testing CPU... OK",
                    "Testing Memory... OK",
                    "Initializing Storage Controller... OK",
                    "Detecting Boot Devices...",
                    "Primary Boot Device: NVMe SSD",
                    "Loading Operating System...",
                    "Starting Web Workers...",
                    "Initializing AI Assistant...",
                    "System Ready"
                ];
                
                let delay = 0;
                bootMessages.forEach((message, index) => {
                    setTimeout(() => {
                        const type = index === bootMessages.length - 1 ? 'system' : 'info';
                        logToBios(message, type);
                        
                        if (index === bootMessages.length - 1) {
                            updateMenuDisplay();
                        }
                    }, delay);
                    
                    delay += 300 + Math.random() * 200;
                });
            }
            
            // Log messages to BIOS output
            function logToBios(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logLine = document.createElement('div');
                logLine.className = `log-line ${type}`;
                logLine.innerHTML = `<span class="timestamp">[${timestamp}]</span> ${message}`;
                
                biosOutput.appendChild(logLine);
                biosOutput.scrollTop = biosOutput.scrollHeight;
            }
            
            // Clear BIOS log
            function clearLog() {
                biosOutput.innerHTML = '';
                logToBios('Log cleared', 'system');
            }
            
            // Refresh diagnostics
            function refreshDiagnostics() {
                logToBios('Refreshing system diagnostics...', 'system');
                
                if (webWorker) {
                    webWorker.postMessage({ command: 'get_performance' });
                }
                
                if (networkWorker) {
                    networkWorker.postMessage({ command: 'check_network' });
                }
                
                // Update display
                updateMenuDisplay();
            }
            
            // Run diagnostics
            function runDiagnostics() {
                logToBios('Starting comprehensive system diagnostics...', 'system');
                
                if (webWorker) {
                    webWorker.postMessage({ command: 'run_diagnostics' });
                } else {
                    logToBios('Web Worker not available. Running simulated diagnostics...', 'warning');
                    
                    // Simulate diagnostics if worker is not available
                    setTimeout(() => {
                        logToBios('CPU: OK', 'info');
                        setTimeout(() => logToBios('Memory: OK', 'info'), 500);
                        setTimeout(() => logToBios('Storage: OK', 'info'), 900);
                        setTimeout(() => logToBios('Network: OK', 'info'), 1200);
                        setTimeout(() => {
                            logToBios('System diagnostics completed', 'system');
                            updatePerformanceData({
                                cpu: 22,
                                memory: 79,
                                disk: 14,
                                network: 38
                            });
                        }, 1500);
                    }, 300);
                }
            }
            
            // Emergency restart
            function emergencyRestart() {
                logToBios('EMERGENCY RESTART INITIATED!', 'error');
                logToBios('Stopping all processes...', 'warning');
                
                // Simulate restart sequence
                setTimeout(() => {
                    biosOutput.innerHTML = '';
                    simulateBootSequence();
                }, 1500);
            }
            
            // Update performance data
            function updatePerformanceData(data) {
                if (data.cpu) cpuUsage.textContent = `${data.cpu}%`;
                if (data.memory) {
                    memoryUsage.textContent = `${data.memory}%`;
                    memoryStatus.textContent = `${data.memory}%`;
                }
                if (data.disk) diskIo.textContent = `${data.disk} MB/s`;
                if (data.network) networkIo.textContent = `${data.network} KB/s`;
                
                // Update system load based on CPU
                const systemLoad = data.cpu || 42;
                systemLoadBar.style.width = `${systemLoad}%`;
                systemLoadValue.textContent = `${systemLoad}%`;
            }
            
            // Update network status
            function updateNetworkStatus(data) {
                networkStatus.textContent = data.status.charAt(0).toUpperCase() + data.status.slice(1);
                networkStatus.style.color = data.status === 'online' ? 'var(--bios-green)' : 
                                           data.status === 'degraded' ? 'var(--bios-yellow)' : 'var(--bios-red)';
                
                networkIo.textContent = `${data.bandwidth} KB/s`;
            }
            
            // Show help
            function showHelp() {
                logToBios('=== HELP: KEYBOARD SHORTCUTS ===', 'system');
                logToBios('Arrow Up/Down: Navigate menu', 'info');
                logToBios('Enter: Select menu item', 'info');
                logToBios('ESC: Go back / Close', 'info');
                logToBios('F1: Show this help', 'info');
                logToBios('F5: Refresh diagnostics', 'info');
                logToBios('Ctrl+Alt+Del: Emergency restart', 'info');
                logToBios('Click menu items or use buttons for actions', 'info');
            }
            
            // AI chat functionality
            function sendAIMessage() {
                const message = aiInput.value.trim();
                if (!message) return;
                
                // Add user message
                const userMessage = document.createElement('div');
                userMessage.className = 'message user';
                userMessage.innerHTML = `<strong>You:</strong> ${message}`;
                aiMessages.appendChild(userMessage);
                
                // Clear input
                aiInput.value = '';
                
                // Scroll to bottom
                aiMessages.scrollTop = aiMessages.scrollHeight;
                
                // Show typing indicator
                const typingIndicator = document.createElement('div');
                typingIndicator.className = 'message ai';
                typingIndicator.id = 'typing-indicator';
                typingIndicator.innerHTML = '<strong>BIOS Assistant:</strong> <span class="blink">Typing...</span>';
                aiMessages.appendChild(typingIndicator);
                aiMessages.scrollTop = aiMessages.scrollHeight;
                
                // Simulate AI processing (in a real app, this would call an AI API)
                setTimeout(() => {
                    // Remove typing indicator
                    const indicator = document.getElementById('typing-indicator');
                    if (indicator) indicator.remove();
                    
                    // Generate AI response
                    const response = generateAIResponse(message);
                    
                    // Add AI response
                    const aiResponse = document.createElement('div');
                    aiResponse.className = 'message ai';
                    aiResponse.innerHTML = `<strong>BIOS Assistant:</strong> ${response}`;
                    aiMessages.appendChild(aiResponse);
                    
                    // Scroll to bottom
                    aiMessages.scrollTop = aiMessages.scrollHeight;
                    
                    // Also log to BIOS if it's a system command
                    if (message.toLowerCase().includes('diagnostic') || 
                        message.toLowerCase().includes('check') || 
                        message.toLowerCase().includes('system')) {
                        logToBios(`AI Assistant: ${response}`, 'info');
                    }
                }, 1000 + Math.random() * 1500);
            }
            
            // Generate AI response (simulated)
            function generateAIResponse(message) {
                const lowerMsg = message.toLowerCase();
                
                if (lowerMsg.includes('hello') || lowerMsg.includes('hi')) {
                    return 'Hello! I am your BIOS AI assistant. How can I help with your system today?';
                } else if (lowerMsg.includes('diagnostic') || lowerMsg.includes('check')) {
                    return 'I can run a system diagnostic for you. The diagnostic will check CPU, memory, storage, and network components. Would you like me to proceed?';
                } else if (lowerMsg.includes('performance') || lowerMsg.includes('slow')) {
                    return 'Based on current metrics, your system is performing within normal parameters. CPU usage is at ' + cpuUsage.textContent + ', memory at ' + memoryUsage.textContent + '.';
                } else if (lowerMsg.includes('boot') || lowerMsg.includes('startup')) {
                    return 'Boot configuration is set to UEFI with secure boot enabled. Average boot time is 8.2 seconds.';
                } else if (lowerMsg.includes('network') || lowerMsg.includes('wifi') || lowerMsg.includes('internet')) {
                    return 'Network status: ' + networkStatus.textContent + '. Connection appears stable. Bandwidth utilization is ' + networkIo.textContent + '.';
                } else if (lowerMsg.includes('memory') || lowerMsg.includes('ram')) {
                    return 'Memory usage is currently ' + memoryUsage.textContent + '. This is within acceptable range. No memory errors detected in recent scans.';
                } else if (lowerMsg.includes('security') || lowerMsg.includes('firewall') || lowerMsg.includes('virus')) {
                    return 'Security status: All protections are active. TPM 2.0 is enabled, secure boot is active, and the AI threat detection system is monitoring for anomalies.';
                } else if (lowerMsg.includes('update') || lowerMsg.includes('upgrade')) {
                    return 'Your BIOS is running version 2.1.4, which is the latest stable release. No updates are currently required.';
                } else if (lowerMsg.includes('worker') || lowerMsg.includes('web worker')) {
                    return 'Web Workers are running optimally. ' + workerCount + ' workers are currently active, handling system diagnostics and network monitoring in the background.';
                } else {
                    const responses = [
                        "I've analyzed your query. For the best assistance, could you provide more details about what you'd like to accomplish?",
                        "I can help with system diagnostics, performance optimization, security settings, and boot configuration. What specific area would you like to address?",
                        "As your BIOS AI assistant, I'm designed to help troubleshoot system issues and optimize performance. Please specify what you'd like me to check.",
                        "I'm detecting your system is running normally. If you're experiencing a specific issue, please describe it and I'll provide targeted assistance."
                    ];
                    return responses[Math.floor(Math.random() * responses.length)];
                }
            }
            
            // Start the application
            init();
        });
    </script>
</body>
</html>
